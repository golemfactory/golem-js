<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Activity module test</title>
    <script src="bundle.js"></script>
</head>
<body>
    <h1>Activity module</h1>
    <h2>Execute Activity Test</h2>
    <button onclick="execute()">execute</button>
    <h4>Result: <b id="execute_activity"></b></h4>
    <h2>Events:</h2>
    <ul id="events">
    </ul>
    <script>
        async function execute() {
            const execute_activity_el = document.getElementById('execute_activity');
            const events_el = document.getElementById('events');

            const activity = new yajsapi.Activity('test_id');

            const appendEvent = (name, data) => {
                const li = document.createElement('li');
                li.appendChild(document.createTextNode(`${name}: ${data || '-'}`));
                events_el.appendChild(li);
            }
            activity.on('StateChanged', (e) => appendEvent('StateChanged', e));
            activity.on('ScriptSent', (e) => appendEvent('ScriptSent', e));
            activity.on('ScriptExecuted', (e) => appendEvent('ScriptExecuted', e));

            const script = new yajsapi.Script(['test_command']);
            const results = await activity.execute(script);
            for await (const result of results) {
                execute_activity_el.innerHTML += result + ', ';
            }
            if (results) execute_activity_el.innerText = 'OK';
        }
    </script>
</body>
</html>
