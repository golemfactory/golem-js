<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Activity module test</title>
    <script src="bundle.js"></script>
</head>
<body>
    <h1>Activity module</h1>
    <h2>Tests:</h2>
    <ol>
        <li>create activity: <b id="create_activity"></b></li>
        <li>execute activity: <b id="execute_activity"></b></li>
        <li>stop activity: <b id="stop_activity"></b></li>
    </ol>
    <h2>Events:</h2>
    <ul id="events">
    </ul>
    <script>
        async function main() {
            const create_activity_el = document.getElementById('create_activity');
            const execute_activity_el = document.getElementById('execute_activity');
            const stop_activity_el = document.getElementById('stop_activity');
            const events_el = document.getElementById('events');

            const activity = new yajsapi.Activity('test_id');
            create_activity_el.innerText = activity ? 'OK' : 'FAILED';

            const appendEvent = (name, data) => {
                const li = document.createElement('li');
                li.appendChild(document.createTextNode(`${name}: ${data}`));
                events_el.appendChild(li);
            }
            activity.on('StateChanged', (e) => appendEvent('StateChanged', e));
            activity.on('ScriptSent', (e) => appendEvent('ScriptSent', e));
            activity.on('ScriptExecuted', (e) => appendEvent('ScriptExecuted', e));

            const script = new yajsapi.Script(['test_command']);
            const results = await activity.execute(script);
            for await (const result of results) {
                execute_activity_el.innerText += result;
            }
            stop_activity_el.innerText = await activity.stop() ? 'OK' : 'FAILED';
        }
        main();
    </script>
</body>
</html>
