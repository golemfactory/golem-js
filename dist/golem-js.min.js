const e=(e,t=!1)=>new Promise((r=>setTimeout(r,e*(t?1:1e3))));class t extends Error{constructor(e,t){super(e),this.previous=t}}class r extends t{}class i extends r{}class n extends r{}class o extends t{}class s extends t{}class a extends t{}class c extends t{constructor(e,t,r){super(e,r),this.code=t}}const u="undefined"!=typeof window&&void 0!==window.document,l="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,h="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name;function d(e){if(u)throw new o(`Feature ${e} is unsupported in the browser.`)}function p(){const e=()=>{};return{child:()=>p(),debug:e,info:e,warn:e,error:e}}var f="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function g(){throw new Error("setTimeout has not been defined")}function v(){throw new Error("clearTimeout has not been defined")}var m=g,y=v;function w(e){if(m===setTimeout)return setTimeout(e,0);if((m===g||!m)&&setTimeout)return m=setTimeout,setTimeout(e,0);try{return m(e,0)}catch(t){try{return m.call(null,e,0)}catch(t){return m.call(this,e,0)}}}"function"==typeof f.setTimeout&&(m=setTimeout),"function"==typeof f.clearTimeout&&(y=clearTimeout);var b,E=[],S=!1,I=-1;function A(){S&&b&&(S=!1,b.length?E=b.concat(E):I=-1,E.length&&P())}function P(){if(!S){var e=w(A);S=!0;for(var t=E.length;t;){for(b=E,E=[];++I<t;)b&&b[I].run();I=-1,t=E.length}b=null,S=!1,function(e){if(y===clearTimeout)return clearTimeout(e);if((y===v||!y)&&clearTimeout)return y=clearTimeout,clearTimeout(e);try{return y(e)}catch(t){try{return y.call(null,e)}catch(t){return y.call(this,e)}}}(e)}}function T(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];E.push(new R(e,t)),1!==E.length||S||w(P)}function R(e,t){this.fun=e,this.array=t}R.prototype.run=function(){this.fun.apply(null,this.array)};function O(){}var C=O,N=O,k=O,_=O,x=O,D=O,F=O;var q=f.performance||{},B=q.now||q.mozNow||q.msNow||q.oNow||q.webkitNow||function(){return(new Date).getTime()};var j=new Date;var $={nextTick:T,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:C,addListener:N,once:k,off:_,removeListener:x,removeAllListeners:D,emit:F,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*B.call(q),r=Math.floor(t),i=Math.floor(t%1*1e9);return e&&(r-=e[0],(i-=e[1])<0&&(r--,i+=1e9)),[r,i]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-j)/1e3}},M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function L(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function V(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})})),r}var U,H,z={exports:{}};function W(){if(H)return U;H=1;var e=1e3,t=60*e,r=60*t,i=24*r,n=7*i,o=365.25*i;function s(e,t,r,i){var n=t>=1.5*r;return Math.round(e/r)+" "+i+(n?"s":"")}return U=function(a,c){c=c||{};var u=typeof a;if("string"===u&&a.length>0)return function(s){if((s=String(s)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*n;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(a);if("number"===u&&isFinite(a))return c.long?function(n){var o=Math.abs(n);if(o>=i)return s(n,o,i,"day");if(o>=r)return s(n,o,r,"hour");if(o>=t)return s(n,o,t,"minute");if(o>=e)return s(n,o,e,"second");return n+" ms"}(a):function(n){var o=Math.abs(n);if(o>=i)return Math.round(n/i)+"d";if(o>=r)return Math.round(n/r)+"h";if(o>=t)return Math.round(n/t)+"m";if(o>=e)return Math.round(n/e)+"s";return n+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}}var G=function(e){function t(e){let i,n,o,s=null;function a(...e){if(!a.enabled)return;const r=a,n=Number(new Date),o=n-(i||n);r.diff=o,r.prev=i,r.curr=n,i=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((i,n)=>{if("%%"===i)return"%";s++;const o=t.formatters[n];if("function"==typeof o){const t=e[s];i=o.call(r,t),e.splice(s,1),s--}return i})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(n!==t.namespaces&&(n=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const i=t(this.namespace+(void 0===r?":":r)+e);return i.log=this.log,i}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=W(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t};!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==$&&"env"in $&&(e=$.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=G(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(z,z.exports);var Y=L(z.exports);function K(e,t={disableAutoPrefix:!1}){const r=function(e,t){return t||e.startsWith("golem-js:")?e:`golem-js:${e}`}(e,t.disableAutoPrefix),i=Y(r);function n(e,t,r){r?i(`[${e}] ${t} %o`,r):i(`[${e}] ${t}`)}return{child:e=>K(`${r}:${e}`,t),info:function(e,t){n("INFO",e,t)},error:function(e,t){n("ERROR",e,t)},warn:function(e,t){n("WARN",e,t)},debug:function(e,t){n("DEBUG",e,t)}}}function J(){return(l?null===process||void 0===process?void 0:process.env.YAGNA_API_URL:"")||"http://127.0.0.1:7465"}function X(){var e;return l&&null!==(e=null===process||void 0===process?void 0:process.env.YAGNA_APPKEY)&&void 0!==e?e:""}function Q(){var e;return l&&null!==(e=null===process||void 0===process?void 0:process.env.YAGNA_SUBNET)&&void 0!==e?e:"public"}function Z(){var e;return l&&null!==(e=null===process||void 0===process?void 0:process.env.GOLEM_REGISTRY_URL)&&void 0!==e?e:"https://registry.golem.network"}function ee(){var e;return l&&null!==(e=process.env.PAYMENT_NETWORK)&&void 0!==e?e:"holesky"}function te(){return!!l&&"true"===(null===process||void 0===process?void 0:process.env.GOLEM_DEV_MODE)}var re=Object.freeze({__proto__:null,getPaymentNetwork:ee,getRepoUrl:Z,getYagnaApiUrl:J,getYagnaAppKey:X,getYagnaSubnet:Q,isDevMode:te}),ie={},ne={},oe={},se={},ae={};Object.defineProperty(ae,"__esModule",{value:!0}),ae.BaseHttpRequest=void 0;ae.BaseHttpRequest=class{constructor(e){this.config=e}};var ce=[],ue=[],le="undefined"!=typeof Uint8Array?Uint8Array:Array,he=!1;function de(){he=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)ce[t]=e[t],ue[e.charCodeAt(t)]=t;ue["-".charCodeAt(0)]=62,ue["_".charCodeAt(0)]=63}function pe(e,t,r){for(var i,n,o=[],s=t;s<r;s+=3)i=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(ce[(n=i)>>18&63]+ce[n>>12&63]+ce[n>>6&63]+ce[63&n]);return o.join("")}function fe(e){var t;he||de();for(var r=e.length,i=r%3,n="",o=[],s=16383,a=0,c=r-i;a<c;a+=s)o.push(pe(e,a,a+s>c?c:a+s));return 1===i?(t=e[r-1],n+=ce[t>>2],n+=ce[t<<4&63],n+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],n+=ce[t>>10],n+=ce[t>>4&63],n+=ce[t<<2&63],n+="="),o.push(n),o.join("")}function ge(e,t,r,i,n){var o,s,a=8*n-i-1,c=(1<<a)-1,u=c>>1,l=-7,h=r?n-1:0,d=r?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+h],h+=d,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=i;l>0;s=256*s+e[t+h],h+=d,l-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=u}return(p?-1:1)*s*Math.pow(2,o-i)}function ve(e,t,r,i,n,o){var s,a,c,u=8*o-n-1,l=(1<<u)-1,h=l>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(t*c-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;e[r+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,u+=n;u>0;e[r+p]=255&s,p+=f,s/=256,u-=8);e[r+p-f]|=128*g}var me={}.toString,ye=Array.isArray||function(e){return"[object Array]"==me.call(e)};function we(){return Ee.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function be(e,t){if(we()<t)throw new RangeError("Invalid typed array length");return Ee.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Ee.prototype:(null===e&&(e=new Ee(t)),e.length=t),e}function Ee(e,t,r){if(!(Ee.TYPED_ARRAY_SUPPORT||this instanceof Ee))return new Ee(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Ae(this,e)}return Se(this,e,t,r)}function Se(e,t,r,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,i){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,r):new Uint8Array(t,r,i);Ee.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Ee.prototype:e=Pe(e,t);return e}(e,t,r,i):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!Ee.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=0|Oe(t,r);e=be(e,i);var n=e.write(t,r);n!==i&&(e=e.slice(0,n));return e}(e,t,r):function(e,t){if(Re(t)){var r=0|Te(t.length);return 0===(e=be(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?be(e,0):Pe(e,t);if("Buffer"===t.type&&ye(t.data))return Pe(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Ie(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Ae(e,t){if(Ie(t),e=be(e,t<0?0:0|Te(t)),!Ee.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function Pe(e,t){var r=t.length<0?0:0|Te(t.length);e=be(e,r);for(var i=0;i<r;i+=1)e[i]=255&t[i];return e}function Te(e){if(e>=we())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+we().toString(16)+" bytes");return 0|e}function Re(e){return!(null==e||!e._isBuffer)}function Oe(e,t){if(Re(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return tt(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return rt(e).length;default:if(i)return tt(e).length;t=(""+t).toLowerCase(),i=!0}}function Ce(e,t,r){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return He(this,t,r);case"utf8":case"utf-8":return Me(this,t,r);case"ascii":return Ve(this,t,r);case"latin1":case"binary":return Ue(this,t,r);case"base64":return $e(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ze(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function Ne(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function ke(e,t,r,i,n){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=Ee.from(t,i)),Re(t))return 0===t.length?-1:_e(e,t,r,i,n);if("number"==typeof t)return t&=255,Ee.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):_e(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function _e(e,t,r,i,n){var o,s=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(n){var l=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var h=!0,d=0;d<c;d++)if(u(e,o+d)!==u(t,d)){h=!1;break}if(h)return o}return-1}function xe(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function De(e,t,r,i){return it(tt(t,e.length-r),e,r,i)}function Fe(e,t,r,i){return it(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}function qe(e,t,r,i){return Fe(e,t,r,i)}function Be(e,t,r,i){return it(rt(t),e,r,i)}function je(e,t,r,i){return it(function(e,t){for(var r,i,n,o=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(r=e.charCodeAt(s))>>8,n=r%256,o.push(n),o.push(i);return o}(t,e.length-r),e,r,i)}function $e(e,t,r){return 0===t&&r===e.length?fe(e):fe(e.slice(t,r))}function Me(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var o,s,a,c,u=e[n],l=null,h=u>239?4:u>223?3:u>191?2:1;if(n+h<=r)switch(h){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[n+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,h=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),n+=h}return function(e){var t=e.length;if(t<=Le)return String.fromCharCode.apply(String,e);var r="",i=0;for(;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=Le));return r}(i)}Ee.TYPED_ARRAY_SUPPORT=void 0===f.TYPED_ARRAY_SUPPORT||f.TYPED_ARRAY_SUPPORT,we(),Ee.poolSize=8192,Ee._augment=function(e){return e.__proto__=Ee.prototype,e},Ee.from=function(e,t,r){return Se(null,e,t,r)},Ee.TYPED_ARRAY_SUPPORT&&(Ee.prototype.__proto__=Uint8Array.prototype,Ee.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Ee[Symbol.species]),Ee.alloc=function(e,t,r){return function(e,t,r,i){return Ie(t),t<=0?be(e,t):void 0!==r?"string"==typeof i?be(e,t).fill(r,i):be(e,t).fill(r):be(e,t)}(null,e,t,r)},Ee.allocUnsafe=function(e){return Ae(null,e)},Ee.allocUnsafeSlow=function(e){return Ae(null,e)},Ee.isBuffer=nt,Ee.compare=function(e,t){if(!Re(e)||!Re(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,n=0,o=Math.min(r,i);n<o;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},Ee.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Ee.concat=function(e,t){if(!ye(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Ee.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var i=Ee.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var o=e[r];if(!Re(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,n),n+=o.length}return i},Ee.byteLength=Oe,Ee.prototype._isBuffer=!0,Ee.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Ne(this,t,t+1);return this},Ee.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Ne(this,t,t+3),Ne(this,t+1,t+2);return this},Ee.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Ne(this,t,t+7),Ne(this,t+1,t+6),Ne(this,t+2,t+5),Ne(this,t+3,t+4);return this},Ee.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Me(this,0,e):Ce.apply(this,arguments)},Ee.prototype.equals=function(e){if(!Re(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Ee.compare(this,e)},Ee.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Ee.prototype.compare=function(e,t,r,i,n){if(!Re(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(i>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(i,n),u=e.slice(t,r),l=0;l<a;++l)if(c[l]!==u[l]){o=c[l],s=u[l];break}return o<s?-1:s<o?1:0},Ee.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Ee.prototype.indexOf=function(e,t,r){return ke(this,e,t,r,!0)},Ee.prototype.lastIndexOf=function(e,t,r){return ke(this,e,t,r,!1)},Ee.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-t;if((void 0===r||r>n)&&(r=n),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return xe(this,e,t,r);case"utf8":case"utf-8":return De(this,e,t,r);case"ascii":return Fe(this,e,t,r);case"latin1":case"binary":return qe(this,e,t,r);case"base64":return Be(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return je(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},Ee.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Le=4096;function Ve(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}function Ue(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}function He(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var n="",o=t;o<r;++o)n+=et(e[o]);return n}function ze(e,t,r){for(var i=e.slice(t,r),n="",o=0;o<i.length;o+=2)n+=String.fromCharCode(i[o]+256*i[o+1]);return n}function We(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function Ge(e,t,r,i,n,o){if(!Re(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function Ye(e,t,r,i){t<0&&(t=65535+t+1);for(var n=0,o=Math.min(e.length-r,2);n<o;++n)e[r+n]=(t&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function Ke(e,t,r,i){t<0&&(t=4294967295+t+1);for(var n=0,o=Math.min(e.length-r,4);n<o;++n)e[r+n]=t>>>8*(i?n:3-n)&255}function Je(e,t,r,i,n,o){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Xe(e,t,r,i,n){return n||Je(e,0,r,4),ve(e,t,r,i,23,4),r+4}function Qe(e,t,r,i,n){return n||Je(e,0,r,8),ve(e,t,r,i,52,8),r+8}Ee.prototype.slice=function(e,t){var r,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),Ee.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Ee.prototype;else{var n=t-e;r=new Ee(n,void 0);for(var o=0;o<n;++o)r[o]=this[o+e]}return r},Ee.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||We(e,t,this.length);for(var i=this[e],n=1,o=0;++o<t&&(n*=256);)i+=this[e+o]*n;return i},Ee.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||We(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},Ee.prototype.readUInt8=function(e,t){return t||We(e,1,this.length),this[e]},Ee.prototype.readUInt16LE=function(e,t){return t||We(e,2,this.length),this[e]|this[e+1]<<8},Ee.prototype.readUInt16BE=function(e,t){return t||We(e,2,this.length),this[e]<<8|this[e+1]},Ee.prototype.readUInt32LE=function(e,t){return t||We(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Ee.prototype.readUInt32BE=function(e,t){return t||We(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Ee.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||We(e,t,this.length);for(var i=this[e],n=1,o=0;++o<t&&(n*=256);)i+=this[e+o]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},Ee.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||We(e,t,this.length);for(var i=t,n=1,o=this[e+--i];i>0&&(n*=256);)o+=this[e+--i]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*t)),o},Ee.prototype.readInt8=function(e,t){return t||We(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Ee.prototype.readInt16LE=function(e,t){t||We(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Ee.prototype.readInt16BE=function(e,t){t||We(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Ee.prototype.readInt32LE=function(e,t){return t||We(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Ee.prototype.readInt32BE=function(e,t){return t||We(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Ee.prototype.readFloatLE=function(e,t){return t||We(e,4,this.length),ge(this,e,!0,23,4)},Ee.prototype.readFloatBE=function(e,t){return t||We(e,4,this.length),ge(this,e,!1,23,4)},Ee.prototype.readDoubleLE=function(e,t){return t||We(e,8,this.length),ge(this,e,!0,52,8)},Ee.prototype.readDoubleBE=function(e,t){return t||We(e,8,this.length),ge(this,e,!1,52,8)},Ee.prototype.writeUIntLE=function(e,t,r,i){(e=+e,t|=0,r|=0,i)||Ge(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,o=0;for(this[t]=255&e;++o<r&&(n*=256);)this[t+o]=e/n&255;return t+r},Ee.prototype.writeUIntBE=function(e,t,r,i){(e=+e,t|=0,r|=0,i)||Ge(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,o=1;for(this[t+n]=255&e;--n>=0&&(o*=256);)this[t+n]=e/o&255;return t+r},Ee.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,1,255,0),Ee.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Ee.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,2,65535,0),Ee.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ye(this,e,t,!0),t+2},Ee.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,2,65535,0),Ee.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ye(this,e,t,!1),t+2},Ee.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,4,4294967295,0),Ee.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Ke(this,e,t,!0),t+4},Ee.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,4,4294967295,0),Ee.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ke(this,e,t,!1),t+4},Ee.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);Ge(this,e,t,r,n-1,-n)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s|0)-a&255;return t+r},Ee.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);Ge(this,e,t,r,n-1,-n)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s|0)-a&255;return t+r},Ee.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,1,127,-128),Ee.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Ee.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,2,32767,-32768),Ee.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ye(this,e,t,!0),t+2},Ee.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,2,32767,-32768),Ee.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ye(this,e,t,!1),t+2},Ee.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,4,2147483647,-2147483648),Ee.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Ke(this,e,t,!0),t+4},Ee.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||Ge(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Ee.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ke(this,e,t,!1),t+4},Ee.prototype.writeFloatLE=function(e,t,r){return Xe(this,e,t,!0,r)},Ee.prototype.writeFloatBE=function(e,t,r){return Xe(this,e,t,!1,r)},Ee.prototype.writeDoubleLE=function(e,t,r){return Qe(this,e,t,!0,r)},Ee.prototype.writeDoubleBE=function(e,t,r){return Qe(this,e,t,!1,r)},Ee.prototype.copy=function(e,t,r,i){if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var n,o=i-r;if(this===e&&r<t&&t<i)for(n=o-1;n>=0;--n)e[n+t]=this[n+r];else if(o<1e3||!Ee.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},Ee.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!Ee.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=Re(e)?e:tt(new Ee(e,i).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var Ze=/[^+\/0-9A-Za-z-_]/g;function et(e){return e<16?"0"+e.toString(16):e.toString(16)}function tt(e,t){var r;t=t||1/0;for(var i=e.length,n=null,o=[],s=0;s<i;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function rt(e){return function(e){var t,r,i,n,o,s;he||de();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new le(3*a/4-o),i=o>0?a-4:a;var c=0;for(t=0,r=0;t<i;t+=4,r+=3)n=ue[e.charCodeAt(t)]<<18|ue[e.charCodeAt(t+1)]<<12|ue[e.charCodeAt(t+2)]<<6|ue[e.charCodeAt(t+3)],s[c++]=n>>16&255,s[c++]=n>>8&255,s[c++]=255&n;return 2===o?(n=ue[e.charCodeAt(t)]<<2|ue[e.charCodeAt(t+1)]>>4,s[c++]=255&n):1===o&&(n=ue[e.charCodeAt(t)]<<10|ue[e.charCodeAt(t+1)]<<4|ue[e.charCodeAt(t+2)]>>2,s[c++]=n>>8&255,s[c++]=255&n),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Ze,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function it(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}function nt(e){return null!=e&&(!!e._isBuffer||ot(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&ot(e.slice(0,0))}(e))}function ot(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var st={},at={};Object.defineProperty(at,"__esModule",{value:!0}),at.ApiError=void 0;let ct=class extends Error{constructor(e,t,r){super(r),this.name="ApiError",this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.body=t.body,this.request=e}};at.ApiError=ct;var ut,lt,ht,dt,pt,ft,gt,vt={},mt=M&&M.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},yt=M&&M.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(vt,"__esModule",{value:!0}),vt.CancelablePromise=vt.CancelError=void 0;let wt=class extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}};vt.CancelError=wt;let bt=class{constructor(e){ut.set(this,void 0),lt.set(this,void 0),ht.set(this,void 0),dt.set(this,void 0),pt.set(this,void 0),ft.set(this,void 0),gt.set(this,void 0),mt(this,ut,!1,"f"),mt(this,lt,!1,"f"),mt(this,ht,!1,"f"),mt(this,dt,[],"f"),mt(this,pt,new Promise(((t,r)=>{mt(this,ft,t,"f"),mt(this,gt,r,"f");const i=e=>{yt(this,ut,"f")||yt(this,lt,"f")||yt(this,ht,"f")||yt(this,dt,"f").push(e)};return Object.defineProperty(i,"isResolved",{get:()=>yt(this,ut,"f")}),Object.defineProperty(i,"isRejected",{get:()=>yt(this,lt,"f")}),Object.defineProperty(i,"isCancelled",{get:()=>yt(this,ht,"f")}),e((e=>{yt(this,ut,"f")||yt(this,lt,"f")||yt(this,ht,"f")||(mt(this,ut,!0,"f"),yt(this,ft,"f")&&yt(this,ft,"f").call(this,e))}),(e=>{yt(this,ut,"f")||yt(this,lt,"f")||yt(this,ht,"f")||(mt(this,lt,!0,"f"),yt(this,gt,"f")&&yt(this,gt,"f").call(this,e))}),i)})),"f")}get[(ut=new WeakMap,lt=new WeakMap,ht=new WeakMap,dt=new WeakMap,pt=new WeakMap,ft=new WeakMap,gt=new WeakMap,Symbol.toStringTag)](){return"Cancellable Promise"}then(e,t){return yt(this,pt,"f").then(e,t)}catch(e){return yt(this,pt,"f").catch(e)}finally(e){return yt(this,pt,"f").finally(e)}cancel(){if(!(yt(this,ut,"f")||yt(this,lt,"f")||yt(this,ht,"f"))){if(mt(this,ht,!0,"f"),yt(this,dt,"f").length)try{for(const e of yt(this,dt,"f"))e()}catch(e){return void console.warn("Cancellation threw an error",e)}yt(this,dt,"f").length=0,yt(this,gt,"f")&&yt(this,gt,"f").call(this,new wt("Request aborted"))}}get isCancelled(){return yt(this,ht,"f")}};vt.CancelablePromise=bt,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=e.catchErrorCodes=e.getResponseBody=e.getResponseHeader=e.sendRequest=e.getRequestBody=e.getHeaders=e.resolve=e.getFormData=e.getQueryString=e.base64=e.isFormData=e.isBlob=e.isStringWithValue=e.isString=e.isDefined=void 0;const t=at,r=vt;e.isDefined=e=>null!=e;e.isString=e=>"string"==typeof e;e.isStringWithValue=t=>(0,e.isString)(t)&&""!==t;e.isBlob=e=>"object"==typeof e&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.arrayBuffer&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]);e.isFormData=e=>e instanceof FormData;e.base64=e=>{try{return btoa(e)}catch(t){return Ee.from(e).toString("base64")}};e.getQueryString=t=>{const r=[],i=(t,n)=>{(0,e.isDefined)(n)&&(Array.isArray(n)?n.forEach((e=>{i(t,e)})):"object"==typeof n?Object.entries(n).forEach((([e,r])=>{i(`${t}[${e}]`,r)})):((e,t)=>{r.push(`${encodeURIComponent(e)}=${encodeURIComponent(String(t))}`)})(t,n))};return Object.entries(t).forEach((([e,t])=>{i(e,t)})),r.length>0?`?${r.join("&")}`:""};e.getFormData=t=>{if(t.formData){const r=new FormData,i=(t,i)=>{(0,e.isString)(i)||(0,e.isBlob)(i)?r.append(t,i):r.append(t,JSON.stringify(i))};return Object.entries(t.formData).filter((([t,r])=>(0,e.isDefined)(r))).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>i(e,t))):i(e,t)})),r}};e.resolve=async(e,t)=>"function"==typeof t?t(e):t;e.getHeaders=async(t,r)=>{const[i,n,o,s]=await Promise.all([(0,e.resolve)(r,t.TOKEN),(0,e.resolve)(r,t.USERNAME),(0,e.resolve)(r,t.PASSWORD),(0,e.resolve)(r,t.HEADERS)]),a=Object.entries({Accept:"application/json",...s,...r.headers}).filter((([t,r])=>(0,e.isDefined)(r))).reduce(((e,[t,r])=>({...e,[t]:String(r)})),{});if((0,e.isStringWithValue)(i)&&(a.Authorization=`Bearer ${i}`),(0,e.isStringWithValue)(n)&&(0,e.isStringWithValue)(o)){const t=(0,e.base64)(`${n}:${o}`);a.Authorization=`Basic ${t}`}return void 0!==r.body&&(r.mediaType?a["Content-Type"]=r.mediaType:(0,e.isBlob)(r.body)?a["Content-Type"]=r.body.type||"application/octet-stream":(0,e.isString)(r.body)?a["Content-Type"]="text/plain":(0,e.isFormData)(r.body)||(a["Content-Type"]="application/json")),new Headers(a)};e.getRequestBody=t=>{if(void 0!==t.body)return t.mediaType?.includes("/json")?JSON.stringify(t.body):(0,e.isString)(t.body)||(0,e.isBlob)(t.body)||(0,e.isFormData)(t.body)?t.body:JSON.stringify(t.body)};e.sendRequest=async(e,t,r,i,n,o,s)=>{const a=new AbortController,c={headers:o,body:i??n,method:t.method,signal:a.signal};return e.WITH_CREDENTIALS&&(c.credentials=e.CREDENTIALS),s((()=>a.abort())),await fetch(r,c)};e.getResponseHeader=(t,r)=>{if(r){const i=t.headers.get(r);if((0,e.isString)(i))return i}};e.getResponseBody=async e=>{if(204!==e.status)try{const t=e.headers.get("Content-Type");if(t){return["application/json","application/problem+json"].some((e=>t.toLowerCase().startsWith(e)))?await e.json():await e.text()}}catch(e){console.error(e)}};e.catchErrorCodes=(e,r)=>{const i={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[r.status];if(i)throw new t.ApiError(e,r,i);if(!r.ok){const i=r.status??"unknown",n=r.statusText??"unknown",o=(()=>{try{return JSON.stringify(r.body,null,2)}catch(e){return}})();throw new t.ApiError(e,r,`Generic Error: status: ${i}; status text: ${n}; body: ${o}`)}};e.request=(t,i)=>new r.CancelablePromise((async(r,n,o)=>{try{const n=((t,r)=>{const i=t.ENCODE_PATH||encodeURI,n=r.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((e,t)=>r.path?.hasOwnProperty(t)?i(String(r.path[t])):e)),o=`${t.BASE}${n}`;return r.query?`${o}${(0,e.getQueryString)(r.query)}`:o})(t,i),s=(0,e.getFormData)(i),a=(0,e.getRequestBody)(i),c=await(0,e.getHeaders)(t,i);if(!o.isCancelled){const u=await(0,e.sendRequest)(t,i,n,a,s,c,o),l=await(0,e.getResponseBody)(u),h=(0,e.getResponseHeader)(u,i.responseHeader),d={url:n,ok:u.ok,status:u.status,statusText:u.statusText,body:h??l};(0,e.catchErrorCodes)(i,d),r(d.body)}}catch(e){n(e)}}))}(st),Object.defineProperty(se,"__esModule",{value:!0}),se.FetchHttpRequest=void 0;const Et=ae,St=st;let It=class extends Et.BaseHttpRequest{constructor(e){super(e)}request(e){return(0,St.request)(this.config,e)}};se.FetchHttpRequest=It;var At={};Object.defineProperty(At,"__esModule",{value:!0}),At.ProviderService=void 0;At.ProviderService=class{constructor(e){this.httpRequest=e}getOffers(){return this.httpRequest.request({method:"GET",url:"/offers",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}subscribeOffer(e){return this.httpRequest.request({method:"POST",url:"/offers",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}unsubscribeOffer(e){return this.httpRequest.request({method:"DELETE",url:"/offers/{subscriptionId}",path:{subscriptionId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Already unsubscribed."}})}collectDemands(e,t=5,r=10){return this.httpRequest.request({method:"GET",url:"/offers/{subscriptionId}/events",path:{subscriptionId:e},query:{timeout:t,maxEvents:r},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}queryReplyOffers(e,t,r){return this.httpRequest.request({method:"POST",url:"/offers/{subscriptionId}/propertyQuery/{queryId}",path:{subscriptionId:e,queryId:t},body:r,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}getProposalDemand(e,t){return this.httpRequest.request({method:"GET",url:"/offers/{subscriptionId}/proposals/{proposalId}",path:{subscriptionId:e,proposalId:t},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Proposal rejected."}})}counterProposalOffer(e,t,r){return this.httpRequest.request({method:"POST",url:"/offers/{subscriptionId}/proposals/{proposalId}",path:{subscriptionId:e,proposalId:t},body:r,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Proposal rejected."}})}rejectProposalDemand(e,t,r){return this.httpRequest.request({method:"POST",url:"/offers/{subscriptionId}/proposals/{proposalId}/reject",path:{subscriptionId:e,proposalId:t},body:r,mediaType:"application/json",errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Proposal already rejected."}})}listAgreements(e,t,r,i){return this.httpRequest.request({method:"GET",url:"/agreements",query:{appSessionId:e,state:t,afterDate:r,beforeDate:i},errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}getAgreement(e){return this.httpRequest.request({method:"GET",url:"/agreements/{agreementId}",path:{agreementId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}collectAgreementEvents(e=5,t,r=10,i){return this.httpRequest.request({method:"GET",url:"/agreementEvents",query:{timeout:e,afterTimestamp:t,maxEvents:r,appSessionId:i},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}approveAgreement(e,t,r=5){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/approve",path:{agreementId:e},query:{appSessionId:t,timeout:r},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",408:"Agreement not approved within given timeout. Try again.",410:"Agreement approval failed permanently.\n                                        Attached `ErrorMessage` contains further details:\n                                        - `Rejected` - Indicates that the Provider himself has already\n                                        called `rejectAgreement`.\n                                        - `Cancelled` - Indicates that before Provider approved this Agreement,\n                                        the Requestor has called `cancelAgreement`, thus invalidating the\n                                        Agreement. The Provider may attempt to return to the Negotiation phase\n                                        by sending a new Proposal.\n                                        - `Expired` - Indicates that Agreement validity period elapsed and it was\n                                        not approved, rejected nor cancelled.\n                                        - `Terminated` - Indicates that Agreement is already terminated.\n                                        "}})}rejectAgreement(e,t){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/reject",path:{agreementId:e},body:t,mediaType:"application/json",errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Agreement rejection failed permanently.\n                                        Attached `ErrorMessage` contains further details:\n                                        - `Rejected` - Indicates that the Provider himself has already\n                                        called `rejectAgreement`.\n                                        - `Cancelled` - Indicates that before Provider rejected this Agreement,\n                                        the Requestor has called `cancelAgreement`, thus invalidating the\n                                        Agreement. The Provider may attempt to return to the Negotiation phase\n                                        by sending a new Proposal.\n                                        - `Expired` - Indicates that Agreement validity period elapsed and it was\n                                        not approved, rejected nor cancelled.\n                                        - `Terminated` - Indicates that Agreement is already terminated.\n                                        "}})}terminateAgreement(e,t){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/terminate",path:{agreementId:e},body:t,mediaType:"application/json",errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",409:"Agreement can not be terminated yet (is in `Proposal` or `Pending` state).",410:"Agreement termination failed permanently.\n                                        Attached `ErrorMessage` contains further details:\n                                        - `Rejected` - Indicates that the Provider has rejected this Agreement.\n                                        - `Cancelled` - Indicates the Requestor has called cancelled this Agreement.\n                                        - `Expired` - Indicates that Agreement validity period elapsed and it was\n                                        not approved, rejected nor cancelled.\n                                        - `Terminated` - Indicates that Agreement is already terminated.\n                                        "}})}getTerminateAgreementReason(e){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/terminate/reason",path:{agreementId:e},errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}};var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.RequestorService=void 0;Pt.RequestorService=class{constructor(e){this.httpRequest=e}beginScan(e){return this.httpRequest.request({method:"POST",url:"/scan",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}collectScanResults(e,t=5,r=10,i){return this.httpRequest.request({method:"GET",url:"/scan/{subscriptionId}/events",path:{subscriptionId:e},query:{timeout:t,maxEvents:r,peerId:i},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}endScan(e){return this.httpRequest.request({method:"DELETE",url:"/scan/{subscriptionId}",path:{subscriptionId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}getDemands(){return this.httpRequest.request({method:"GET",url:"/demands",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}subscribeDemand(e){return this.httpRequest.request({method:"POST",url:"/demands",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}unsubscribeDemand(e){return this.httpRequest.request({method:"DELETE",url:"/demands/{subscriptionId}",path:{subscriptionId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Already unsubscribed."}})}collectOffers(e,t=5,r=10){return this.httpRequest.request({method:"GET",url:"/demands/{subscriptionId}/events",path:{subscriptionId:e},query:{timeout:t,maxEvents:r},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}queryReplyDemands(e,t,r){return this.httpRequest.request({method:"POST",url:"/demands/{subscriptionId}/propertyQuery/{queryId}",path:{subscriptionId:e,queryId:t},body:r,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}getProposalOffer(e,t){return this.httpRequest.request({method:"GET",url:"/demands/{subscriptionId}/proposals/{proposalId}",path:{subscriptionId:e,proposalId:t},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Proposal rejected."}})}counterProposalDemand(e,t,r){return this.httpRequest.request({method:"POST",url:"/demands/{subscriptionId}/proposals/{proposalId}",path:{subscriptionId:e,proposalId:t},body:r,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Proposal rejected."}})}rejectProposalOffer(e,t,r){return this.httpRequest.request({method:"POST",url:"/demands/{subscriptionId}/proposals/{proposalId}/reject",path:{subscriptionId:e,proposalId:t},body:r,mediaType:"application/json",errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Proposal already rejected."}})}listAgreements(e,t,r,i){return this.httpRequest.request({method:"GET",url:"/agreements",query:{appSessionId:e,state:t,afterDate:r,beforeDate:i},errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}createAgreement(e){return this.httpRequest.request({method:"POST",url:"/agreements",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",409:"Proposal not negotiated yet (in `Initial` state).",410:"Proposal rejected or expired."}})}getAgreement(e){return this.httpRequest.request({method:"GET",url:"/agreements/{agreementId}",path:{agreementId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}cancelAgreement(e,t){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/cancel",path:{agreementId:e},body:t,mediaType:"application/json",errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Agreement not in `Proposal` nor `Pending` state."}})}confirmAgreement(e,t){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/confirm",path:{agreementId:e},query:{appSessionId:t},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"Agreement not in `Proposal` state."}})}waitForApproval(e,t=5){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/wait",path:{agreementId:e},query:{timeout:t},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",408:"Agreement not approved within given timeout. Try again.",409:"Agreement not confirmed yet by Requestor himself.",410:"Agreement is not approved. This state is permanent.\n                                            Attached `ErrorMessage` contains further details:\n                                            - `Rejected` - Indicates that the Provider has called\n                                            `rejectAgreement`, which effectively stops the Agreement handshake.\n                                            The Requestor may attempt to return to the Negotiation phase by\n                                            sending a new Proposal or to the Agreement phase by creating\n                                            new Agreement.\n                                            - `Cancelled` - Indicates that the Requestor himself has called\n                                            `cancelAgreement`, which effectively stops the Agreement handshake.\n                                            - `Expired` - Indicates that Agreement validity period elapsed and it\n                                            was not approved, rejected nor cancelled.\n                                            - `Terminated` - Indicates that Agreement is already terminated.\n                                            "}})}collectAgreementEvents(e=5,t,r=10,i){return this.httpRequest.request({method:"GET",url:"/agreementEvents",query:{timeout:e,afterTimestamp:t,maxEvents:r,appSessionId:i},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}terminateAgreement(e,t){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/terminate",path:{agreementId:e},body:t,mediaType:"application/json",errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",409:"Agreement can not be terminated yet (is in `Proposal` or `Pending` state).",410:"Agreement termination failed permanently.\n                                            Attached `ErrorMessage` contains further details:\n                                            - `Rejected` - Indicates that the Provider has rejected this Agreement.\n                                            - `Cancelled` - Indicates the Requestor has called cancelled this Agreement.\n                                            - `Expired` - Indicates that Agreement validity period elapsed and it was\n                                            not approved, rejected nor cancelled.\n                                            - `Terminated` - Indicates that Agreement is already terminated.\n                                            "}})}getTerminateAgreementReason(e){return this.httpRequest.request({method:"POST",url:"/agreements/{agreementId}/terminate/reason",path:{agreementId:e},errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}},Object.defineProperty(oe,"__esModule",{value:!0}),oe.Client=void 0;const Tt=se,Rt=At,Ot=Pt;oe.Client=class{constructor(e,t=Tt.FetchHttpRequest){this.request=new t({BASE:e?.BASE??"/market-api/v1",VERSION:e?.VERSION??"1.7.0",WITH_CREDENTIALS:e?.WITH_CREDENTIALS??!1,CREDENTIALS:e?.CREDENTIALS??"include",TOKEN:e?.TOKEN,USERNAME:e?.USERNAME,PASSWORD:e?.PASSWORD,HEADERS:e?.HEADERS,ENCODE_PATH:e?.ENCODE_PATH}),this.provider=new Rt.ProviderService(this.request),this.requestor=new Ot.RequestorService(this.request)}};var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.OpenAPI=void 0,Ct.OpenAPI={BASE:"/market-api/v1",VERSION:"1.7.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FetchHttpRequest=e.RequestorService=e.ProviderService=e.OpenAPI=e.CancelError=e.CancelablePromise=e.BaseHttpRequest=e.ApiError=e.Client=void 0;var t=oe;Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return t.Client}});var r=at;Object.defineProperty(e,"ApiError",{enumerable:!0,get:function(){return r.ApiError}});var i=ae;Object.defineProperty(e,"BaseHttpRequest",{enumerable:!0,get:function(){return i.BaseHttpRequest}});var n=vt;Object.defineProperty(e,"CancelablePromise",{enumerable:!0,get:function(){return n.CancelablePromise}}),Object.defineProperty(e,"CancelError",{enumerable:!0,get:function(){return n.CancelError}});var o=Ct;Object.defineProperty(e,"OpenAPI",{enumerable:!0,get:function(){return o.OpenAPI}});var s=At;Object.defineProperty(e,"ProviderService",{enumerable:!0,get:function(){return s.ProviderService}});var a=Pt;Object.defineProperty(e,"RequestorService",{enumerable:!0,get:function(){return a.RequestorService}});var c=se;Object.defineProperty(e,"FetchHttpRequest",{enumerable:!0,get:function(){return c.FetchHttpRequest}})}(ne);var Nt={},kt={},_t={},xt={};Object.defineProperty(xt,"__esModule",{value:!0}),xt.BaseHttpRequest=void 0;xt.BaseHttpRequest=class{constructor(e){this.config=e}};var Dt={},Ft={};Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.ApiError=void 0;let qt=class extends Error{constructor(e,t,r){super(r),this.name="ApiError",this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.body=t.body,this.request=e}};Ft.ApiError=qt;var Bt,jt,$t,Mt,Lt,Vt,Ut,Ht={},zt=M&&M.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},Wt=M&&M.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.CancelablePromise=Ht.CancelError=void 0;let Gt=class extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}};Ht.CancelError=Gt;let Yt=class{constructor(e){Bt.set(this,void 0),jt.set(this,void 0),$t.set(this,void 0),Mt.set(this,void 0),Lt.set(this,void 0),Vt.set(this,void 0),Ut.set(this,void 0),zt(this,Bt,!1,"f"),zt(this,jt,!1,"f"),zt(this,$t,!1,"f"),zt(this,Mt,[],"f"),zt(this,Lt,new Promise(((t,r)=>{zt(this,Vt,t,"f"),zt(this,Ut,r,"f");const i=e=>{Wt(this,Bt,"f")||Wt(this,jt,"f")||Wt(this,$t,"f")||Wt(this,Mt,"f").push(e)};return Object.defineProperty(i,"isResolved",{get:()=>Wt(this,Bt,"f")}),Object.defineProperty(i,"isRejected",{get:()=>Wt(this,jt,"f")}),Object.defineProperty(i,"isCancelled",{get:()=>Wt(this,$t,"f")}),e((e=>{Wt(this,Bt,"f")||Wt(this,jt,"f")||Wt(this,$t,"f")||(zt(this,Bt,!0,"f"),Wt(this,Vt,"f")&&Wt(this,Vt,"f").call(this,e))}),(e=>{Wt(this,Bt,"f")||Wt(this,jt,"f")||Wt(this,$t,"f")||(zt(this,jt,!0,"f"),Wt(this,Ut,"f")&&Wt(this,Ut,"f").call(this,e))}),i)})),"f")}get[(Bt=new WeakMap,jt=new WeakMap,$t=new WeakMap,Mt=new WeakMap,Lt=new WeakMap,Vt=new WeakMap,Ut=new WeakMap,Symbol.toStringTag)](){return"Cancellable Promise"}then(e,t){return Wt(this,Lt,"f").then(e,t)}catch(e){return Wt(this,Lt,"f").catch(e)}finally(e){return Wt(this,Lt,"f").finally(e)}cancel(){if(!(Wt(this,Bt,"f")||Wt(this,jt,"f")||Wt(this,$t,"f"))){if(zt(this,$t,!0,"f"),Wt(this,Mt,"f").length)try{for(const e of Wt(this,Mt,"f"))e()}catch(e){return void console.warn("Cancellation threw an error",e)}Wt(this,Mt,"f").length=0,Wt(this,Ut,"f")&&Wt(this,Ut,"f").call(this,new Gt("Request aborted"))}}get isCancelled(){return Wt(this,$t,"f")}};Ht.CancelablePromise=Yt,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=e.catchErrorCodes=e.getResponseBody=e.getResponseHeader=e.sendRequest=e.getRequestBody=e.getHeaders=e.resolve=e.getFormData=e.getQueryString=e.base64=e.isFormData=e.isBlob=e.isStringWithValue=e.isString=e.isDefined=void 0;const t=Ft,r=Ht;e.isDefined=e=>null!=e;e.isString=e=>"string"==typeof e;e.isStringWithValue=t=>(0,e.isString)(t)&&""!==t;e.isBlob=e=>"object"==typeof e&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.arrayBuffer&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]);e.isFormData=e=>e instanceof FormData;e.base64=e=>{try{return btoa(e)}catch(t){return Ee.from(e).toString("base64")}};e.getQueryString=t=>{const r=[],i=(t,n)=>{(0,e.isDefined)(n)&&(Array.isArray(n)?n.forEach((e=>{i(t,e)})):"object"==typeof n?Object.entries(n).forEach((([e,r])=>{i(`${t}[${e}]`,r)})):((e,t)=>{r.push(`${encodeURIComponent(e)}=${encodeURIComponent(String(t))}`)})(t,n))};return Object.entries(t).forEach((([e,t])=>{i(e,t)})),r.length>0?`?${r.join("&")}`:""};e.getFormData=t=>{if(t.formData){const r=new FormData,i=(t,i)=>{(0,e.isString)(i)||(0,e.isBlob)(i)?r.append(t,i):r.append(t,JSON.stringify(i))};return Object.entries(t.formData).filter((([t,r])=>(0,e.isDefined)(r))).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>i(e,t))):i(e,t)})),r}};e.resolve=async(e,t)=>"function"==typeof t?t(e):t;e.getHeaders=async(t,r)=>{const[i,n,o,s]=await Promise.all([(0,e.resolve)(r,t.TOKEN),(0,e.resolve)(r,t.USERNAME),(0,e.resolve)(r,t.PASSWORD),(0,e.resolve)(r,t.HEADERS)]),a=Object.entries({Accept:"application/json",...s,...r.headers}).filter((([t,r])=>(0,e.isDefined)(r))).reduce(((e,[t,r])=>({...e,[t]:String(r)})),{});if((0,e.isStringWithValue)(i)&&(a.Authorization=`Bearer ${i}`),(0,e.isStringWithValue)(n)&&(0,e.isStringWithValue)(o)){const t=(0,e.base64)(`${n}:${o}`);a.Authorization=`Basic ${t}`}return void 0!==r.body&&(r.mediaType?a["Content-Type"]=r.mediaType:(0,e.isBlob)(r.body)?a["Content-Type"]=r.body.type||"application/octet-stream":(0,e.isString)(r.body)?a["Content-Type"]="text/plain":(0,e.isFormData)(r.body)||(a["Content-Type"]="application/json")),new Headers(a)};e.getRequestBody=t=>{if(void 0!==t.body)return t.mediaType?.includes("/json")?JSON.stringify(t.body):(0,e.isString)(t.body)||(0,e.isBlob)(t.body)||(0,e.isFormData)(t.body)?t.body:JSON.stringify(t.body)};e.sendRequest=async(e,t,r,i,n,o,s)=>{const a=new AbortController,c={headers:o,body:i??n,method:t.method,signal:a.signal};return e.WITH_CREDENTIALS&&(c.credentials=e.CREDENTIALS),s((()=>a.abort())),await fetch(r,c)};e.getResponseHeader=(t,r)=>{if(r){const i=t.headers.get(r);if((0,e.isString)(i))return i}};e.getResponseBody=async e=>{if(204!==e.status)try{const t=e.headers.get("Content-Type");if(t){return["application/json","application/problem+json"].some((e=>t.toLowerCase().startsWith(e)))?await e.json():await e.text()}}catch(e){console.error(e)}};e.catchErrorCodes=(e,r)=>{const i={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[r.status];if(i)throw new t.ApiError(e,r,i);if(!r.ok){const i=r.status??"unknown",n=r.statusText??"unknown",o=(()=>{try{return JSON.stringify(r.body,null,2)}catch(e){return}})();throw new t.ApiError(e,r,`Generic Error: status: ${i}; status text: ${n}; body: ${o}`)}};e.request=(t,i)=>new r.CancelablePromise((async(r,n,o)=>{try{const n=((t,r)=>{const i=t.ENCODE_PATH||encodeURI,n=r.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((e,t)=>r.path?.hasOwnProperty(t)?i(String(r.path[t])):e)),o=`${t.BASE}${n}`;return r.query?`${o}${(0,e.getQueryString)(r.query)}`:o})(t,i),s=(0,e.getFormData)(i),a=(0,e.getRequestBody)(i),c=await(0,e.getHeaders)(t,i);if(!o.isCancelled){const u=await(0,e.sendRequest)(t,i,n,a,s,c,o),l=await(0,e.getResponseBody)(u),h=(0,e.getResponseHeader)(u,i.responseHeader),d={url:n,ok:u.ok,status:u.status,statusText:u.statusText,body:h??l};(0,e.catchErrorCodes)(i,d),r(d.body)}}catch(e){n(e)}}))}(Dt),Object.defineProperty(_t,"__esModule",{value:!0}),_t.FetchHttpRequest=void 0;const Kt=xt,Jt=Dt;let Xt=class extends Kt.BaseHttpRequest{constructor(e){super(e)}request(e){return(0,Jt.request)(this.config,e)}};_t.FetchHttpRequest=Xt;var Qt={};Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.ProviderService=void 0;Qt.ProviderService=class{constructor(e){this.httpRequest=e}getActivityAgreement(e){return this.httpRequest.request({method:"GET",url:"/activity/{activityId}/agreement",path:{activityId:e},errors:{400:"(400) Bad request",403:"(403) Forbidden.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}collectActivityEvents(e,t,r=5,i=10){return this.httpRequest.request({method:"GET",url:"/events",query:{appSessionId:e,afterTimestamp:t,timeout:r,maxEvents:i},errors:{403:"(403) Forbidden.",500:"(500) Server error."}})}getActivityState(e){return this.httpRequest.request({method:"GET",url:"/activity/{activityId}/state",path:{activityId:e},errors:{404:"(404) The specified resource was not found.",500:"(500) Server error."}})}setActivityState(e,t){return this.httpRequest.request({method:"PUT",url:"/activity/{activityId}/state",path:{activityId:e},body:t,mediaType:"application/json",errors:{404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getActivityUsage(e){return this.httpRequest.request({method:"GET",url:"/activity/{activityId}/usage",path:{activityId:e},errors:{404:"(404) The specified resource was not found.",500:"(500) Server error."}})}};var Zt={};Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.RequestorControlService=void 0;Zt.RequestorControlService=class{constructor(e){this.httpRequest=e}createActivity(e,t=5){return this.httpRequest.request({method:"POST",url:"/activity",query:{timeout:t},body:e,mediaType:"application/json",errors:{400:"(400) Bad request",403:"(403) Forbidden.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}exec(e,t){return this.httpRequest.request({method:"POST",url:"/activity/{activityId}/exec",path:{activityId:e},body:t,mediaType:"application/json",errors:{400:"(400) Bad request",403:"(403) Forbidden.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}callEncrypted(e,t){return this.httpRequest.request({method:"POST",url:"/activity/{activityId}/encrypted",path:{activityId:e},body:t,mediaType:"application/octet-stream",errors:{404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getExecBatchResults(e,t,r,i=5){return this.httpRequest.request({method:"GET",url:"/activity/{activityId}/exec/{batchId}",path:{activityId:e,batchId:t},query:{commandIndex:r,timeout:i},errors:{400:"(400) Bad request",403:"(403) Forbidden.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}destroyActivity(e,t=5){return this.httpRequest.request({method:"DELETE",url:"/activity/{activityId}",path:{activityId:e},query:{timeout:t},errors:{403:"(403) Forbidden.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}};var er={};Object.defineProperty(er,"__esModule",{value:!0}),er.RequestorStateService=void 0;er.RequestorStateService=class{constructor(e){this.httpRequest=e}getActivityAgreement(e){return this.httpRequest.request({method:"GET",url:"/activity/{activityId}/agreement",path:{activityId:e},errors:{400:"(400) Bad request",403:"(403) Forbidden.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getActivityState(e){return this.httpRequest.request({method:"GET",url:"/activity/{activityId}/state",path:{activityId:e},errors:{404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getActivityUsage(e){return this.httpRequest.request({method:"GET",url:"/activity/{activityId}/usage",path:{activityId:e},errors:{404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getRunningCommand(e){return this.httpRequest.request({method:"GET",url:"/activity/{activityId}/command",path:{activityId:e},errors:{404:"(404) The specified resource was not found.",500:"(500) Server error."}})}},Object.defineProperty(kt,"__esModule",{value:!0}),kt.Client=void 0;const tr=_t,rr=Qt,ir=Zt,nr=er;kt.Client=class{constructor(e,t=tr.FetchHttpRequest){this.request=new t({BASE:e?.BASE??"/activity-api/v1",VERSION:e?.VERSION??"1.7.0",WITH_CREDENTIALS:e?.WITH_CREDENTIALS??!1,CREDENTIALS:e?.CREDENTIALS??"include",TOKEN:e?.TOKEN,USERNAME:e?.USERNAME,PASSWORD:e?.PASSWORD,HEADERS:e?.HEADERS,ENCODE_PATH:e?.ENCODE_PATH}),this.provider=new rr.ProviderService(this.request),this.requestorControl=new ir.RequestorControlService(this.request),this.requestorState=new nr.RequestorStateService(this.request)}};var or={};Object.defineProperty(or,"__esModule",{value:!0}),or.OpenAPI=void 0,or.OpenAPI={BASE:"/activity-api/v1",VERSION:"1.7.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FetchHttpRequest=e.RequestorStateService=e.RequestorControlService=e.ProviderService=e.OpenAPI=e.CancelError=e.CancelablePromise=e.BaseHttpRequest=e.ApiError=e.Client=void 0;var t=kt;Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return t.Client}});var r=Ft;Object.defineProperty(e,"ApiError",{enumerable:!0,get:function(){return r.ApiError}});var i=xt;Object.defineProperty(e,"BaseHttpRequest",{enumerable:!0,get:function(){return i.BaseHttpRequest}});var n=Ht;Object.defineProperty(e,"CancelablePromise",{enumerable:!0,get:function(){return n.CancelablePromise}}),Object.defineProperty(e,"CancelError",{enumerable:!0,get:function(){return n.CancelError}});var o=or;Object.defineProperty(e,"OpenAPI",{enumerable:!0,get:function(){return o.OpenAPI}});var s=Qt;Object.defineProperty(e,"ProviderService",{enumerable:!0,get:function(){return s.ProviderService}});var a=Zt;Object.defineProperty(e,"RequestorControlService",{enumerable:!0,get:function(){return a.RequestorControlService}});var c=er;Object.defineProperty(e,"RequestorStateService",{enumerable:!0,get:function(){return c.RequestorStateService}});var u=_t;Object.defineProperty(e,"FetchHttpRequest",{enumerable:!0,get:function(){return u.FetchHttpRequest}})}(Nt);var sr={},ar={},cr={},ur={};Object.defineProperty(ur,"__esModule",{value:!0}),ur.BaseHttpRequest=void 0;ur.BaseHttpRequest=class{constructor(e){this.config=e}};var lr={},hr={};Object.defineProperty(hr,"__esModule",{value:!0}),hr.ApiError=void 0;let dr=class extends Error{constructor(e,t,r){super(r),this.name="ApiError",this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.body=t.body,this.request=e}};hr.ApiError=dr;var pr,fr,gr,vr,mr,yr,wr,br={},Er=M&&M.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},Sr=M&&M.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(br,"__esModule",{value:!0}),br.CancelablePromise=br.CancelError=void 0;let Ir=class extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}};br.CancelError=Ir;let Ar=class{constructor(e){pr.set(this,void 0),fr.set(this,void 0),gr.set(this,void 0),vr.set(this,void 0),mr.set(this,void 0),yr.set(this,void 0),wr.set(this,void 0),Er(this,pr,!1,"f"),Er(this,fr,!1,"f"),Er(this,gr,!1,"f"),Er(this,vr,[],"f"),Er(this,mr,new Promise(((t,r)=>{Er(this,yr,t,"f"),Er(this,wr,r,"f");const i=e=>{Sr(this,pr,"f")||Sr(this,fr,"f")||Sr(this,gr,"f")||Sr(this,vr,"f").push(e)};return Object.defineProperty(i,"isResolved",{get:()=>Sr(this,pr,"f")}),Object.defineProperty(i,"isRejected",{get:()=>Sr(this,fr,"f")}),Object.defineProperty(i,"isCancelled",{get:()=>Sr(this,gr,"f")}),e((e=>{Sr(this,pr,"f")||Sr(this,fr,"f")||Sr(this,gr,"f")||(Er(this,pr,!0,"f"),Sr(this,yr,"f")&&Sr(this,yr,"f").call(this,e))}),(e=>{Sr(this,pr,"f")||Sr(this,fr,"f")||Sr(this,gr,"f")||(Er(this,fr,!0,"f"),Sr(this,wr,"f")&&Sr(this,wr,"f").call(this,e))}),i)})),"f")}get[(pr=new WeakMap,fr=new WeakMap,gr=new WeakMap,vr=new WeakMap,mr=new WeakMap,yr=new WeakMap,wr=new WeakMap,Symbol.toStringTag)](){return"Cancellable Promise"}then(e,t){return Sr(this,mr,"f").then(e,t)}catch(e){return Sr(this,mr,"f").catch(e)}finally(e){return Sr(this,mr,"f").finally(e)}cancel(){if(!(Sr(this,pr,"f")||Sr(this,fr,"f")||Sr(this,gr,"f"))){if(Er(this,gr,!0,"f"),Sr(this,vr,"f").length)try{for(const e of Sr(this,vr,"f"))e()}catch(e){return void console.warn("Cancellation threw an error",e)}Sr(this,vr,"f").length=0,Sr(this,wr,"f")&&Sr(this,wr,"f").call(this,new Ir("Request aborted"))}}get isCancelled(){return Sr(this,gr,"f")}};br.CancelablePromise=Ar,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=e.catchErrorCodes=e.getResponseBody=e.getResponseHeader=e.sendRequest=e.getRequestBody=e.getHeaders=e.resolve=e.getFormData=e.getQueryString=e.base64=e.isFormData=e.isBlob=e.isStringWithValue=e.isString=e.isDefined=void 0;const t=hr,r=br;e.isDefined=e=>null!=e;e.isString=e=>"string"==typeof e;e.isStringWithValue=t=>(0,e.isString)(t)&&""!==t;e.isBlob=e=>"object"==typeof e&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.arrayBuffer&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]);e.isFormData=e=>e instanceof FormData;e.base64=e=>{try{return btoa(e)}catch(t){return Ee.from(e).toString("base64")}};e.getQueryString=t=>{const r=[],i=(t,n)=>{(0,e.isDefined)(n)&&(Array.isArray(n)?n.forEach((e=>{i(t,e)})):"object"==typeof n?Object.entries(n).forEach((([e,r])=>{i(`${t}[${e}]`,r)})):((e,t)=>{r.push(`${encodeURIComponent(e)}=${encodeURIComponent(String(t))}`)})(t,n))};return Object.entries(t).forEach((([e,t])=>{i(e,t)})),r.length>0?`?${r.join("&")}`:""};e.getFormData=t=>{if(t.formData){const r=new FormData,i=(t,i)=>{(0,e.isString)(i)||(0,e.isBlob)(i)?r.append(t,i):r.append(t,JSON.stringify(i))};return Object.entries(t.formData).filter((([t,r])=>(0,e.isDefined)(r))).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>i(e,t))):i(e,t)})),r}};e.resolve=async(e,t)=>"function"==typeof t?t(e):t;e.getHeaders=async(t,r)=>{const[i,n,o,s]=await Promise.all([(0,e.resolve)(r,t.TOKEN),(0,e.resolve)(r,t.USERNAME),(0,e.resolve)(r,t.PASSWORD),(0,e.resolve)(r,t.HEADERS)]),a=Object.entries({Accept:"application/json",...s,...r.headers}).filter((([t,r])=>(0,e.isDefined)(r))).reduce(((e,[t,r])=>({...e,[t]:String(r)})),{});if((0,e.isStringWithValue)(i)&&(a.Authorization=`Bearer ${i}`),(0,e.isStringWithValue)(n)&&(0,e.isStringWithValue)(o)){const t=(0,e.base64)(`${n}:${o}`);a.Authorization=`Basic ${t}`}return void 0!==r.body&&(r.mediaType?a["Content-Type"]=r.mediaType:(0,e.isBlob)(r.body)?a["Content-Type"]=r.body.type||"application/octet-stream":(0,e.isString)(r.body)?a["Content-Type"]="text/plain":(0,e.isFormData)(r.body)||(a["Content-Type"]="application/json")),new Headers(a)};e.getRequestBody=t=>{if(void 0!==t.body)return t.mediaType?.includes("/json")?JSON.stringify(t.body):(0,e.isString)(t.body)||(0,e.isBlob)(t.body)||(0,e.isFormData)(t.body)?t.body:JSON.stringify(t.body)};e.sendRequest=async(e,t,r,i,n,o,s)=>{const a=new AbortController,c={headers:o,body:i??n,method:t.method,signal:a.signal};return e.WITH_CREDENTIALS&&(c.credentials=e.CREDENTIALS),s((()=>a.abort())),await fetch(r,c)};e.getResponseHeader=(t,r)=>{if(r){const i=t.headers.get(r);if((0,e.isString)(i))return i}};e.getResponseBody=async e=>{if(204!==e.status)try{const t=e.headers.get("Content-Type");if(t){return["application/json","application/problem+json"].some((e=>t.toLowerCase().startsWith(e)))?await e.json():await e.text()}}catch(e){console.error(e)}};e.catchErrorCodes=(e,r)=>{const i={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[r.status];if(i)throw new t.ApiError(e,r,i);if(!r.ok){const i=r.status??"unknown",n=r.statusText??"unknown",o=(()=>{try{return JSON.stringify(r.body,null,2)}catch(e){return}})();throw new t.ApiError(e,r,`Generic Error: status: ${i}; status text: ${n}; body: ${o}`)}};e.request=(t,i)=>new r.CancelablePromise((async(r,n,o)=>{try{const n=((t,r)=>{const i=t.ENCODE_PATH||encodeURI,n=r.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((e,t)=>r.path?.hasOwnProperty(t)?i(String(r.path[t])):e)),o=`${t.BASE}${n}`;return r.query?`${o}${(0,e.getQueryString)(r.query)}`:o})(t,i),s=(0,e.getFormData)(i),a=(0,e.getRequestBody)(i),c=await(0,e.getHeaders)(t,i);if(!o.isCancelled){const u=await(0,e.sendRequest)(t,i,n,a,s,c,o),l=await(0,e.getResponseBody)(u),h=(0,e.getResponseHeader)(u,i.responseHeader),d={url:n,ok:u.ok,status:u.status,statusText:u.statusText,body:h??l};(0,e.catchErrorCodes)(i,d),r(d.body)}}catch(e){n(e)}}))}(lr),Object.defineProperty(cr,"__esModule",{value:!0}),cr.FetchHttpRequest=void 0;const Pr=ur,Tr=lr;let Rr=class extends Pr.BaseHttpRequest{constructor(e){super(e)}request(e){return(0,Tr.request)(this.config,e)}};cr.FetchHttpRequest=Rr;var Or={};Object.defineProperty(Or,"__esModule",{value:!0}),Or.ProviderService=void 0;Or.ProviderService=class{constructor(e){this.httpRequest=e}issueDebitNote(e){return this.httpRequest.request({method:"POST",url:"/debitNotes",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getDebitNotes(e,t=10){return this.httpRequest.request({method:"GET",url:"/debitNotes",query:{afterTimestamp:e,maxItems:t},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getDebitNote(e){return this.httpRequest.request({method:"GET",url:"/debitNotes/{debitNoteId}",path:{debitNoteId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getPaymentsForDebitNote(e,t,r=10){return this.httpRequest.request({method:"GET",url:"/debitNotes/{debitNoteId}/payments",path:{debitNoteId:e},query:{afterTimestamp:t,maxItems:r},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}sendDebitNote(e,t=5){return this.httpRequest.request({method:"POST",url:"/debitNotes/{debitNoteId}/send",path:{debitNoteId:e},query:{timeout:t},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error.",504:"(504) Ack timeout."}})}cancelDebitNote(e,t=5){return this.httpRequest.request({method:"POST",url:"/debitNotes/{debitNoteId}/cancel",path:{debitNoteId:e},query:{timeout:t},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",409:"The Requestor has refused to cancel the Debit Note.",500:"(500) Server error.",504:"(504) Ack timeout."}})}getDebitNoteEvents(e=5,t,r=10,i){return this.httpRequest.request({method:"GET",url:"/debitNoteEvents",query:{timeout:e,afterTimestamp:t,maxEvents:r,appSessionId:i},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}issueInvoice(e){return this.httpRequest.request({method:"POST",url:"/invoices",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getInvoices(e,t=10){return this.httpRequest.request({method:"GET",url:"/invoices",query:{afterTimestamp:e,maxItems:t},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getInvoice(e){return this.httpRequest.request({method:"GET",url:"/invoices/{invoiceId}",path:{invoiceId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getPaymentsForInvoice(e,t,r=10){return this.httpRequest.request({method:"GET",url:"/invoices/{invoiceId}/payments",path:{invoiceId:e},query:{afterTimestamp:t,maxItems:r},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}sendInvoice(e,t=5){return this.httpRequest.request({method:"POST",url:"/invoices/{invoiceId}/send",path:{invoiceId:e},query:{timeout:t},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error.",504:"(504) Ack timeout."}})}cancelInvoice(e,t=5){return this.httpRequest.request({method:"POST",url:"/invoices/{invoiceId}/cancel",path:{invoiceId:e},query:{timeout:t},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",409:"The Requestor has refused to cancel the Invoice.",500:"(500) Server error.",504:"(504) Ack timeout."}})}getInvoiceEvents(e=5,t,r=10,i){return this.httpRequest.request({method:"GET",url:"/invoiceEvents",query:{timeout:e,afterTimestamp:t,maxEvents:r,appSessionId:i},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getProviderAccounts(){return this.httpRequest.request({method:"GET",url:"/providerAccounts",errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getPayments(e=5,t,r=10,i,n,o){return this.httpRequest.request({method:"GET",url:"/payments",query:{timeout:e,afterTimestamp:t,maxEvents:r,appSessionId:i,network:n,driver:o},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getPayment(e){return this.httpRequest.request({method:"GET",url:"/payments/{paymentId}",path:{paymentId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}paymentsStatus(e,t){return this.httpRequest.request({method:"GET",url:"/payments/status",query:{network:e,driver:t},errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}};var Cr={};Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.RequestorService=void 0;Cr.RequestorService=class{constructor(e){this.httpRequest=e}getDebitNotes(e,t=10){return this.httpRequest.request({method:"GET",url:"/debitNotes",query:{afterTimestamp:e,maxItems:t},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getDebitNote(e){return this.httpRequest.request({method:"GET",url:"/debitNotes/{debitNoteId}",path:{debitNoteId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getPaymentsForDebitNote(e,t,r=10){return this.httpRequest.request({method:"GET",url:"/debitNotes/{debitNoteId}/payments",path:{debitNoteId:e},query:{afterTimestamp:t,maxItems:r},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getDebitNoteEvents(e=5,t,r=10,i){return this.httpRequest.request({method:"GET",url:"/debitNoteEvents",query:{timeout:e,afterTimestamp:t,maxEvents:r,appSessionId:i},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}issueInvoice(e){return this.httpRequest.request({method:"POST",url:"/invoices",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getInvoices(e,t=10){return this.httpRequest.request({method:"GET",url:"/invoices",query:{afterTimestamp:e,maxItems:t},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getInvoice(e){return this.httpRequest.request({method:"GET",url:"/invoices/{invoiceId}",path:{invoiceId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getPaymentsForInvoice(e,t,r=10){return this.httpRequest.request({method:"GET",url:"/invoices/{invoiceId}/payments",path:{invoiceId:e},query:{afterTimestamp:t,maxItems:r},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getInvoiceEvents(e=5,t,r=10,i){return this.httpRequest.request({method:"GET",url:"/invoiceEvents",query:{timeout:e,afterTimestamp:t,maxEvents:r,appSessionId:i},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}acceptDebitNote(e,t,r=5){return this.httpRequest.request({method:"POST",url:"/debitNotes/{debitNoteId}/accept",path:{debitNoteId:e},query:{timeout:r},body:t,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error.",504:"(504) Ack timeout."}})}rejectDebitNote(e,t,r=5){return this.httpRequest.request({method:"POST",url:"/debitNotes/{debitNoteId}/reject",path:{debitNoteId:e},query:{timeout:r},body:t,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error.",504:"(504) Ack timeout."}})}acceptInvoice(e,t,r=5){return this.httpRequest.request({method:"POST",url:"/invoices/{invoiceId}/accept",path:{invoiceId:e},query:{timeout:r},body:t,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error.",504:"(504) Ack timeout."}})}rejectInvoice(e,t,r=5){return this.httpRequest.request({method:"POST",url:"/invoices/{invoiceId}/reject",path:{invoiceId:e},query:{timeout:r},body:t,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error.",504:"(504) Ack timeout."}})}createAllocation(e,t,r=10){return this.httpRequest.request({method:"POST",url:"/allocations",query:{afterTimestamp:t,maxItems:r},body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getAllocations(){return this.httpRequest.request({method:"GET",url:"/allocations",errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getAllocation(e){return this.httpRequest.request({method:"GET",url:"/allocations/{allocationId}",path:{allocationId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}amendAllocation(e,t){return this.httpRequest.request({method:"PUT",url:"/allocations/{allocationId}",path:{allocationId:e},body:t,mediaType:"application/json",errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}releaseAllocation(e){return this.httpRequest.request({method:"DELETE",url:"/allocations/{allocationId}",path:{allocationId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",410:"(410) Gone.",500:"(500) Server error."}})}getPayments(e=5,t,r=10,i,n,o){return this.httpRequest.request({method:"GET",url:"/payments",query:{timeout:e,afterTimestamp:t,maxEvents:r,appSessionId:i,network:n,driver:o},errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getPayment(e){return this.httpRequest.request({method:"GET",url:"/payments/{paymentId}",path:{paymentId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}paymentsStatus(e,t){return this.httpRequest.request({method:"GET",url:"/payments/status",query:{network:e,driver:t},errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found.",500:"(500) Server error."}})}getRequestorAccounts(){return this.httpRequest.request({method:"GET",url:"/requestorAccounts",errors:{401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}getDemandDecorations(e){return this.httpRequest.request({method:"GET",url:"/demandDecorations",query:{allocationIds:e},errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",500:"(500) Server error."}})}},Object.defineProperty(ar,"__esModule",{value:!0}),ar.Client=void 0;const Nr=cr,kr=Or,_r=Cr;ar.Client=class{constructor(e,t=Nr.FetchHttpRequest){this.request=new t({BASE:e?.BASE??"/payment-api/v1",VERSION:e?.VERSION??"1.6.3",WITH_CREDENTIALS:e?.WITH_CREDENTIALS??!1,CREDENTIALS:e?.CREDENTIALS??"include",TOKEN:e?.TOKEN,USERNAME:e?.USERNAME,PASSWORD:e?.PASSWORD,HEADERS:e?.HEADERS,ENCODE_PATH:e?.ENCODE_PATH}),this.provider=new kr.ProviderService(this.request),this.requestor=new _r.RequestorService(this.request)}};var xr={};Object.defineProperty(xr,"__esModule",{value:!0}),xr.OpenAPI=void 0,xr.OpenAPI={BASE:"/payment-api/v1",VERSION:"1.6.3",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FetchHttpRequest=e.RequestorService=e.ProviderService=e.OpenAPI=e.CancelError=e.CancelablePromise=e.BaseHttpRequest=e.ApiError=e.Client=void 0;var t=ar;Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return t.Client}});var r=hr;Object.defineProperty(e,"ApiError",{enumerable:!0,get:function(){return r.ApiError}});var i=ur;Object.defineProperty(e,"BaseHttpRequest",{enumerable:!0,get:function(){return i.BaseHttpRequest}});var n=br;Object.defineProperty(e,"CancelablePromise",{enumerable:!0,get:function(){return n.CancelablePromise}}),Object.defineProperty(e,"CancelError",{enumerable:!0,get:function(){return n.CancelError}});var o=xr;Object.defineProperty(e,"OpenAPI",{enumerable:!0,get:function(){return o.OpenAPI}});var s=Or;Object.defineProperty(e,"ProviderService",{enumerable:!0,get:function(){return s.ProviderService}});var a=Cr;Object.defineProperty(e,"RequestorService",{enumerable:!0,get:function(){return a.RequestorService}});var c=cr;Object.defineProperty(e,"FetchHttpRequest",{enumerable:!0,get:function(){return c.FetchHttpRequest}})}(sr);var Dr={},Fr={},qr={},Br={};Object.defineProperty(Br,"__esModule",{value:!0}),Br.BaseHttpRequest=void 0;Br.BaseHttpRequest=class{constructor(e){this.config=e}};var jr={},$r={};Object.defineProperty($r,"__esModule",{value:!0}),$r.ApiError=void 0;let Mr=class extends Error{constructor(e,t,r){super(r),this.name="ApiError",this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.body=t.body,this.request=e}};$r.ApiError=Mr;var Lr,Vr,Ur,Hr,zr,Wr,Gr,Yr={},Kr=M&&M.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},Jr=M&&M.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.CancelablePromise=Yr.CancelError=void 0;let Xr=class extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}};Yr.CancelError=Xr;let Qr=class{constructor(e){Lr.set(this,void 0),Vr.set(this,void 0),Ur.set(this,void 0),Hr.set(this,void 0),zr.set(this,void 0),Wr.set(this,void 0),Gr.set(this,void 0),Kr(this,Lr,!1,"f"),Kr(this,Vr,!1,"f"),Kr(this,Ur,!1,"f"),Kr(this,Hr,[],"f"),Kr(this,zr,new Promise(((t,r)=>{Kr(this,Wr,t,"f"),Kr(this,Gr,r,"f");const i=e=>{Jr(this,Lr,"f")||Jr(this,Vr,"f")||Jr(this,Ur,"f")||Jr(this,Hr,"f").push(e)};return Object.defineProperty(i,"isResolved",{get:()=>Jr(this,Lr,"f")}),Object.defineProperty(i,"isRejected",{get:()=>Jr(this,Vr,"f")}),Object.defineProperty(i,"isCancelled",{get:()=>Jr(this,Ur,"f")}),e((e=>{Jr(this,Lr,"f")||Jr(this,Vr,"f")||Jr(this,Ur,"f")||(Kr(this,Lr,!0,"f"),Jr(this,Wr,"f")&&Jr(this,Wr,"f").call(this,e))}),(e=>{Jr(this,Lr,"f")||Jr(this,Vr,"f")||Jr(this,Ur,"f")||(Kr(this,Vr,!0,"f"),Jr(this,Gr,"f")&&Jr(this,Gr,"f").call(this,e))}),i)})),"f")}get[(Lr=new WeakMap,Vr=new WeakMap,Ur=new WeakMap,Hr=new WeakMap,zr=new WeakMap,Wr=new WeakMap,Gr=new WeakMap,Symbol.toStringTag)](){return"Cancellable Promise"}then(e,t){return Jr(this,zr,"f").then(e,t)}catch(e){return Jr(this,zr,"f").catch(e)}finally(e){return Jr(this,zr,"f").finally(e)}cancel(){if(!(Jr(this,Lr,"f")||Jr(this,Vr,"f")||Jr(this,Ur,"f"))){if(Kr(this,Ur,!0,"f"),Jr(this,Hr,"f").length)try{for(const e of Jr(this,Hr,"f"))e()}catch(e){return void console.warn("Cancellation threw an error",e)}Jr(this,Hr,"f").length=0,Jr(this,Gr,"f")&&Jr(this,Gr,"f").call(this,new Xr("Request aborted"))}}get isCancelled(){return Jr(this,Ur,"f")}};Yr.CancelablePromise=Qr,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=e.catchErrorCodes=e.getResponseBody=e.getResponseHeader=e.sendRequest=e.getRequestBody=e.getHeaders=e.resolve=e.getFormData=e.getQueryString=e.base64=e.isFormData=e.isBlob=e.isStringWithValue=e.isString=e.isDefined=void 0;const t=$r,r=Yr;e.isDefined=e=>null!=e;e.isString=e=>"string"==typeof e;e.isStringWithValue=t=>(0,e.isString)(t)&&""!==t;e.isBlob=e=>"object"==typeof e&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.arrayBuffer&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]);e.isFormData=e=>e instanceof FormData;e.base64=e=>{try{return btoa(e)}catch(t){return Ee.from(e).toString("base64")}};e.getQueryString=t=>{const r=[],i=(t,n)=>{(0,e.isDefined)(n)&&(Array.isArray(n)?n.forEach((e=>{i(t,e)})):"object"==typeof n?Object.entries(n).forEach((([e,r])=>{i(`${t}[${e}]`,r)})):((e,t)=>{r.push(`${encodeURIComponent(e)}=${encodeURIComponent(String(t))}`)})(t,n))};return Object.entries(t).forEach((([e,t])=>{i(e,t)})),r.length>0?`?${r.join("&")}`:""};e.getFormData=t=>{if(t.formData){const r=new FormData,i=(t,i)=>{(0,e.isString)(i)||(0,e.isBlob)(i)?r.append(t,i):r.append(t,JSON.stringify(i))};return Object.entries(t.formData).filter((([t,r])=>(0,e.isDefined)(r))).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>i(e,t))):i(e,t)})),r}};e.resolve=async(e,t)=>"function"==typeof t?t(e):t;e.getHeaders=async(t,r)=>{const[i,n,o,s]=await Promise.all([(0,e.resolve)(r,t.TOKEN),(0,e.resolve)(r,t.USERNAME),(0,e.resolve)(r,t.PASSWORD),(0,e.resolve)(r,t.HEADERS)]),a=Object.entries({Accept:"application/json",...s,...r.headers}).filter((([t,r])=>(0,e.isDefined)(r))).reduce(((e,[t,r])=>({...e,[t]:String(r)})),{});if((0,e.isStringWithValue)(i)&&(a.Authorization=`Bearer ${i}`),(0,e.isStringWithValue)(n)&&(0,e.isStringWithValue)(o)){const t=(0,e.base64)(`${n}:${o}`);a.Authorization=`Basic ${t}`}return void 0!==r.body&&(r.mediaType?a["Content-Type"]=r.mediaType:(0,e.isBlob)(r.body)?a["Content-Type"]=r.body.type||"application/octet-stream":(0,e.isString)(r.body)?a["Content-Type"]="text/plain":(0,e.isFormData)(r.body)||(a["Content-Type"]="application/json")),new Headers(a)};e.getRequestBody=t=>{if(void 0!==t.body)return t.mediaType?.includes("/json")?JSON.stringify(t.body):(0,e.isString)(t.body)||(0,e.isBlob)(t.body)||(0,e.isFormData)(t.body)?t.body:JSON.stringify(t.body)};e.sendRequest=async(e,t,r,i,n,o,s)=>{const a=new AbortController,c={headers:o,body:i??n,method:t.method,signal:a.signal};return e.WITH_CREDENTIALS&&(c.credentials=e.CREDENTIALS),s((()=>a.abort())),await fetch(r,c)};e.getResponseHeader=(t,r)=>{if(r){const i=t.headers.get(r);if((0,e.isString)(i))return i}};e.getResponseBody=async e=>{if(204!==e.status)try{const t=e.headers.get("Content-Type");if(t){return["application/json","application/problem+json"].some((e=>t.toLowerCase().startsWith(e)))?await e.json():await e.text()}}catch(e){console.error(e)}};e.catchErrorCodes=(e,r)=>{const i={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[r.status];if(i)throw new t.ApiError(e,r,i);if(!r.ok){const i=r.status??"unknown",n=r.statusText??"unknown",o=(()=>{try{return JSON.stringify(r.body,null,2)}catch(e){return}})();throw new t.ApiError(e,r,`Generic Error: status: ${i}; status text: ${n}; body: ${o}`)}};e.request=(t,i)=>new r.CancelablePromise((async(r,n,o)=>{try{const n=((t,r)=>{const i=t.ENCODE_PATH||encodeURI,n=r.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((e,t)=>r.path?.hasOwnProperty(t)?i(String(r.path[t])):e)),o=`${t.BASE}${n}`;return r.query?`${o}${(0,e.getQueryString)(r.query)}`:o})(t,i),s=(0,e.getFormData)(i),a=(0,e.getRequestBody)(i),c=await(0,e.getHeaders)(t,i);if(!o.isCancelled){const u=await(0,e.sendRequest)(t,i,n,a,s,c,o),l=await(0,e.getResponseBody)(u),h=(0,e.getResponseHeader)(u,i.responseHeader),d={url:n,ok:u.ok,status:u.status,statusText:u.statusText,body:h??l};(0,e.catchErrorCodes)(i,d),r(d.body)}}catch(e){n(e)}}))}(jr),Object.defineProperty(qr,"__esModule",{value:!0}),qr.FetchHttpRequest=void 0;const Zr=Br,ei=jr;let ti=class extends Zr.BaseHttpRequest{constructor(e){super(e)}request(e){return(0,ei.request)(this.config,e)}};qr.FetchHttpRequest=ti;var ri={};Object.defineProperty(ri,"__esModule",{value:!0}),ri.DefaultService=void 0;ri.DefaultService=class{constructor(e){this.httpRequest=e}connectTcp(e,t,r){return this.httpRequest.request({method:"GET",url:"/net/{networkId}/tcp/{ip}/{port}",path:{networkId:e,ip:t,port:r},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}};var ii={};Object.defineProperty(ii,"__esModule",{value:!0}),ii.RequestorService=void 0;ii.RequestorService=class{constructor(e){this.httpRequest=e}getNetworks(){return this.httpRequest.request({method:"GET",url:"/net",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}createNetwork(e){return this.httpRequest.request({method:"POST",url:"/net",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}getNetwork(e){return this.httpRequest.request({method:"GET",url:"/net/{networkId}",path:{networkId:e},errors:{401:"(401) Authorization information is missing or invalid.",403:"(403) Forbidden.",404:"(404) The specified resource was not found."}})}removeNetwork(e){return this.httpRequest.request({method:"DELETE",url:"/net/{networkId}",path:{networkId:e},errors:{401:"(401) Authorization information is missing or invalid.",403:"(403) Forbidden.",404:"(404) The specified resource was not found."}})}getAddresses(e){return this.httpRequest.request({method:"GET",url:"/net/{networkId}/addresses",path:{networkId:e},errors:{401:"(401) Authorization information is missing or invalid.",403:"(403) Forbidden.",404:"(404) The specified resource was not found."}})}addAddress(e,t){return this.httpRequest.request({method:"POST",url:"/net/{networkId}/addresses",path:{networkId:e},body:t,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",409:"(409) Conflict."}})}getNodes(e){return this.httpRequest.request({method:"GET",url:"/net/{networkId}/nodes",path:{networkId:e},errors:{401:"(401) Authorization information is missing or invalid.",403:"(403) Forbidden.",404:"(404) The specified resource was not found."}})}addNode(e,t){return this.httpRequest.request({method:"POST",url:"/net/{networkId}/nodes",path:{networkId:e},body:t,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid.",409:"(409) Conflict."}})}removeNode(e,t){return this.httpRequest.request({method:"DELETE",url:"/net/{networkId}/nodes/{nodeId}",path:{networkId:e,nodeId:t},errors:{401:"(401) Authorization information is missing or invalid.",403:"(403) Forbidden.",404:"(404) The specified resource was not found."}})}getConnections(e){return this.httpRequest.request({method:"GET",url:"/net/{networkId}/tcp",path:{networkId:e},errors:{401:"(401) Authorization information is missing or invalid.",403:"(403) Forbidden.",404:"(404) The specified resource was not found."}})}},Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.Client=void 0;const ni=qr,oi=ri,si=ii;Fr.Client=class{constructor(e,t=ni.FetchHttpRequest){this.request=new t({BASE:e?.BASE??"/net-api/v1",VERSION:e?.VERSION??"0.1.0",WITH_CREDENTIALS:e?.WITH_CREDENTIALS??!1,CREDENTIALS:e?.CREDENTIALS??"include",TOKEN:e?.TOKEN,USERNAME:e?.USERNAME,PASSWORD:e?.PASSWORD,HEADERS:e?.HEADERS,ENCODE_PATH:e?.ENCODE_PATH}),this.default=new oi.DefaultService(this.request),this.requestor=new si.RequestorService(this.request)}};var ai={};Object.defineProperty(ai,"__esModule",{value:!0}),ai.OpenAPI=void 0,ai.OpenAPI={BASE:"/net-api/v1",VERSION:"0.1.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FetchHttpRequest=e.RequestorService=e.DefaultService=e.OpenAPI=e.CancelError=e.CancelablePromise=e.BaseHttpRequest=e.ApiError=e.Client=void 0;var t=Fr;Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return t.Client}});var r=$r;Object.defineProperty(e,"ApiError",{enumerable:!0,get:function(){return r.ApiError}});var i=Br;Object.defineProperty(e,"BaseHttpRequest",{enumerable:!0,get:function(){return i.BaseHttpRequest}});var n=Yr;Object.defineProperty(e,"CancelablePromise",{enumerable:!0,get:function(){return n.CancelablePromise}}),Object.defineProperty(e,"CancelError",{enumerable:!0,get:function(){return n.CancelError}});var o=ai;Object.defineProperty(e,"OpenAPI",{enumerable:!0,get:function(){return o.OpenAPI}});var s=ri;Object.defineProperty(e,"DefaultService",{enumerable:!0,get:function(){return s.DefaultService}});var a=ii;Object.defineProperty(e,"RequestorService",{enumerable:!0,get:function(){return a.RequestorService}});var c=qr;Object.defineProperty(e,"FetchHttpRequest",{enumerable:!0,get:function(){return c.FetchHttpRequest}})}(Dr);var ci={},ui={},li={},hi={};Object.defineProperty(hi,"__esModule",{value:!0}),hi.BaseHttpRequest=void 0;hi.BaseHttpRequest=class{constructor(e){this.config=e}};var di={},pi={};Object.defineProperty(pi,"__esModule",{value:!0}),pi.ApiError=void 0;let fi=class extends Error{constructor(e,t,r){super(r),this.name="ApiError",this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.body=t.body,this.request=e}};pi.ApiError=fi;var gi,vi,mi,yi,wi,bi,Ei,Si={},Ii=M&&M.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},Ai=M&&M.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(Si,"__esModule",{value:!0}),Si.CancelablePromise=Si.CancelError=void 0;let Pi=class extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}};Si.CancelError=Pi;let Ti=class{constructor(e){gi.set(this,void 0),vi.set(this,void 0),mi.set(this,void 0),yi.set(this,void 0),wi.set(this,void 0),bi.set(this,void 0),Ei.set(this,void 0),Ii(this,gi,!1,"f"),Ii(this,vi,!1,"f"),Ii(this,mi,!1,"f"),Ii(this,yi,[],"f"),Ii(this,wi,new Promise(((t,r)=>{Ii(this,bi,t,"f"),Ii(this,Ei,r,"f");const i=e=>{Ai(this,gi,"f")||Ai(this,vi,"f")||Ai(this,mi,"f")||Ai(this,yi,"f").push(e)};return Object.defineProperty(i,"isResolved",{get:()=>Ai(this,gi,"f")}),Object.defineProperty(i,"isRejected",{get:()=>Ai(this,vi,"f")}),Object.defineProperty(i,"isCancelled",{get:()=>Ai(this,mi,"f")}),e((e=>{Ai(this,gi,"f")||Ai(this,vi,"f")||Ai(this,mi,"f")||(Ii(this,gi,!0,"f"),Ai(this,bi,"f")&&Ai(this,bi,"f").call(this,e))}),(e=>{Ai(this,gi,"f")||Ai(this,vi,"f")||Ai(this,mi,"f")||(Ii(this,vi,!0,"f"),Ai(this,Ei,"f")&&Ai(this,Ei,"f").call(this,e))}),i)})),"f")}get[(gi=new WeakMap,vi=new WeakMap,mi=new WeakMap,yi=new WeakMap,wi=new WeakMap,bi=new WeakMap,Ei=new WeakMap,Symbol.toStringTag)](){return"Cancellable Promise"}then(e,t){return Ai(this,wi,"f").then(e,t)}catch(e){return Ai(this,wi,"f").catch(e)}finally(e){return Ai(this,wi,"f").finally(e)}cancel(){if(!(Ai(this,gi,"f")||Ai(this,vi,"f")||Ai(this,mi,"f"))){if(Ii(this,mi,!0,"f"),Ai(this,yi,"f").length)try{for(const e of Ai(this,yi,"f"))e()}catch(e){return void console.warn("Cancellation threw an error",e)}Ai(this,yi,"f").length=0,Ai(this,Ei,"f")&&Ai(this,Ei,"f").call(this,new Pi("Request aborted"))}}get isCancelled(){return Ai(this,mi,"f")}};Si.CancelablePromise=Ti,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=e.catchErrorCodes=e.getResponseBody=e.getResponseHeader=e.sendRequest=e.getRequestBody=e.getHeaders=e.resolve=e.getFormData=e.getQueryString=e.base64=e.isFormData=e.isBlob=e.isStringWithValue=e.isString=e.isDefined=void 0;const t=pi,r=Si;e.isDefined=e=>null!=e;e.isString=e=>"string"==typeof e;e.isStringWithValue=t=>(0,e.isString)(t)&&""!==t;e.isBlob=e=>"object"==typeof e&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.arrayBuffer&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]);e.isFormData=e=>e instanceof FormData;e.base64=e=>{try{return btoa(e)}catch(t){return Ee.from(e).toString("base64")}};e.getQueryString=t=>{const r=[],i=(t,n)=>{(0,e.isDefined)(n)&&(Array.isArray(n)?n.forEach((e=>{i(t,e)})):"object"==typeof n?Object.entries(n).forEach((([e,r])=>{i(`${t}[${e}]`,r)})):((e,t)=>{r.push(`${encodeURIComponent(e)}=${encodeURIComponent(String(t))}`)})(t,n))};return Object.entries(t).forEach((([e,t])=>{i(e,t)})),r.length>0?`?${r.join("&")}`:""};e.getFormData=t=>{if(t.formData){const r=new FormData,i=(t,i)=>{(0,e.isString)(i)||(0,e.isBlob)(i)?r.append(t,i):r.append(t,JSON.stringify(i))};return Object.entries(t.formData).filter((([t,r])=>(0,e.isDefined)(r))).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>i(e,t))):i(e,t)})),r}};e.resolve=async(e,t)=>"function"==typeof t?t(e):t;e.getHeaders=async(t,r)=>{const[i,n,o,s]=await Promise.all([(0,e.resolve)(r,t.TOKEN),(0,e.resolve)(r,t.USERNAME),(0,e.resolve)(r,t.PASSWORD),(0,e.resolve)(r,t.HEADERS)]),a=Object.entries({Accept:"application/json",...s,...r.headers}).filter((([t,r])=>(0,e.isDefined)(r))).reduce(((e,[t,r])=>({...e,[t]:String(r)})),{});if((0,e.isStringWithValue)(i)&&(a.Authorization=`Bearer ${i}`),(0,e.isStringWithValue)(n)&&(0,e.isStringWithValue)(o)){const t=(0,e.base64)(`${n}:${o}`);a.Authorization=`Basic ${t}`}return void 0!==r.body&&(r.mediaType?a["Content-Type"]=r.mediaType:(0,e.isBlob)(r.body)?a["Content-Type"]=r.body.type||"application/octet-stream":(0,e.isString)(r.body)?a["Content-Type"]="text/plain":(0,e.isFormData)(r.body)||(a["Content-Type"]="application/json")),new Headers(a)};e.getRequestBody=t=>{if(void 0!==t.body)return t.mediaType?.includes("/json")?JSON.stringify(t.body):(0,e.isString)(t.body)||(0,e.isBlob)(t.body)||(0,e.isFormData)(t.body)?t.body:JSON.stringify(t.body)};e.sendRequest=async(e,t,r,i,n,o,s)=>{const a=new AbortController,c={headers:o,body:i??n,method:t.method,signal:a.signal};return e.WITH_CREDENTIALS&&(c.credentials=e.CREDENTIALS),s((()=>a.abort())),await fetch(r,c)};e.getResponseHeader=(t,r)=>{if(r){const i=t.headers.get(r);if((0,e.isString)(i))return i}};e.getResponseBody=async e=>{if(204!==e.status)try{const t=e.headers.get("Content-Type");if(t){return["application/json","application/problem+json"].some((e=>t.toLowerCase().startsWith(e)))?await e.json():await e.text()}}catch(e){console.error(e)}};e.catchErrorCodes=(e,r)=>{const i={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[r.status];if(i)throw new t.ApiError(e,r,i);if(!r.ok){const i=r.status??"unknown",n=r.statusText??"unknown",o=(()=>{try{return JSON.stringify(r.body,null,2)}catch(e){return}})();throw new t.ApiError(e,r,`Generic Error: status: ${i}; status text: ${n}; body: ${o}`)}};e.request=(t,i)=>new r.CancelablePromise((async(r,n,o)=>{try{const n=((t,r)=>{const i=t.ENCODE_PATH||encodeURI,n=r.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((e,t)=>r.path?.hasOwnProperty(t)?i(String(r.path[t])):e)),o=`${t.BASE}${n}`;return r.query?`${o}${(0,e.getQueryString)(r.query)}`:o})(t,i),s=(0,e.getFormData)(i),a=(0,e.getRequestBody)(i),c=await(0,e.getHeaders)(t,i);if(!o.isCancelled){const u=await(0,e.sendRequest)(t,i,n,a,s,c,o),l=await(0,e.getResponseBody)(u),h=(0,e.getResponseHeader)(u,i.responseHeader),d={url:n,ok:u.ok,status:u.status,statusText:u.statusText,body:h??l};(0,e.catchErrorCodes)(i,d),r(d.body)}}catch(e){n(e)}}))}(di),Object.defineProperty(li,"__esModule",{value:!0}),li.FetchHttpRequest=void 0;const Ri=hi,Oi=di;let Ci=class extends Ri.BaseHttpRequest{constructor(e){super(e)}request(e){return(0,Oi.request)(this.config,e)}};li.FetchHttpRequest=Ci;var Ni={};Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.DefaultService=void 0;Ni.DefaultService=class{constructor(e){this.httpRequest=e}getServiceMessages(e){return this.httpRequest.request({method:"GET",url:"/services/{servicesId}",path:{servicesId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}};var ki={};Object.defineProperty(ki,"__esModule",{value:!0}),ki.RequestorService=void 0;ki.RequestorService=class{constructor(e){this.httpRequest=e}bindServices(e){return this.httpRequest.request({method:"POST",url:"/services",body:e,mediaType:"application/json",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}unbindServices(e){return this.httpRequest.request({method:"DELETE",url:"/services/{servicesId}",path:{servicesId:e},errors:{401:"(401) Authorization information is missing or invalid.",404:"(404) The specified resource was not found."}})}},Object.defineProperty(ui,"__esModule",{value:!0}),ui.Client=void 0;const _i=li,xi=Ni,Di=ki;ui.Client=class{constructor(e,t=_i.FetchHttpRequest){this.request=new t({BASE:e?.BASE??"/gsb-api/v1",VERSION:e?.VERSION??"0.1.0",WITH_CREDENTIALS:e?.WITH_CREDENTIALS??!1,CREDENTIALS:e?.CREDENTIALS??"include",TOKEN:e?.TOKEN,USERNAME:e?.USERNAME,PASSWORD:e?.PASSWORD,HEADERS:e?.HEADERS,ENCODE_PATH:e?.ENCODE_PATH}),this.default=new xi.DefaultService(this.request),this.requestor=new Di.RequestorService(this.request)}};var Fi={};Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.OpenAPI=void 0,Fi.OpenAPI={BASE:"/gsb-api/v1",VERSION:"0.1.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FetchHttpRequest=e.RequestorService=e.DefaultService=e.OpenAPI=e.CancelError=e.CancelablePromise=e.BaseHttpRequest=e.ApiError=e.Client=void 0;var t=ui;Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return t.Client}});var r=pi;Object.defineProperty(e,"ApiError",{enumerable:!0,get:function(){return r.ApiError}});var i=hi;Object.defineProperty(e,"BaseHttpRequest",{enumerable:!0,get:function(){return i.BaseHttpRequest}});var n=Si;Object.defineProperty(e,"CancelablePromise",{enumerable:!0,get:function(){return n.CancelablePromise}}),Object.defineProperty(e,"CancelError",{enumerable:!0,get:function(){return n.CancelError}});var o=Fi;Object.defineProperty(e,"OpenAPI",{enumerable:!0,get:function(){return o.OpenAPI}});var s=Ni;Object.defineProperty(e,"DefaultService",{enumerable:!0,get:function(){return s.DefaultService}});var a=ki;Object.defineProperty(e,"RequestorService",{enumerable:!0,get:function(){return a.RequestorService}});var c=li;Object.defineProperty(e,"FetchHttpRequest",{enumerable:!0,get:function(){return c.FetchHttpRequest}})}(ci);var qi={},Bi={},ji={},$i={};Object.defineProperty($i,"__esModule",{value:!0}),$i.BaseHttpRequest=void 0;$i.BaseHttpRequest=class{constructor(e){this.config=e}};var Mi={},Li={};Object.defineProperty(Li,"__esModule",{value:!0}),Li.ApiError=void 0;let Vi=class extends Error{constructor(e,t,r){super(r),this.name="ApiError",this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.body=t.body,this.request=e}};Li.ApiError=Vi;var Ui,Hi,zi,Wi,Gi,Yi,Ki,Ji={},Xi=M&&M.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},Qi=M&&M.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.CancelablePromise=Ji.CancelError=void 0;let Zi=class extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}};Ji.CancelError=Zi;let en=class{constructor(e){Ui.set(this,void 0),Hi.set(this,void 0),zi.set(this,void 0),Wi.set(this,void 0),Gi.set(this,void 0),Yi.set(this,void 0),Ki.set(this,void 0),Xi(this,Ui,!1,"f"),Xi(this,Hi,!1,"f"),Xi(this,zi,!1,"f"),Xi(this,Wi,[],"f"),Xi(this,Gi,new Promise(((t,r)=>{Xi(this,Yi,t,"f"),Xi(this,Ki,r,"f");const i=e=>{Qi(this,Ui,"f")||Qi(this,Hi,"f")||Qi(this,zi,"f")||Qi(this,Wi,"f").push(e)};return Object.defineProperty(i,"isResolved",{get:()=>Qi(this,Ui,"f")}),Object.defineProperty(i,"isRejected",{get:()=>Qi(this,Hi,"f")}),Object.defineProperty(i,"isCancelled",{get:()=>Qi(this,zi,"f")}),e((e=>{Qi(this,Ui,"f")||Qi(this,Hi,"f")||Qi(this,zi,"f")||(Xi(this,Ui,!0,"f"),Qi(this,Yi,"f")&&Qi(this,Yi,"f").call(this,e))}),(e=>{Qi(this,Ui,"f")||Qi(this,Hi,"f")||Qi(this,zi,"f")||(Xi(this,Hi,!0,"f"),Qi(this,Ki,"f")&&Qi(this,Ki,"f").call(this,e))}),i)})),"f")}get[(Ui=new WeakMap,Hi=new WeakMap,zi=new WeakMap,Wi=new WeakMap,Gi=new WeakMap,Yi=new WeakMap,Ki=new WeakMap,Symbol.toStringTag)](){return"Cancellable Promise"}then(e,t){return Qi(this,Gi,"f").then(e,t)}catch(e){return Qi(this,Gi,"f").catch(e)}finally(e){return Qi(this,Gi,"f").finally(e)}cancel(){if(!(Qi(this,Ui,"f")||Qi(this,Hi,"f")||Qi(this,zi,"f"))){if(Xi(this,zi,!0,"f"),Qi(this,Wi,"f").length)try{for(const e of Qi(this,Wi,"f"))e()}catch(e){return void console.warn("Cancellation threw an error",e)}Qi(this,Wi,"f").length=0,Qi(this,Ki,"f")&&Qi(this,Ki,"f").call(this,new Zi("Request aborted"))}}get isCancelled(){return Qi(this,zi,"f")}};Ji.CancelablePromise=en,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=e.catchErrorCodes=e.getResponseBody=e.getResponseHeader=e.sendRequest=e.getRequestBody=e.getHeaders=e.resolve=e.getFormData=e.getQueryString=e.base64=e.isFormData=e.isBlob=e.isStringWithValue=e.isString=e.isDefined=void 0;const t=Li,r=Ji;e.isDefined=e=>null!=e;e.isString=e=>"string"==typeof e;e.isStringWithValue=t=>(0,e.isString)(t)&&""!==t;e.isBlob=e=>"object"==typeof e&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.arrayBuffer&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]);e.isFormData=e=>e instanceof FormData;e.base64=e=>{try{return btoa(e)}catch(t){return Ee.from(e).toString("base64")}};e.getQueryString=t=>{const r=[],i=(t,n)=>{(0,e.isDefined)(n)&&(Array.isArray(n)?n.forEach((e=>{i(t,e)})):"object"==typeof n?Object.entries(n).forEach((([e,r])=>{i(`${t}[${e}]`,r)})):((e,t)=>{r.push(`${encodeURIComponent(e)}=${encodeURIComponent(String(t))}`)})(t,n))};return Object.entries(t).forEach((([e,t])=>{i(e,t)})),r.length>0?`?${r.join("&")}`:""};e.getFormData=t=>{if(t.formData){const r=new FormData,i=(t,i)=>{(0,e.isString)(i)||(0,e.isBlob)(i)?r.append(t,i):r.append(t,JSON.stringify(i))};return Object.entries(t.formData).filter((([t,r])=>(0,e.isDefined)(r))).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>i(e,t))):i(e,t)})),r}};e.resolve=async(e,t)=>"function"==typeof t?t(e):t;e.getHeaders=async(t,r)=>{const[i,n,o,s]=await Promise.all([(0,e.resolve)(r,t.TOKEN),(0,e.resolve)(r,t.USERNAME),(0,e.resolve)(r,t.PASSWORD),(0,e.resolve)(r,t.HEADERS)]),a=Object.entries({Accept:"application/json",...s,...r.headers}).filter((([t,r])=>(0,e.isDefined)(r))).reduce(((e,[t,r])=>({...e,[t]:String(r)})),{});if((0,e.isStringWithValue)(i)&&(a.Authorization=`Bearer ${i}`),(0,e.isStringWithValue)(n)&&(0,e.isStringWithValue)(o)){const t=(0,e.base64)(`${n}:${o}`);a.Authorization=`Basic ${t}`}return void 0!==r.body&&(r.mediaType?a["Content-Type"]=r.mediaType:(0,e.isBlob)(r.body)?a["Content-Type"]=r.body.type||"application/octet-stream":(0,e.isString)(r.body)?a["Content-Type"]="text/plain":(0,e.isFormData)(r.body)||(a["Content-Type"]="application/json")),new Headers(a)};e.getRequestBody=t=>{if(void 0!==t.body)return t.mediaType?.includes("/json")?JSON.stringify(t.body):(0,e.isString)(t.body)||(0,e.isBlob)(t.body)||(0,e.isFormData)(t.body)?t.body:JSON.stringify(t.body)};e.sendRequest=async(e,t,r,i,n,o,s)=>{const a=new AbortController,c={headers:o,body:i??n,method:t.method,signal:a.signal};return e.WITH_CREDENTIALS&&(c.credentials=e.CREDENTIALS),s((()=>a.abort())),await fetch(r,c)};e.getResponseHeader=(t,r)=>{if(r){const i=t.headers.get(r);if((0,e.isString)(i))return i}};e.getResponseBody=async e=>{if(204!==e.status)try{const t=e.headers.get("Content-Type");if(t){return["application/json","application/problem+json"].some((e=>t.toLowerCase().startsWith(e)))?await e.json():await e.text()}}catch(e){console.error(e)}};e.catchErrorCodes=(e,r)=>{const i={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[r.status];if(i)throw new t.ApiError(e,r,i);if(!r.ok){const i=r.status??"unknown",n=r.statusText??"unknown",o=(()=>{try{return JSON.stringify(r.body,null,2)}catch(e){return}})();throw new t.ApiError(e,r,`Generic Error: status: ${i}; status text: ${n}; body: ${o}`)}};e.request=(t,i)=>new r.CancelablePromise((async(r,n,o)=>{try{const n=((t,r)=>{const i=t.ENCODE_PATH||encodeURI,n=r.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((e,t)=>r.path?.hasOwnProperty(t)?i(String(r.path[t])):e)),o=`${t.BASE}${n}`;return r.query?`${o}${(0,e.getQueryString)(r.query)}`:o})(t,i),s=(0,e.getFormData)(i),a=(0,e.getRequestBody)(i),c=await(0,e.getHeaders)(t,i);if(!o.isCancelled){const u=await(0,e.sendRequest)(t,i,n,a,s,c,o),l=await(0,e.getResponseBody)(u),h=(0,e.getResponseHeader)(u,i.responseHeader),d={url:n,ok:u.ok,status:u.status,statusText:u.statusText,body:h??l};(0,e.catchErrorCodes)(i,d),r(d.body)}}catch(e){n(e)}}))}(Mi),Object.defineProperty(ji,"__esModule",{value:!0}),ji.FetchHttpRequest=void 0;const tn=$i,rn=Mi;let nn=class extends tn.BaseHttpRequest{constructor(e){super(e)}request(e){return(0,rn.request)(this.config,e)}};ji.FetchHttpRequest=nn;var on={};Object.defineProperty(on,"__esModule",{value:!0}),on.DefaultService=void 0;on.DefaultService=class{constructor(e){this.httpRequest=e}getIdentity(){return this.httpRequest.request({method:"GET",url:"/me",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}},Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.Client=void 0;const sn=ji,an=on;Bi.Client=class{constructor(e,t=sn.FetchHttpRequest){this.request=new t({BASE:e?.BASE??"",VERSION:e?.VERSION??"0.1.0",WITH_CREDENTIALS:e?.WITH_CREDENTIALS??!1,CREDENTIALS:e?.CREDENTIALS??"include",TOKEN:e?.TOKEN,USERNAME:e?.USERNAME,PASSWORD:e?.PASSWORD,HEADERS:e?.HEADERS,ENCODE_PATH:e?.ENCODE_PATH}),this.default=new an.DefaultService(this.request)}};var cn={};Object.defineProperty(cn,"__esModule",{value:!0}),cn.OpenAPI=void 0,cn.OpenAPI={BASE:"",VERSION:"0.1.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FetchHttpRequest=e.DefaultService=e.OpenAPI=e.CancelError=e.CancelablePromise=e.BaseHttpRequest=e.ApiError=e.Client=void 0;var t=Bi;Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return t.Client}});var r=Li;Object.defineProperty(e,"ApiError",{enumerable:!0,get:function(){return r.ApiError}});var i=$i;Object.defineProperty(e,"BaseHttpRequest",{enumerable:!0,get:function(){return i.BaseHttpRequest}});var n=Ji;Object.defineProperty(e,"CancelablePromise",{enumerable:!0,get:function(){return n.CancelablePromise}}),Object.defineProperty(e,"CancelError",{enumerable:!0,get:function(){return n.CancelError}});var o=cn;Object.defineProperty(e,"OpenAPI",{enumerable:!0,get:function(){return o.OpenAPI}});var s=on;Object.defineProperty(e,"DefaultService",{enumerable:!0,get:function(){return s.DefaultService}});var a=ji;Object.defineProperty(e,"FetchHttpRequest",{enumerable:!0,get:function(){return a.FetchHttpRequest}})}(qi);var un={},ln={},hn={},dn={};Object.defineProperty(dn,"__esModule",{value:!0}),dn.BaseHttpRequest=void 0;dn.BaseHttpRequest=class{constructor(e){this.config=e}};var pn={},fn={};Object.defineProperty(fn,"__esModule",{value:!0}),fn.ApiError=void 0;class gn extends Error{constructor(e,t,r){super(r),this.name="ApiError",this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.body=t.body,this.request=e}}fn.ApiError=gn;var vn,mn,yn,wn,bn,En,Sn,In={},An=M&&M.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},Pn=M&&M.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(In,"__esModule",{value:!0}),In.CancelablePromise=In.CancelError=void 0;class Tn extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}}In.CancelError=Tn;class Rn{constructor(e){vn.set(this,void 0),mn.set(this,void 0),yn.set(this,void 0),wn.set(this,void 0),bn.set(this,void 0),En.set(this,void 0),Sn.set(this,void 0),An(this,vn,!1,"f"),An(this,mn,!1,"f"),An(this,yn,!1,"f"),An(this,wn,[],"f"),An(this,bn,new Promise(((t,r)=>{An(this,En,t,"f"),An(this,Sn,r,"f");const i=e=>{Pn(this,vn,"f")||Pn(this,mn,"f")||Pn(this,yn,"f")||Pn(this,wn,"f").push(e)};return Object.defineProperty(i,"isResolved",{get:()=>Pn(this,vn,"f")}),Object.defineProperty(i,"isRejected",{get:()=>Pn(this,mn,"f")}),Object.defineProperty(i,"isCancelled",{get:()=>Pn(this,yn,"f")}),e((e=>{Pn(this,vn,"f")||Pn(this,mn,"f")||Pn(this,yn,"f")||(An(this,vn,!0,"f"),Pn(this,En,"f")&&Pn(this,En,"f").call(this,e))}),(e=>{Pn(this,vn,"f")||Pn(this,mn,"f")||Pn(this,yn,"f")||(An(this,mn,!0,"f"),Pn(this,Sn,"f")&&Pn(this,Sn,"f").call(this,e))}),i)})),"f")}get[(vn=new WeakMap,mn=new WeakMap,yn=new WeakMap,wn=new WeakMap,bn=new WeakMap,En=new WeakMap,Sn=new WeakMap,Symbol.toStringTag)](){return"Cancellable Promise"}then(e,t){return Pn(this,bn,"f").then(e,t)}catch(e){return Pn(this,bn,"f").catch(e)}finally(e){return Pn(this,bn,"f").finally(e)}cancel(){if(!(Pn(this,vn,"f")||Pn(this,mn,"f")||Pn(this,yn,"f"))){if(An(this,yn,!0,"f"),Pn(this,wn,"f").length)try{for(const e of Pn(this,wn,"f"))e()}catch(e){return void console.warn("Cancellation threw an error",e)}Pn(this,wn,"f").length=0,Pn(this,Sn,"f")&&Pn(this,Sn,"f").call(this,new Tn("Request aborted"))}}get isCancelled(){return Pn(this,yn,"f")}}In.CancelablePromise=Rn,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=e.catchErrorCodes=e.getResponseBody=e.getResponseHeader=e.sendRequest=e.getRequestBody=e.getHeaders=e.resolve=e.getFormData=e.getQueryString=e.base64=e.isFormData=e.isBlob=e.isStringWithValue=e.isString=e.isDefined=void 0;const t=fn,r=In;e.isDefined=e=>null!=e;e.isString=e=>"string"==typeof e;e.isStringWithValue=t=>(0,e.isString)(t)&&""!==t;e.isBlob=e=>"object"==typeof e&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.arrayBuffer&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag]);e.isFormData=e=>e instanceof FormData;e.base64=e=>{try{return btoa(e)}catch(t){return Ee.from(e).toString("base64")}};e.getQueryString=t=>{const r=[],i=(t,n)=>{(0,e.isDefined)(n)&&(Array.isArray(n)?n.forEach((e=>{i(t,e)})):"object"==typeof n?Object.entries(n).forEach((([e,r])=>{i(`${t}[${e}]`,r)})):((e,t)=>{r.push(`${encodeURIComponent(e)}=${encodeURIComponent(String(t))}`)})(t,n))};return Object.entries(t).forEach((([e,t])=>{i(e,t)})),r.length>0?`?${r.join("&")}`:""};e.getFormData=t=>{if(t.formData){const r=new FormData,i=(t,i)=>{(0,e.isString)(i)||(0,e.isBlob)(i)?r.append(t,i):r.append(t,JSON.stringify(i))};return Object.entries(t.formData).filter((([t,r])=>(0,e.isDefined)(r))).forEach((([e,t])=>{Array.isArray(t)?t.forEach((t=>i(e,t))):i(e,t)})),r}};e.resolve=async(e,t)=>"function"==typeof t?t(e):t;e.getHeaders=async(t,r)=>{const[i,n,o,s]=await Promise.all([(0,e.resolve)(r,t.TOKEN),(0,e.resolve)(r,t.USERNAME),(0,e.resolve)(r,t.PASSWORD),(0,e.resolve)(r,t.HEADERS)]),a=Object.entries({Accept:"application/json",...s,...r.headers}).filter((([t,r])=>(0,e.isDefined)(r))).reduce(((e,[t,r])=>({...e,[t]:String(r)})),{});if((0,e.isStringWithValue)(i)&&(a.Authorization=`Bearer ${i}`),(0,e.isStringWithValue)(n)&&(0,e.isStringWithValue)(o)){const t=(0,e.base64)(`${n}:${o}`);a.Authorization=`Basic ${t}`}return void 0!==r.body&&(r.mediaType?a["Content-Type"]=r.mediaType:(0,e.isBlob)(r.body)?a["Content-Type"]=r.body.type||"application/octet-stream":(0,e.isString)(r.body)?a["Content-Type"]="text/plain":(0,e.isFormData)(r.body)||(a["Content-Type"]="application/json")),new Headers(a)};e.getRequestBody=t=>{if(void 0!==t.body)return t.mediaType?.includes("/json")?JSON.stringify(t.body):(0,e.isString)(t.body)||(0,e.isBlob)(t.body)||(0,e.isFormData)(t.body)?t.body:JSON.stringify(t.body)};e.sendRequest=async(e,t,r,i,n,o,s)=>{const a=new AbortController,c={headers:o,body:i??n,method:t.method,signal:a.signal};return e.WITH_CREDENTIALS&&(c.credentials=e.CREDENTIALS),s((()=>a.abort())),await fetch(r,c)};e.getResponseHeader=(t,r)=>{if(r){const i=t.headers.get(r);if((0,e.isString)(i))return i}};e.getResponseBody=async e=>{if(204!==e.status)try{const t=e.headers.get("Content-Type");if(t){return["application/json","application/problem+json"].some((e=>t.toLowerCase().startsWith(e)))?await e.json():await e.text()}}catch(e){console.error(e)}};e.catchErrorCodes=(e,r)=>{const i={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...e.errors}[r.status];if(i)throw new t.ApiError(e,r,i);if(!r.ok){const i=r.status??"unknown",n=r.statusText??"unknown",o=(()=>{try{return JSON.stringify(r.body,null,2)}catch(e){return}})();throw new t.ApiError(e,r,`Generic Error: status: ${i}; status text: ${n}; body: ${o}`)}};e.request=(t,i)=>new r.CancelablePromise((async(r,n,o)=>{try{const n=((t,r)=>{const i=t.ENCODE_PATH||encodeURI,n=r.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((e,t)=>r.path?.hasOwnProperty(t)?i(String(r.path[t])):e)),o=`${t.BASE}${n}`;return r.query?`${o}${(0,e.getQueryString)(r.query)}`:o})(t,i),s=(0,e.getFormData)(i),a=(0,e.getRequestBody)(i),c=await(0,e.getHeaders)(t,i);if(!o.isCancelled){const u=await(0,e.sendRequest)(t,i,n,a,s,c,o),l=await(0,e.getResponseBody)(u),h=(0,e.getResponseHeader)(u,i.responseHeader),d={url:n,ok:u.ok,status:u.status,statusText:u.statusText,body:h??l};(0,e.catchErrorCodes)(i,d),r(d.body)}}catch(e){n(e)}}))}(pn),Object.defineProperty(hn,"__esModule",{value:!0}),hn.FetchHttpRequest=void 0;const On=dn,Cn=pn;class Nn extends On.BaseHttpRequest{constructor(e){super(e)}request(e){return(0,Cn.request)(this.config,e)}}hn.FetchHttpRequest=Nn;var kn={};Object.defineProperty(kn,"__esModule",{value:!0}),kn.DefaultService=void 0;kn.DefaultService=class{constructor(e){this.httpRequest=e}getVersion(){return this.httpRequest.request({method:"GET",url:"/version/get",errors:{400:"(400) Bad request",401:"(401) Authorization information is missing or invalid."}})}},Object.defineProperty(ln,"__esModule",{value:!0}),ln.Client=void 0;const _n=hn,xn=kn;ln.Client=class{constructor(e,t=_n.FetchHttpRequest){this.request=new t({BASE:e?.BASE??"",VERSION:e?.VERSION??"0.1.0",WITH_CREDENTIALS:e?.WITH_CREDENTIALS??!1,CREDENTIALS:e?.CREDENTIALS??"include",TOKEN:e?.TOKEN,USERNAME:e?.USERNAME,PASSWORD:e?.PASSWORD,HEADERS:e?.HEADERS,ENCODE_PATH:e?.ENCODE_PATH}),this.default=new xn.DefaultService(this.request)}};var Dn={};Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.OpenAPI=void 0,Dn.OpenAPI={BASE:"",VERSION:"0.1.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FetchHttpRequest=e.DefaultService=e.OpenAPI=e.CancelError=e.CancelablePromise=e.BaseHttpRequest=e.ApiError=e.Client=void 0;var t=ln;Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return t.Client}});var r=fn;Object.defineProperty(e,"ApiError",{enumerable:!0,get:function(){return r.ApiError}});var i=dn;Object.defineProperty(e,"BaseHttpRequest",{enumerable:!0,get:function(){return i.BaseHttpRequest}});var n=In;Object.defineProperty(e,"CancelablePromise",{enumerable:!0,get:function(){return n.CancelablePromise}}),Object.defineProperty(e,"CancelError",{enumerable:!0,get:function(){return n.CancelError}});var o=Dn;Object.defineProperty(e,"OpenAPI",{enumerable:!0,get:function(){return o.OpenAPI}});var s=kn;Object.defineProperty(e,"DefaultService",{enumerable:!0,get:function(){return s.DefaultService}});var a=hn;Object.defineProperty(e,"FetchHttpRequest",{enumerable:!0,get:function(){return a.FetchHttpRequest}})}(un);var Fn=M&&M.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),qn=M&&M.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Bn=M&&M.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Fn(t,e,r);return qn(t,e),t};Object.defineProperty(ie,"__esModule",{value:!0});var jn=ie.VersionApi=Hn=ie.IdentityApi=Un=ie.GsbApi=Vn=ie.NetApi=Ln=ie.PaymentApi=Mn=ie.ActivityApi=$n=ie.MarketApi=void 0,$n=ie.MarketApi=Bn(ne),Mn=ie.ActivityApi=Bn(Nt),Ln=ie.PaymentApi=Bn(sr),Vn=ie.NetApi=Bn(Dr),Un=ie.GsbApi=Bn(ci),Hn=ie.IdentityApi=Bn(qi);jn=ie.VersionApi=Bn(un);for(var zn,Wn=[],Gn=0;Gn<256;++Gn)Wn.push((Gn+256).toString(16).slice(1));var Yn=new Uint8Array(16);function Kn(){if(!zn&&!(zn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zn(Yn)}var Jn={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Xn(e,t,r){if(Jn.randomUUID&&!t&&!e)return Jn.randomUUID();var i=(e=e||{}).random||(e.rng||Kn)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,function(e,t=0){return(Wn[e[t+0]]+Wn[e[t+1]]+Wn[e[t+2]]+Wn[e[t+3]]+"-"+Wn[e[t+4]]+Wn[e[t+5]]+"-"+Wn[e[t+6]]+Wn[e[t+7]]+"-"+Wn[e[t+8]]+Wn[e[t+9]]+"-"+Wn[e[t+10]]+Wn[e[t+11]]+Wn[e[t+12]]+Wn[e[t+13]]+Wn[e[t+14]]+Wn[e[t+15]]).toLowerCase()}(i)}var Qn=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}};const Zn=Object.freeze({loose:!0}),eo=Object.freeze({});var to=e=>e?"object"!=typeof e?Zn:e:eo,ro={exports:{}};var io={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};var no="object"==typeof $&&$.env&&$.env.NODE_DEBUG&&/\bsemver\b/i.test($.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:n}=io,o=no,s=(t=e.exports={}).re=[],a=t.safeRe=[],c=t.src=[],u=t.t={};let l=0;const h="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",n],[h,i]],p=(e,t,r)=>{const i=(e=>{for(const[t,r]of d)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=l++;o(e,n,t),u[e]=n,c[n]=t,s[n]=new RegExp(t,r?"g":void 0),a[n]=new RegExp(i,r?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),p("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${h}+`),p("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),p("FULL",`^${c[u.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),p("LOOSE",`^${c[u.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),p("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),p("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",c[u.COERCE],!0),p("COERCERTLFULL",c[u.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",p("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",p("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(ro,ro.exports);var oo=ro.exports;const so=/^[0-9]+$/,ao=(e,t)=>{const r=so.test(e),i=so.test(t);return r&&i&&(e=+e,t=+t),e===t?0:r&&!i?-1:i&&!r?1:e<t?-1:1};var co={compareIdentifiers:ao,rcompareIdentifiers:(e,t)=>ao(t,e)};const uo=no,{MAX_LENGTH:lo,MAX_SAFE_INTEGER:ho}=io,{safeRe:po,t:fo}=oo,go=to,{compareIdentifiers:vo}=co;var mo=class e{constructor(t,r){if(r=go(r),t instanceof e){if(t.loose===!!r.loose&&t.includePrerelease===!!r.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>lo)throw new TypeError(`version is longer than ${lo} characters`);uo("SemVer",t,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;const i=t.trim().match(r.loose?po[fo.LOOSE]:po[fo.FULL]);if(!i)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>ho||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ho||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ho||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<ho)return t}return e})):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(uo("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof e||(t=new e(t,this.options)),vo(this.major,t.major)||vo(this.minor,t.minor)||vo(this.patch,t.patch)}comparePre(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let r=0;do{const e=this.prerelease[r],i=t.prerelease[r];if(uo("prerelease compare",r,e,i),void 0===e&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===e)return-1;if(e!==i)return vo(e,i)}while(++r)}compareBuild(t){t instanceof e||(t=new e(t,this.options));let r=0;do{const e=this.build[r],i=t.build[r];if(uo("build compare",r,e,i),void 0===e&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===e)return-1;if(e!==i)return vo(e,i)}while(++r)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let i=[t,e];!1===r&&(i=[t]),0===vo(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};const yo=mo;var wo=(e,t,r)=>new yo(e,r).compare(new yo(t,r));const bo=wo;const Eo=wo;const So=wo;const Io=wo;const Ao=wo;const Po=wo;const To=(e,t,r)=>0===bo(e,t,r),Ro=(e,t,r)=>0!==Eo(e,t,r),Oo=(e,t,r)=>So(e,t,r)>0,Co=(e,t,r)=>Io(e,t,r)>=0,No=(e,t,r)=>Ao(e,t,r)<0,ko=(e,t,r)=>Po(e,t,r)<=0;var _o,xo,Do,Fo,qo=(e,t,r,i)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return To(e,r,i);case"!=":return Ro(e,r,i);case">":return Oo(e,r,i);case">=":return Co(e,r,i);case"<":return No(e,r,i);case"<=":return ko(e,r,i);default:throw new TypeError(`Invalid operator: ${t}`)}};function Bo(){if(Fo)return Do;Fo=1;const e=/\s+/g;class t{constructor(r,o){if(o=i(o),r instanceof t)return r.loose===!!o.loose&&r.includePrerelease===!!o.includePrerelease?r:new t(r.raw,o);if(r instanceof n)return this.raw=r.value,this.set=[[r]],this.formatted=void 0,this;if(this.options=o,this.loose=!!o.loose,this.includePrerelease=!!o.includePrerelease,this.raw=r.trim().replace(e," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!f(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&g(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&d)|(this.options.loose&&p))+":"+e,i=r.get(t);if(i)return i;const s=this.options.loose,g=s?a[c.HYPHENRANGELOOSE]:a[c.HYPHENRANGE];e=e.replace(g,R(this.options.includePrerelease)),o("hyphen replace",e),e=e.replace(a[c.COMPARATORTRIM],u),o("comparator trim",e),e=e.replace(a[c.TILDETRIM],l),o("tilde trim",e),e=e.replace(a[c.CARETTRIM],h),o("caret trim",e);let v=e.split(" ").map((e=>m(e,this.options))).join(" ").split(/\s+/).map((e=>T(e,this.options)));s&&(v=v.filter((e=>(o("loose invalid filter",e,this.options),!!e.match(a[c.COMPARATORLOOSE]))))),o("range list",v);const y=new Map,w=v.map((e=>new n(e,this.options)));for(const e of w){if(f(e))return[e];y.set(e.value,e)}y.size>1&&y.has("")&&y.delete("");const b=[...y.values()];return r.set(t,b),b}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some((t=>v(t,r)&&e.set.some((e=>v(e,r)&&t.every((t=>e.every((e=>t.intersects(e,r)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new s(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(O(this.set[t],e,this.options))return!0;return!1}}Do=t;const r=new Qn,i=to,n=function(){if(xo)return _o;xo=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(i,n){if(n=r(n),i instanceof t){if(i.loose===!!n.loose)return i;i=i.value}i=i.trim().split(/\s+/).join(" "),s("comparator",i,n),this.options=n,this.loose=!!n.loose,this.parse(i),this.semver===e?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}parse(t){const r=this.options.loose?i[n.COMPARATORLOOSE]:i[n.COMPARATOR],o=t.match(r);if(!o)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==o[1]?o[1]:"","="===this.operator&&(this.operator=""),o[2]?this.semver=new a(o[2],this.options.loose):this.semver=e}toString(){return this.value}test(t){if(s("Comparator.test",t,this.options.loose),this.semver===e||t===e)return!0;if("string"==typeof t)try{t=new a(t,this.options)}catch(e){return!1}return o(t,this.operator,this.semver,this.options)}intersects(e,i){if(!(e instanceof t))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new c(e.value,i).test(this.value):""===e.operator?""===e.value||new c(this.value,i).test(e.semver):!((i=r(i)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!i.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(o(this.semver,"<",e.semver,i)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(o(this.semver,">",e.semver,i)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}_o=t;const r=to,{safeRe:i,t:n}=oo,o=qo,s=no,a=mo,c=Bo();return _o}(),o=no,s=mo,{safeRe:a,t:c,comparatorTrimReplace:u,tildeTrimReplace:l,caretTrimReplace:h}=oo,{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:p}=io,f=e=>"<0.0.0-0"===e.value,g=e=>""===e.value,v=(e,t)=>{let r=!0;const i=e.slice();let n=i.pop();for(;r&&i.length;)r=i.every((e=>n.intersects(e,t))),n=i.pop();return r},m=(e,t)=>(o("comp",e,t),e=E(e,t),o("caret",e),e=w(e,t),o("tildes",e),e=I(e,t),o("xrange",e),e=P(e,t),o("stars",e),e),y=e=>!e||"x"===e.toLowerCase()||"*"===e,w=(e,t)=>e.trim().split(/\s+/).map((e=>b(e,t))).join(" "),b=(e,t)=>{const r=t.loose?a[c.TILDELOOSE]:a[c.TILDE];return e.replace(r,((t,r,i,n,s)=>{let a;return o("tilde",e,t,r,i,n,s),y(r)?a="":y(i)?a=`>=${r}.0.0 <${+r+1}.0.0-0`:y(n)?a=`>=${r}.${i}.0 <${r}.${+i+1}.0-0`:s?(o("replaceTilde pr",s),a=`>=${r}.${i}.${n}-${s} <${r}.${+i+1}.0-0`):a=`>=${r}.${i}.${n} <${r}.${+i+1}.0-0`,o("tilde return",a),a}))},E=(e,t)=>e.trim().split(/\s+/).map((e=>S(e,t))).join(" "),S=(e,t)=>{o("caret",e,t);const r=t.loose?a[c.CARETLOOSE]:a[c.CARET],i=t.includePrerelease?"-0":"";return e.replace(r,((t,r,n,s,a)=>{let c;return o("caret",e,t,r,n,s,a),y(r)?c="":y(n)?c=`>=${r}.0.0${i} <${+r+1}.0.0-0`:y(s)?c="0"===r?`>=${r}.${n}.0${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${i} <${+r+1}.0.0-0`:a?(o("replaceCaret pr",a),c="0"===r?"0"===n?`>=${r}.${n}.${s}-${a} <${r}.${n}.${+s+1}-0`:`>=${r}.${n}.${s}-${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${s}-${a} <${+r+1}.0.0-0`):(o("no pr"),c="0"===r?"0"===n?`>=${r}.${n}.${s}${i} <${r}.${n}.${+s+1}-0`:`>=${r}.${n}.${s}${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${s} <${+r+1}.0.0-0`),o("caret return",c),c}))},I=(e,t)=>(o("replaceXRanges",e,t),e.split(/\s+/).map((e=>A(e,t))).join(" ")),A=(e,t)=>{e=e.trim();const r=t.loose?a[c.XRANGELOOSE]:a[c.XRANGE];return e.replace(r,((r,i,n,s,a,c)=>{o("xRange",e,r,i,n,s,a,c);const u=y(n),l=u||y(s),h=l||y(a),d=h;return"="===i&&d&&(i=""),c=t.includePrerelease?"-0":"",u?r=">"===i||"<"===i?"<0.0.0-0":"*":i&&d?(l&&(s=0),a=0,">"===i?(i=">=",l?(n=+n+1,s=0,a=0):(s=+s+1,a=0)):"<="===i&&(i="<",l?n=+n+1:s=+s+1),"<"===i&&(c="-0"),r=`${i+n}.${s}.${a}${c}`):l?r=`>=${n}.0.0${c} <${+n+1}.0.0-0`:h&&(r=`>=${n}.${s}.0${c} <${n}.${+s+1}.0-0`),o("xRange return",r),r}))},P=(e,t)=>(o("replaceStars",e,t),e.trim().replace(a[c.STAR],"")),T=(e,t)=>(o("replaceGTE0",e,t),e.trim().replace(a[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),R=e=>(t,r,i,n,o,s,a,c,u,l,h,d)=>`${r=y(i)?"":y(n)?`>=${i}.0.0${e?"-0":""}`:y(o)?`>=${i}.${n}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`} ${c=y(u)?"":y(l)?`<${+u+1}.0.0-0`:y(h)?`<${u}.${+l+1}.0-0`:d?`<=${u}.${l}.${h}-${d}`:e?`<${u}.${l}.${+h+1}-0`:`<=${c}`}`.trim(),O=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(o(e[r].semver),e[r].semver!==n.ANY&&e[r].semver.prerelease.length>0){const i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0};return Do}const jo=Bo();var $o=(e,t,r)=>{try{t=new jo(t,r)}catch(e){return!1}return t.test(e)},Mo=L($o);const Lo=mo;var Vo=(e,t,r=!1)=>{if(e instanceof Lo)return e;try{return new Lo(e,t)}catch(e){if(!r)return null;throw e}};const Uo=mo,Ho=Vo,{safeRe:zo,t:Wo}=oo;var Go=(e,t)=>{if(e instanceof Uo)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const i=t.includePrerelease?zo[Wo.COERCERTLFULL]:zo[Wo.COERCERTL];let n;for(;(n=i.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&n.index+n[0].length===r.index+r[0].length||(r=n),i.lastIndex=n.index+n[1].length+n[2].length;i.lastIndex=-1}else r=e.match(t.includePrerelease?zo[Wo.COERCEFULL]:zo[Wo.COERCE]);if(null===r)return null;const i=r[2],n=r[3]||"0",o=r[4]||"0",s=t.includePrerelease&&r[5]?`-${r[5]}`:"",a=t.includePrerelease&&r[6]?`+${r[6]}`:"";return Ho(`${i}.${n}.${o}${s}${a}`,t)},Yo=L(Go),Ko=function(e,t){return Ko=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Ko(e,t)};function Jo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Ko(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function Xo(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}function Qo(e,t){var r,i,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function Zo(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function es(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return s}function ts(e,t,r){if(r||2===arguments.length)for(var i,n=0,o=t.length;n<o;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function rs(e){return this instanceof rs?(this.v=e,this):new rs(e)}function is(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),i[Symbol.asyncIterator]=function(){return this},i;function s(e,t){n[e]&&(i[e]=function(t){return new Promise((function(r,i){o.push([e,t,r,i])>1||a(e,t)}))},t&&(i[e]=t(i[e])))}function a(e,t){try{(r=n[e](t)).value instanceof rs?Promise.resolve(r.value.v).then(c,u):l(o[0][2],r)}catch(e){l(o[0][3],e)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function ns(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=Zo(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise((function(i,n){(function(e,t,r,i){Promise.resolve(i).then((function(t){e({value:t,done:r})}),t)})(i,n,(t=e[r](t)).done,t.value)}))}}}function os(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)}function ss(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r}function as(e){return"function"==typeof e}function cs(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}"function"==typeof SuppressedError&&SuppressedError;var us=cs((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function ls(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var hs=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,i,n;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=Zo(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var c=this.initialTeardown;if(as(c))try{c()}catch(e){n=e instanceof us?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=Zo(u),h=l.next();!h.done;h=l.next()){var d=h.value;try{fs(d)}catch(e){n=null!=n?n:[],e instanceof us?n=ts(ts([],es(n)),es(e.errors)):n.push(e)}}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}if(n)throw new us(n)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)fs(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ls(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&ls(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),ds=hs.EMPTY;function ps(e){return e instanceof hs||e&&"closed"in e&&as(e.remove)&&as(e.add)&&as(e.unsubscribe)}function fs(e){as(e)?e():e.unsubscribe()}var gs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},vs={setTimeout:function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return setTimeout.apply(void 0,ts([e,t],es(r)))},clearTimeout:function(e){var t=vs.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ms(e){vs.setTimeout((function(){throw e}))}function ys(){}function ws(e){e()}var bs=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,ps(t)&&t.add(r)):r.destination=Ts,r}return Jo(t,e),t.create=function(e,t,r){return new As(e,t,r)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(hs),Es=Function.prototype.bind;function Ss(e,t){return Es.call(e,t)}var Is=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Ps(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Ps(e)}else Ps(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Ps(e)}},e}(),As=function(e){function t(t,r,i){var n,o,s=e.call(this)||this;as(t)||!t?n={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=i?i:void 0}:s&&gs.useDeprecatedNextContext?((o=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},n={next:t.next&&Ss(t.next,o),error:t.error&&Ss(t.error,o),complete:t.complete&&Ss(t.complete,o)}):n=t;return s.destination=new Is(n),s}return Jo(t,e),t}(bs);function Ps(e){ms(e)}var Ts={closed:!0,next:ys,error:function(e){throw e},complete:ys},Rs="function"==typeof Symbol&&Symbol.observable||"@@observable";function Os(e){return e}var Cs=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var i,n=this,o=(i=e)&&i instanceof bs||function(e){return e&&as(e.next)&&as(e.error)&&as(e.complete)}(i)&&ps(i)?e:new As(e,t,r);return ws((function(){var e=n,t=e.operator,r=e.source;o.add(t?t.call(o,r):r?n._subscribe(o):n._trySubscribe(o))})),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Ns(t))((function(t,i){var n=new As({next:function(t){try{e(t)}catch(e){i(e),n.unsubscribe()}},error:i,complete:t});r.subscribe(n)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Rs]=function(){return this},e.prototype.pipe=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(0===(e=t).length?Os:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)})(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Ns(e))((function(e,r){var i;t.subscribe((function(e){return i=e}),(function(e){return r(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function Ns(e){var t;return null!==(t=null!=e?e:gs.Promise)&&void 0!==t?t:Promise}function ks(e){return function(t){if(function(e){return as(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function _s(e,t,r,i,n){return new xs(e,t,r,i,n)}var xs=function(e){function t(t,r,i,n,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=n?function(e){try{n(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return Jo(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(bs),Ds=cs((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Fs=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Jo(t,e),t.prototype.lift=function(e){var t=new qs(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Ds},t.prototype.next=function(e){var t=this;ws((function(){var r,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var n=Zo(t.currentObservers),o=n.next();!o.done;o=n.next()){o.value.next(e)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}}}))},t.prototype.error=function(e){var t=this;ws((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}}))},t.prototype.complete=function(){var e=this;ws((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this,i=r.hasError,n=r.isStopped,o=r.observers;return i||n?ds:(this.currentObservers=null,o.push(e),new hs((function(){t.currentObservers=null,ls(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,i=t.thrownError,n=t.isStopped;r?e.error(i):n&&e.complete()},t.prototype.asObservable=function(){var e=new Cs;return e.source=this,e},t.create=function(e,t){return new qs(e,t)},t}(Cs),qs=function(e){function t(t,r){var i=e.call(this)||this;return i.destination=t,i.source=r,i}return Jo(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:ds},t}(Fs);function Bs(e){return e[e.length-1]}function js(e){return(t=Bs(e))&&as(t.schedule)?e.pop():void 0;var t}var $s=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Ms(e){return as(null==e?void 0:e.then)}function Ls(e){return as(e[Rs])}function Vs(e){return Symbol.asyncIterator&&as(null==e?void 0:e[Symbol.asyncIterator])}function Us(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Hs="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function zs(e){return as(null==e?void 0:e[Hs])}function Ws(e){return is(this,arguments,(function(){var t,r,i;return Qo(this,(function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,rs(t.read())];case 3:return r=n.sent(),i=r.value,r.done?[4,rs(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,rs(i)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Gs(e){return as(null==e?void 0:e.getReader)}function Ys(e){if(e instanceof Cs)return e;if(null!=e){if(Ls(e))return n=e,new Cs((function(e){var t=n[Rs]();if(as(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if($s(e))return i=e,new Cs((function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()}));if(Ms(e))return r=e,new Cs((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,ms)}));if(Vs(e))return Ks(e);if(zs(e))return t=e,new Cs((function(e){var r,i;try{for(var n=Zo(t),o=n.next();!o.done;o=n.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(e){r={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}e.complete()}));if(Gs(e))return Ks(Ws(e))}var t,r,i,n;throw Us(e)}function Ks(e){return new Cs((function(t){(function(e,t){var r,i,n,o;return Xo(this,void 0,void 0,(function(){var s,a;return Qo(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=ns(e),c.label=1;case 1:return[4,r.next()];case 2:if((i=c.sent()).done)return[3,4];if(s=i.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),n={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Js(e,t,r,i,n){void 0===i&&(i=0),void 0===n&&(n=!1);var o=t.schedule((function(){r(),n?e.add(this.schedule(null,i)):this.unsubscribe()}),i);if(e.add(o),!n)return o}function Xs(e,t){return void 0===t&&(t=0),ks((function(r,i){r.subscribe(_s(i,(function(r){return Js(i,e,(function(){return i.next(r)}),t)}),(function(){return Js(i,e,(function(){return i.complete()}),t)}),(function(r){return Js(i,e,(function(){return i.error(r)}),t)})))}))}function Qs(e,t){return void 0===t&&(t=0),ks((function(r,i){i.add(e.schedule((function(){return r.subscribe(i)}),t))}))}function Zs(e,t){if(!e)throw new Error("Iterable cannot be null");return new Cs((function(r){Js(r,t,(function(){var i=e[Symbol.asyncIterator]();Js(r,t,(function(){i.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function ea(e,t){if(null!=e){if(Ls(e))return function(e,t){return Ys(e).pipe(Qs(t),Xs(t))}(e,t);if($s(e))return function(e,t){return new Cs((function(r){var i=0;return t.schedule((function(){i===e.length?r.complete():(r.next(e[i++]),r.closed||this.schedule())}))}))}(e,t);if(Ms(e))return function(e,t){return Ys(e).pipe(Qs(t),Xs(t))}(e,t);if(Vs(e))return Zs(e,t);if(zs(e))return function(e,t){return new Cs((function(r){var i;return Js(r,t,(function(){i=e[Hs](),Js(r,t,(function(){var e,t,n;try{t=(e=i.next()).value,n=e.done}catch(e){return void r.error(e)}n?r.complete():r.next(t)}),0,!0)})),function(){return as(null==i?void 0:i.return)&&i.return()}}))}(e,t);if(Gs(e))return function(e,t){return Zs(Ws(e),t)}(e,t)}throw Us(e)}function ta(e,t){return t?ea(e,t):Ys(e)}function ra(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ta(e,js(e))}var ia=cs((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function na(e,t){return new Promise((function(t,r){var i,n=!1;e.subscribe({next:function(e){i=e,n=!0},error:r,complete:function(){n?t(i):r(new ia)}})}))}function oa(e,t){return ks((function(r,i){var n=0;r.subscribe(_s(i,(function(r){i.next(e.call(t,r,n++))})))}))}function sa(e,t,r){return void 0===r&&(r=1/0),as(t)?sa((function(r,i){return oa((function(e,n){return t(r,e,i,n)}))(Ys(e(r,i)))}),r):("number"==typeof t&&(r=t),ks((function(t,i){return function(e,t,r,i,n,o,s){var a=[],c=0,u=0,l=!1,h=function(){!l||a.length||c||t.complete()},d=function(e){c++;var n=!1;Ys(r(e,u++)).subscribe(_s(t,(function(e){t.next(e)}),(function(){n=!0}),void 0,(function(){if(n)try{for(c--;a.length&&c<i;)e=void 0,e=a.shift(),s||d(e);h()}catch(e){t.error(e)}var e})))};return e.subscribe(_s(t,(function(e){return c<i?d(e):a.push(e)}),(function(){l=!0,h()}))),function(){}}(t,i,e,r)})))}function aa(e,t){return ks((function(r,i){var n=0;r.subscribe(_s(i,(function(r){return e.call(t,r,n++)&&i.next(r)})))}))}function ca(e){return ks((function(t,r){var i,n=null,o=!1;n=t.subscribe(_s(r,void 0,void 0,(function(s){i=Ys(e(s,ca(e)(t))),n?(n.unsubscribe(),n=null,i.subscribe(r)):o=!0}))),o&&(n.unsubscribe(),n=null,i.subscribe(r))}))}function ua(e,t){return ks(function(e,t,r){return function(i,n){var o=r,s=t,a=0;i.subscribe(_s(n,(function(t){var r=a++;s=o?e(s,t,r):(o=!0,t)}),(function(){o&&n.next(s),n.complete()})))}}(e,t,arguments.length>=2))}var la=function(e,t){return e.push(t),e};function ha(e){return ks((function(t,r){try{t.subscribe(r)}finally{r.add(e)}}))}function da(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=js(e),i=function(e,t){return"number"==typeof Bs(e)?e.pop():t}(e,1/0);return ks((function(t,n){(function(e){return void 0===e&&(e=1/0),sa(Os,e)})(i)(ta(ts([t],es(e)),r)).subscribe(n)}))}function pa(e,t){return ks((function(r,i){var n=null,o=0,s=!1,a=function(){return s&&!n&&i.complete()};r.subscribe(_s(i,(function(r){null==n||n.unsubscribe();var s=0,c=o++;Ys(e(r,c)).subscribe(n=_s(i,(function(e){return i.next(t?t(r,e,c,s++):e)}),(function(){n=null,a()})))}),(function(){s=!0,a()})))}))}function fa(e){return ks((function(t,r){Ys(e).subscribe(_s(r,(function(){return r.complete()}),ys)),!r.closed&&t.subscribe(r)}))}function ga(e,t,r){var i=as(e)||t||r?{next:e,error:t,complete:r}:e;return i?ks((function(e,t){var r;null===(r=i.subscribe)||void 0===r||r.call(i);var n=!0;e.subscribe(_s(t,(function(e){var r;null===(r=i.next)||void 0===r||r.call(i,e),t.next(e)}),(function(){var e;n=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()}),(function(e){var r;n=!1,null===(r=i.error)||void 0===r||r.call(i,e),t.error(e)}),(function(){var e,t;n&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)})))})):Os}function va(e,t){var r;const n=null!==(r=null==t?void 0:t.intervalSeconds)&&void 0!==r?r:1;let o;const s=new Promise(((r,s)=>{o=setInterval((async()=>{var n;(null===(n=null==t?void 0:t.abortSignal)||void 0===n?void 0:n.aborted)&&s(new i("Waiting for a condition has been aborted",t.abortSignal.reason)),await e()&&r()}),1e3*n)}));return s.finally((()=>{clearInterval(o)}))}function ma(e,t){return new Promise(((r,i)=>{setTimeout((async()=>{try{const t=await e();r(t)}catch(e){i(e)}}),1e3*t)}))}class ya{constructor(e){this.logger=e}async pollToSubject(e,t){for await(const r of e)t.next(r);t.complete()}createReader(e,t){let r=!1,i=!0,n=null,o=(new Date).toISOString();const s=this.logger;return{eventType:e,isFinished:r,pollValues:async function*(){for(;i;)try{n=t(o);const r=await n;s.debug("Polled events from Yagna",{eventType:e,count:r.length,lastEventTimestamp:o});for(const e of r)yield e,o=e.eventDate}catch(t){if("object"==typeof t&&"CancelError"===t.name){s.debug("Polling was cancelled",{eventType:e});continue}s.error("Error fetching events from Yagna",{eventType:e,error:t})}s.debug("Stopped reading events",{eventType:e}),r=!0},cancel:async function(){i=!1,n&&n.cancel(),await va((()=>r),{intervalSeconds:0}),s.debug("Cancelled reading the events",{eventType:e})}}}}
/*! https://mths.be/punycode v1.4.1 by @mathias */var wa,ba=2147483647,Ea=/[^\x20-\x7E]/,Sa=/[\x2E\u3002\uFF0E\uFF61]/g,Ia={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Aa=Math.floor,Pa=String.fromCharCode;function Ta(e){throw new RangeError(Ia[e])}function Ra(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function Oa(e,t,r){var i=0;for(e=r?Aa(e/700):e>>1,e+=Aa(e/t);e>455;i+=36)e=Aa(e/35);return Aa(i+36*e/(e+38))}function Ca(e){return function(e,t){var r=e.split("@"),i="";r.length>1&&(i=r[0]+"@",e=r[1]);var n=function(e,t){for(var r=e.length,i=[];r--;)i[r]=t(e[r]);return i}((e=e.replace(Sa,".")).split("."),t).join(".");return i+n}(e,(function(e){return Ea.test(e)?"xn--"+function(e){var t,r,i,n,o,s,a,c,u,l,h,d,p,f,g,v=[];for(e=function(e){for(var t,r,i=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(r=e.charCodeAt(n++)))?i.push(((1023&t)<<10)+(1023&r)+65536):(i.push(t),n--):i.push(t);return i}(e),d=e.length,t=128,r=0,o=72,s=0;s<d;++s)(h=e[s])<128&&v.push(Pa(h));for(i=n=v.length,n&&v.push("-");i<d;){for(a=ba,s=0;s<d;++s)(h=e[s])>=t&&h<a&&(a=h);for(a-t>Aa((ba-r)/(p=i+1))&&Ta("overflow"),r+=(a-t)*p,t=a,s=0;s<d;++s)if((h=e[s])<t&&++r>ba&&Ta("overflow"),h==t){for(c=r,u=36;!(c<(l=u<=o?1:u>=o+26?26:u-o));u+=36)g=c-l,f=36-l,v.push(Pa(Ra(l+g%f,0))),c=Aa(g/f);v.push(Pa(Ra(c,0))),o=Oa(r,p,i==n),r=0,++i}++r,++t}return v.join("")}(e):e}))}wa="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e};var Na=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},i=0;i<t.length;i++)r[t[i]]=Object.getOwnPropertyDescriptor(e,t[i]);return r},ka=/%[sdj%]/g;function _a(e){if(!Ya(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(Ba(arguments[r]));return t.join(" ")}r=1;for(var i=arguments,n=i.length,o=String(e).replace(ka,(function(e){if("%%"===e)return"%";if(r>=n)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(e){return"[Circular]"}default:return e}})),s=i[r];r<n;s=i[++r])za(s)||!Qa(s)?o+=" "+s:o+=" "+Ba(s);return o}function xa(e,t){if(Ja(f.process))return function(){return xa(e,t).apply(this,arguments)};if(!0===$.noDeprecation)return e;var r=!1;return function(){if(!r){if($.throwDeprecation)throw new Error(t);$.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}}var Da,Fa={};function qa(e){if(Ja(Da)&&(Da=$.env.NODE_DEBUG||""),e=e.toUpperCase(),!Fa[e])if(new RegExp("\\b"+e+"\\b","i").test(Da)){Fa[e]=function(){var t=_a.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else Fa[e]=function(){};return Fa[e]}function Ba(e,t){var r={seen:[],stylize:$a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),Ha(t)?r.showHidden=t:t&&cc(r,t),Ja(r.showHidden)&&(r.showHidden=!1),Ja(r.depth)&&(r.depth=2),Ja(r.colors)&&(r.colors=!1),Ja(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=ja),Ma(r,e,r.depth)}function ja(e,t){var r=Ba.styles[t];return r?"["+Ba.colors[r][0]+"m"+e+"["+Ba.colors[r][1]+"m":e}function $a(e,t){return e}function Ma(e,t,r){if(e.customInspect&&t&&tc(t.inspect)&&t.inspect!==Ba&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return Ya(i)||(i=Ma(e,i,r)),i}var n=function(e,t){if(Ja(t))return e.stylize("undefined","undefined");if(Ya(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(Ga(t))return e.stylize(""+t,"number");if(Ha(t))return e.stylize(""+t,"boolean");if(za(t))return e.stylize("null","null")}(e,t);if(n)return n;var o=Object.keys(t),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),ec(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return La(t);if(0===o.length){if(tc(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(Xa(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Za(t))return e.stylize(Date.prototype.toString.call(t),"date");if(ec(t))return La(t)}var c,u="",l=!1,h=["{","}"];(Ua(t)&&(l=!0,h=["[","]"]),tc(t))&&(u=" [Function"+(t.name?": "+t.name:"")+"]");return Xa(t)&&(u=" "+RegExp.prototype.toString.call(t)),Za(t)&&(u=" "+Date.prototype.toUTCString.call(t)),ec(t)&&(u=" "+La(t)),0!==o.length||l&&0!=t.length?r<0?Xa(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=l?function(e,t,r,i,n){for(var o=[],s=0,a=t.length;s<a;++s)uc(t,String(s))?o.push(Va(e,t,r,i,String(s),!0)):o.push("");return n.forEach((function(n){n.match(/^\d+$/)||o.push(Va(e,t,r,i,n,!0))})),o}(e,t,r,s,o):o.map((function(i){return Va(e,t,r,s,i,l)})),e.seen.pop(),function(e,t,r){var i=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(i>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,u,h)):h[0]+u+h[1]}function La(e){return"["+Error.prototype.toString.call(e)+"]"}function Va(e,t,r,i,n,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),uc(i,n)||(s="["+n+"]"),a||(e.seen.indexOf(c.value)<0?(a=za(r)?Ma(e,c.value,null):Ma(e,c.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),Ja(s)){if(o&&n.match(/^\d+$/))return a;(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function Ua(e){return Array.isArray(e)}function Ha(e){return"boolean"==typeof e}function za(e){return null===e}function Wa(e){return null==e}function Ga(e){return"number"==typeof e}function Ya(e){return"string"==typeof e}function Ka(e){return"symbol"==typeof e}function Ja(e){return void 0===e}function Xa(e){return Qa(e)&&"[object RegExp]"===nc(e)}function Qa(e){return"object"==typeof e&&null!==e}function Za(e){return Qa(e)&&"[object Date]"===nc(e)}function ec(e){return Qa(e)&&("[object Error]"===nc(e)||e instanceof Error)}function tc(e){return"function"==typeof e}function rc(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function ic(e){return Ee.isBuffer(e)}function nc(e){return Object.prototype.toString.call(e)}function oc(e){return e<10?"0"+e.toString(10):e.toString(10)}Ba.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Ba.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var sc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ac(){var e,t;console.log("%s - %s",(e=new Date,t=[oc(e.getHours()),oc(e.getMinutes()),oc(e.getSeconds())].join(":"),[e.getDate(),sc[e.getMonth()],t].join(" ")),_a.apply(null,arguments))}function cc(e,t){if(!t||!Qa(t))return e;for(var r=Object.keys(t),i=r.length;i--;)e[r[i]]=t[r[i]];return e}function uc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var lc="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function hc(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(lc&&e[lc]){var t;if("function"!=typeof(t=e[lc]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,lc,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,i=new Promise((function(e,i){t=e,r=i})),n=[],o=0;o<arguments.length;o++)n.push(arguments[o]);n.push((function(e,i){e?r(e):t(i)}));try{e.apply(this,n)}catch(e){r(e)}return i}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),lc&&Object.defineProperty(t,lc,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,Na(e))}function dc(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}function pc(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);var i=t.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var n=this,o=function(){return i.apply(n,arguments)};e.apply(this,t).then((function(e){$.nextTick(o.bind(null,null,e))}),(function(e){$.nextTick(dc.bind(null,e,o))}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,Na(e)),t}hc.custom=lc;var fc={inherits:wa,_extend:cc,log:ac,isBuffer:ic,isPrimitive:rc,isFunction:tc,isError:ec,isDate:Za,isObject:Qa,isRegExp:Xa,isUndefined:Ja,isSymbol:Ka,isString:Ya,isNumber:Ga,isNullOrUndefined:Wa,isNull:za,isBoolean:Ha,isArray:Ua,inspect:Ba,deprecate:xa,format:_a,debuglog:qa,promisify:hc,callbackify:pc},gc=Object.freeze({__proto__:null,_extend:cc,callbackify:pc,debuglog:qa,default:fc,deprecate:xa,format:_a,inherits:wa,inspect:Ba,isArray:Ua,isBoolean:Ha,isBuffer:ic,isDate:Za,isError:ec,isFunction:tc,isNull:za,isNullOrUndefined:Wa,isNumber:Ga,isObject:Qa,isPrimitive:rc,isRegExp:Xa,isString:Ya,isSymbol:Ka,isUndefined:Ja,log:ac,promisify:hc});function vc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var mc=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function yc(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function wc(e,t){if(e.map)return e.map(t);for(var r=[],i=0;i<e.length;i++)r.push(t(e[i],i));return r}var bc=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t};function Ec(e,t,r,i){t=t||"&",r=r||"=";var n={};if("string"!=typeof e||0===e.length)return n;var o=/\+/g;e=e.split(t);var s=1e3;i&&"number"==typeof i.maxKeys&&(s=i.maxKeys);var a=e.length;s>0&&a>s&&(a=s);for(var c=0;c<a;++c){var u,l,h,d,p=e[c].replace(o,"%20"),f=p.indexOf(r);f>=0?(u=p.substr(0,f),l=p.substr(f+1)):(u=p,l=""),h=decodeURIComponent(u),d=decodeURIComponent(l),vc(n,h)?mc(n[h])?n[h].push(d):n[h]=[n[h],d]:n[h]=d}return n}const Sc=f.URL,Ic=f.URLSearchParams;var Ac={parse:$c,resolve:Hc,resolveObject:zc,fileURLToPath:Lc,format:Vc,Url:Pc,URL:Sc,URLSearchParams:Ic};function Pc(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Tc=/^([a-z0-9.+-]+:)/i,Rc=/:[0-9]*$/,Oc=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Cc=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Nc=["'"].concat(Cc),kc=["%","/","?",";","#"].concat(Nc),_c=["/","?","#"],xc=255,Dc=/^[+a-z0-9A-Z_-]{0,63}$/,Fc=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,qc={javascript:!0,"javascript:":!0},Bc={javascript:!0,"javascript:":!0},jc={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function $c(e,t,r){if(e&&Qa(e)&&e instanceof Pc)return e;var i=new Pc;return i.parse(e,t,r),i}function Mc(e,t,r,i){if(!Ya(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),o=-1!==n&&n<t.indexOf("#")?"?":"#",s=t.split(o);s[0]=s[0].replace(/\\/g,"/");var a=t=s.join(o);if(a=a.trim(),!i&&1===t.split("#").length){var c=Oc.exec(a);if(c)return e.path=a,e.href=a,e.pathname=c[1],c[2]?(e.search=c[2],e.query=r?Ec(e.search.substr(1)):e.search.substr(1)):r&&(e.search="",e.query={}),e}var u,l,h,d,p=Tc.exec(a);if(p){var f=(p=p[0]).toLowerCase();e.protocol=f,a=a.substr(p.length)}if(i||p||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var g="//"===a.substr(0,2);!g||p&&Bc[p]||(a=a.substr(2),e.slashes=!0)}if(!Bc[p]&&(g||p&&!jc[p])){var v,m,y=-1;for(u=0;u<_c.length;u++)-1!==(l=a.indexOf(_c[u]))&&(-1===y||l<y)&&(y=l);for(-1!==(m=-1===y?a.lastIndexOf("@"):a.lastIndexOf("@",y))&&(v=a.slice(0,m),a=a.slice(m+1),e.auth=decodeURIComponent(v)),y=-1,u=0;u<kc.length;u++)-1!==(l=a.indexOf(kc[u]))&&(-1===y||l<y)&&(y=l);-1===y&&(y=a.length),e.host=a.slice(0,y),a=a.slice(y),Wc(e),e.hostname=e.hostname||"";var w="["===e.hostname[0]&&"]"===e.hostname[e.hostname.length-1];if(!w){var b=e.hostname.split(/\./);for(u=0,h=b.length;u<h;u++){var E=b[u];if(E&&!E.match(Dc)){for(var S="",I=0,A=E.length;I<A;I++)E.charCodeAt(I)>127?S+="x":S+=E[I];if(!S.match(Dc)){var P=b.slice(0,u),T=b.slice(u+1),R=E.match(Fc);R&&(P.push(R[1]),T.unshift(R[2])),T.length&&(a="/"+T.join(".")+a),e.hostname=P.join(".");break}}}}e.hostname.length>xc?e.hostname="":e.hostname=e.hostname.toLowerCase(),w||(e.hostname=Ca(e.hostname)),d=e.port?":"+e.port:"";var O=e.hostname||"";e.host=O+d,e.href+=e.host,w&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!qc[f])for(u=0,h=Nc.length;u<h;u++){var C=Nc[u];if(-1!==a.indexOf(C)){var N=encodeURIComponent(C);N===C&&(N=escape(C)),a=a.split(C).join(N)}}var k=a.indexOf("#");-1!==k&&(e.hash=a.substr(k),a=a.slice(0,k));var _=a.indexOf("?");if(-1!==_?(e.search=a.substr(_),e.query=a.substr(_+1),r&&(e.query=Ec(e.query)),a=a.slice(0,_)):r&&(e.search="",e.query={}),a&&(e.pathname=a),jc[f]&&e.hostname&&!e.pathname&&(e.pathname="/"),e.pathname||e.search){d=e.pathname||"";var x=e.search||"";e.path=d+x}return e.href=Uc(e),e}function Lc(e){if("string"==typeof e)e=(new Pc).parse(e);else if(!(e instanceof Pc))throw new TypeError('The "path" argument must be of type string or an instance of URL. Received type '+typeof e+String(e));if("file:"!==e.protocol)throw new TypeError("The URL must be of scheme file");return function(e){const t=e.pathname;for(let e=0;e<t.length;e++)if("%"===t[e]){const r=32|t.codePointAt(e+2);if("2"===t[e+1]&&102===r)throw new TypeError("must not include encoded / characters")}return decodeURIComponent(t)}(e)}function Vc(e){return Ya(e)&&(e=Mc({},e)),Uc(e)}function Uc(e){var t=e.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var r=e.protocol||"",i=e.pathname||"",n=e.hash||"",o=!1,s="";e.host?o=t+e.host:e.hostname&&(o=t+(-1===e.hostname.indexOf(":")?e.hostname:"["+this.hostname+"]"),e.port&&(o+=":"+e.port)),e.query&&Qa(e.query)&&Object.keys(e.query).length&&(s=function(e,t,r,i){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?wc(bc(e),(function(i){var n=encodeURIComponent(yc(i))+r;return mc(e[i])?wc(e[i],(function(e){return n+encodeURIComponent(yc(e))})).join(t):n+encodeURIComponent(yc(e[i]))})).join(t):i?encodeURIComponent(yc(i))+r+encodeURIComponent(yc(e)):""}(e.query));var a=e.search||s&&"?"+s||"";return r&&":"!==r.substr(-1)&&(r+=":"),e.slashes||(!r||jc[r])&&!1!==o?(o="//"+(o||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),r+o+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n}function Hc(e,t){return $c(e,!1,!0).resolve(t)}function zc(e,t){return e?$c(e,!1,!0).resolveObject(t):t}function Wc(e){var t=e.host,r=Rc.exec(t);r&&(":"!==(r=r[0])&&(e.port=r.substr(1)),t=t.substr(0,t.length-r.length)),t&&(e.hostname=t)}Pc.prototype.parse=function(e,t,r){return Mc(this,e,t,r)},Pc.prototype.format=function(){return Uc(this)},Pc.prototype.resolve=function(e){return this.resolveObject($c(e,!1,!0)).format()},Pc.prototype.resolveObject=function(e){if(Ya(e)){var t=new Pc;t.parse(e,!1,!0),e=t}for(var r,i=new Pc,n=Object.keys(this),o=0;o<n.length;o++){var s=n[o];i[s]=this[s]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),c=0;c<a.length;c++){var u=a[c];"protocol"!==u&&(i[u]=e[u])}return jc[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!jc[e.protocol]){for(var l=Object.keys(e),h=0;h<l.length;h++){var d=l[h];i[d]=e[d]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||Bc[e.protocol])i.pathname=e.pathname;else{for(r=(e.pathname||"").split("/");r.length&&!(e.host=r.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),i.pathname=r.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var p=i.pathname||"",f=i.search||"";i.path=p+f}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var g,v=i.pathname&&"/"===i.pathname.charAt(0),m=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=m||v||i.host&&e.pathname,w=y,b=i.pathname&&i.pathname.split("/")||[],E=i.protocol&&!jc[i.protocol];if(r=e.pathname&&e.pathname.split("/")||[],E&&(i.hostname="",i.port=null,i.host&&(""===b[0]?b[0]=i.host:b.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===r[0]?r[0]=e.host:r.unshift(e.host)),e.host=null),y=y&&(""===r[0]||""===b[0])),m)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,b=r;else if(r.length)b||(b=[]),b.pop(),b=b.concat(r),i.search=e.search,i.query=e.query;else if(!Wa(e.search))return E&&(i.hostname=i.host=b.shift(),(g=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=g.shift(),i.host=i.hostname=g.shift())),i.search=e.search,i.query=e.query,za(i.pathname)&&za(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!b.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var S=b.slice(-1)[0],I=(i.host||e.host||b.length>1)&&("."===S||".."===S)||""===S,A=0,P=b.length;P>=0;P--)"."===(S=b[P])?b.splice(P,1):".."===S?(b.splice(P,1),A++):A&&(b.splice(P,1),A--);if(!y&&!w)for(;A--;A)b.unshift("..");!y||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),I&&"/"!==b.join("/").substr(-1)&&b.push("");var T=""===b[0]||b[0]&&"/"===b[0].charAt(0);return E&&(i.hostname=i.host=T?"":b.length?b.shift():"",(g=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=g.shift(),i.host=i.hostname=g.shift())),(y=y||i.host&&b.length)&&!T&&b.unshift(""),b.length?i.pathname=b.join("/"):(i.pathname=null,i.path=null),za(i.pathname)&&za(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},Pc.prototype.parseHost=function(){return Wc(this)};var Gc=V(Object.freeze({__proto__:null,URL:Sc,URLSearchParams:Ic,Url:Pc,default:Ac,fileURLToPath:Lc,format:Vc,parse:$c,resolve:Hc,resolveObject:zc}));function Yc(){}function Kc(){Kc.init.call(this)}function Jc(e){return void 0===e._maxListeners?Kc.defaultMaxListeners:e._maxListeners}function Xc(e,t,r,i){var n,o,s,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]):(o=e._events=new Yc,e._eventsCount=0),s){if("function"==typeof s?s=o[t]=i?[r,s]:[s,r]:i?s.unshift(r):s.push(r),!s.warned&&(n=Jc(e))&&n>0&&s.length>n){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,"function"==typeof console.warn?console.warn(a):console.log(a)}}else s=o[t]=r,++e._eventsCount;return e}function Qc(e,t,r){var i=!1;function n(){e.removeListener(t,n),i||(i=!0,r.apply(e,arguments))}return n.listener=r,n}function Zc(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function eu(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}Yc.prototype=Object.create(null),Kc.EventEmitter=Kc,Kc.usingDomains=!1,Kc.prototype.domain=void 0,Kc.prototype._events=void 0,Kc.prototype._maxListeners=void 0,Kc.defaultMaxListeners=10,Kc.init=function(){this.domain=null,Kc.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Yc,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Kc.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Kc.prototype.getMaxListeners=function(){return Jc(this)},Kc.prototype.emit=function(e){var t,r,i,n,o,s,a,c="error"===e;if(s=this._events)c=c&&null==s.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(r=s[e]))return!1;var l="function"==typeof r;switch(i=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var i=e.length,n=eu(e,i),o=0;o<i;++o)n[o].call(r)}(r,l,this);break;case 2:!function(e,t,r,i){if(t)e.call(r,i);else for(var n=e.length,o=eu(e,n),s=0;s<n;++s)o[s].call(r,i)}(r,l,this,arguments[1]);break;case 3:!function(e,t,r,i,n){if(t)e.call(r,i,n);else for(var o=e.length,s=eu(e,o),a=0;a<o;++a)s[a].call(r,i,n)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,i,n,o){if(t)e.call(r,i,n,o);else for(var s=e.length,a=eu(e,s),c=0;c<s;++c)a[c].call(r,i,n,o)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),o=1;o<i;o++)n[o-1]=arguments[o];!function(e,t,r,i){if(t)e.apply(r,i);else for(var n=e.length,o=eu(e,n),s=0;s<n;++s)o[s].apply(r,i)}(r,l,this,n)}return!0},Kc.prototype.addListener=function(e,t){return Xc(this,e,t,!1)},Kc.prototype.on=Kc.prototype.addListener,Kc.prototype.prependListener=function(e,t){return Xc(this,e,t,!0)},Kc.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Qc(this,e,t)),this},Kc.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Qc(this,e,t)),this},Kc.prototype.removeListener=function(e,t){var r,i,n,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new Yc:(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,o=r.length;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){s=r[o].listener,n=o;break}if(n<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new Yc,this;delete i[e]}else!function(e,t){for(var r=t,i=r+1,n=e.length;i<n;r+=1,i+=1)e[r]=e[i];e.pop()}(r,n);i.removeListener&&this.emit("removeListener",e,s||t)}return this},Kc.prototype.off=function(e,t){return this.removeListener(e,t)},Kc.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new Yc,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new Yc:delete r[e]),this;if(0===arguments.length){for(var i,n=Object.keys(r),o=0;o<n.length;++o)"removeListener"!==(i=n[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new Yc,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Kc.prototype.listeners=function(e){var t,r,i=this._events;return r=i&&(t=i[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[],r},Kc.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Zc.call(e,t)},Kc.prototype.listenerCount=Zc,Kc.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var tu,ru,iu=V(Object.freeze({__proto__:null,EventEmitter:Kc,default:Kc})),nu=pu(f.fetch)&&pu(f.ReadableStream);function ou(e){ru||(ru=new f.XMLHttpRequest).open("GET",f.location.host?"/":"https://example.com");try{return ru.responseType=e,ru.responseType===e}catch(e){return!1}}var su=void 0!==f.ArrayBuffer,au=su&&pu(f.ArrayBuffer.prototype.slice),cu=su&&ou("arraybuffer"),uu=!nu&&au&&ou("ms-stream"),lu=!nu&&su&&ou("moz-chunked-arraybuffer"),hu=pu(ru.overrideMimeType),du=pu(f.VBArray);function pu(e){return"function"==typeof e}function fu(){this.head=null,this.tail=null,this.length=0}ru=null,fu.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},fu.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},fu.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},fu.prototype.clear=function(){this.head=this.tail=null,this.length=0},fu.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},fu.prototype.concat=function(e){if(0===this.length)return Ee.alloc(0);if(1===this.length)return this.head.data;for(var t=Ee.allocUnsafe(e>>>0),r=this.head,i=0;r;)r.data.copy(t,i),i+=r.data.length,r=r.next;return t};var gu=Ee.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function vu(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!gu(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=yu;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=wu;break;default:return void(this.write=mu)}this.charBuffer=new Ee(6),this.charReceived=0,this.charLength=0}function mu(e){return e.toString(this.encoding)}function yu(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function wu(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}vu.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(e=e.slice(r,e.length),!((n=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&n<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived);var n;i=(t+=e.toString(this.encoding,0,i)).length-1;if((n=t.charCodeAt(i))>=55296&&n<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},vu.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},vu.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,i=this.charBuffer,n=this.encoding;t+=i.slice(0,r).toString(n)}return t},Su.ReadableState=Eu;var bu=qa("stream");function Eu(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof Ju&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new fu,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new vu(e.encoding),this.encoding=e.encoding)}function Su(e){if(!(this instanceof Su))return new Su(e);this._readableState=new Eu(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),Kc.call(this)}function Iu(e,t,r,i,n){var o=function(e,t){var r=null;Ee.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(t,r);if(o)e.emit("error",o);else if(null===r)t.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,Tu(e)}(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!n){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&n){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else{var c;!t.decoder||n||i||(r=t.decoder.write(r),c=!t.objectMode&&0===r.length),n||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&Tu(e))),function(e,t){t.readingMore||(t.readingMore=!0,T(Ou,e,t))}(e,t)}else n||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}wa(Su,Kc),Su.prototype.push=function(e,t){var r=this._readableState;return r.objectMode||"string"!=typeof e||(t=t||r.defaultEncoding)!==r.encoding&&(e=Ee.from(e,t),t=""),Iu(this,r,e,t,!1)},Su.prototype.unshift=function(e){return Iu(this,this._readableState,e,"",!0)},Su.prototype.isPaused=function(){return!1===this._readableState.flowing},Su.prototype.setEncoding=function(e){return this._readableState.decoder=new vu(e),this._readableState.encoding=e,this};var Au=8388608;function Pu(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=Au?e=Au:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function Tu(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(bu("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?T(Ru,e):Ru(e))}function Ru(e){bu("emit readable"),e.emit("readable"),ku(e)}function Ou(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(bu("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function Cu(e){bu("readable nexttick read 0"),e.read(0)}function Nu(e,t){t.reading||(bu("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),ku(e),t.flowing&&!t.reading&&e.read(0)}function ku(e){var t=e._readableState;for(bu("flow",t.flowing);t.flowing&&null!==e.read(););}function _u(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var i;e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,i=1,n=r.data;e-=n.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(s===o.length?n+=o:n+=o.slice(0,e),0===(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t):function(e,t){var r=Ee.allocUnsafe(e),i=t.head,n=1;i.data.copy(r),e-=i.data.length;for(;i=i.next;){var o=i.data,s=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,s),0===(e-=s)){s===o.length?(++n,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=o.slice(s));break}++n}return t.length-=n,r}(e,t);return i}(e,t.buffer,t.decoder),r);var r}function xu(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,T(Du,t,e))}function Du(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function Fu(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}function qu(){}function Bu(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function ju(e,t){Object.defineProperty(this,"buffer",{get:xa((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof Ju&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=!1===e.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,n=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,n){--t.pendingcb,r?T(n,i):n(i);e._writableState.errorEmitted=!0,e.emit("error",i)}(e,r,i,t,n);else{var o=Uu(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||Vu(e,r),i?T(Lu,e,r,o,n):Lu(e,r,o,n)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Wu(this)}function $u(e){if(!(this instanceof $u||this instanceof Ju))return new $u(e);this._writableState=new ju(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),Kc.call(this)}function Mu(e,t,r,i,n,o,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(n,t.onwrite):e._write(n,o,t.onwrite),t.sync=!1}function Lu(e,t,r,i){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),zu(e,t)}function Vu(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,n=new Array(i),o=t.corkedRequestsFree;o.entry=r;for(var s=0;r;)n[s]=r,r=r.next,s+=1;Mu(e,t,!0,t.length,n,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new Wu(t)}else{for(;r;){var a=r.chunk,c=r.encoding,u=r.callback;if(Mu(e,t,!1,t.objectMode?1:a.length,a,c,u),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function Uu(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function Hu(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function zu(e,t){var r=Uu(t);return r&&(0===t.pendingcb?(Hu(e,t),t.finished=!0,e.emit("finish")):Hu(e,t)),r}function Wu(e){var t=this;this.next=null,this.entry=null,this.finish=function(r){var i=t.entry;for(t.entry=null;i;){var n=i.callback;e.pendingcb--,n(r),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}Su.prototype.read=function(e){bu("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return bu("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?xu(this):Tu(this),null;if(0===(e=Pu(e,t))&&t.ended)return 0===t.length&&xu(this),null;var i,n=t.needReadable;return bu("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&bu("length less than watermark",n=!0),t.ended||t.reading?bu("reading or ended",n=!1):n&&(bu("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=Pu(r,t))),null===(i=e>0?_u(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&xu(this)),null!==i&&this.emit("data",i),i},Su.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Su.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,bu("pipe count=%d opts=%j",i.pipesCount,t);var n=!t||!1!==t.end?s:u;function o(e){bu("onunpipe"),e===r&&u()}function s(){bu("onend"),e.end()}i.endEmitted?T(n):r.once("end",n),e.on("unpipe",o);var a=function(e){return function(){var t=e._readableState;bu("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,ku(e))}}(r);e.on("drain",a);var c=!1;function u(){bu("cleanup"),e.removeListener("close",p),e.removeListener("finish",f),e.removeListener("drain",a),e.removeListener("error",d),e.removeListener("unpipe",o),r.removeListener("end",s),r.removeListener("end",u),r.removeListener("data",h),c=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||a()}var l=!1;function h(t){bu("ondata"),l=!1,!1!==e.write(t)||l||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==Fu(i.pipes,e))&&!c&&(bu("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,l=!0),r.pause())}function d(t){var r;bu("onerror",t),g(),e.removeListener("error",d),0===(r="error",e.listeners(r).length)&&e.emit("error",t)}function p(){e.removeListener("finish",f),g()}function f(){bu("onfinish"),e.removeListener("close",p),g()}function g(){bu("unpipe"),r.unpipe(e)}return r.on("data",h),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",d),e.once("close",p),e.once("finish",f),e.emit("pipe",r),i.flowing||(bu("pipe resume"),r.resume()),e},Su.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var n=0;n<i;n++)r[n].emit("unpipe",this);return this}var o=Fu(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},Su.prototype.on=function(e,t){var r=Kc.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&Tu(this):T(Cu,this))}return r},Su.prototype.addListener=Su.prototype.on,Su.prototype.resume=function(){var e=this._readableState;return e.flowing||(bu("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,T(Nu,e,t))}(this,e)),this},Su.prototype.pause=function(){return bu("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(bu("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Su.prototype.wrap=function(e){var t=this._readableState,r=!1,i=this;for(var n in e.on("end",(function(){if(bu("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&i.push(e)}i.push(null)})),e.on("data",(function(n){(bu("wrapped data"),t.decoder&&(n=t.decoder.write(n)),t.objectMode&&null==n)||(t.objectMode||n&&n.length)&&(i.push(n)||(r=!0,e.pause()))})),e)void 0===this[n]&&"function"==typeof e[n]&&(this[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n));return function(e,t){for(var r=0,i=e.length;r<i;r++)t(e[r],r)}(["error","close","destroy","pause","resume"],(function(t){e.on(t,i.emit.bind(i,t))})),i._read=function(t){bu("wrapped _read",t),r&&(r=!1,e.resume())},i},Su._fromList=_u,$u.WritableState=ju,wa($u,Kc),ju.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},$u.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},$u.prototype.write=function(e,t,r){var i=this._writableState,n=!1;return"function"==typeof t&&(r=t,t=null),Ee.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=qu),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),T(t,r)}(this,r):function(e,t,r,i){var n=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):Ee.isBuffer(r)||"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),T(i,o),n=!1),n}(this,i,e,r)&&(i.pendingcb++,n=function(e,t,r,i,n){r=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=Ee.from(t,r));return t}(t,r,i),Ee.isBuffer(r)&&(i="buffer");var o=t.objectMode?1:r.length;t.length+=o;var s=t.length<t.highWaterMark;s||(t.needDrain=!0);if(t.writing||t.corked){var a=t.lastBufferedRequest;t.lastBufferedRequest=new Bu(r,i,n),a?a.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Mu(e,t,!1,o,r,i,n);return s}(this,i,e,t,r)),n},$u.prototype.cork=function(){this._writableState.corked++},$u.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||Vu(this,e))},$u.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},$u.prototype._write=function(e,t,r){r(new Error("not implemented"))},$u.prototype._writev=null,$u.prototype.end=function(e,t,r){var i=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,r){t.ending=!0,zu(e,t),r&&(t.finished?T(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,i,r)},wa(Ju,Su);for(var Gu=Object.keys($u.prototype),Yu=0;Yu<Gu.length;Yu++){var Ku=Gu[Yu];Ju.prototype[Ku]||(Ju.prototype[Ku]=$u.prototype[Ku])}function Ju(e){if(!(this instanceof Ju))return new Ju(e);Su.call(this,e),$u.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",Xu)}function Xu(){this.allowHalfOpen||this._writableState.ended||T(Qu,this)}function Qu(e){e.end()}var Zu=3,el=4;function tl(e,t,r){var i,n=this;if(Su.call(n),n._mode=r,n.headers={},n.rawHeaders=[],n.trailers={},n.rawTrailers=[],n.on("end",(function(){$.nextTick((function(){n.emit("close")}))})),"fetch"===r){n._fetchResponse=t,n.url=t.url,n.statusCode=t.status,n.statusMessage=t.statusText;for(var o,s,a=t.headers[Symbol.iterator]();o=(s=a.next()).value,!s.done;)n.headers[o[0].toLowerCase()]=o[1],n.rawHeaders.push(o[0],o[1]);var c=t.body.getReader();(i=function(){c.read().then((function(e){n._destroyed||(e.done?n.push(null):(n.push(new Ee(e.value)),i()))}))})()}else{if(n._xhr=e,n._pos=0,n.url=e.responseURL,n.statusCode=e.status,n.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach((function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var r=t[1].toLowerCase();"set-cookie"===r?(void 0===n.headers[r]&&(n.headers[r]=[]),n.headers[r].push(t[2])):void 0!==n.headers[r]?n.headers[r]+=", "+t[2]:n.headers[r]=t[2],n.rawHeaders.push(t[1],t[2])}})),n._charset="x-user-defined",!hu){var u=n.rawHeaders["mime-type"];if(u){var l=u.match(/;\s*charset=([^;])(;|$)/);l&&(n._charset=l[1].toLowerCase())}n._charset||(n._charset="utf-8")}}}function rl(e){var t,r=this;$u.call(r),r._opts=e,r._body=[],r._headers={},e.auth&&r.setHeader("Authorization","Basic "+new Ee(e.auth).toString("base64")),Object.keys(e.headers).forEach((function(t){r.setHeader(t,e.headers[t])}));var i=!0;if("disable-fetch"===e.mode)i=!1,t=!0;else if("prefer-streaming"===e.mode)t=!1;else if("allow-wrong-content-type"===e.mode)t=!hu;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");t=!0}r._mode=function(e,t){return nu&&t?"fetch":lu?"moz-chunked-arraybuffer":uu?"ms-stream":cu&&e?"arraybuffer":du&&e?"text:vbarray":"text"}(t,i),r.on("finish",(function(){r._onFinish()}))}wa(tl,Su),tl.prototype._read=function(){},tl.prototype._onXHRProgress=function(){var e=this,t=e._xhr,r=null;switch(e._mode){case"text:vbarray":if(t.readyState!==el)break;try{r=new f.VBArray(t.responseBody).toArray()}catch(e){}if(null!==r){e.push(new Ee(r));break}case"text":try{r=t.responseText}catch(t){e._mode="text:vbarray";break}if(r.length>e._pos){var i=r.substr(e._pos);if("x-user-defined"===e._charset){for(var n=new Ee(i.length),o=0;o<i.length;o++)n[o]=255&i.charCodeAt(o);e.push(n)}else e.push(i,e._charset);e._pos=r.length}break;case"arraybuffer":if(t.readyState!==el||!t.response)break;r=t.response,e.push(new Ee(new Uint8Array(r)));break;case"moz-chunked-arraybuffer":if(r=t.response,t.readyState!==Zu||!r)break;e.push(new Ee(new Uint8Array(r)));break;case"ms-stream":if(r=t.response,t.readyState!==Zu)break;var s=new f.MSStreamReader;s.onprogress=function(){s.result.byteLength>e._pos&&(e.push(new Ee(new Uint8Array(s.result.slice(e._pos)))),e._pos=s.result.byteLength)},s.onload=function(){e.push(null)},s.readAsArrayBuffer(r)}e._xhr.readyState===el&&"ms-stream"!==e._mode&&e.push(null)},wa(rl,$u);var il=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];function nl(e,t){"string"==typeof e&&(e=$c(e));var r=-1===f.location.protocol.search(/^https?:$/)?"http:":"",i=e.protocol||r,n=e.hostname||e.host,o=e.port,s=e.path||"/";n&&-1!==n.indexOf(":")&&(n="["+n+"]"),e.url=(n?i+"//"+n:"")+(o?":"+o:"")+s,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};var a=new rl(e);return t&&a.on("response",t),a}function ol(e,t){var r=nl(e,t);return r.end(),r}function sl(){}rl.prototype.setHeader=function(e,t){var r=e.toLowerCase();-1===il.indexOf(r)&&(this._headers[r]={name:e,value:t})},rl.prototype.getHeader=function(e){return this._headers[e.toLowerCase()].value},rl.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},rl.prototype._onFinish=function(){var e=this;if(!e._destroyed){var t,r=e._opts,i=e._headers;if("POST"!==r.method&&"PUT"!==r.method&&"PATCH"!==r.method||(t=function(){if(void 0!==tu)return tu;try{new f.Blob([new ArrayBuffer(1)]),tu=!0}catch(e){tu=!1}return tu}()?new f.Blob(e._body.map((function(e){return function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(nt(e)){for(var t=new Uint8Array(e.length),r=e.length,i=0;i<r;i++)t[i]=e[i];return t.buffer}throw new Error("Argument must be a Buffer")}(e)})),{type:(i["content-type"]||{}).value||""}):Ee.concat(e._body).toString()),"fetch"===e._mode){var n=Object.keys(i).map((function(e){return[i[e].name,i[e].value]}));f.fetch(e._opts.url,{method:e._opts.method,headers:n,body:t,mode:"cors",credentials:r.withCredentials?"include":"same-origin"}).then((function(t){e._fetchResponse=t,e._connect()}),(function(t){e.emit("error",t)}))}else{var o=e._xhr=new f.XMLHttpRequest;try{o.open(e._opts.method,e._opts.url,!0)}catch(t){return void $.nextTick((function(){e.emit("error",t)}))}"responseType"in o&&(o.responseType=e._mode.split(":")[0]),"withCredentials"in o&&(o.withCredentials=!!r.withCredentials),"text"===e._mode&&"overrideMimeType"in o&&o.overrideMimeType("text/plain; charset=x-user-defined"),Object.keys(i).forEach((function(e){o.setRequestHeader(i[e].name,i[e].value)})),e._response=null,o.onreadystatechange=function(){switch(o.readyState){case Zu:case el:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(o.onprogress=function(){e._onXHRProgress()}),o.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{o.send(t)}catch(t){return void $.nextTick((function(){e.emit("error",t)}))}}}},rl.prototype._onXHRProgress=function(){var e=this;(function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return!1}})(e._xhr)&&!e._destroyed&&(e._response||e._connect(),e._response._onXHRProgress())},rl.prototype._connect=function(){var e=this;e._destroyed||(e._response=new tl(e._xhr,e._fetchResponse,e._mode),e.emit("response",e._response))},rl.prototype._write=function(e,t,r){this._body.push(e),r()},rl.prototype.abort=rl.prototype.destroy=function(){var e=this;e._destroyed=!0,e._response&&(e._response._destroyed=!0),e._xhr&&e._xhr.abort()},rl.prototype.end=function(e,t,r){"function"==typeof e&&(r=e,e=void 0),$u.prototype.end.call(this,e,t,r)},rl.prototype.flushHeaders=function(){},rl.prototype.setTimeout=function(){},rl.prototype.setNoDelay=function(){},rl.prototype.setSocketKeepAlive=function(){},sl.defaultMaxSockets=4;var al=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"],cl={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},ul={request:nl,get:ol,Agent:sl,METHODS:al,STATUS_CODES:cl},ll=V(Object.freeze({__proto__:null,Agent:sl,METHODS:al,STATUS_CODES:cl,default:ul,get:ol,request:nl}));function hl(e,t){"string"==typeof e&&(e=$c(e));var r=-1===f.location.protocol.search(/^https?:$/)?"http:":"",i=e.protocol||r,n=e.hostname||e.host,o=e.port,s=e.path||"/";n&&-1!==n.indexOf(":")&&(n="["+n+"]"),e.url=(n?i+"//"+n:"")+(o?":"+o:"")+s,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};var a=new rl(e);return t&&a.on("response",t),a}function dl(e,t){var r=hl(e,t);return r.end(),r}function pl(){}pl.defaultMaxSockets=4;var fl=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"],gl={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},vl={request:hl,get:dl,Agent:pl,METHODS:fl,STATUS_CODES:gl},ml=V(Object.freeze({__proto__:null,Agent:pl,METHODS:fl,STATUS_CODES:gl,default:vl,get:dl,request:hl})),yl=V(gc),wl=Gc.parse,bl=iu,El=ll,Sl=ml,Il=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],Al=[239,187,191],Pl=262144,Tl=/^(cookie|authorization)$/i;function Rl(e,t){var r=Rl.CONNECTING,i=t&&t.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return r}}),Object.defineProperty(this,"url",{get:function(){return e}});var o,s=this;function a(t){r!==Rl.CLOSED&&(r=Rl.CONNECTING,f("error",new Cl("error",{message:t})),d&&(e=d,d=null,n=!1),setTimeout((function(){r!==Rl.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,p())}),s.reconnectInterval))}s.reconnectInterval=1e3,s.connectionInProgress=!1;var c="";i&&i["Last-Event-ID"]&&(c=i["Last-Event-ID"],delete i["Last-Event-ID"]);var u=!1,l="",h="",d=null;function p(){var l=wl(e),h="https:"===l.protocol;if(l.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},c&&(l.headers["Last-Event-ID"]=c),i){var v=n?function(e){var t={};for(var r in e)Tl.test(r)||(t[r]=e[r]);return t}(i):i;for(var m in v){var y=v[m];y&&(l.headers[m]=y)}}if(l.rejectUnauthorized=!(t&&!t.rejectUnauthorized),t&&void 0!==t.createConnection&&(l.createConnection=t.createConnection),t&&t.proxy){var w=wl(t.proxy);h="https:"===w.protocol,l.protocol=h?"https:":"http:",l.path=e,l.headers.Host=l.host,l.hostname=w.hostname,l.host=w.host,l.port=w.port}if(t&&t.https)for(var b in t.https)if(-1!==Il.indexOf(b)){var E=t.https[b];void 0!==E&&(l[b]=E)}t&&void 0!==t.withCredentials&&(l.withCredentials=t.withCredentials),o=(h?El:Sl).request(l,(function(t){if(s.connectionInProgress=!1,500===t.statusCode||502===t.statusCode||503===t.statusCode||504===t.statusCode)return f("error",new Cl("error",{status:t.statusCode,message:t.statusMessage})),void a();if(301===t.statusCode||302===t.statusCode||307===t.statusCode){var i=t.headers.location;if(!i)return void f("error",new Cl("error",{status:t.statusCode,message:t.statusMessage}));var o=new URL(e).origin,c=new URL(i).origin;return n=o!==c,307===t.statusCode&&(d=e),e=i,void $.nextTick(p)}if(200!==t.statusCode)return f("error",new Cl("error",{status:t.statusCode,message:t.statusMessage})),s.close();var l,h;r=Rl.OPEN,t.on("close",(function(){t.removeAllListeners("close"),t.removeAllListeners("end"),a()})),t.on("end",(function(){t.removeAllListeners("close"),t.removeAllListeners("end"),a()})),f("open",new Cl("open"));var v=0,m=-1,y=0,w=0;t.on("data",(function(e){l?(e.length>l.length-w&&((y=2*l.length+e.length)>Pl&&(y=l.length+e.length+Pl),h=Ee.alloc(y),l.copy(h,0,0,w),l=h),e.copy(l,w),w+=e.length):(function(e){return Al.every((function(t,r){return e[r]===t}))}(l=e)&&(l=l.slice(Al.length)),w=l.length);for(var t=0,r=w;t<r;){u&&(10===l[t]&&++t,u=!1);for(var i,n=-1,o=m,s=v;n<0&&s<r;++s)58===(i=l[s])?o<0&&(o=s-t):13===i?(u=!0,n=s-t):10===i&&(n=s-t);if(n<0){v=r-t,m=o;break}v=0,m=-1,g(l,t,o,n),t+=n+1}t===r?(l=void 0,w=0):t>0&&(l=l.slice(t,w),w=l.length)}))})),o.on("error",(function(e){s.connectionInProgress=!1,a(e.message)})),o.setNoDelay&&o.setNoDelay(!0),o.end()}function f(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}function g(t,r,i,n){if(0===n){if(l.length>0){var o=h||"message";f(o,new Nl(o,{data:l.slice(0,-1),lastEventId:c,origin:new URL(e).origin})),l=""}h=void 0}else if(i>0){var a=i<0,u=0,d=t.slice(r,r+(a?n:i)).toString();r+=u=a?n:32!==t[r+i+1]?i+1:i+2;var p=n-u,g=t.slice(r,r+p).toString();if("data"===d)l+=g+"\n";else if("event"===d)h=g;else if("id"===d)c=g;else if("retry"===d){var v=parseInt(g,10);Number.isNaN(v)||(s.reconnectInterval=v)}}}p(),this._close=function(){r!==Rl.CLOSED&&(r=Rl.CLOSED,o.abort&&o.abort(),o.xhr&&o.xhr.abort&&o.xhr.abort())}}var Ol=Rl;function Cl(e,t){if(Object.defineProperty(this,"type",{writable:!1,value:e,enumerable:!0}),t)for(var r in t)t.hasOwnProperty(r)&&Object.defineProperty(this,r,{writable:!1,value:t[r],enumerable:!0})}function Nl(e,t){for(var r in Object.defineProperty(this,"type",{writable:!1,value:e,enumerable:!0}),t)t.hasOwnProperty(r)&&Object.defineProperty(this,r,{writable:!1,value:t[r],enumerable:!0})}yl.inherits(Rl,bl.EventEmitter),Rl.prototype.constructor=Rl,["open","error","message"].forEach((function(e){Object.defineProperty(Rl.prototype,"on"+e,{get:function(){var t=this.listeners(e)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(e),this.addEventListener(e,t)}})})),Object.defineProperty(Rl,"CONNECTING",{enumerable:!0,value:0}),Object.defineProperty(Rl,"OPEN",{enumerable:!0,value:1}),Object.defineProperty(Rl,"CLOSED",{enumerable:!0,value:2}),Rl.prototype.CONNECTING=0,Rl.prototype.OPEN=1,Rl.prototype.CLOSED=2,Rl.prototype.close=function(){this._close()},Rl.prototype.addEventListener=function(e,t){"function"==typeof t&&(t._listener=t,this.on(e,t))},Rl.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)},Rl.prototype.removeEventListener=function(e,t){"function"==typeof t&&(t._listener=void 0,this.removeListener(e,t))};var kl=L(Ol);const _l="0.15.2";class xl{constructor(e){this.debitNoteEvents$=new Fs,this.debitNoteEventsPoll=null,this.invoiceEvents$=new Fs,this.invoiceEventPoll=null,this.agreementEvents$=new Fs,this.agreementEventsPoll=null;const t=(null==e?void 0:e.apiKey)||X();this.basePath=(null==e?void 0:e.basePath)||J();const r={apiKey:t,basePath:this.basePath};if(!r.apiKey)throw new n("Yagna API key not defined");const i={Authorization:`Bearer ${t}`},o=new $n.Client({BASE:`${this.basePath}/market-api/v1`,HEADERS:i});this.market=o.requestor;const s=new Ln.Client({BASE:`${this.basePath}/payment-api/v1`,HEADERS:i});this.payment=s.requestor;const a=new Mn.Client({BASE:`${this.basePath}/activity-api/v1`,HEADERS:i});this.activity={control:a.requestorControl,state:a.requestorState,exec:{observeBatchExecResults:(e,r)=>new Cs((i=>{const n=new kl(`${this.basePath}/activity-api/v1/activity/${e}/exec/${r}`,{headers:{Accept:"text/event-stream",Authorization:`Bearer ${t}`}});return n.addEventListener("runtime",(e=>i.next(JSON.parse(e.data)))),n.addEventListener("error",(e=>i.error(e))),()=>n.close()}))}};const c=new Vn.Client({BASE:`${this.basePath}/net-api/v1`,HEADERS:i});this.net=c.requestor;const u=new Un.Client({BASE:`${this.basePath}/gsb-api/v1`,HEADERS:i});this.gsb=u.requestor,this.logger=(null==e?void 0:e.logger)?e.logger.child("yagna"):K("yagna");const l=new Hn.Client({BASE:this.basePath,HEADERS:i});this.identity=l.default;const h=new jn.Client({BASE:this.basePath});this.version=h.default,this.yagnaOptions=r,this.appSessionId=Xn(),this.reader=new ya(this.logger)}async connect(){this.logger.debug("Connecting to Yagna");const e=await this.assertSupportedVersion(),t=await this.identity.getIdentity();return this.startPollingEvents(),this.logger.info("Connected to Yagna",{version:e,identity:t.identity}),t}async disconnect(){this.logger.debug("Disconnecting from Yagna"),await this.stopPollingEvents(),this.logger.info("Disconnected from Yagna")}async getVersion(){try{return(await this.version.getVersion()).current.version}catch(e){throw new s(`Failed to establish yagna version due to: ${e}`,e)}}startPollingEvents(){this.logger.debug("Starting to poll for events from Yagna",{appSessionId:this.appSessionId});this.agreementEventsPoll=this.reader.createReader("AgreementEvents",(e=>this.market.collectAgreementEvents(5,e,100,this.appSessionId))),this.debitNoteEventsPoll=this.reader.createReader("DebitNoteEvents",(e=>this.payment.getDebitNoteEvents(5,e,100,this.appSessionId))),this.invoiceEventPoll=this.reader.createReader("InvoiceEvents",(e=>this.payment.getInvoiceEvents(5,e,100,this.appSessionId))),this.reader.pollToSubject(this.agreementEventsPoll.pollValues(),this.agreementEvents$).then((()=>this.logger.debug("Finished polling agreement events from Yagna"))).catch((e=>this.logger.error("Error while polling agreement events from Yagna",e))),this.reader.pollToSubject(this.debitNoteEventsPoll.pollValues(),this.debitNoteEvents$).then((()=>this.logger.debug("Finished polling debit note events from Yagna"))).catch((e=>this.logger.error("Error while polling debit note events from Yagna",e))),this.reader.pollToSubject(this.invoiceEventPoll.pollValues(),this.invoiceEvents$).then((()=>this.logger.debug("Finished polling invoice events from Yagna"))).catch((e=>this.logger.error("Error while polling invoice events from Yagna",e)))}async stopPollingEvents(){this.logger.debug("Stopping polling events from Yagna");const e=[];this.invoiceEventPoll&&e.push(this.invoiceEventPoll.cancel()),this.debitNoteEventsPoll&&e.push(this.debitNoteEventsPoll.cancel()),this.agreementEventsPoll&&e.push(this.agreementEventsPoll.cancel()),await Promise.allSettled(e),this.logger.debug("Stopped polling events from Yagna")}async assertSupportedVersion(){const e=await this.getVersion(),t=Yo(e);if(this.logger.debug("Checking Yagna version support",{userInstalled:null==t?void 0:t.raw,minSupported:_l}),!t)throw new s(`Unreadable yagna version '${e}'. Can't proceed without checking yagna version support status.`);if(!Mo(t,`>=${_l}`))throw new s(`You run yagna in version ${e} and the minimal version supported by the SDK is ${_l}. Please consult the golem-js README to find matching SDK version or upgrade your yagna installation.`);return t.version}}function Dl(e){return e instanceof AbortSignal?e:"number"==typeof e?AbortSignal.timeout(e):(new AbortController).signal}function Fl(...e){const t=new AbortController,r=e=>{if(t.signal.aborted)return;const r=e.target.reason;t.abort(r)};for(const i of e){if(i.aborted){t.abort(i.reason);break}i.addEventListener("abort",r)}return{signal:t.signal,cleanup:()=>{for(const t of e)t.removeEventListener("abort",r)}}}function ql(e){return new Promise(((t,r)=>{setTimeout((()=>e().then(t).catch(r)))}))}function Bl(e,t){const r=new Fs,i=e.pipe(fa(r),ha((()=>r.next()))),n=t.pipe(fa(r),ha((()=>r.next())));return i.pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return da.apply(void 0,ts([],es(e)))}(n))}class jl{constructor(e,t){this.prototype=e,this.paymentPlatform=t}}class $l{constructor(e,t){this.id=e,this.details=t}get paymentPlatform(){return this.details.paymentPlatform}}var Ml;!function(e){e.CouldNotGetAgreement="CouldNotGetAgreement",e.CouldNotGetProposal="CouldNotGetProposal",e.ServiceNotInitialized="ServiceNotInitialized",e.MissingAllocation="MissingAllocation",e.SubscriptionFailed="SubscriptionFailed",e.InvalidProposal="InvalidProposal",e.ProposalResponseFailed="ProposalResponseFailed",e.ProposalRejectionFailed="ProposalRejectionFailed",e.DemandExpired="DemandExpired",e.ResourceRentalTerminationFailed="ResourceRentalTerminationFailed",e.ResourceRentalCreationFailed="ResourceRentalCreationFailed",e.AgreementApprovalFailed="AgreementApprovalFailed",e.NoProposalAvailable="NoProposalAvailable",e.InternalError="InternalError",e.ScanFailed="ScanFailed"}(Ml||(Ml={}));class Ll extends c{constructor(e,t,r){super(e,t,r),this.code=t,this.previous=r}}class Vl{constructor(e){var t;this.model=e,this.previousProposalId=null,this.id=e.proposalId,this.previousProposalId=null!==(t=e.prevProposalId)&&void 0!==t?t:null,this.properties=e.properties}get state(){return this.model.state}get timestamp(){return new Date(Date.parse(this.model.timestamp))}isInitial(){return"Initial"===this.model.state}isDraft(){return"Draft"===this.model.state}isExpired(){return"Expired"===this.model.state}isRejected(){return"Rejected"===this.model.state}isValid(){try{return this.validate(),!0}catch(e){return!1}}}class Ul extends Vl{constructor(e,t){super(e),this.demand=t,this.issuer="Provider",this.validate()}get pricing(){var e,t;const r=this.properties["golem.com.usage.vector"],i=this.properties["golem.com.pricing.model.linear.coeffs"];if(!r)throw new o("The proposal does not contain 'golem.com.usage.vector' property. We can't estimate the costs.");if(!i)throw new o("The proposal does not contain 'golem.com.pricing.model.linear.coeffs' property. We can't estimate costs.");const n=r.findIndex((e=>"golem.usage.duration_sec"===e)),s=r.findIndex((e=>"golem.usage.cpu_sec"===e)),a=null!==(e=i[n])&&void 0!==e?e:0;return{cpuSec:null!==(t=i[s])&&void 0!==t?t:0,envSec:a,start:i[i.length-1]}}getDto(){return{transferProtocol:this.properties["golem.activity.caps.transfer.protocol"],cpuBrand:this.properties["golem.inf.cpu.brand"],cpuCapabilities:this.properties["golem.inf.cpu.capabilities"],cpuCores:this.properties["golem.inf.cpu.cores"],cpuThreads:this.properties["golem.inf.cpu.threads"],memory:this.properties["golem.inf.mem.gib"],storage:this.properties["golem.inf.storage.gib"],publicNet:this.properties["golem.node.net.is-public"],runtimeCapabilities:this.properties["golem.runtime.capabilities"],runtimeName:this.properties["golem.runtime.name"],runtimeVersion:this.properties["golem.runtime.version"],state:this.state}}getEstimatedCost(e=1){var t;const r=null!==(t=this.getDto().cpuThreads)&&void 0!==t?t:1,i=60*e*60;return this.pricing.start+this.pricing.cpuSec*r*i+this.pricing.envSec*i}get provider(){return{id:this.model.issuerId,name:this.properties["golem.node.id.name"],walletAddress:this.properties[`golem.com.payment.platform.${this.demand.paymentPlatform}.address`]}}validate(){const e=this.properties["golem.com.usage.vector"],t=this.properties["golem.com.pricing.model.linear.coeffs"];if(!e||0===e.length)throw new Ll("Broken proposal: the `golem.com.usage.vector` does not contain valid information about structure of the usage counters vector",Ml.InvalidProposal);if(!t||0===t.length)throw new Ll("Broken proposal: the `golem.com.pricing.model.linear.coeffs` does not contain pricing information",Ml.InvalidProposal);if(e.length<t.length-1)throw new Ll("Broken proposal: the `golem.com.usage.vector` has less pricing information than `golem.com.pricing.model.linear.coeffs`",Ml.InvalidProposal);if(t.length<e.length)throw new Ll("Broken proposal: the `golem.com.pricing.model.linear.coeffs` should contain 3 price values",Ml.InvalidProposal)}getProviderPaymentPlatforms(){return Object.keys(this.properties).filter((e=>e.startsWith("golem.com.payment.platform."))).map((e=>e.split(".")[4]))||[]}}var Hl=Object.freeze({__proto__:null,acceptAll:()=>()=>!0,allowProvidersById:e=>t=>e.includes(t.provider.id),allowProvidersByName:e=>t=>e.includes(t.provider.name),allowProvidersByNameRegex:e=>t=>!!t.provider.name.match(e),disallowProvidersById:e=>t=>!e.includes(t.provider.id),disallowProvidersByName:e=>t=>!e.includes(t.provider.name),disallowProvidersByNameRegex:e=>t=>!t.provider.name.match(e),limitPriceFilter:e=>t=>t.pricing.cpuSec<=e.cpuPerSec&&t.pricing.envSec<=e.envPerSec&&t.pricing.start<=e.start});var zl=Object.freeze({__proto__:null,getHealthyProvidersWhiteList:async function(){try{const e=await fetch("https://reputation.golem.network/v1/provider-whitelist");if(e.ok)return e.json();{const t=await e.text();throw new o(`Request to download healthy provider whitelist failed: ${t}`)}}catch(e){throw new o(`Failed to download healthy provider whitelist due to an error: ${e}`,e)}}}),Wl={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,i,o,s){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new n(i,o||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,i,n=[];if(0===this._eventsCount)return n;for(i in e=this._events)t.call(e,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,o=i.length,s=new Array(o);n<o;n++)s[n]=i[n].fn;return s},a.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},a.prototype.emit=function(e,t,i,n,o,s){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,n),!0;case 5:return l.fn.call(l.context,t,i,n,o),!0;case 6:return l.fn.call(l.context,t,i,n,o,s),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,n);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,i,n){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||n&&!a.once||i&&a.context!==i||s(this,o);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||n&&!a[c].once||i&&a[c].context!==i)&&u.push(a[c]);u.length?this._events[o]=1===u.length?u[0]:u:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a}(Wl);var Gl=L(Wl.exports);class Yl{constructor(){this.queue=[],this.abortController=new AbortController}releaseAll(){this.abortController.abort(),this.queue=[],this.abortController=new AbortController}async get(e){const{signal:t,cleanup:r}=Fl(Dl(e),this.abortController.signal);t.throwIfAborted();const{resolve:i,promise:n}=function(){let e,t;const r=new Promise(((r,i)=>{e=r,t=i}));return{resolve:e,reject:t,promise:r}}();this.queue.push(i);const o=new Promise(((e,r)=>{t.addEventListener("abort",(()=>{this.queue=this.queue.filter((e=>e!==i)),r(t.reason)}))}));return Promise.race([n,o]).finally(r)}hasAcquirers(){return this.queue.length>0}put(e){if(!this.hasAcquirers())throw new o("No acquirers waiting for the item");this.queue.shift()(e)}size(){return this.queue.length}}class Kl{constructor(e){this.options=e,this.events=new Gl,this.acquireQueue=new Yl,this.minCount=0,this.selectOfferProposal=e=>e[0],this.validateOfferProposal=e=>void 0!==e,this.available=new Set,this.leased=new Set,(null==e?void 0:e.selectOfferProposal)&&(this.selectOfferProposal=e.selectOfferProposal),(null==e?void 0:e.validateOfferProposal)&&(this.validateOfferProposal=e.validateOfferProposal),(null==e?void 0:e.minCount)&&e.minCount>=0&&(this.minCount=e.minCount),this.logger=this.logger=(null==e?void 0:e.logger)||K("proposal-pool")}add(e){if(!e.isDraft())throw this.logger.error("Cannot add a non-draft proposal to the pool",{proposalId:e.id}),new Ll("Cannot add a non-draft proposal to the pool",Ml.InvalidProposal);this.acquireQueue.hasAcquirers()?this.acquireQueue.put(e):(this.available.add(e),this.events.emit("added",{proposal:e}))}async acquire(e){const t=Dl(e);t.throwIfAborted();const r=async()=>{t.throwIfAborted(),console.log("AAAAAAAAAAAAAAAAA Draft proposal pool acquiring ...");const e=this.available.size>0?this.selectOfferProposal([...this.available]):null;if(e)return this.validateOfferProposal(e)?e:(this.removeFromAvailable(e),ql(r))},i=await r();return i?(this.available.delete(i),this.leased.add(i),this.events.emit("acquired",{proposal:i}),i):this.acquireQueue.get(t)}release(e){if(this.leased.delete(e),this.validateOfferProposal(e)){if(this.events.emit("released",{proposal:e}),this.acquireQueue.hasAcquirers())return void this.acquireQueue.put(e);this.available.add(e)}else this.events.emit("removed",{proposal:e})}remove(e){this.leased.has(e)&&(this.leased.delete(e),this.events.emit("removed",{proposal:e})),this.available.has(e)&&(this.available.delete(e),this.events.emit("removed",{proposal:e}))}count(){return this.availableCount()+this.leasedCount()}availableCount(){return this.available.size}leasedCount(){return this.leased.size}isReady(){return this.count()>=this.minCount}async clear(){this.acquireQueue.releaseAll();for(const e of this.available)this.available.delete(e),this.events.emit("removed",{proposal:e});for(const e of this.leased)this.leased.delete(e),this.events.emit("removed",{proposal:e});this.available=new Set,this.leased=new Set,this.events.emit("cleared")}removeFromAvailable(e){this.available.delete(e),this.events.emit("removed",{proposal:e})}readFrom(e){return e.subscribe({next:e=>this.add(e),error:e=>this.logger.error("Error while collecting proposals",e)})}}class Jl extends Vl{constructor(e){super(e),this.issuer="Requestor"}validate(){}}var Xl=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(void 0===$||void 0===$.domain)throw new Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||Xl.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||Xl.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||Xl.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=Xl.DEFAULT_MAX_PENDING};Xl.DEFAULT_TIMEOUT=0,Xl.DEFAULT_MAX_OCCUPATION_TIME=0,Xl.DEFAULT_MAX_EXECUTION_TIME=0,Xl.DEFAULT_MAX_PENDING=1e3,Xl.prototype.acquire=function(e,t,r,i){if(Array.isArray(e))return this._acquireBatch(e,t,r,i);if("function"!=typeof t)throw new Error("You must pass a function to execute");var n=null,o=null,s=null;"function"!=typeof r&&(i=r,r=null,s=new this.Promise((function(e,t){n=e,o=t}))),i=i||{};var a=!1,c=null,u=null,l=null,h=this,d=function(t,i,c){u&&(clearTimeout(u),u=null),l&&(clearTimeout(l),l=null),t&&(h.queues[e]&&0===h.queues[e].length&&delete h.queues[e],h.domainReentrant&&delete h.domains[e]),a||(s?i?o(i):n(c):"function"==typeof r&&r(i,c),a=!0),t&&h.queues[e]&&h.queues[e].length>0&&h.queues[e].shift()()},p=function(r){if(a)return d(r);c&&(clearTimeout(c),c=null),h.domainReentrant&&r&&(h.domains[e]=$.domain);var n=i.maxExecutionTime||h.maxExecutionTime;if(n&&(l=setTimeout((function(){h.queues[e]&&d(r,new Error("Maximum execution time is exceeded "+e))}),n)),1===t.length){var o=!1;try{t((function(e,t){o||(o=!0,d(r,e,t))}))}catch(e){o||(o=!0,d(r,e))}}else h._promiseTry((function(){return t()})).then((function(e){d(r,void 0,e)}),(function(e){d(r,e)}))};h.domainReentrant&&$.domain&&(p=$.domain.bind(p));var f=i.maxPending||h.maxPending;if(h.queues[e])if(h.domainReentrant&&$.domain&&$.domain===h.domains[e])p(!1);else if(h.queues[e].length>=f)d(!1,new Error("Too many pending tasks in queue "+e));else{var g=function(){p(!0)};i.skipQueue?h.queues[e].unshift(g):h.queues[e].push(g);var v=i.timeout||h.timeout;v&&(c=setTimeout((function(){c=null,d(!1,new Error("async-lock timed out in queue "+e))}),v))}else h.queues[e]=[],p(!0);var m=i.maxOccupationTime||h.maxOccupationTime;return m&&(u=setTimeout((function(){h.queues[e]&&d(!1,new Error("Maximum occupation time is exceeded in queue "+e))}),m)),s||void 0},Xl.prototype._acquireBatch=function(e,t,r,i){"function"!=typeof r&&(i=r,r=null);var n=this,o=e.reduceRight((function(e,t){return function(e,t){return function(r){n.acquire(e,t,r,i)}}(t,e)}),t);if("function"!=typeof r)return new this.Promise((function(e,t){1===o.length?o((function(r,i){r?t(r):e(i)})):e(o())}));o(r)},Xl.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},Xl.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}};var Ql=L(Xl);const Zl=100,eh=1e3;class th{constructor(e){var t,r;this.batch=new Map,this.lock=new Ql,this.config={minBatchSize:null!==(t=null==e?void 0:e.minBatchSize)&&void 0!==t?t:Zl,releaseTimeoutMs:null!==(r=null==e?void 0:e.releaseTimeoutMs)&&void 0!==r?r:eh}}async addProposal(e){const t=this.getProviderKey(e);await this.lock.acquire("proposals-batch",(()=>{let r=this.batch.get(t);r||(r=new Set,this.batch.set(t,r)),r.add(e)}))}async getProposals(){const e=[];return await this.lock.acquire("proposals-batch",(()=>{this.batch.forEach((t=>e.push(this.getBestProposal(t)))),this.batch.clear()})),e}async waitForProposals(){let e,t;const r=new Promise((t=>{e=setTimeout(t,this.config.releaseTimeoutMs)})),i=new Promise((e=>{t=setInterval((()=>{this.batch.size>=this.config.minBatchSize&&e(!0)}),1e3)}));await Promise.race([r,i]),clearTimeout(e),clearInterval(t)}getBestProposal(e){return[...e].sort(((e,t)=>{const r=e.getEstimatedCost(),i=t.getEstimatedCost(),n=e.timestamp.valueOf(),o=t.timestamp.valueOf();return r!==i?r-i:o-n}))[0]}getProviderKey(e){return[e.provider.id,e.properties["golem.inf.cpu.cores"],e.properties["golem.inf.cpu.threads"],e.properties["golem.inf.mem.gib"],e.properties["golem.inf.storage.gib"]].join("-")}}var rh,ih;!function(e){e.Eq="=",e.Lt="<",e.Gt=">",e.GtEq=">=",e.LtEq="<="}(rh||(rh={}));class nh{constructor(){this.properties=[],this.constraints=[]}addProperty(e,t){const r=this.properties.findIndex((t=>t.key===e));return r>=0?this.properties[r]={key:e,value:t}:this.properties.push({key:e,value:t}),this}addConstraint(e,t,r=rh.Eq){return this.constraints.push({key:e,value:t,comparisonOperator:r}),this}getProduct(){return{properties:this.properties,constraints:this.constraints.map((e=>`(${e.key+e.comparisonOperator+e.value})`))}}mergePrototype(e){return e.properties&&e.properties.forEach((e=>{this.addProperty(e.key,e.value)})),e.constraints&&e.constraints.forEach((e=>{const{key:t,value:r,comparisonOperator:i}={...this.parseConstraint(e)};this.addConstraint(t,r,i)})),this}parseConstraint(e){for(const t in rh){const r=rh[t],i=e.slice(1,-1).split(r);if(2===i.length)return{key:i[0],value:i[1],comparisonOperator:r}}throw new o(`Unable to parse constraint "${e}"`)}}class oh{isPositiveInt(e){return e>0&&Number.isInteger(e)}}!function(e){e.GVMKitSquash="gvmkit-squash"}(ih||(ih={}));class sh extends oh{constructor(e){var t;if(super(),this.packageFormat=ih.GVMKitSquash,this.engine="vm",this.runtime={name:"vm",version:void 0},this.minMemGib=.5,this.minStorageGib=2,this.minCpuThreads=1,this.minCpuCores=1,this.capabilities=[],this.useHttps=!1,Object.assign(this,e),(null===(t=e.runtime)||void 0===t?void 0:t.name)||(this.runtime.name=this.engine),this.expirationSec=e.expirationSec,!(this.imageHash||this.manifest||this.imageTag||this.imageUrl))throw new n("You must define a package or manifest option");if(this.imageUrl&&!this.imageHash)throw new n("If you provide an imageUrl, you must also provide it's SHA3-224 hash in imageHash");if(!this.isPositiveInt(this.expirationSec))throw new n("The expirationSec param has to be a positive integer");if(e.engine&&e.runtime)throw new n("The engine parameter is deprecated and cannot be used with the runtime parameter. Use the runtime option only")}}class ah extends oh{constructor(e){super(),this.subnetTag=Q(),(null==e?void 0:e.subnetTag)&&(this.subnetTag=e.subnetTag)}}class ch{constructor(e=new ah){this.config=e}apply(e){e.addProperty("golem.srv.caps.multi-activity",!0).addProperty("golem.node.debug.subnet",this.config.subnetTag),e.addConstraint("golem.com.pricing.model","linear").addConstraint("golem.node.debug.subnet",this.config.subnetTag)}}class uh extends oh{constructor(e){if(super(),this.debitNotesAcceptanceTimeoutSec=120,this.midAgreementDebitNoteIntervalSec=120,this.midAgreementPaymentTimeoutSec=43200,e&&Object.assign(this,e),!this.isPositiveInt(this.debitNotesAcceptanceTimeoutSec))throw new n("The debit note acceptance timeout time has to be a positive integer");if(!this.isPositiveInt(this.midAgreementDebitNoteIntervalSec))throw new n("The debit note interval time has to be a positive integer");if(!this.isPositiveInt(this.midAgreementPaymentTimeoutSec))throw new n("The mid-agreement payment timeout time has to be a positive integer")}}class lh{constructor(e,t,r=new uh){this.allocation=e,this.marketApiAdapter=t,this.config=r}async apply(e){e.addProperty("golem.com.scheme.payu.debit-note.interval-sec?",this.config.midAgreementDebitNoteIntervalSec).addProperty("golem.com.scheme.payu.payment-timeout-sec?",this.config.midAgreementPaymentTimeoutSec).addProperty("golem.com.payment.debit-notes.accept-timeout?",this.config.debitNotesAcceptanceTimeoutSec);const{constraints:t,properties:r}=await this.marketApiAdapter.getPaymentRelatedDemandDecorations(this.allocation.id);e.mergePrototype({constraints:t,properties:r})}}class hh{constructor(e){this.config=e}async apply(e){if(e.addProperty("golem.srv.comp.expiration",Date.now()+1e3*this.config.expirationSec),e.addProperty("golem.srv.comp.vm.package_format",this.config.packageFormat).addConstraint("golem.runtime.name",this.config.runtime.name),this.config.runtime.version&&e.addConstraint("golem.runtime.version",this.config.runtime.version),this.config.capabilities.length&&this.config.capabilities.forEach((t=>e.addConstraint("golem.runtime.capabilities",t))),e.addConstraint("golem.inf.mem.gib",this.config.minMemGib,rh.GtEq).addConstraint("golem.inf.storage.gib",this.config.minStorageGib,rh.GtEq).addConstraint("golem.inf.cpu.cores",this.config.minCpuCores,rh.GtEq).addConstraint("golem.inf.cpu.threads",this.config.minCpuThreads,rh.GtEq),this.config.imageUrl){const t=await this.resolveTaskPackageFromCustomUrl();e.addProperty("golem.srv.comp.task_package",t)}else if(this.config.imageHash||this.config.imageTag){const t=await this.resolveTaskPackageUrl();e.addProperty("golem.srv.comp.task_package",t)}this.addManifestDecorations(e)}async resolveTaskPackageFromCustomUrl(){if(!this.config.imageUrl)throw new s("Tried to resolve task package from custom url, but no url was provided");if(!this.config.imageHash)throw new s("Tried to resolve task package from custom url, but no hash was provided. Please calculate the SHA3-224 hash of the image and provide it as `imageHash`");return`hash:sha3:${this.config.imageHash}:${this.config.imageUrl}`}async resolveTaskPackageUrl(){const e=Z(),r=this.config.useHttps,i=te();let n=this.config.imageHash;const o=this.config.imageTag,a=`${e}/v1/image/info?${i?"dev=true":"count=true"}&${o?`tag=${o}`:`hash=${n}`}`;try{const e=await fetch(a);if(!e.ok)throw new s(`Unable to get image ${await e.text()}`);const t=await e.json(),i=r?t.https:t.http;return n=t.sha3,`hash:sha3:${n}:${i}`}catch(e){if(e instanceof t)throw e;throw new s(`Failed to fetch image: ${e}`)}}addManifestDecorations(e){this.config.manifest&&(e.addProperty("golem.srv.comp.payload",this.config.manifest),this.config.manifestSig&&e.addProperty("golem.srv.comp.payload.sig",this.config.manifestSig),this.config.manifestSigAlgorithm&&e.addProperty("golem.srv.comp.payload.sig.algorithm",this.config.manifestSigAlgorithm),this.config.manifestCert&&e.addProperty("golem.srv.comp.payload.cert",this.config.manifestCert))}}class dh{constructor(e){this.options=e}async apply(e){this.addWorkloadDecorations(e),this.addGenericDecorations(e),this.addPaymentDecorations(e)}addPaymentDecorations(e){if(!this.options.payment)return;const t=this.options.payment.network,r=this.options.payment.driver||"erc20",i=this.options.payment.token||["mainnet","polygon"].includes(t)?"glm":"tglm";e.addConstraint(`golem.com.payment.platform.${r}-${t}-${i}.address`,"*")}addWorkloadDecorations(e){var t,r,i,o,s,a,c,u,l,h,d,p,f,g,v,m,y,w,b,E,S,I,A,P,T,R;if((null===(t=this.options.workload)||void 0===t?void 0:t.engine)&&(null===(r=this.options.workload)||void 0===r?void 0:r.runtime))throw new n("The engine parameter is deprecated and cannot be used with the runtime parameter. Use the runtime parameter only");(null===(i=this.options.workload)||void 0===i?void 0:i.engine)&&e.addConstraint("golem.runtime.name",null===(o=this.options.workload)||void 0===o?void 0:o.engine),(null===(a=null===(s=this.options.workload)||void 0===s?void 0:s.runtime)||void 0===a?void 0:a.name)&&e.addConstraint("golem.runtime.name",this.options.workload.runtime.name),(null===(u=null===(c=this.options.workload)||void 0===c?void 0:c.runtime)||void 0===u?void 0:u.version)&&e.addConstraint("golem.runtime.version",this.options.workload.runtime.version),(null===(l=this.options.workload)||void 0===l?void 0:l.capabilities)&&(null===(h=this.options.workload)||void 0===h||h.capabilities.forEach((t=>e.addConstraint("golem.runtime.capabilities",t)))),(null===(d=this.options.workload)||void 0===d?void 0:d.minMemGib)&&e.addConstraint("golem.inf.mem.gib",null===(p=this.options.workload)||void 0===p?void 0:p.minMemGib,rh.GtEq),(null===(f=this.options.workload)||void 0===f?void 0:f.maxMemGib)&&e.addConstraint("golem.inf.mem.gib",null===(g=this.options.workload)||void 0===g?void 0:g.maxMemGib,rh.LtEq),(null===(v=this.options.workload)||void 0===v?void 0:v.minStorageGib)&&e.addConstraint("golem.inf.storage.gib",null===(m=this.options.workload)||void 0===m?void 0:m.minStorageGib,rh.GtEq),(null===(y=this.options.workload)||void 0===y?void 0:y.maxStorageGib)&&e.addConstraint("golem.inf.storage.gib",null===(w=this.options.workload)||void 0===w?void 0:w.maxStorageGib,rh.LtEq),(null===(b=this.options.workload)||void 0===b?void 0:b.minCpuThreads)&&e.addConstraint("golem.inf.cpu.threads",null===(E=this.options.workload)||void 0===E?void 0:E.minCpuThreads,rh.GtEq),(null===(S=this.options.workload)||void 0===S?void 0:S.maxCpuThreads)&&e.addConstraint("golem.inf.cpu.threads",null===(I=this.options.workload)||void 0===I?void 0:I.maxCpuThreads,rh.LtEq),(null===(A=this.options.workload)||void 0===A?void 0:A.minCpuCores)&&e.addConstraint("golem.inf.cpu.cores",null===(P=this.options.workload)||void 0===P?void 0:P.minCpuCores,rh.GtEq),(null===(T=this.options.workload)||void 0===T?void 0:T.maxCpuCores)&&e.addConstraint("golem.inf.cpu.cores",null===(R=this.options.workload)||void 0===R?void 0:R.maxCpuCores,rh.LtEq)}addGenericDecorations(e){this.options.subnetTag&&e.addConstraint("golem.node.debug.subnet",this.options.subnetTag)}}class ph{constructor(e){this.model=e}get properties(){return this.model.properties}get constraints(){return this.model.constraints}get pricing(){var e,t;const r=this.properties["golem.com.usage.vector"],i=this.properties["golem.com.pricing.model.linear.coeffs"];if(!r)throw new o("The proposal does not contain 'golem.com.usage.vector' property. We can't estimate the costs.");if(!i)throw new o("The proposal does not contain 'golem.com.pricing.model.linear.coeffs' property. We can't estimate costs.");const n=r.findIndex((e=>"golem.usage.duration_sec"===e)),s=r.findIndex((e=>"golem.usage.cpu_sec"===e)),a=null!==(e=i[n])&&void 0!==e?e:0;return{cpuSec:null!==(t=i[s])&&void 0!==t?t:0,envSec:a,start:i[i.length-1]}}get provider(){return{id:this.model.providerId,name:this.properties["golem.node.id.name"]||"<unknown>"}}get transferProtocol(){return this.properties["golem.activity.caps.transfer.protocol"]}get cpuBrand(){return this.properties["golem.inf.cpu.brand"]}get cpuVendor(){return this.properties["golem.inf.cpu.vendor"]}get cpuCapabilities(){return this.properties["golem.inf.cpu.capabilities"]}get cpuCores(){return this.properties["golem.inf.cpu.cores"]}get cpuThreads(){return this.properties["golem.inf.cpu.threads"]}get gpuBrand(){return this.properties["golem.!exp.gap-35.v1.inf.gpu.model"]}get memory(){return this.memoryGib}get memoryGib(){return this.properties["golem.inf.mem.gib"]}get storage(){return this.storageGib}get storageGib(){return this.properties["golem.inf.storage.gib"]}get publicNet(){return this.properties["golem.node.net.is-public"]}get runtimeCapabilities(){return this.properties["golem.runtime.capabilities"]}get runtimeName(){return this.properties["golem.runtime.name"]}get runtimeVersion(){return this.properties["golem.runtime.version"]}get offerId(){return this.model.offerId}get offerCreateAt(){return this.model.timestamp}get paymentPlatformAddresses(){const e=/golem\.com\.payment\.platform\.([a-z0-9-]+)\.address/,t=Object.entries(this.model.properties).map((([t,r])=>{const i=t.match(e);return[i?i[1]:"",r]})).filter((([e])=>!!e));return Object.fromEntries(t)}getEstimatedCost(e=1){const t=this.cpuThreads,r=60*e*60;return this.pricing.start+this.pricing.cpuSec*t*r+this.pricing.envSec*r}}class fh{constructor(e,t){this.deps=e,this.events=new Gl,this.logger=K("market"),this.logger=e.logger,this.marketApi=e.marketApi,this.fileServer=e.fileServer,this.options={demandRefreshIntervalSec:1800,...t},this.collectAndEmitAgreementEvents()}async buildDemandDetails(e,t,r){const i=new nh,n=new ah({subnetTag:e.subnetTag});new ch(n).apply(i);const o=e.workload?await this.applyLocalGVMIServeSupport(e.workload):e.workload,s=60*t.rentHours*60;s<300&&this.logger.warn("The declared value of rentHours is less than 5 min. This may cause offers to be rejected during negotiations.");const a=new sh({...o,expirationSec:s}),c=new hh(a);await c.apply(i);const u=new uh(e.payment),l=new lh(r,this.deps.marketApi,u);return await l.apply(i),new jl(i.getProduct(),r.paymentPlatform)}buildScanSpecification(e){const t=new nh;return new dh(e).apply(t),t.getProduct()}async applyLocalGVMIServeSupport(e){var t,r,i;if(null===(t=e.imageUrl)||void 0===t?void 0:t.startsWith("file://")){const t=null===(r=e.imageUrl)||void 0===r?void 0:r.replace("file://",""),n=null!==(i=this.fileServer.getPublishInfo(t))&&void 0!==i?i:await this.fileServer.publishFile(t),{fileUrl:o,fileHash:s}=n;return this.logger.debug("Applied local GVMI serve support",{sourcePath:t,publishInfo:n}),{...e,imageUrl:o,imageHash:s}}return e}publishAndRefreshDemand(e){return new Cs((t=>{let r;const i=async()=>{try{return r=await this.deps.marketApi.publishDemandSpecification(e),t.next(r),this.events.emit("demandSubscriptionStarted",{demand:r}),this.logger.debug("Subscribing for proposals matched with the demand",{demand:r}),r}catch(e){const r=new Ll("Could not publish demand on the market",Ml.SubscriptionFailed,e);t.error(r)}},n=async e=>{try{await this.deps.marketApi.unpublishDemand(e),this.logger.info("Unpublished demand",{demandId:e.id}),this.logger.debug("Unpublished demand",e),this.events.emit("demandSubscriptionStopped",{demand:e})}catch(e){const r=new Ll("Could not publish demand on the market",Ml.SubscriptionFailed,e);t.error(r)}};i();const o=setInterval((()=>{Promise.all([n(r),i()]).then((([,e])=>{e&&(this.events.emit("demandSubscriptionRefreshed",{demand:e}),this.logger.info("Refreshed subscription for offer proposals with the new demand",{demand:e}))})).catch((e=>{this.logger.error("Error while re-publishing demand for offers",e),t.error(e)}))}),1e3*this.options.demandRefreshIntervalSec);return()=>{clearInterval(o),r&&n(r)}}))}collectMarketProposalEvents(e){return this.deps.marketApi.collectMarketProposalEvents(e).pipe(ga((e=>this.logger.debug("Received demand offer event from yagna",{event:e}))),ga((e=>this.emitMarketProposalEvents(e))))}collectAllOfferProposals(e){return this.collectMarketProposalEvents(e).pipe(aa((e=>"ProposalReceived"===e.type)),oa((e=>e.proposal)))}async negotiateProposal(e,t){try{const r=await this.deps.marketApi.counterProposal(e,t);return this.logger.debug("Counter proposal sent",r),this.events.emit("offerCounterProposalSent",{offerProposal:e,counterProposal:r}),r}catch(t){throw this.events.emit("errorSendingCounterProposal",{offerProposal:e,error:t}),t}}async proposeAgreement(e,t){const r=await this.marketApi.proposeAgreement(e,t);return this.logger.info("Proposed and got approval for agreement",{agreementId:r.id,provider:r.provider}),r}async terminateAgreement(e,t){return await this.marketApi.terminateAgreement(e,t),this.logger.info("Terminated agreement",{agreementId:e.id,provider:e.provider,reason:t}),e}collectDraftOfferProposals(e){return this.publishAndRefreshDemand(e.demandSpecification).pipe(pa((e=>this.collectMarketProposalEvents(e))),aa((e=>"ProposalReceived"===e.type)),oa((e=>e.proposal)),aa((e=>(e.isInitial()||e.isDraft())&&e.isValid())),aa((t=>this.filterProposalsByPricingOptions(e.pricing,t))),aa((t=>!(null==e?void 0:e.filter)||this.filterProposalsByUserFilter(e.filter,t))),this.reduceInitialProposalsByProviderKey({minProposalsBatchSize:null==e?void 0:e.minProposalsBatchSize,proposalsBatchReleaseTimeoutMs:null==e?void 0:e.proposalsBatchReleaseTimeoutMs}),ga((t=>{t.isInitial()&&this.negotiateProposal(t,e.demandSpecification).catch((e=>this.logger.error("Failed to negotiate the proposal",e)))})),aa((e=>e.isDraft())))}emitMarketProposalEvents(e){const{type:t}=e;switch(t){case"ProposalReceived":this.events.emit("offerProposalReceived",{offerProposal:e.proposal});break;case"ProposalRejected":this.events.emit("offerCounterProposalRejected",{counterProposal:e.counterProposal,reason:e.reason});break;case"PropertyQueryReceived":this.events.emit("offerPropertyQueryReceived");break;default:this.logger.warn("Unsupported event type in event",{event:e})}}async signAgreementFromPool(e,t,r){this.logger.info("Trying to sign an agreement...");const n=Dl(r),o=async()=>{try{n.throwIfAborted(),this.logger.debug("Acquiring proposal from draft proposal pool",{draftPoolCounters:{total:e.count(),available:e.availableCount()}});const t=await e.acquire(n);return this.logger.debug("Acquired proposal from the pool",{proposal:t}),n.aborted&&(e.release(t),n.throwIfAborted()),t}catch(e){if(n.aborted)throw"TimeoutError"===n.reason.name?new a("Could not sign any agreement in time"):new i("The signing of the agreement has been aborted",e);throw e}},s=async()=>{const r=await o();try{const i=await this.proposeAgreement(r,t);return e.remove(r),i}catch(t){return this.logger.debug("Failed to propose agreement, retrying",{error:t}),e.remove(r),ql(s)}};return s()}reduceInitialProposalsByProviderKey(e){return t=>new Cs((r=>{let i=!1;const n=new th({minBatchSize:null==e?void 0:e.minProposalsBatchSize,releaseTimeoutMs:null==e?void 0:e.proposalsBatchReleaseTimeoutMs}),o=t.subscribe((e=>{e.isInitial()?n.addProposal(e).catch((e=>this.logger.error("Failed to add the initial proposal to the batch",e))):r.next(e)})),s=async()=>{if(!i){try{await n.waitForProposals();const e=await n.getProposals();e.length>0&&(this.logger.debug("Received batch of proposals",{count:e.length}),e.forEach((e=>r.next(e))))}catch(e){r.error(e)}s()}};return s(),()=>{i=!0,o.unsubscribe()}}))}estimateBudget({order:e,maxAgreements:t}){var i,n;const o=e.market.pricing.model,s=null!==(n=null===(i=e.demand.workload)||void 0===i?void 0:i.minCpuThreads)&&void 0!==n?n:1,{rentHours:a}=e.market;switch(o){case"linear":{const{maxCpuPerHourPrice:r,maxStartPrice:i,maxEnvPerHourPrice:n}=e.market.pricing;return t*i+t*a*n+t*a*s*r}case"burn-rate":return t*a*e.market.pricing.avgGlmPerHour;default:throw new r(`Unsupported pricing model ${o}`)}}async fetchAgreement(e){return this.marketApi.getAgreement(e)}collectAndEmitAgreementEvents(){this.marketApi.collectAgreementEvents().subscribe((e=>{switch(e.type){case"AgreementApproved":this.events.emit("agreementApproved",{agreement:e.agreement});break;case"AgreementCancelled":this.events.emit("agreementCancelled",{agreement:e.agreement});break;case"AgreementTerminated":this.events.emit("agreementTerminated",{agreement:e.agreement,reason:e.reason,terminatedBy:e.terminatedBy});break;case"AgreementRejected":this.events.emit("agreementRejected",{agreement:e.agreement,reason:e.reason})}}))}filterProposalsByUserFilter(e,t){try{const r=e(t);return r||(this.events.emit("offerProposalRejectedByProposalFilter",{offerProposal:t}),this.logger.debug("The offer was rejected by the user filter",{id:t.id})),r}catch(e){throw this.logger.error("Executing user provided proposal filter resulted with an error",e),e}}filterProposalsByPricingOptions(e,t){let r=!0;return"linear"===e.model?r=t.pricing.cpuSec<=e.maxCpuPerHourPrice/3600&&t.pricing.envSec<=e.maxEnvPerHourPrice/3600&&t.pricing.start<=e.maxStartPrice:"burn-rate"===e.model&&(r=t.pricing.start+3600*t.pricing.envSec+3600*t.pricing.cpuSec<=e.avgGlmPerHour),r||(this.events.emit("offerProposalRejectedByPriceFilter",{offerProposal:t}),this.logger.debug("The offer was ignored because the price was too high",{id:t.id,pricing:t.pricing})),r}scan(e){return this.deps.marketApi.scan(e)}}class gh{constructor(e,t,r){this.id=e,this.model=t,this.demand=r}getState(){return this.model.state}get provider(){return{id:this.model.offer.providerId,name:this.model.offer.properties["golem.node.id.name"],walletAddress:this.model.offer.properties[`golem.com.payment.platform.${this.demand.paymentPlatform}.address`]}}isFinalState(){const e=this.getState();return"Pending"!==e&&"Proposal"!==e}}class vh{constructor(e,t,r){this.id=e,this.model=t,this.provider=r,this.recipientId=t.recipientId,this.payeeAddr=t.payeeAddr,this.requestorWalletAddress=t.payerAddr,this.paymentPlatform=t.paymentPlatform,this.agreementId=t.agreementId,this.paymentDueDate=t.paymentDueDate,this.status=t.status}getStatus(){return this.status}}var mh,yh={exports:{}};
/*! decimal.js-light v2.5.1 https://github.com/MikeMcl/decimal.js-light/LICENCE */mh=yh,function(e){var t,r=1e9,i={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},n=!0,o="[DecimalError] ",s=o+"Invalid argument: ",a=o+"Exponent out of range: ",c=Math.floor,u=Math.pow,l=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,h=1e7,d=9007199254740991,p=c(1286742750677284.5),f={};function g(e,t){var r,i,o,s,a,c,u,l,d=e.constructor,p=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),n?P(t,p):t;if(u=e.d,l=t.d,a=e.e,o=t.e,u=u.slice(),s=a-o){for(s<0?(i=u,s=-s,c=l.length):(i=l,o=a,c=u.length),s>(c=(a=Math.ceil(p/7))>c?a+1:c+1)&&(s=c,i.length=1),i.reverse();s--;)i.push(0);i.reverse()}for((c=u.length)-(s=l.length)<0&&(s=c,i=l,l=u,u=i),r=0;s;)r=(u[--s]=u[s]+l[s]+r)/h|0,u[s]%=h;for(r&&(u.unshift(r),++o),c=u.length;0==u[--c];)u.pop();return t.d=u,t.e=o,n?P(t,p):t}function v(e,t,r){if(e!==~~e||e<t||e>r)throw Error(s+e)}function m(e){var t,r,i,n=e.length-1,o="",s=e[0];if(n>0){for(o+=s,t=1;t<n;t++)(r=7-(i=e[t]+"").length)&&(o+=S(r)),o+=i;(r=7-(i=(s=e[t])+"").length)&&(o+=S(r))}else if(0===s)return"0";for(;s%10==0;)s/=10;return o+s}f.absoluteValue=f.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e},f.comparedTo=f.cmp=function(e){var t,r,i,n,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(t=0,r=(i=o.d.length)<(n=e.d.length)?i:n;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return i===n?0:i>n^o.s<0?1:-1},f.decimalPlaces=f.dp=function(){var e=this,t=e.d.length-1,r=7*(t-e.e);if(t=e.d[t])for(;t%10==0;t/=10)r--;return r<0?0:r},f.dividedBy=f.div=function(e){return y(this,new this.constructor(e))},f.dividedToIntegerBy=f.idiv=function(e){var t=this.constructor;return P(y(this,new t(e),0,1),t.precision)},f.equals=f.eq=function(e){return!this.cmp(e)},f.exponent=function(){return b(this)},f.greaterThan=f.gt=function(e){return this.cmp(e)>0},f.greaterThanOrEqualTo=f.gte=function(e){return this.cmp(e)>=0},f.isInteger=f.isint=function(){return this.e>this.d.length-2},f.isNegative=f.isneg=function(){return this.s<0},f.isPositive=f.ispos=function(){return this.s>0},f.isZero=function(){return 0===this.s},f.lessThan=f.lt=function(e){return this.cmp(e)<0},f.lessThanOrEqualTo=f.lte=function(e){return this.cmp(e)<1},f.logarithm=f.log=function(e){var r,i=this,s=i.constructor,a=s.precision,c=a+5;if(void 0===e)e=new s(10);else if((e=new s(e)).s<1||e.eq(t))throw Error(o+"NaN");if(i.s<1)throw Error(o+(i.s?"NaN":"-Infinity"));return i.eq(t)?new s(0):(n=!1,r=y(I(i,c),I(e,c),c),n=!0,P(r,a))},f.minus=f.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?T(t,e):g(t,(e.s=-e.s,e))},f.modulo=f.mod=function(e){var t,r=this,i=r.constructor,s=i.precision;if(!(e=new i(e)).s)throw Error(o+"NaN");return r.s?(n=!1,t=y(r,e,0,1).times(e),n=!0,r.minus(t)):P(new i(r),s)},f.naturalExponential=f.exp=function(){return w(this)},f.naturalLogarithm=f.ln=function(){return I(this)},f.negated=f.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e},f.plus=f.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?g(t,e):T(t,(e.s=-e.s,e))},f.precision=f.sd=function(e){var t,r,i,n=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(s+e);if(t=b(n)+1,r=7*(i=n.d.length-1)+1,i=n.d[i]){for(;i%10==0;i/=10)r--;for(i=n.d[0];i>=10;i/=10)r++}return e&&t>r?t:r},f.squareRoot=f.sqrt=function(){var e,t,r,i,s,a,u,l=this,h=l.constructor;if(l.s<1){if(!l.s)return new h(0);throw Error(o+"NaN")}for(e=b(l),n=!1,0==(s=Math.sqrt(+l))||s==1/0?(((t=m(l.d)).length+e)%2==0&&(t+="0"),s=Math.sqrt(t),e=c((e+1)/2)-(e<0||e%2),i=new h(t=s==1/0?"5e"+e:(t=s.toExponential()).slice(0,t.indexOf("e")+1)+e)):i=new h(s.toString()),s=u=(r=h.precision)+3;;)if(i=(a=i).plus(y(l,a,u+2)).times(.5),m(a.d).slice(0,u)===(t=m(i.d)).slice(0,u)){if(t=t.slice(u-3,u+1),s==u&&"4999"==t){if(P(a,r+1,0),a.times(a).eq(l)){i=a;break}}else if("9999"!=t)break;u+=4}return n=!0,P(i,r)},f.times=f.mul=function(e){var t,r,i,o,s,a,c,u,l,d=this,p=d.constructor,f=d.d,g=(e=new p(e)).d;if(!d.s||!e.s)return new p(0);for(e.s*=d.s,r=d.e+e.e,(u=f.length)<(l=g.length)&&(s=f,f=g,g=s,a=u,u=l,l=a),s=[],i=a=u+l;i--;)s.push(0);for(i=l;--i>=0;){for(t=0,o=u+i;o>i;)c=s[o]+g[i]*f[o-i-1]+t,s[o--]=c%h|0,t=c/h|0;s[o]=(s[o]+t)%h|0}for(;!s[--a];)s.pop();return t?++r:s.shift(),e.d=s,e.e=r,n?P(e,p.precision):e},f.toDecimalPlaces=f.todp=function(e,t){var i=this,n=i.constructor;return i=new n(i),void 0===e?i:(v(e,0,r),void 0===t?t=n.rounding:v(t,0,8),P(i,e+b(i)+1,t))},f.toExponential=function(e,t){var i,n=this,o=n.constructor;return void 0===e?i=R(n,!0):(v(e,0,r),void 0===t?t=o.rounding:v(t,0,8),i=R(n=P(new o(n),e+1,t),!0,e+1)),i},f.toFixed=function(e,t){var i,n,o=this,s=o.constructor;return void 0===e?R(o):(v(e,0,r),void 0===t?t=s.rounding:v(t,0,8),i=R((n=P(new s(o),e+b(o)+1,t)).abs(),!1,e+b(n)+1),o.isneg()&&!o.isZero()?"-"+i:i)},f.toInteger=f.toint=function(){var e=this,t=e.constructor;return P(new t(e),b(e)+1,t.rounding)},f.toNumber=function(){return+this},f.toPower=f.pow=function(e){var r,i,s,a,u,l,h=this,p=h.constructor,f=+(e=new p(e));if(!e.s)return new p(t);if(!(h=new p(h)).s){if(e.s<1)throw Error(o+"Infinity");return h}if(h.eq(t))return h;if(s=p.precision,e.eq(t))return P(h,s);if(l=(r=e.e)>=(i=e.d.length-1),u=h.s,l){if((i=f<0?-f:f)<=d){for(a=new p(t),r=Math.ceil(s/7+4),n=!1;i%2&&O((a=a.times(h)).d,r),0!==(i=c(i/2));)O((h=h.times(h)).d,r);return n=!0,e.s<0?new p(t).div(a):P(a,s)}}else if(u<0)throw Error(o+"NaN");return u=u<0&&1&e.d[Math.max(r,i)]?-1:1,h.s=1,n=!1,a=e.times(I(h,s+12)),n=!0,(a=w(a)).s=u,a},f.toPrecision=function(e,t){var i,n,o=this,s=o.constructor;return void 0===e?n=R(o,(i=b(o))<=s.toExpNeg||i>=s.toExpPos):(v(e,1,r),void 0===t?t=s.rounding:v(t,0,8),n=R(o=P(new s(o),e,t),e<=(i=b(o))||i<=s.toExpNeg,e)),n},f.toSignificantDigits=f.tosd=function(e,t){var i=this.constructor;return void 0===e?(e=i.precision,t=i.rounding):(v(e,1,r),void 0===t?t=i.rounding:v(t,0,8)),P(new i(this),e,t)},f.toString=f.valueOf=f.val=f.toJSON=function(){var e=this,t=b(e),r=e.constructor;return R(e,t<=r.toExpNeg||t>=r.toExpPos)};var y=function(){function e(e,t){var r,i=0,n=e.length;for(e=e.slice();n--;)r=e[n]*t+i,e[n]=r%h|0,i=r/h|0;return i&&e.unshift(i),e}function t(e,t,r,i){var n,o;if(r!=i)o=r>i?1:-1;else for(n=o=0;n<r;n++)if(e[n]!=t[n]){o=e[n]>t[n]?1:-1;break}return o}function r(e,t,r){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*h+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return function(i,n,s,a){var c,u,l,d,p,f,g,v,m,y,w,E,S,I,A,T,R,O,C=i.constructor,N=i.s==n.s?1:-1,k=i.d,_=n.d;if(!i.s)return new C(i);if(!n.s)throw Error(o+"Division by zero");for(u=i.e-n.e,R=_.length,A=k.length,v=(g=new C(N)).d=[],l=0;_[l]==(k[l]||0);)++l;if(_[l]>(k[l]||0)&&--u,(E=null==s?s=C.precision:a?s+(b(i)-b(n))+1:s)<0)return new C(0);if(E=E/7+2|0,l=0,1==R)for(d=0,_=_[0],E++;(l<A||d)&&E--;l++)S=d*h+(k[l]||0),v[l]=S/_|0,d=S%_|0;else{for((d=h/(_[0]+1)|0)>1&&(_=e(_,d),k=e(k,d),R=_.length,A=k.length),I=R,y=(m=k.slice(0,R)).length;y<R;)m[y++]=0;(O=_.slice()).unshift(0),T=_[0],_[1]>=h/2&&++T;do{d=0,(c=t(_,m,R,y))<0?(w=m[0],R!=y&&(w=w*h+(m[1]||0)),(d=w/T|0)>1?(d>=h&&(d=h-1),1==(c=t(p=e(_,d),m,f=p.length,y=m.length))&&(d--,r(p,R<f?O:_,f))):(0==d&&(c=d=1),p=_.slice()),(f=p.length)<y&&p.unshift(0),r(m,p,y),-1==c&&(c=t(_,m,R,y=m.length))<1&&(d++,r(m,R<y?O:_,y)),y=m.length):0===c&&(d++,m=[0]),v[l++]=d,c&&m[0]?m[y++]=k[I]||0:(m=[k[I]],y=1)}while((I++<A||void 0!==m[0])&&E--)}return v[0]||v.shift(),g.e=u,P(g,a?s+b(g)+1:s)}}();function w(e,r){var i,o,s,c,l,h=0,d=0,p=e.constructor,f=p.precision;if(b(e)>16)throw Error(a+b(e));if(!e.s)return new p(t);for(null==r?(n=!1,l=f):l=r,c=new p(.03125);e.abs().gte(.1);)e=e.times(c),d+=5;for(l+=Math.log(u(2,d))/Math.LN10*2+5|0,i=o=s=new p(t),p.precision=l;;){if(o=P(o.times(e),l),i=i.times(++h),m((c=s.plus(y(o,i,l))).d).slice(0,l)===m(s.d).slice(0,l)){for(;d--;)s=P(s.times(s),l);return p.precision=f,null==r?(n=!0,P(s,f)):s}s=c}}function b(e){for(var t=7*e.e,r=e.d[0];r>=10;r/=10)t++;return t}function E(e,t,r){if(t>e.LN10.sd())throw n=!0,r&&(e.precision=r),Error(o+"LN10 precision limit exceeded");return P(new e(e.LN10),t)}function S(e){for(var t="";e--;)t+="0";return t}function I(e,r){var i,s,a,c,u,l,h,d,p,f=1,g=e,v=g.d,w=g.constructor,S=w.precision;if(g.s<1)throw Error(o+(g.s?"NaN":"-Infinity"));if(g.eq(t))return new w(0);if(null==r?(n=!1,d=S):d=r,g.eq(10))return null==r&&(n=!0),E(w,d);if(d+=10,w.precision=d,s=(i=m(v)).charAt(0),c=b(g),!(Math.abs(c)<15e14))return h=E(w,d+2,S).times(c+""),g=I(new w(s+"."+i.slice(1)),d-10).plus(h),w.precision=S,null==r?(n=!0,P(g,S)):g;for(;s<7&&1!=s||1==s&&i.charAt(1)>3;)s=(i=m((g=g.times(e)).d)).charAt(0),f++;for(c=b(g),s>1?(g=new w("0."+i),c++):g=new w(s+"."+i.slice(1)),l=u=g=y(g.minus(t),g.plus(t),d),p=P(g.times(g),d),a=3;;){if(u=P(u.times(p),d),m((h=l.plus(y(u,new w(a),d))).d).slice(0,d)===m(l.d).slice(0,d))return l=l.times(2),0!==c&&(l=l.plus(E(w,d+2,S).times(c+""))),l=y(l,new w(f),d),w.precision=S,null==r?(n=!0,P(l,S)):l;l=h,a+=2}}function A(e,t){var r,i,o;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(r<0&&(r=i),r+=+t.slice(i+1),t=t.substring(0,i)):r<0&&(r=t.length),i=0;48===t.charCodeAt(i);)++i;for(o=t.length;48===t.charCodeAt(o-1);)--o;if(t=t.slice(i,o)){if(o-=i,r=r-i-1,e.e=c(r/7),e.d=[],i=(r+1)%7,r<0&&(i+=7),i<o){for(i&&e.d.push(+t.slice(0,i)),o-=7;i<o;)e.d.push(+t.slice(i,i+=7));i=7-(t=t.slice(i)).length}else i-=o;for(;i--;)t+="0";if(e.d.push(+t),n&&(e.e>p||e.e<-p))throw Error(a+r)}else e.s=0,e.e=0,e.d=[0];return e}function P(e,t,r){var i,o,s,l,d,f,g,v,m=e.d;for(l=1,s=m[0];s>=10;s/=10)l++;if((i=t-l)<0)i+=7,o=t,g=m[v=0];else{if((v=Math.ceil((i+1)/7))>=(s=m.length))return e;for(g=s=m[v],l=1;s>=10;s/=10)l++;o=(i%=7)-7+l}if(void 0!==r&&(d=g/(s=u(10,l-o-1))%10|0,f=t<0||void 0!==m[v+1]||g%s,f=r<4?(d||f)&&(0==r||r==(e.s<0?3:2)):d>5||5==d&&(4==r||f||6==r&&(i>0?o>0?g/u(10,l-o):0:m[v-1])%10&1||r==(e.s<0?8:7))),t<1||!m[0])return f?(s=b(e),m.length=1,t=t-s-1,m[0]=u(10,(7-t%7)%7),e.e=c(-t/7)||0):(m.length=1,m[0]=e.e=e.s=0),e;if(0==i?(m.length=v,s=1,v--):(m.length=v+1,s=u(10,7-i),m[v]=o>0?(g/u(10,l-o)%u(10,o)|0)*s:0),f)for(;;){if(0==v){(m[0]+=s)==h&&(m[0]=1,++e.e);break}if(m[v]+=s,m[v]!=h)break;m[v--]=0,s=1}for(i=m.length;0===m[--i];)m.pop();if(n&&(e.e>p||e.e<-p))throw Error(a+b(e));return e}function T(e,t){var r,i,o,s,a,c,u,l,d,p,f=e.constructor,g=f.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new f(e),n?P(t,g):t;if(u=e.d,p=t.d,i=t.e,l=e.e,u=u.slice(),a=l-i){for((d=a<0)?(r=u,a=-a,c=p.length):(r=p,i=l,c=u.length),a>(o=Math.max(Math.ceil(g/7),c)+2)&&(a=o,r.length=1),r.reverse(),o=a;o--;)r.push(0);r.reverse()}else{for((d=(o=u.length)<(c=p.length))&&(c=o),o=0;o<c;o++)if(u[o]!=p[o]){d=u[o]<p[o];break}a=0}for(d&&(r=u,u=p,p=r,t.s=-t.s),c=u.length,o=p.length-c;o>0;--o)u[c++]=0;for(o=p.length;o>a;){if(u[--o]<p[o]){for(s=o;s&&0===u[--s];)u[s]=h-1;--u[s],u[o]+=h}u[o]-=p[o]}for(;0===u[--c];)u.pop();for(;0===u[0];u.shift())--i;return u[0]?(t.d=u,t.e=i,n?P(t,g):t):new f(0)}function R(e,t,r){var i,n=b(e),o=m(e.d),s=o.length;return t?(r&&(i=r-s)>0?o=o.charAt(0)+"."+o.slice(1)+S(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n<0?"e":"e+")+n):n<0?(o="0."+S(-n-1)+o,r&&(i=r-s)>0&&(o+=S(i))):n>=s?(o+=S(n+1-s),r&&(i=r-n-1)>0&&(o=o+"."+S(i))):((i=n+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),r&&(i=r-s)>0&&(n+1===s&&(o+="."),o+=S(i))),e.s<0?"-"+o:o}function O(e,t){if(e.length>t)return e.length=t,!0}function C(e){if(!e||"object"!=typeof e)throw Error(o+"Object expected");var t,i,n,a=["precision",1,r,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if(void 0!==(n=e[i=a[t]])){if(!(c(n)===n&&n>=a[t+1]&&n<=a[t+2]))throw Error(s+i+": "+n);this[i]=n}if(void 0!==(n=e[i="LN10"])){if(n!=Math.LN10)throw Error(s+i+": "+n);this[i]=new this(n)}return this}i=function e(t){var r,i,n;function o(e){var t=this;if(!(t instanceof o))return new o(e);if(t.constructor=o,e instanceof o)return t.s=e.s,t.e=e.e,void(t.d=(e=e.d)?e.slice():e);if("number"==typeof e){if(0*e!=0)throw Error(s+e);if(e>0)t.s=1;else{if(!(e<0))return t.s=0,t.e=0,void(t.d=[0]);e=-e,t.s=-1}return e===~~e&&e<1e7?(t.e=0,void(t.d=[e])):A(t,e.toString())}if("string"!=typeof e)throw Error(s+e);if(45===e.charCodeAt(0)?(e=e.slice(1),t.s=-1):t.s=1,!l.test(e))throw Error(s+e);A(t,e)}if(o.prototype=f,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.clone=e,o.config=o.set=C,void 0===t&&(t={}),t)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],r=0;r<n.length;)t.hasOwnProperty(i=n[r++])||(t[i]=this[i]);return o.config(t),o}(i),i.default=i.Decimal=i,t=new i(1),mh.exports?mh.exports=i:(e||(e="undefined"!=typeof self&&self&&self.self==self?self:Function("return this")()),e.Decimal=i)}(M);var wh,bh=L(yh.exports);class Eh extends vh{constructor(e,t){super(e.invoiceId,e,t),this.model=e,this.activityIds=e.activityIds,this.amount=e.amount,this.timestamp=e.timestamp,this.recipientId=e.recipientId}getPreciseAmount(){return new bh(this.amount)}isSameAs(e){return this.id===e.id&&this.amount===e.amount&&this.agreementId===e.agreementId}}class Sh extends vh{constructor(e,t){super(e.debitNoteId,e,t),this.model=e,this.id=e.debitNoteId,this.timestamp=e.timestamp,this.activityId=e.activityId,this.totalAmountDue=e.totalAmountDue,this.usageCounterVector=e.usageCounterVector}getPreciseAmount(){return new bh(this.totalAmountDue)}}class Ih{constructor(e){if(this.model=e,this.id=e.allocationId,this.timeout=e.timeout,this.timestamp=e.timestamp,this.totalAmount=e.totalAmount,this.spentAmount=e.spentAmount,this.remainingAmount=e.remainingAmount,!e.address||!e.paymentPlatform)throw new n("Account address and payment platform are required");this.address=e.address,this.paymentPlatform=e.paymentPlatform}}!function(e){e.UnsolicitedService="UNSOLICITED_SERVICE",e.BadService="BAD_SERVICE",e.IncorrectAmount="INCORRECT_AMOUNT",e.RejectedByRequestorFilter="REJECTED_BY_REQUESTOR_FILTER",e.AgreementFinalized="AGREEMENT_FINALIZED"}(wh||(wh={}));var Ah,Ph,Th,Rh=Object.freeze({__proto__:null,acceptAllDebitNotesFilter:()=>async()=>!0,acceptAllInvoicesFilter:()=>async()=>!0,acceptMaxAmountDebitNoteFilter:e=>async t=>new bh(t.totalAmountDue).lte(e),acceptMaxAmountInvoiceFilter:e=>async t=>new bh(t.amount).lte(e)});!function(e){e.AllocationCreationFailed="AllocationCreationFailed",e.MissingAllocation="MissingAllocation",e.PaymentProcessNotInitialized="PaymentProcessNotInitialized",e.AllocationReleaseFailed="AllocationReleaseFailed",e.InvoiceAcceptanceFailed="InvoiceAcceptanceFailed",e.DebitNoteAcceptanceFailed="DebitNoteAcceptanceFailed",e.InvoiceRejectionFailed="InvoiceRejectionFailed",e.DebitNoteRejectionFailed="DebitNoteRejectionFailed",e.CouldNotGetDebitNote="CouldNotGetDebitNote",e.CouldNotGetInvoice="CouldNotGetInvoice",e.PaymentStatusQueryFailed="PaymentStatusQueryFailed",e.AgreementAlreadyPaid="AgreementAlreadyPaid",e.InvoiceAlreadyReceived="InvoiceAlreadyReceived"}(Th||(Th={}));class Oh extends c{constructor(e,t,r,i,n){super(e,t,n),this.code=t,this.previous=n,Ah.set(this,void 0),Ph.set(this,void 0),ss(this,Ah,r,"f"),ss(this,Ph,i,"f")}getAllocation(){return os(this,Ah,"f")}getProvider(){return os(this,Ph,"f")}}Ah=new WeakMap,Ph=new WeakMap;class Ch{constructor(e){this.api=e}async collectInvoices({after:e=new Date(0),limit:t=50,statuses:r,providerIds:i,minAmount:n,maxAmount:o,providerWallets:s,paymentPlatforms:a}={}){const c=(await this.api.payment.getInvoices(null==e?void 0:e.toISOString())).filter((e=>!(r&&!r.includes(e.status))&&(!(i&&!i.includes(e.issuerId))&&((void 0===n||!new bh(e.amount).lt(n))&&((void 0===o||!new bh(e.amount).gt(o))&&(!(s&&!s.includes(e.payeeAddr))&&!(a&&!a.includes(e.paymentPlatform))))))));return c.sort(((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())),c.slice(0,t)}async fetchSingleInvoice(e){return this.api.payment.getInvoice(e)}async acceptInvoice({invoice:e,dryRun:t=!1}){let r={totalAmount:e.amount,paymentPlatform:e.paymentPlatform,address:e.payerAddr,timestamp:(new Date).toISOString(),timeout:new Date(Date.now()+6e4).toISOString(),makeDeposit:!1,remainingAmount:"",spentAmount:"",allocationId:""};if(t)return{allocation:r,amount:e.amount,invoiceId:e.invoiceId,success:!0,dryRun:t};try{return r=await this.api.payment.createAllocation(r),await this.api.payment.acceptInvoice(e.invoiceId,{allocationId:r.allocationId,totalAmountAccepted:e.amount}),{success:!0,allocation:r,amount:e.amount,invoiceId:e.invoiceId,dryRun:t}}catch(i){return{success:!1,allocation:r,amount:e.amount,invoiceId:e.invoiceId,reason:i,dryRun:t}}}async acceptManyInvoices({invoices:e,dryRun:t=!1}){const r=e=>e.reduce(((e,t)=>(e[t.payerAddr]=e[t.payerAddr]||[],e[t.payerAddr].push(t),e)),{}),i=[],n=e.reduce(((e,t)=>(e[t.paymentPlatform]=e[t.paymentPlatform]||[],e[t.paymentPlatform].push(t),e)),{});for(const[e,o]of Object.entries(n)){const n=r(o);for(const[r,o]of Object.entries(n)){let n={totalAmount:o.reduce(((e,t)=>e.plus(t.amount)),new bh(0)).toFixed(18),paymentPlatform:e,address:r,timestamp:(new Date).toISOString(),timeout:new Date(Date.now()+6e4).toISOString(),makeDeposit:!1,remainingAmount:"",spentAmount:"",allocationId:""};t||(n=await this.api.payment.createAllocation(n));for(const e of o)if(t)i.push({invoiceId:e.invoiceId,allocation:n,success:!0,amount:e.amount,dryRun:t});else try{await this.api.payment.acceptInvoice(e.invoiceId,{allocationId:n.allocationId,totalAmountAccepted:e.amount}),i.push({invoiceId:e.invoiceId,allocation:n,success:!0,amount:e.amount,dryRun:t})}catch(r){i.push({invoiceId:e.invoiceId,allocation:n,success:!1,amount:e.amount,reason:r,dryRun:t})}}}return i}}class Nh{constructor(e,t,r,i){this.network=e,this.driver=t,this.address=r,this.token=i}getPaymentPlatform(){return`${this.driver}-${this.network}-${this.token}`}}function kh(e){if(!(e instanceof Error))return String(e);if(function(e){return"object"==typeof e&&null!==e&&"name"in e&&"ApiError"===e.name}(e))try{return JSON.stringify(e.body,null,2)}catch(t){return e.message}return e.message}class _h{constructor(e,t,r,i,n){this.agreement=e,this.allocation=t,this.paymentModule=r,this.invoice=null,this.debitNotes=new Map,this.lock=new Ql,this.logger=n||K("payment"),this.options={invoiceFilter:(null==i?void 0:i.invoiceFilter)||(()=>!0),debitNoteFilter:(null==i?void 0:i.debitNoteFilter)||(()=>!0)};const o=this.paymentModule.observeInvoices().pipe(aa((e=>e.agreementId===this.agreement.id))).subscribe({next:async e=>{try{await this.addInvoice(e)}catch(e){this.logger.error("Error processing invoice",e)}},error:e=>{this.logger.error("Invoice subscription error",e),this.stop()}}),s=this.paymentModule.observeDebitNotes().pipe(aa((e=>e.agreementId===this.agreement.id))).subscribe({next:async e=>{try{await this.addDebitNote(e)}catch(e){this.logger.error("Error processing debit note",e)}},error:e=>{this.logger.error("Debit note subscription error",e),this.stop()}});this.cleanupSubscriptions=()=>{o.unsubscribe(),s.unsubscribe()}}addDebitNote(e){return this.lock.acquire(`app-${e.agreementId}`,(()=>this.applyDebitNote(e)))}addInvoice(e){return this.lock.acquire(`app-${e.agreementId}`,(()=>this.applyInvoice(e)))}isFinished(){return null!==this.invoice}async applyDebitNote(e){if(this.hasReceivedInvoice())return await this.rejectDebitNote(e,wh.AgreementFinalized,`DebitNote ${e.id} rejected because the agreement ${e.agreementId} is already covered with a final invoice that should be paid instead of the debit note`),!1;if(this.debitNotes.has(e.id)){if(await this.hasProcessedDebitNote(e))return this.logger.warn("We received a duplicate debit note - the previous one was already accepted, so this one gets ignored",{debitNoteId:e.id,agreementId:e.agreementId}),!1}this.debitNotes.set(e.id,e);let t=!1;try{t=await this.options.debitNoteFilter(e,{agreement:this.agreement,allocation:this.allocation,demand:this.agreement.demand})}catch(e){throw new r("An error occurred in the debit note filter",e)}if(!t)return await this.rejectDebitNote(e,wh.RejectedByRequestorFilter,`DebitNote ${e.id} for agreement ${e.agreementId} rejected by DebitNote Filter`),!1;try{return await this.paymentModule.acceptDebitNote(e,this.allocation,e.totalAmountDue),this.logger.debug("DebitNote accepted",{debitNoteId:e.id,agreementId:e.agreementId}),!0}catch(t){const r=kh(t);throw new Oh(`Unable to accept debit note ${e.id}. ${r}`,Th.DebitNoteAcceptanceFailed,void 0,e.provider,t)}}async hasProcessedDebitNote(e){return"RECEIVED"!==await e.getStatus()}async rejectDebitNote(e,t,r){try{await this.paymentModule.rejectDebitNote(e,r)}catch(t){const r=kh(t);throw new Oh(`Unable to reject debit note ${e.id}. ${r}`,Th.DebitNoteRejectionFailed,void 0,e.provider,t)}}finalize(e){this.invoice=e,this.cleanupSubscriptions()}async applyInvoice(e){if(this.logger.debug("Applying invoice for agreement",{invoiceId:e.id,agreementId:e.agreementId,provider:e.provider}),this.invoice)throw new Oh(`Agreement ${this.agreement.id} is already covered with an invoice: ${this.invoice.id}`,Th.AgreementAlreadyPaid,this.allocation,this.invoice.provider);if("RECEIVED"!==e.getStatus())throw new Oh(`The invoice ${e.id} for agreement ${e.agreementId} has status ${e.getStatus()}, but we can accept only the ones with status RECEIVED`,Th.InvoiceAlreadyReceived,this.allocation,e.provider);this.finalize(e);let t=!1;try{t=await this.options.invoiceFilter(e,{agreement:this.agreement,allocation:this.allocation,demand:this.agreement.demand})}catch(e){throw new r("An error occurred in the invoice filter",e)}if(!t){const t=wh.RejectedByRequestorFilter,r=`Invoice ${e.id} for agreement ${e.agreementId} rejected by Invoice Filter`;return await this.rejectInvoice(e,t,r),!1}try{await this.paymentModule.acceptInvoice(e,this.allocation,e.amount)}catch(t){const r=kh(t);throw new Oh(`Unable to accept invoice ${e.id} ${r}`,Th.InvoiceAcceptanceFailed,void 0,e.provider,t)}return!0}async rejectInvoice(e,t,r){try{await this.paymentModule.rejectInvoice(e,r),this.logger.warn("Invoice rejected",{reason:r})}catch(t){const r=kh(t);throw new Oh(`Unable to reject invoice ${e.id} ${r}`,Th.InvoiceRejectionFailed,void 0,e.provider,t)}}hasReceivedInvoice(){return null!==this.invoice}isStarted(){return null!==this.cleanupSubscriptions}stop(){this.cleanupSubscriptions()}}const xh=Object.freeze(["mainnet","polygon"]);class Dh{constructor(e,t){var r,i,n;this.events=new Gl,this.logger=K("payment"),this.options={driver:"erc20",network:ee(),token:"tglm"};const o=null!==(r=null==t?void 0:t.network)&&void 0!==r?r:this.options.network,s=null!==(i=null==t?void 0:t.driver)&&void 0!==i?i:this.options.driver,a=null!==(n=null==t?void 0:t.token)&&void 0!==n?n:xh.includes(o)?"glm":"tglm";this.options={network:o,driver:s,token:a},this.logger=e.logger,this.yagnaApi=e.yagna,this.paymentApi=e.paymentApi,this.startEmittingPaymentEvents()}startEmittingPaymentEvents(){this.paymentApi.receivedInvoices$.subscribe((e=>{this.events.emit("invoiceReceived",{invoice:e})})),this.paymentApi.receivedDebitNotes$.subscribe((e=>{this.events.emit("debitNoteReceived",{debitNote:e})}))}getPaymentPlatform(){return`${this.options.driver}-${this.options.network}-${this.options.token}`}async getPayerDetails(){const{identity:e}=await this.yagnaApi.identity.getIdentity();return new Nh(this.options.network,this.options.driver,e,this.options.token)}observeDebitNotes(){return this.paymentApi.receivedDebitNotes$}observeInvoices(){return this.paymentApi.receivedInvoices$}async createAllocation(e){this.logger.debug("Creating allocation",{params:e});try{const t=await this.paymentApi.createAllocation({paymentPlatform:this.getPaymentPlatform(),...e});return this.events.emit("allocationCreated",{allocation:t}),this.logger.info("Created allocation",{allocationId:t.id,budget:t.totalAmount,platform:t.paymentPlatform}),this.logger.debug("Created allocation",t),t}catch(e){throw this.events.emit("errorCreatingAllocation",e),e}}async releaseAllocation(e){this.logger.debug("Releasing allocation",e);try{const t=await this.getAllocation(e.id).catch((()=>(this.logger.warn("Failed to fetch allocation before releasing",{id:e.id}),e)));await this.paymentApi.releaseAllocation(e),this.events.emit("allocationReleased",{allocation:t}),this.logger.info("Released allocation",{allocationId:t.id,totalAmount:t.totalAmount,spentAmount:t.spentAmount})}catch(t){throw this.events.emit("errorReleasingAllocation",{allocation:await this.paymentApi.getAllocation(e.id).catch((()=>(this.logger.warn("Failed to fetch allocation after failed release attempt",{id:e.id}),e))),error:t}),t}}getAllocation(e){return this.logger.debug("Fetching allocation by id",{id:e}),this.paymentApi.getAllocation(e)}amendAllocation(e,t){const r=Error("Amending allocation is not supported yet");throw this.events.emit("errorAmendingAllocation",{allocation:e,error:r}),r}async acceptInvoice(e,t,r){this.logger.debug("Accepting invoice",e);try{const i=await this.paymentApi.acceptInvoice(e,t,r);return this.events.emit("invoiceAccepted",{invoice:i}),this.logger.info("Accepted invoice",{id:e.id,allocationId:t.id,agreementId:e.agreementId,provider:e.provider,amount:r}),i}catch(i){throw this.events.emit("errorAcceptingInvoice",{invoice:e,error:i}),this.logger.error(`Failed to accept invoice. ${i}`,{id:e.id,allocationId:t.id,agreementId:e.agreementId,provider:e.provider,amount:r}),i}}async rejectInvoice(e,t){this.logger.debug("Rejecting invoice",{id:e.id,reason:t});try{const r=await this.paymentApi.rejectInvoice(e,t);return this.events.emit("invoiceRejected",{invoice:r}),this.logger.warn("Rejeced invoice",{id:e.id,reason:t}),r}catch(r){throw this.events.emit("errorRejectingInvoice",{invoice:e,error:r}),this.logger.error(`Failed to reject invoice. ${r}`,{id:e.id,reason:t}),r}}async acceptDebitNote(e,t,r){this.logger.debug("Accepting debit note",e);try{const i=await this.paymentApi.acceptDebitNote(e,t,r);return this.events.emit("debitNoteAccepted",{debitNote:i}),this.logger.debug("Accepted debit note",{id:e.id,allocationId:t.id,activityId:e.activityId,provider:e.provider,amount:r}),i}catch(i){throw this.events.emit("errorAcceptingDebitNote",{debitNote:e,error:i}),this.logger.error(`Failed to accept debitNote. ${i}`,{id:e.id,allocationId:t.id,activityId:e.activityId,provider:e.provider,amount:r}),i}}async rejectDebitNote(e,t){this.logger.info("Rejecting debit note",{id:e.id,reason:t});const r="Unable to send debitNote rejection to provider. This feature is not yet supported.";return this.logger.warn(r),this.events.emit("errorRejectingDebitNote",{debitNote:e,error:new o(r)}),e}createInvoiceProcessor(){return new Ch(this.yagnaApi)}createAgreementPaymentProcess(e,t,r){return new _h(e,t,this,r,this.logger.child("agreement-payment-process"))}}var Fh;!function(e){e.New="New",e.Initialized="Initialized",e.Deployed="Deployed",e.Ready="Ready",e.Unresponsive="Unresponsive",e.Terminated="Terminated",e.Unknown="Unknown"}(Fh||(Fh={}));class qh{constructor(e,t,r=Fh.New,i=Fh.Unknown,n){this.id=e,this.agreement=t,this.currentState=r,this.previousState=i,this.usage=n}get provider(){return this.agreement.provider}getState(){return this.currentState}getPreviousState(){return this.previousState}}class Bh{constructor(e){this.index=e.index,this.eventDate=e.eventDate,this.result=e.result,this.stdout=e.stdout,this.stderr=e.stderr,this.message=e.message,this.isBatchFinished=e.isBatchFinished,this.data=e.data}getOutputAsJson(){if(!this.stdout)throw new o("Can't convert Result output to JSON, because the output is missing!");try{return JSON.parse(this.stdout.toString().trim())}catch(e){throw new o(`Failed to parse output to JSON! Output: "${this.stdout.toString()}". Error: ${e}`)}}}const jh=5,$h=20;class Mh{constructor(e){this.activityExeBatchResultMaxRetries=(null==e?void 0:e.activityExeBatchResultMaxRetries)||$h,this.activityExeBatchResultPollIntervalSeconds=(null==e?void 0:e.activityExeBatchResultPollIntervalSeconds)||jh}}class Lh{constructor(e=[]){this.commands=e}static create(e){return new Lh(e)}add(e){this.commands.push(e)}async before(){await Promise.all(this.commands.map((e=>e.before())))}async after(e){return Promise.all(this.commands.map(((t,r)=>t.after(e[r]))))}getExeScriptRequest(){if(!this.commands.length)throw new o("There are no commands in the script");return{text:JSON.stringify(this.commands.map((e=>e.toJson())))}}}const Vh=new Bh({result:"Error",eventDate:(new Date).toISOString(),index:-1,message:"No result due to error"});class Uh{constructor(e,t){this.commandName=e,this.args=t||{}}toJson(){return{[this.commandName]:this.args}}toExeScriptRequest(){return{text:JSON.stringify([this.toJson()])}}async before(){}async after(e){return null!=e?e:Vh}}class Hh extends Uh{constructor(e){super("deploy",e)}}class zh extends Uh{constructor(e){super("start",e)}}class Wh extends Uh{constructor(e,t,r,i){super("run",{entry_point:e,args:t,env:r,capture:i||{stdout:{atEnd:{format:"string"}},stderr:{atEnd:{format:"string"}}}})}}class Gh extends Uh{constructor(e,t,r){super("transfer",{from:e,to:t,args:r}),this.from=e,this.to=t}}class Yh extends Gh{constructor(e,t,r){super(),this.storageProvider=e,this.src=t,this.dstPath=r,this.args.to=`container:${r}`}async before(){this.args.from=await this.storageProvider.publishFile(this.src)}async after(e){return await this.storageProvider.release([this.args.from]),e}}class Kh extends Gh{constructor(e,t,r){super(),this.storageProvider=e,this.src=t,this.dstPath=r,this.args.to=`container:${r}`}async before(){this.args.from=await this.storageProvider.publishData(this.src)}async after(e){return await this.storageProvider.release([this.args.from]),e}}class Jh extends Gh{constructor(e,t,r){super(),this.storageProvider=e,this.srcPath=t,this.dstPath=r,this.args={from:`container:${t}`}}async before(){this.args.to=await this.storageProvider.receiveFile(this.dstPath)}async after(e){return await this.storageProvider.release([this.args.to]),e}}class Xh extends Gh{constructor(e,t){super(),this.storageProvider=e,this.srcPath=t,this.chunks=[],this.args={from:`container:${t}`}}async before(){this.args.to=await this.storageProvider.receiveData((e=>{this.chunks.push(e)}))}async after(e){return await this.storageProvider.release([this.args.to]),"Ok"===e.result?new Bh({...e,data:this.combineChunks()}):new Bh({...e,result:"Error",data:void 0})}combineChunks(){const e=new Uint8Array(this.chunks.reduce(((e,t)=>e+t.length),0));let t=0;for(const r of this.chunks)e.set(r,t),t+=r.length;return this.chunks=[],e}}function Qh(e,t){for(var r=0,i=e.length-1;i>=0;i--){var n=e[i];"."===n?e.splice(i,1):".."===n?(e.splice(i,1),r++):r&&(e.splice(i,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}var Zh=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ed=function(e){return Zh.exec(e).slice(1)};function td(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var i=r>=0?arguments[r]:"/";if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(e=i+"/"+e,t="/"===i.charAt(0))}return(t?"/":"")+(e=Qh(ld(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."}function rd(e){var t=id(e),r="/"===vd(e,-1);return(e=Qh(ld(e.split("/"),(function(e){return!!e})),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function id(e){return"/"===e.charAt(0)}function nd(){return rd(ld(Array.prototype.slice.call(arguments,0),(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function od(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=td(e).substr(1),t=td(t).substr(1);for(var i=r(e.split("/")),n=r(t.split("/")),o=Math.min(i.length,n.length),s=o,a=0;a<o;a++)if(i[a]!==n[a]){s=a;break}var c=[];for(a=s;a<i.length;a++)c.push("..");return(c=c.concat(n.slice(s))).join("/")}function sd(e){var t=ed(e),r=t[0],i=t[1];return r||i?(i&&(i=i.substr(0,i.length-1)),r+i):"."}function ad(e,t){var r=ed(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r}function cd(e){return ed(e)[3]}var ud={extname:cd,basename:ad,dirname:sd,sep:"/",delimiter:":",relative:od,join:nd,isAbsolute:id,normalize:rd,resolve:td};function ld(e,t){if(e.filter)return e.filter(t);for(var r=[],i=0;i<e.length;i++)t(e[i],i,e)&&r.push(e[i]);return r}var hd,dd,pd,fd,gd,vd="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)},md=Object.freeze({__proto__:null,basename:ad,default:ud,delimiter:":",dirname:sd,extname:cd,isAbsolute:id,join:nd,normalize:rd,relative:od,resolve:td,sep:"/"}),yd={},wd=Object.freeze({__proto__:null,default:yd}),bd={exports:{}},Ed=V(Object.freeze({__proto__:null,default:{}})),Sd=V(md),Id=V(wd);gd="win32"===$.platform||M.TESTING_WINDOWS?function(){if(dd)return hd;dd=1,hd=r,r.sync=function(r,i){return t(e.statSync(r),r,i)};var e=Id;function t(e,t,r){return!(!e.isSymbolicLink()&&!e.isFile())&&function(e,t){var r=void 0!==t.pathExt?t.pathExt:$.env.PATHEXT;if(!r)return!0;if(-1!==(r=r.split(";")).indexOf(""))return!0;for(var i=0;i<r.length;i++){var n=r[i].toLowerCase();if(n&&e.substr(-n.length).toLowerCase()===n)return!0}return!1}(t,r)}function r(r,i,n){e.stat(r,(function(e,o){n(e,!e&&t(o,r,i))}))}return hd}():function(){if(fd)return pd;fd=1,pd=t,t.sync=function(t,i){return r(e.statSync(t),i)};var e=Id;function t(t,i,n){e.stat(t,(function(e,t){n(e,!e&&r(t,i))}))}function r(e,t){return e.isFile()&&function(e,t){var r=e.mode,i=e.uid,n=e.gid,o=void 0!==t.uid?t.uid:$.getuid&&$.getuid(),s=void 0!==t.gid?t.gid:$.getgid&&$.getgid(),a=parseInt("100",8),c=parseInt("010",8);return r&parseInt("001",8)||r&c&&n===s||r&a&&i===o||r&(a|c)&&0===o}(e,t)}return pd}();var Ad=Pd;function Pd(e,t,r){if("function"==typeof t&&(r=t,t={}),!r){if("function"!=typeof Promise)throw new TypeError("callback not provided");return new Promise((function(r,i){Pd(e,t||{},(function(e,t){e?i(e):r(t)}))}))}gd(e,t||{},(function(e,i){e&&("EACCES"===e.code||t&&t.ignoreErrors)&&(e=null,i=!1),r(e,i)}))}Pd.sync=function(e,t){try{return gd.sync(e,t||{})}catch(e){if(t&&t.ignoreErrors||"EACCES"===e.code)return!1;throw e}};const Td="win32"===$.platform||"cygwin"===$.env.OSTYPE||"msys"===$.env.OSTYPE,Rd=Sd,Od=Td?";":":",Cd=Ad,Nd=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),kd=(e,t)=>{const r=t.colon||Od,i=e.match(/\//)||Td&&e.match(/\\/)?[""]:[...Td?[$.cwd()]:[],...(t.path||$.env.PATH||"").split(r)],n=Td?t.pathExt||$.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",o=Td?n.split(r):[""];return Td&&-1!==e.indexOf(".")&&""!==o[0]&&o.unshift(""),{pathEnv:i,pathExt:o,pathExtExe:n}},_d=(e,t,r)=>{"function"==typeof t&&(r=t,t={}),t||(t={});const{pathEnv:i,pathExt:n,pathExtExe:o}=kd(e,t),s=[],a=r=>new Promise(((n,o)=>{if(r===i.length)return t.all&&s.length?n(s):o(Nd(e));const a=i[r],u=/^".*"$/.test(a)?a.slice(1,-1):a,l=Rd.join(u,e),h=!u&&/^\.[\\\/]/.test(e)?e.slice(0,2)+l:l;n(c(h,r,0))})),c=(e,r,i)=>new Promise(((u,l)=>{if(i===n.length)return u(a(r+1));const h=n[i];Cd(e+h,{pathExt:o},((n,o)=>{if(!n&&o){if(!t.all)return u(e+h);s.push(e+h)}return u(c(e,r,i+1))}))}));return r?a(0).then((e=>r(null,e)),r):a(0)};var xd=_d;_d.sync=(e,t)=>{t=t||{};const{pathEnv:r,pathExt:i,pathExtExe:n}=kd(e,t),o=[];for(let s=0;s<r.length;s++){const a=r[s],c=/^".*"$/.test(a)?a.slice(1,-1):a,u=Rd.join(c,e),l=!c&&/^\.[\\\/]/.test(e)?e.slice(0,2)+u:u;for(let e=0;e<i.length;e++){const r=l+i[e];try{if(Cd.sync(r,{pathExt:n})){if(!t.all)return r;o.push(r)}}catch(e){}}}if(t.all&&o.length)return o;if(t.nothrow)return null;throw Nd(e)};var Dd={exports:{}};const Fd=(e={})=>{const t=e.env||$.env;return"win32"!==(e.platform||$.platform)?"PATH":Object.keys(t).reverse().find((e=>"PATH"===e.toUpperCase()))||"Path"};Dd.exports=Fd,Dd.exports.default=Fd;var qd=Dd.exports;const Bd=Sd,jd=xd,$d=qd;function Md(e,t){const r=e.options.env||$.env,i=$.cwd(),n=null!=e.options.cwd,o=n&&void 0!==$.chdir&&!$.chdir.disabled;if(o)try{$.chdir(e.options.cwd)}catch(e){}let s;try{s=jd.sync(e.command,{path:r[$d({env:r})],pathExt:t?Bd.delimiter:void 0})}catch(e){}finally{o&&$.chdir(i)}return s&&(s=Bd.resolve(n?e.options.cwd:"",s)),s}var Ld=function(e){return Md(e)||Md(e,!0)},Vd={};const Ud=/([()\][%!^"`<>&|;, *?])/g;Vd.command=function(e){return e=e.replace(Ud,"^$1")},Vd.argument=function(e,t){return e=(e=`"${e=(e=(e=`${e}`).replace(/(?=(\\+?)?)\1"/g,'$1$1\\"')).replace(/(?=(\\+?)?)\1$/,"$1$1")}"`).replace(Ud,"^$1"),t&&(e=e.replace(Ud,"^$1")),e};const Hd=/^#!(.*)/;const zd=Id,Wd=(e="")=>{const t=e.match(Hd);if(!t)return null;const[r,i]=t[0].replace(/#! ?/,"").split(" "),n=r.split("/").pop();return"env"===n?i:i?`${n} ${i}`:n};const Gd=Sd,Yd=Ld,Kd=Vd,Jd=function(e){const t=Ee.alloc(150);let r;try{r=zd.openSync(e,"r"),zd.readSync(r,t,0,150,0),zd.closeSync(r)}catch(e){}return Wd(t.toString())},Xd="win32"===$.platform,Qd=/\.(?:com|exe)$/i,Zd=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function ep(e){if(!Xd)return e;const t=function(e){e.file=Yd(e);const t=e.file&&Jd(e.file);return t?(e.args.unshift(e.file),e.command=t,Yd(e)):e.file}(e),r=!Qd.test(t);if(e.options.forceShell||r){const r=Zd.test(t);e.command=Gd.normalize(e.command),e.command=Kd.command(e.command),e.args=e.args.map((e=>Kd.argument(e,r)));const i=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${i}"`],e.command=$.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}var tp=function(e,t,r){t&&!Array.isArray(t)&&(r=t,t=null);const i={command:e,args:t=t?t.slice(0):[],options:r=Object.assign({},r),file:void 0,original:{command:e,args:t}};return r.shell?i:ep(i)};const rp="win32"===$.platform;function ip(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function np(e,t){return rp&&1===e&&!t.file?ip(t.original,"spawn"):null}var op={hookChildProcess:function(e,t){if(!rp)return;const r=e.emit;e.emit=function(i,n){if("exit"===i){const i=np(n,t);if(i)return r.call(e,"error",i)}return r.apply(e,arguments)}},verifyENOENT:np,verifyENOENTSync:function(e,t){return rp&&1===e&&!t.file?ip(t.original,"spawnSync"):null},notFoundError:ip};const sp=Ed,ap=tp,cp=op;function up(e,t,r){const i=ap(e,t,r),n=sp.spawn(i.command,i.args,i.options);return cp.hookChildProcess(n,i),n}bd.exports=up,bd.exports.spawn=up,bd.exports.sync=function(e,t,r){const i=ap(e,t,r),n=sp.spawnSync(i.command,i.args,i.options);return n.error=n.error||cp.verifyENOENTSync(n.status,i),n},bd.exports._parse=ap,bd.exports._enoent=cp;var lp=L(bd.exports);class hp{constructor(e){if(this.publishedUrls=new Set,this.isInitialized=!1,this.lock=new Ql,u)throw new r("File transfer by GFTP module is unsupported in the browser context.");this.logger=e||K("storage")}async init(){this.isInitialized?this.logger.warn("GFTP init attempted even though it was already ready - check the logic of your application"):(await this.startGftpServer(),this.logger.info(`GFTP Version: ${await this.jsonRpc("version")}`))}startGftpServer(){return new Promise(((e,t)=>{var r,i,n,o,s,a;this.logger.debug("Starting GFTP server"),this.gftpServerProcess=lp("gftp",["server"]),this.gftpServerProcess.on("spawn",(()=>{this.logger.info("GFTP server spawned"),this.isInitialized=!0,e()})),this.gftpServerProcess.on("error",(e=>{this.logger.error("Error while spawning GFTP server",e),t(e)})),this.gftpServerProcess.on("close",((e,t)=>{this.logger.info("GFTP server closed",{code:e,signal:t}),this.isInitialized=!1})),null===(i=null===(r=this.gftpServerProcess)||void 0===r?void 0:r.stdout)||void 0===i||i.setEncoding("utf-8"),null===(o=null===(n=this.gftpServerProcess)||void 0===n?void 0:n.stderr)||void 0===o||o.setEncoding("utf-8"),this.reader=null===(a=null===(s=this.gftpServerProcess)||void 0===s?void 0:s.stdout)||void 0===a?void 0:a.iterator()}))}async generateTempFileName(){const{randomUUID:e}=await Promise.resolve().then((function(){return sv})),t=await Promise.resolve().then((function(){return av})),r=ud.join(t.dirSync().name,e().toString());return yd.existsSync(r)&&yd.unlinkSync(r),r}async receiveFile(e){const{url:t}=await this.jsonRpc("receive",{output_file:e});return t}receiveData(){throw new r("receiveData is not implemented in GftpStorageProvider")}async publishFile(e){const t=await this.uploadFile(e);return this.publishedUrls.add(t),t}async publishData(e){let t;return t=Buffer.isBuffer(e)?await this.uploadBytes(e):await this.uploadBytes(Buffer.from(e)),this.publishedUrls.add(t),t}release(){return Promise.resolve(void 0)}async releaseAll(){const e=Array.from(this.publishedUrls).filter((e=>!!e));e.length&&await this.jsonRpc("close",{urls:e})}async close(){var e;this.isInitialized&&(await this.releaseAll(),null===(e=this.gftpServerProcess)||void 0===e||e.kill())}async jsonRpc(e,t={}){return this.lock.acquire("gftp-io",(async()=>{var r,i,n,s;if(!this.isInitialized)throw new o(`GFTP was not initialized when calling JSON-RPC ${e} with ${JSON.stringify(t)}`);const a={jsonrpc:"2.0",id:Xn(),method:e,params:t},c=`${JSON.stringify(a)}\n`;this.logger.debug("Sending GFTP command",{request:a}),null===(i=null===(r=this.gftpServerProcess)||void 0===r?void 0:r.stdin)||void 0===i||i.write(c);const u=null===(s=await(null===(n=this.reader)||void 0===n?void 0:n.next()))||void 0===s?void 0:s.value;if(!u)throw new o("Unable to get GFTP command result");const{result:l}=JSON.parse(u);if(void 0===l)throw new o(u);return l}))}async uploadStream(e){var t;const r=await this.generateTempFileName(),i=yd.createWriteStream(r,{encoding:"binary"});await new Promise((async t=>{i.once("finish",t);for await(const t of e)i.write(t);i.end()}));const n=await this.jsonRpc("publish",{files:[r.toString()]});if(1!==n.length)throw"invalid gftp publish response";return null===(t=n[0])||void 0===t?void 0:t.url}async uploadBytes(e){return await this.uploadStream(async function*(){yield e}())}async uploadFile(e){var t;return null===(t=(await this.jsonRpc("publish",{files:[e.toString()]}))[0])||void 0===t?void 0:t.url}isReady(){return this.isInitialized}}class dp{close(){return Promise.resolve(void 0)}init(){return Promise.resolve(void 0)}publishData(e){return Promise.reject(new o("NullStorageProvider does not support upload data"))}publishFile(e){return Promise.reject(new o("NullStorageProvider does not support upload files"))}receiveFile(e){return Promise.reject(new o("NullStorageProvider does not support download files"))}receiveData(e){return Promise.reject(new o("NullStorageProvider does not support download data"))}release(e){return Promise.resolve(void 0)}isReady(){return!0}}var pp,fp={},gp={},vp={};Object.defineProperty(vp,"__esModule",{value:!0}),vp.BitWidth=void 0,function(e){e[e.WIDTH8=0]="WIDTH8",e[e.WIDTH16=1]="WIDTH16",e[e.WIDTH32=2]="WIDTH32",e[e.WIDTH64=3]="WIDTH64"}(pp||(vp.BitWidth=pp={}));var mp={};Object.defineProperty(mp,"__esModule",{value:!0}),mp.paddingSize=mp.fromByteWidth=mp.uwidth=mp.fwidth=mp.iwidth=mp.toByteWidth=void 0;const yp=vp;mp.toByteWidth=function(e){return 1<<e},mp.iwidth=function(e){return e>=-128&&e<=127?yp.BitWidth.WIDTH8:e>=-32768&&e<=32767?yp.BitWidth.WIDTH16:e>=-2147483648&&e<=2147483647?yp.BitWidth.WIDTH32:yp.BitWidth.WIDTH64},mp.fwidth=function(e){return e===Math.fround(e)?yp.BitWidth.WIDTH32:yp.BitWidth.WIDTH64},mp.uwidth=function(e){return e<=255?yp.BitWidth.WIDTH8:e<=65535?yp.BitWidth.WIDTH16:e<=4294967295?yp.BitWidth.WIDTH32:yp.BitWidth.WIDTH64},mp.fromByteWidth=function(e){return 1===e?yp.BitWidth.WIDTH8:2===e?yp.BitWidth.WIDTH16:4===e?yp.BitWidth.WIDTH32:yp.BitWidth.WIDTH64},mp.paddingSize=function(e,t){return 1+~e&t-1};var wp={};Object.defineProperty(wp,"__esModule",{value:!0}),wp.toUTF8Array=wp.fromUTF8Array=void 0,wp.fromUTF8Array=function(e){return(new TextDecoder).decode(e)},wp.toUTF8Array=function(e){return(new TextEncoder).encode(e)};var bp,Ep={};Object.defineProperty(Ep,"__esModule",{value:!0}),Ep.ValueType=void 0,function(e){e[e.NULL=0]="NULL",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e[e.FLOAT=3]="FLOAT",e[e.KEY=4]="KEY",e[e.STRING=5]="STRING",e[e.INDIRECT_INT=6]="INDIRECT_INT",e[e.INDIRECT_UINT=7]="INDIRECT_UINT",e[e.INDIRECT_FLOAT=8]="INDIRECT_FLOAT",e[e.MAP=9]="MAP",e[e.VECTOR=10]="VECTOR",e[e.VECTOR_INT=11]="VECTOR_INT",e[e.VECTOR_UINT=12]="VECTOR_UINT",e[e.VECTOR_FLOAT=13]="VECTOR_FLOAT",e[e.VECTOR_KEY=14]="VECTOR_KEY",e[e.VECTOR_STRING_DEPRECATED=15]="VECTOR_STRING_DEPRECATED",e[e.VECTOR_INT2=16]="VECTOR_INT2",e[e.VECTOR_UINT2=17]="VECTOR_UINT2",e[e.VECTOR_FLOAT2=18]="VECTOR_FLOAT2",e[e.VECTOR_INT3=19]="VECTOR_INT3",e[e.VECTOR_UINT3=20]="VECTOR_UINT3",e[e.VECTOR_FLOAT3=21]="VECTOR_FLOAT3",e[e.VECTOR_INT4=22]="VECTOR_INT4",e[e.VECTOR_UINT4=23]="VECTOR_UINT4",e[e.VECTOR_FLOAT4=24]="VECTOR_FLOAT4",e[e.BLOB=25]="BLOB",e[e.BOOL=26]="BOOL",e[e.VECTOR_BOOL=36]="VECTOR_BOOL"}(bp||(Ep.ValueType=bp={}));var Sp={};Object.defineProperty(Sp,"__esModule",{value:!0}),Sp.packedType=Sp.fixedTypedVectorElementSize=Sp.fixedTypedVectorElementType=Sp.typedVectorElementType=Sp.toTypedVector=Sp.isAVector=Sp.isFixedTypedVector=Sp.isTypedVector=Sp.isTypedVectorElement=Sp.isIndirectNumber=Sp.isNumber=Sp.isInline=void 0;const Ip=Ep;function Ap(e){return e===Ip.ValueType.VECTOR_BOOL||e>=Ip.ValueType.VECTOR_INT&&e<=Ip.ValueType.VECTOR_STRING_DEPRECATED}function Pp(e){return e>=Ip.ValueType.VECTOR_INT2&&e<=Ip.ValueType.VECTOR_FLOAT4}Sp.isInline=function(e){return e===Ip.ValueType.BOOL||e<=Ip.ValueType.FLOAT},Sp.isNumber=function(e){return e>=Ip.ValueType.INT&&e<=Ip.ValueType.FLOAT},Sp.isIndirectNumber=function(e){return e>=Ip.ValueType.INDIRECT_INT&&e<=Ip.ValueType.INDIRECT_FLOAT},Sp.isTypedVectorElement=function(e){return e===Ip.ValueType.BOOL||e>=Ip.ValueType.INT&&e<=Ip.ValueType.STRING},Sp.isTypedVector=Ap,Sp.isFixedTypedVector=Pp,Sp.isAVector=function(e){return Ap(e)||Pp(e)||e===Ip.ValueType.VECTOR},Sp.toTypedVector=function(e,t){if(0===t)return e-Ip.ValueType.INT+Ip.ValueType.VECTOR_INT;if(2===t)return e-Ip.ValueType.INT+Ip.ValueType.VECTOR_INT2;if(3===t)return e-Ip.ValueType.INT+Ip.ValueType.VECTOR_INT3;if(4===t)return e-Ip.ValueType.INT+Ip.ValueType.VECTOR_INT4;throw"Unexpected length "+t},Sp.typedVectorElementType=function(e){return e-Ip.ValueType.VECTOR_INT+Ip.ValueType.INT},Sp.fixedTypedVectorElementType=function(e){return(e-Ip.ValueType.VECTOR_INT2)%3+Ip.ValueType.INT},Sp.fixedTypedVectorElementSize=function(e){return 2+((e-Ip.ValueType.VECTOR_INT2)/3|0)},Sp.packedType=function(e,t){return t|e<<2};var Tp={};Object.defineProperty(Tp,"__esModule",{value:!0}),Tp.StackValue=void 0;const Rp=vp,Op=mp,Cp=Ep,Np=Sp;Tp.StackValue=class{constructor(e,t,r,i=null,n=0){this.builder=e,this.type=t,this.width=r,this.value=i,this.offset=n}elementWidth(e,t){if((0,Np.isInline)(this.type))return this.width;for(let r=0;r<4;r++){const i=1<<r,n=e+(0,Op.paddingSize)(e,i)+t*i-this.offset,o=(0,Op.uwidth)(n);if(1<<o===i)return o}throw`Element is unknown. Size: ${e} at index: ${t}. This might be a bug. Please create an issue https://github.com/google/flatbuffers/issues/new`}writeToBuffer(e){const t=this.builder.computeOffset(e);if(this.type===Cp.ValueType.FLOAT)this.width===Rp.BitWidth.WIDTH32?this.builder.view.setFloat32(this.builder.offset,this.value,!0):this.builder.view.setFloat64(this.builder.offset,this.value,!0);else if(this.type===Cp.ValueType.INT){const t=(0,Op.fromByteWidth)(e);this.builder.pushInt(this.value,t)}else if(this.type===Cp.ValueType.UINT){const t=(0,Op.fromByteWidth)(e);this.builder.pushUInt(this.value,t)}else if(this.type===Cp.ValueType.NULL)this.builder.pushInt(0,this.width);else{if(this.type!==Cp.ValueType.BOOL)throw`Unexpected type: ${this.type}. This might be a bug. Please create an issue https://github.com/google/flatbuffers/issues/new`;this.builder.pushInt(this.value?1:0,this.width)}this.offset=t}storedWidth(e=Rp.BitWidth.WIDTH8){return(0,Np.isInline)(this.type)?Math.max(e,this.width):this.width}storedPackedType(e=Rp.BitWidth.WIDTH8){return(0,Np.packedType)(this.type,this.storedWidth(e))}isOffset(){return!(0,Np.isInline)(this.type)}},Object.defineProperty(gp,"__esModule",{value:!0}),gp.Builder=void 0;const kp=vp,_p=mp,xp=wp,Dp=Ep,Fp=Sp,qp=Tp;gp.Builder=class{constructor(e=2048,t=!0,r=!0,i=!0){this.dedupStrings=t,this.dedupKeys=r,this.dedupKeyVectors=i,this.stack=[],this.stackPointers=[],this.offset=0,this.finished=!1,this.stringLookup={},this.keyLookup={},this.keyVectorLookup={},this.indirectIntLookup={},this.indirectUIntLookup={},this.indirectFloatLookup={},this.buffer=new ArrayBuffer(e>0?e:2048),this.view=new DataView(this.buffer)}align(e){const t=(0,_p.toByteWidth)(e);return this.offset+=(0,_p.paddingSize)(this.offset,t),t}computeOffset(e){const t=this.offset+e;let r=this.buffer.byteLength;const i=r;for(;r<t;)r<<=1;if(i<r){const e=this.buffer;this.buffer=new ArrayBuffer(r),this.view=new DataView(this.buffer),new Uint8Array(this.buffer).set(new Uint8Array(e),0)}return t}pushInt(e,t){if(t===kp.BitWidth.WIDTH8)this.view.setInt8(this.offset,e);else if(t===kp.BitWidth.WIDTH16)this.view.setInt16(this.offset,e,!0);else if(t===kp.BitWidth.WIDTH32)this.view.setInt32(this.offset,e,!0);else{if(t!==kp.BitWidth.WIDTH64)throw`Unexpected width: ${t} for value: ${e}`;this.view.setBigInt64(this.offset,BigInt(e),!0)}}pushUInt(e,t){if(t===kp.BitWidth.WIDTH8)this.view.setUint8(this.offset,e);else if(t===kp.BitWidth.WIDTH16)this.view.setUint16(this.offset,e,!0);else if(t===kp.BitWidth.WIDTH32)this.view.setUint32(this.offset,e,!0);else{if(t!==kp.BitWidth.WIDTH64)throw`Unexpected width: ${t} for value: ${e}`;this.view.setBigUint64(this.offset,BigInt(e),!0)}}writeInt(e,t){const r=this.computeOffset(t);this.pushInt(e,(0,_p.fromByteWidth)(t)),this.offset=r}writeUInt(e,t){const r=this.computeOffset(t);this.pushUInt(e,(0,_p.fromByteWidth)(t)),this.offset=r}writeBlob(e){const t=e.byteLength,r=(0,_p.uwidth)(t),i=this.align(r);this.writeUInt(t,i);const n=this.offset,o=this.computeOffset(t);new Uint8Array(this.buffer).set(new Uint8Array(e),n),this.stack.push(this.offsetStackValue(n,Dp.ValueType.BLOB,r)),this.offset=o}writeString(e){if(this.dedupStrings&&Object.prototype.hasOwnProperty.call(this.stringLookup,e))return void this.stack.push(this.stringLookup[e]);const t=(0,xp.toUTF8Array)(e),r=t.length,i=(0,_p.uwidth)(r),n=this.align(i);this.writeUInt(r,n);const o=this.offset,s=this.computeOffset(r+1);new Uint8Array(this.buffer).set(t,o);const a=this.offsetStackValue(o,Dp.ValueType.STRING,i);this.stack.push(a),this.dedupStrings&&(this.stringLookup[e]=a),this.offset=s}writeKey(e){if(this.dedupKeys&&Object.prototype.hasOwnProperty.call(this.keyLookup,e))return void this.stack.push(this.keyLookup[e]);const t=(0,xp.toUTF8Array)(e),r=t.length,i=this.computeOffset(r+1);new Uint8Array(this.buffer).set(t,this.offset);const n=this.offsetStackValue(this.offset,Dp.ValueType.KEY,kp.BitWidth.WIDTH8);this.stack.push(n),this.dedupKeys&&(this.keyLookup[e]=n),this.offset=i}writeStackValue(e,t){const r=this.computeOffset(t);if(e.isOffset()){const r=this.offset-e.offset;if(!(8===t||BigInt(r)<BigInt(1)<<BigInt(8*t)))throw`Unexpected size ${t}. This might be a bug. Please create an issue https://github.com/google/flatbuffers/issues/new`;this.writeUInt(r,t)}else e.writeToBuffer(t);this.offset=r}integrityCheckOnValueAddition(){if(this.finished)throw"Adding values after finish is prohibited";if(0!==this.stackPointers.length&&!1===this.stackPointers[this.stackPointers.length-1].isVector&&this.stack[this.stack.length-1].type!==Dp.ValueType.KEY)throw"Adding value to a map before adding a key is prohibited"}integrityCheckOnKeyAddition(){if(this.finished)throw"Adding values after finish is prohibited";if(0===this.stackPointers.length||this.stackPointers[this.stackPointers.length-1].isVector)throw"Adding key before starting a map is prohibited"}startVector(){this.stackPointers.push({stackPosition:this.stack.length,isVector:!0})}startMap(e=!1){this.stackPointers.push({stackPosition:this.stack.length,isVector:!1,presorted:e})}endVector(e){const t=this.stack.length-e.stackPosition,r=this.createVector(e.stackPosition,t,1);this.stack.splice(e.stackPosition,t),this.stack.push(r)}endMap(e){e.presorted||this.sort(e);let t="";for(let r=e.stackPosition;r<this.stack.length;r+=2)t+=`,${this.stack[r].offset}`;const r=this.stack.length-e.stackPosition>>1;this.dedupKeyVectors&&!Object.prototype.hasOwnProperty.call(this.keyVectorLookup,t)&&(this.keyVectorLookup[t]=this.createVector(e.stackPosition,r,2));const i=this.dedupKeyVectors?this.keyVectorLookup[t]:this.createVector(e.stackPosition,r,2),n=this.createVector(e.stackPosition+1,r,2,i);this.stack.splice(e.stackPosition,r<<1),this.stack.push(n)}sort(e){const t=this.view,r=this.stack;function i(e,r){if(e.type!==Dp.ValueType.KEY||r.type!==Dp.ValueType.KEY)throw`Stack values are not keys ${e} | ${r}. Check if you combined [addKey] with add... method calls properly.`;let i,n,o=0;do{if(i=t.getUint8(e.offset+o),n=t.getUint8(r.offset+o),n<i)return!0;if(i<n)return!1;o+=1}while(0!==i&&0!==n);return!1}function n(e,t,r){if(t===r)return;const i=e[t],n=e[t+1];e[t]=e[r],e[t+1]=e[r+1],e[r]=i,e[r+1]=n}function o(e,r){if(e.type!==Dp.ValueType.KEY||r.type!==Dp.ValueType.KEY)throw`Stack values are not keys ${e} | ${r}. Check if you combined [addKey] with add... method calls properly.`;if(e.offset===r.offset)return!1;let i,n,o=0;do{if(i=t.getUint8(e.offset+o),n=t.getUint8(r.offset+o),i<n)return!0;if(n<i)return!1;o+=1}while(0!==i&&0!==n);return!1}let s=!0;for(let t=e.stackPosition;t<this.stack.length-2;t+=2)if(i(this.stack[t],this.stack[t+2])){s=!1;break}s||(this.stack.length-e.stackPosition>40?function e(t,i){if(t<i){const s=r[t+2*(i-t>>2)];let a=t,c=i;do{for(;o(r[a],s);)a+=2;for(;o(s,r[c]);)c-=2;a<=c&&(n(r,a,c),a+=2,c-=2)}while(a<=c);e(t,c),e(a,i)}}(e.stackPosition,this.stack.length-2):function(){for(let t=e.stackPosition;t<r.length;t+=2){let e=t;for(let n=t+2;n<r.length;n+=2)i(r[e],r[n])&&(e=n);e!==t&&n(r,e,t)}}())}end(){if(this.stackPointers.length<1)return;const e=this.stackPointers.pop();e.isVector?this.endVector(e):this.endMap(e)}createVector(e,t,r,i=null){let n=(0,_p.uwidth)(t),o=1;if(null!==i){const e=i.elementWidth(this.offset,0);e>n&&(n=e),o+=2}let s=Dp.ValueType.KEY,a=null===i;for(let t=e;t<this.stack.length;t+=r){const r=this.stack[t].elementWidth(this.offset,t+o);r>n&&(n=r),t===e?(s=this.stack[t].type,a=a&&(0,Fp.isTypedVectorElement)(s)):s!==this.stack[t].type&&(a=!1)}const c=this.align(n),u=a&&(0,Fp.isNumber)(s)&&t>=2&&t<=4;null!==i&&(this.writeStackValue(i,c),this.writeUInt(1<<i.width,c)),u||this.writeUInt(t,c);const l=this.offset;for(let t=e;t<this.stack.length;t+=r)this.writeStackValue(this.stack[t],c);if(!a)for(let t=e;t<this.stack.length;t+=r)this.writeUInt(this.stack[t].storedPackedType(),1);if(null!==i)return this.offsetStackValue(l,Dp.ValueType.MAP,n);if(a){const e=(0,Fp.toTypedVector)(s,u?t:0);return this.offsetStackValue(l,e,n)}return this.offsetStackValue(l,Dp.ValueType.VECTOR,n)}nullStackValue(){return new qp.StackValue(this,Dp.ValueType.NULL,kp.BitWidth.WIDTH8)}boolStackValue(e){return new qp.StackValue(this,Dp.ValueType.BOOL,kp.BitWidth.WIDTH8,e)}intStackValue(e){return new qp.StackValue(this,Dp.ValueType.INT,(0,_p.iwidth)(e),e)}uintStackValue(e){return new qp.StackValue(this,Dp.ValueType.UINT,(0,_p.uwidth)(e),e)}floatStackValue(e){return new qp.StackValue(this,Dp.ValueType.FLOAT,(0,_p.fwidth)(e),e)}offsetStackValue(e,t,r){return new qp.StackValue(this,t,r,null,e)}finishBuffer(){if(1!==this.stack.length)throw`Stack has to be exactly 1, but it is ${this.stack.length}. You have to end all started vectors and maps before calling [finish]`;const e=this.stack[0],t=this.align(e.elementWidth(this.offset,0));this.writeStackValue(e,t),this.writeUInt(e.storedPackedType(),1),this.writeUInt(t,1),this.finished=!0}add(e){if(this.integrityCheckOnValueAddition(),void 0===e)throw"You need to provide a value";if(null===e)this.stack.push(this.nullStackValue());else if("boolean"==typeof e)this.stack.push(this.boolStackValue(e));else if("bigint"==typeof e)this.stack.push(this.intStackValue(e));else if("number"==typeof e)Number.isInteger(e)?this.stack.push(this.intStackValue(e)):this.stack.push(this.floatStackValue(e));else if(ArrayBuffer.isView(e))this.writeBlob(e.buffer);else if("string"==typeof e||e instanceof String)this.writeString(e);else if(Array.isArray(e)){this.startVector();for(let t=0;t<e.length;t++)this.add(e[t]);this.end()}else{if("object"!=typeof e)throw`Unexpected value input ${e}`;{const t=Object.getOwnPropertyNames(e).sort();this.startMap(!0);for(let r=0;r<t.length;r++){const i=t[r];this.addKey(i),this.add(e[i])}this.end()}}}finish(){this.finished||this.finishBuffer();const e=this.buffer.slice(0,this.offset);return new Uint8Array(e)}isFinished(){return this.finished}addKey(e){this.integrityCheckOnKeyAddition(),this.writeKey(e)}addInt(e,t=!1,r=!1){if(this.integrityCheckOnValueAddition(),!t)return void this.stack.push(this.intStackValue(e));if(r&&Object.prototype.hasOwnProperty.call(this.indirectIntLookup,e))return void this.stack.push(this.indirectIntLookup[e]);const i=this.intStackValue(e),n=this.align(i.width),o=this.computeOffset(n),s=this.offset;i.writeToBuffer(n);const a=this.offsetStackValue(s,Dp.ValueType.INDIRECT_INT,i.width);this.stack.push(a),this.offset=o,r&&(this.indirectIntLookup[e]=a)}addUInt(e,t=!1,r=!1){if(this.integrityCheckOnValueAddition(),!t)return void this.stack.push(this.uintStackValue(e));if(r&&Object.prototype.hasOwnProperty.call(this.indirectUIntLookup,e))return void this.stack.push(this.indirectUIntLookup[e]);const i=this.uintStackValue(e),n=this.align(i.width),o=this.computeOffset(n),s=this.offset;i.writeToBuffer(n);const a=this.offsetStackValue(s,Dp.ValueType.INDIRECT_UINT,i.width);this.stack.push(a),this.offset=o,r&&(this.indirectUIntLookup[e]=a)}addFloat(e,t=!1,r=!1){if(this.integrityCheckOnValueAddition(),!t)return void this.stack.push(this.floatStackValue(e));if(r&&Object.prototype.hasOwnProperty.call(this.indirectFloatLookup,e))return void this.stack.push(this.indirectFloatLookup[e]);const i=this.floatStackValue(e),n=this.align(i.width),o=this.computeOffset(n),s=this.offset;i.writeToBuffer(n);const a=this.offsetStackValue(s,Dp.ValueType.INDIRECT_FLOAT,i.width);this.stack.push(a),this.offset=o,r&&(this.indirectFloatLookup[e]=a)}};var Bp={},jp={};Object.defineProperty(jp,"__esModule",{value:!0}),jp.keyForIndex=jp.diffKeys=jp.keyIndex=jp.indirect=jp.readFloat=jp.readUInt=jp.readInt=jp.validateOffset=void 0;const $p=vp,Mp=mp,Lp=wp;function Vp(e,t,r){return r<2?r<1?e.getUint8(t):e.getUint16(t,!0):r<3?e.getUint32(t,!0):void 0===e.getBigUint64?BigInt(e.getUint32(t,!0))+(BigInt(e.getUint32(t+4,!0))<<BigInt(32)):e.getBigUint64(t,!0)}function Up(e,t,r){return t-Vp(e,t,r)}function Hp(e,t,r,i,n){const o=i+t*n,s=o-Number(Vp(r,o,(0,Mp.fromByteWidth)(n)));for(let t=0;t<e.length;t++){const i=e[t]-r.getUint8(s+t);if(0!==i)return i}return 0===r.getUint8(s+e.length)?0:-1}jp.validateOffset=function(e,t,r){if(e.byteLength<=t+r||t&(0,Mp.toByteWidth)(r)-1)throw"Bad offset: "+t+", width: "+r},jp.readInt=function(e,t,r){return r<2?r<1?e.getInt8(t):e.getInt16(t,!0):r<3?e.getInt32(t,!0):void 0===e.setBigInt64?BigInt(e.getUint32(t,!0))+(BigInt(e.getUint32(t+4,!0))<<BigInt(32)):e.getBigInt64(t,!0)},jp.readUInt=Vp,jp.readFloat=function(e,t,r){if(r<$p.BitWidth.WIDTH32)throw"Bad width: "+r;return r===$p.BitWidth.WIDTH32?e.getFloat32(t,!0):e.getFloat64(t,!0)},jp.indirect=Up,jp.keyIndex=function(e,t,r,i,n,o){const s=(0,Lp.toUTF8Array)(e),a=Up(t,r,i)-3*n,c=(0,Mp.fromByteWidth)(n),u=a-Number(Vp(t,a,c)),l=Number(Vp(t,a+n,c));let h=0,d=o-1;for(;h<=d;){const e=d+h>>1,r=Hp(s,e,t,u,l);if(0===r)return e;r<0?d=e-1:h=e+1}return null},jp.diffKeys=Hp,jp.keyForIndex=function(e,t,r,i,n){const o=Up(t,r,i)-3*n,s=(0,Mp.fromByteWidth)(n),a=o-Number(Vp(t,o,s)),c=Number(Vp(t,o+n,s)),u=a+e*c,l=u-Number(Vp(t,u,(0,Mp.fromByteWidth)(c)));let h=0;for(;0!==t.getUint8(l+h);)h++;return(0,Lp.fromUTF8Array)(new Uint8Array(t.buffer,l,h))},Object.defineProperty(Bp,"__esModule",{value:!0}),Bp.Reference=Bp.toReference=void 0;const zp=mp,Wp=Ep,Gp=Sp,Yp=jp,Kp=wp,Jp=vp;function Xp(e,t,r,i,n,o,s,a){const c=(0,Yp.indirect)(r,i,n),u=c+e*o,l=r.getUint8(c+s*o+e);return new Qp(r,u,(0,zp.fromByteWidth)(o),l,`${a}/${t}`)}Bp.toReference=function(e){const t=e.byteLength;if(t<3)throw"Buffer needs to be bigger than 3";const r=new DataView(e),i=r.getUint8(t-1),n=r.getUint8(t-2),o=(0,zp.fromByteWidth)(i);return new Qp(r,t-i-2,o,n,"/")};class Qp{constructor(e,t,r,i,n){this.dataView=e,this.offset=t,this.parentWidth=r,this.packedType=i,this.path=n,this._length=-1,this.byteWidth=1<<(3&i),this.valueType=i>>2}isNull(){return this.valueType===Wp.ValueType.NULL}isNumber(){return(0,Gp.isNumber)(this.valueType)||(0,Gp.isIndirectNumber)(this.valueType)}isFloat(){return Wp.ValueType.FLOAT===this.valueType||Wp.ValueType.INDIRECT_FLOAT===this.valueType}isInt(){return this.isNumber()&&!this.isFloat()}isString(){return Wp.ValueType.STRING===this.valueType||Wp.ValueType.KEY===this.valueType}isBool(){return Wp.ValueType.BOOL===this.valueType}isBlob(){return Wp.ValueType.BLOB===this.valueType}isVector(){return(0,Gp.isAVector)(this.valueType)}isMap(){return Wp.ValueType.MAP===this.valueType}boolValue(){return this.isBool()?(0,Yp.readInt)(this.dataView,this.offset,this.parentWidth)>0:null}intValue(){return this.valueType===Wp.ValueType.INT?(0,Yp.readInt)(this.dataView,this.offset,this.parentWidth):this.valueType===Wp.ValueType.UINT?(0,Yp.readUInt)(this.dataView,this.offset,this.parentWidth):this.valueType===Wp.ValueType.INDIRECT_INT?(0,Yp.readInt)(this.dataView,(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth),(0,zp.fromByteWidth)(this.byteWidth)):this.valueType===Wp.ValueType.INDIRECT_UINT?(0,Yp.readUInt)(this.dataView,(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth),(0,zp.fromByteWidth)(this.byteWidth)):null}floatValue(){return this.valueType===Wp.ValueType.FLOAT?(0,Yp.readFloat)(this.dataView,this.offset,this.parentWidth):this.valueType===Wp.ValueType.INDIRECT_FLOAT?(0,Yp.readFloat)(this.dataView,(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth),(0,zp.fromByteWidth)(this.byteWidth)):null}numericValue(){return this.floatValue()||this.intValue()}stringValue(){if(this.valueType===Wp.ValueType.STRING||this.valueType===Wp.ValueType.KEY){const e=(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth);return(0,Kp.fromUTF8Array)(new Uint8Array(this.dataView.buffer,e,this.length()))}return null}blobValue(){if(this.isBlob()){const e=(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth);return new Uint8Array(this.dataView.buffer,e,this.length())}return null}get(e){const t=this.length();if(Number.isInteger(e)&&(0,Gp.isAVector)(this.valueType)){if(e>=t||e<0)throw`Key: [${e}] is not applicable on ${this.path} of ${this.valueType} length: ${t}`;const r=(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth),i=r+e*this.byteWidth;let n=this.dataView.getUint8(r+t*this.byteWidth+e);if((0,Gp.isTypedVector)(this.valueType)){const e=(0,Gp.typedVectorElementType)(this.valueType);n=(0,Gp.packedType)(e,Jp.BitWidth.WIDTH8)}else if((0,Gp.isFixedTypedVector)(this.valueType)){const e=(0,Gp.fixedTypedVectorElementType)(this.valueType);n=(0,Gp.packedType)(e,Jp.BitWidth.WIDTH8)}return new Qp(this.dataView,i,(0,zp.fromByteWidth)(this.byteWidth),n,`${this.path}[${e}]`)}if("string"==typeof e){const r=(0,Yp.keyIndex)(e,this.dataView,this.offset,this.parentWidth,this.byteWidth,t);if(null!==r)return Xp(r,e,this.dataView,this.offset,this.parentWidth,this.byteWidth,t,this.path)}throw`Key [${e}] is not applicable on ${this.path} of ${this.valueType}`}length(){let e;if(this._length>-1)return this._length;if((0,Gp.isFixedTypedVector)(this.valueType))this._length=(0,Gp.fixedTypedVectorElementSize)(this.valueType);else if(this.valueType===Wp.ValueType.BLOB||this.valueType===Wp.ValueType.MAP||(0,Gp.isAVector)(this.valueType))this._length=(0,Yp.readUInt)(this.dataView,(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth)-this.byteWidth,(0,zp.fromByteWidth)(this.byteWidth));else if(this.valueType===Wp.ValueType.NULL)this._length=0;else if(this.valueType===Wp.ValueType.STRING){const t=(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth);let r=this.byteWidth;for(e=(0,Yp.readUInt)(this.dataView,t-r,(0,zp.fromByteWidth)(this.byteWidth));0!==this.dataView.getInt8(t+e);)r<<=1,e=(0,Yp.readUInt)(this.dataView,t-r,(0,zp.fromByteWidth)(this.byteWidth));this._length=e}else if(this.valueType===Wp.ValueType.KEY){const t=(0,Yp.indirect)(this.dataView,this.offset,this.parentWidth);for(e=1;0!==this.dataView.getInt8(t+e);)e++;this._length=e}else this._length=1;return Number(this._length)}toObject(){const e=this.length();if(this.isVector()){const t=[];for(let r=0;r<e;r++)t.push(this.get(r).toObject());return t}if(this.isMap()){const t={};for(let r=0;r<e;r++){const i=(0,Yp.keyForIndex)(r,this.dataView,this.offset,this.parentWidth,this.byteWidth);t[i]=Xp(r,i,this.dataView,this.offset,this.parentWidth,this.byteWidth,e,this.path).toObject()}return t}return this.isNull()?null:this.isBool()?this.boolValue():this.isNumber()?this.numericValue():this.blobValue()||this.stringValue()}}Bp.Reference=Qp,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.encode=e.toObject=e.builder=e.toReference=void 0;const t=gp,r=Bp;var i=Bp;Object.defineProperty(e,"toReference",{enumerable:!0,get:function(){return i.toReference}}),e.builder=function(){return new t.Builder},e.toObject=function(e){return(0,r.toReference)(e).toObject()},e.encode=function(e,r=2048,i=!0,n=!0,o=!0){const s=new t.Builder(r>0?r:2048,i,n,o);return s.add(e),s.finish()}}(fp);var Zp={exports:{}};!function(e){!function(){var t="input is invalid type",r="object"==typeof window,i=r?window:{};i.JS_SHA3_NO_WINDOW&&(r=!1);var n=!r&&"object"==typeof self;!i.JS_SHA3_NO_NODE_JS&&"object"==typeof $&&$.versions&&$.versions.node?i=M:n&&(i=self);for(var o=!i.JS_SHA3_NO_COMMON_JS&&e.exports,s=!i.JS_SHA3_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,a="0123456789abcdef".split(""),c=[4,1024,262144,67108864],u=[0,8,16,24],l=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],h=[224,256,384,512],d=[128,256],p=["hex","buffer","arrayBuffer","array","digest"],f={128:168,256:136},g=i.JS_SHA3_NO_NODE_JS||!Array.isArray?function(e){return"[object Array]"===Object.prototype.toString.call(e)}:Array.isArray,v=!s||!i.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView?ArrayBuffer.isView:function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer},m=function(e){var r=typeof e;if("string"===r)return[e,!0];if("object"!==r||null===e)throw new Error(t);if(s&&e.constructor===ArrayBuffer)return[new Uint8Array(e),!1];if(!g(e)&&!v(e))throw new Error(t);return[e,!1]},y=function(e){return 0===m(e)[0].length},w=function(e){for(var t=[],r=0;r<e.length;++r)t[r]=e[r];return t},b=function(e,t,r){return function(i){return new F(e,t,e).update(i)[r]()}},E=function(e,t,r){return function(i,n){return new F(e,t,n).update(i)[r]()}},S=function(e,t,r){return function(t,i,n,o){return R["cshake"+e].update(t,i,n,o)[r]()}},I=function(e,t,r){return function(t,i,n,o){return R["kmac"+e].update(t,i,n,o)[r]()}},A=function(e,t,r,i){for(var n=0;n<p.length;++n){var o=p[n];e[o]=t(r,i,o)}return e},P=function(e,t){var r=b(e,t,"hex");return r.create=function(){return new F(e,t,e)},r.update=function(e){return r.create().update(e)},A(r,b,e,t)},T=[{name:"keccak",padding:[1,256,65536,16777216],bits:h,createMethod:P},{name:"sha3",padding:[6,1536,393216,100663296],bits:h,createMethod:P},{name:"shake",padding:[31,7936,2031616,520093696],bits:d,createMethod:function(e,t){var r=E(e,t,"hex");return r.create=function(r){return new F(e,t,r)},r.update=function(e,t){return r.create(t).update(e)},A(r,E,e,t)}},{name:"cshake",padding:c,bits:d,createMethod:function(e,t){var r=f[e],i=S(e,0,"hex");return i.create=function(i,n,o){return y(n)&&y(o)?R["shake"+e].create(i):new F(e,t,i).bytepad([n,o],r)},i.update=function(e,t,r,n){return i.create(t,r,n).update(e)},A(i,S,e,t)}},{name:"kmac",padding:c,bits:d,createMethod:function(e,t){var r=f[e],i=I(e,0,"hex");return i.create=function(i,n,o){return new q(e,t,n).bytepad(["KMAC",o],r).bytepad([i],r)},i.update=function(e,t,r,n){return i.create(e,r,n).update(t)},A(i,I,e,t)}}],R={},O=[],C=0;C<T.length;++C)for(var N=T[C],k=N.bits,_=0;_<k.length;++_){var x=N.name+"_"+k[_];if(O.push(x),R[x]=N.createMethod(k[_],N.padding),"sha3"!==N.name){var D=N.name+k[_];O.push(D),R[D]=R[x]}}function F(e,t,r){this.blocks=[],this.s=[],this.padding=t,this.outputBits=r,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(e<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=r>>5,this.extraBytes=(31&r)>>3;for(var i=0;i<50;++i)this.s[i]=0}function q(e,t,r){F.call(this,e,t,r)}F.prototype.update=function(e){if(this.finalized)throw new Error("finalize already called");var t=m(e);e=t[0];for(var r,i,n=t[1],o=this.blocks,s=this.byteCount,a=e.length,c=this.blockCount,l=0,h=this.s;l<a;){if(this.reset)for(this.reset=!1,o[0]=this.block,r=1;r<c+1;++r)o[r]=0;if(n)for(r=this.start;l<a&&r<s;++l)(i=e.charCodeAt(l))<128?o[r>>2]|=i<<u[3&r++]:i<2048?(o[r>>2]|=(192|i>>6)<<u[3&r++],o[r>>2]|=(128|63&i)<<u[3&r++]):i<55296||i>=57344?(o[r>>2]|=(224|i>>12)<<u[3&r++],o[r>>2]|=(128|i>>6&63)<<u[3&r++],o[r>>2]|=(128|63&i)<<u[3&r++]):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++l)),o[r>>2]|=(240|i>>18)<<u[3&r++],o[r>>2]|=(128|i>>12&63)<<u[3&r++],o[r>>2]|=(128|i>>6&63)<<u[3&r++],o[r>>2]|=(128|63&i)<<u[3&r++]);else for(r=this.start;l<a&&r<s;++l)o[r>>2]|=e[l]<<u[3&r++];if(this.lastByteIndex=r,r>=s){for(this.start=r-s,this.block=o[c],r=0;r<c;++r)h[r]^=o[r];B(h),this.reset=!0}else this.start=r}return this},F.prototype.encode=function(e,t){var r=255&e,i=1,n=[r];for(r=255&(e>>=8);r>0;)n.unshift(r),r=255&(e>>=8),++i;return t?n.push(i):n.unshift(i),this.update(n),n.length},F.prototype.encodeString=function(e){var t=m(e);e=t[0];var r=t[1],i=0,n=e.length;if(r)for(var o=0;o<e.length;++o){var s=e.charCodeAt(o);s<128?i+=1:s<2048?i+=2:s<55296||s>=57344?i+=3:(s=65536+((1023&s)<<10|1023&e.charCodeAt(++o)),i+=4)}else i=n;return i+=this.encode(8*i),this.update(e),i},F.prototype.bytepad=function(e,t){for(var r=this.encode(t),i=0;i<e.length;++i)r+=this.encodeString(e[i]);var n=(t-r%t)%t,o=[];return o.length=n,this.update(o),this},F.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex,r=this.blockCount,i=this.s;if(e[t>>2]|=this.padding[3&t],this.lastByteIndex===this.byteCount)for(e[0]=e[r],t=1;t<r+1;++t)e[t]=0;for(e[r-1]|=2147483648,t=0;t<r;++t)i[t]^=e[t];B(i)}},F.prototype.toString=F.prototype.hex=function(){this.finalize();for(var e,t=this.blockCount,r=this.s,i=this.outputBlocks,n=this.extraBytes,o=0,s=0,c="";s<i;){for(o=0;o<t&&s<i;++o,++s)e=r[o],c+=a[e>>4&15]+a[15&e]+a[e>>12&15]+a[e>>8&15]+a[e>>20&15]+a[e>>16&15]+a[e>>28&15]+a[e>>24&15];s%t==0&&(r=w(r),B(r),o=0)}return n&&(e=r[o],c+=a[e>>4&15]+a[15&e],n>1&&(c+=a[e>>12&15]+a[e>>8&15]),n>2&&(c+=a[e>>20&15]+a[e>>16&15])),c},F.prototype.arrayBuffer=function(){this.finalize();var e,t=this.blockCount,r=this.s,i=this.outputBlocks,n=this.extraBytes,o=0,s=0,a=this.outputBits>>3;e=n?new ArrayBuffer(i+1<<2):new ArrayBuffer(a);for(var c=new Uint32Array(e);s<i;){for(o=0;o<t&&s<i;++o,++s)c[s]=r[o];s%t==0&&(r=w(r),B(r))}return n&&(c[s]=r[o],e=e.slice(0,a)),e},F.prototype.buffer=F.prototype.arrayBuffer,F.prototype.digest=F.prototype.array=function(){this.finalize();for(var e,t,r=this.blockCount,i=this.s,n=this.outputBlocks,o=this.extraBytes,s=0,a=0,c=[];a<n;){for(s=0;s<r&&a<n;++s,++a)e=a<<2,t=i[s],c[e]=255&t,c[e+1]=t>>8&255,c[e+2]=t>>16&255,c[e+3]=t>>24&255;a%r==0&&(i=w(i),B(i))}return o&&(e=a<<2,t=i[s],c[e]=255&t,o>1&&(c[e+1]=t>>8&255),o>2&&(c[e+2]=t>>16&255)),c},q.prototype=new F,q.prototype.finalize=function(){return this.encode(this.outputBits,!0),F.prototype.finalize.call(this)};var B=function(e){var t,r,i,n,o,s,a,c,u,h,d,p,f,g,v,m,y,w,b,E,S,I,A,P,T,R,O,C,N,k,_,x,D,F,q,B,j,$,M,L,V,U,H,z,W,G,Y,K,J,X,Q,Z,ee,te,re,ie,ne,oe,se,ae,ce,ue,le;for(i=0;i<48;i+=2)n=e[0]^e[10]^e[20]^e[30]^e[40],o=e[1]^e[11]^e[21]^e[31]^e[41],s=e[2]^e[12]^e[22]^e[32]^e[42],a=e[3]^e[13]^e[23]^e[33]^e[43],c=e[4]^e[14]^e[24]^e[34]^e[44],u=e[5]^e[15]^e[25]^e[35]^e[45],h=e[6]^e[16]^e[26]^e[36]^e[46],d=e[7]^e[17]^e[27]^e[37]^e[47],t=(p=e[8]^e[18]^e[28]^e[38]^e[48])^(s<<1|a>>>31),r=(f=e[9]^e[19]^e[29]^e[39]^e[49])^(a<<1|s>>>31),e[0]^=t,e[1]^=r,e[10]^=t,e[11]^=r,e[20]^=t,e[21]^=r,e[30]^=t,e[31]^=r,e[40]^=t,e[41]^=r,t=n^(c<<1|u>>>31),r=o^(u<<1|c>>>31),e[2]^=t,e[3]^=r,e[12]^=t,e[13]^=r,e[22]^=t,e[23]^=r,e[32]^=t,e[33]^=r,e[42]^=t,e[43]^=r,t=s^(h<<1|d>>>31),r=a^(d<<1|h>>>31),e[4]^=t,e[5]^=r,e[14]^=t,e[15]^=r,e[24]^=t,e[25]^=r,e[34]^=t,e[35]^=r,e[44]^=t,e[45]^=r,t=c^(p<<1|f>>>31),r=u^(f<<1|p>>>31),e[6]^=t,e[7]^=r,e[16]^=t,e[17]^=r,e[26]^=t,e[27]^=r,e[36]^=t,e[37]^=r,e[46]^=t,e[47]^=r,t=h^(n<<1|o>>>31),r=d^(o<<1|n>>>31),e[8]^=t,e[9]^=r,e[18]^=t,e[19]^=r,e[28]^=t,e[29]^=r,e[38]^=t,e[39]^=r,e[48]^=t,e[49]^=r,g=e[0],v=e[1],G=e[11]<<4|e[10]>>>28,Y=e[10]<<4|e[11]>>>28,C=e[20]<<3|e[21]>>>29,N=e[21]<<3|e[20]>>>29,ae=e[31]<<9|e[30]>>>23,ce=e[30]<<9|e[31]>>>23,U=e[40]<<18|e[41]>>>14,H=e[41]<<18|e[40]>>>14,F=e[2]<<1|e[3]>>>31,q=e[3]<<1|e[2]>>>31,m=e[13]<<12|e[12]>>>20,y=e[12]<<12|e[13]>>>20,K=e[22]<<10|e[23]>>>22,J=e[23]<<10|e[22]>>>22,k=e[33]<<13|e[32]>>>19,_=e[32]<<13|e[33]>>>19,ue=e[42]<<2|e[43]>>>30,le=e[43]<<2|e[42]>>>30,te=e[5]<<30|e[4]>>>2,re=e[4]<<30|e[5]>>>2,B=e[14]<<6|e[15]>>>26,j=e[15]<<6|e[14]>>>26,w=e[25]<<11|e[24]>>>21,b=e[24]<<11|e[25]>>>21,X=e[34]<<15|e[35]>>>17,Q=e[35]<<15|e[34]>>>17,x=e[45]<<29|e[44]>>>3,D=e[44]<<29|e[45]>>>3,P=e[6]<<28|e[7]>>>4,T=e[7]<<28|e[6]>>>4,ie=e[17]<<23|e[16]>>>9,ne=e[16]<<23|e[17]>>>9,$=e[26]<<25|e[27]>>>7,M=e[27]<<25|e[26]>>>7,E=e[36]<<21|e[37]>>>11,S=e[37]<<21|e[36]>>>11,Z=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,z=e[8]<<27|e[9]>>>5,W=e[9]<<27|e[8]>>>5,R=e[18]<<20|e[19]>>>12,O=e[19]<<20|e[18]>>>12,oe=e[29]<<7|e[28]>>>25,se=e[28]<<7|e[29]>>>25,L=e[38]<<8|e[39]>>>24,V=e[39]<<8|e[38]>>>24,I=e[48]<<14|e[49]>>>18,A=e[49]<<14|e[48]>>>18,e[0]=g^~m&w,e[1]=v^~y&b,e[10]=P^~R&C,e[11]=T^~O&N,e[20]=F^~B&$,e[21]=q^~j&M,e[30]=z^~G&K,e[31]=W^~Y&J,e[40]=te^~ie&oe,e[41]=re^~ne&se,e[2]=m^~w&E,e[3]=y^~b&S,e[12]=R^~C&k,e[13]=O^~N&_,e[22]=B^~$&L,e[23]=j^~M&V,e[32]=G^~K&X,e[33]=Y^~J&Q,e[42]=ie^~oe&ae,e[43]=ne^~se&ce,e[4]=w^~E&I,e[5]=b^~S&A,e[14]=C^~k&x,e[15]=N^~_&D,e[24]=$^~L&U,e[25]=M^~V&H,e[34]=K^~X&Z,e[35]=J^~Q&ee,e[44]=oe^~ae&ue,e[45]=se^~ce&le,e[6]=E^~I&g,e[7]=S^~A&v,e[16]=k^~x&P,e[17]=_^~D&T,e[26]=L^~U&F,e[27]=V^~H&q,e[36]=X^~Z&z,e[37]=Q^~ee&W,e[46]=ae^~ue&te,e[47]=ce^~le&re,e[8]=I^~g&m,e[9]=A^~v&y,e[18]=x^~P&R,e[19]=D^~T&O,e[28]=U^~F&B,e[29]=H^~q&j,e[38]=Z^~z&G,e[39]=ee^~W&Y,e[48]=ue^~te&ie,e[49]=le^~re&ne,e[0]^=l[i],e[1]^=l[i+1]};if(o)e.exports=R;else for(C=0;C<O.length;++C)i[O[C]]=R[O[C]]}()}(Zp);var ef=Zp.exports,tf=L(ef),rf=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},nf=L(rf);const of=void 0;class sf{constructor(e,t){var r;this.yagnaApi=e,this.services=new Map,this.ready=!1,this.openHandles=new Set,this.logger=(null===(r=null==t?void 0:t.logger)||void 0===r?void 0:r.child("storage"))||K("storage")}async close(){return this.ready=!1,await Promise.allSettled(Array.from(this.openHandles).map((e=>e.close()))),this.release(Array.from(this.services.keys()))}init(){return this.ready=!0,Promise.resolve(void 0)}async publishData(e){const t=await this.createFileInfo(),r=await this.createSocket(t,["GetMetadata","GetChunk"]);return r.addEventListener("message",(t=>{if(!(t.data instanceof ArrayBuffer))return void this.logger.error("Received non-ArrayBuffer data from the socket",{data:t.data});const i=fp.toObject(t.data);this.logger.debug("Received GFTP request for publishData",i),"GetMetadata"===i.component?this.respond(r,i.id,{fileSize:e.byteLength}):"GetChunk"===i.component?this.respond(r,i.id,{content:e.slice(i.payload.offset,i.payload.offset+i.payload.size),offset:i.payload.offset}):this.logger.error(`Unsupported message in publishData(): ${i.component}`)})),t.url}async publishFile(e){if(u)throw new r("Cannot publish files in browser context, did you mean to use `publishData()`?");this.logger.info("Preparing file upload",{sourcePath:e});const t=await this.createFileInfo(),i=await this.createSocket(t,["GetMetadata","GetChunk"]),n=(await of.stat(e)).size,o=await of.open(e,"r");return this.openHandles.add(o),i.addEventListener("message",(async e=>{if(!(e.data instanceof ArrayBuffer))return void this.logger.error("Received non-ArrayBuffer data from the socket",{data:e.data});const t=fp.toObject(e.data);if(this.logger.debug("Received GFTP request for publishFile",t),"GetMetadata"===t.component)this.respond(i,t.id,{fileSize:n});else if("GetChunk"===t.component){const{offset:e,size:r}=t.payload,s=Math.min(r,n-e),a=Buffer.alloc(s);try{await o.read(a,0,s,e),this.respond(i,t.id,{content:a,offset:e})}catch(e){this.logger.error("Something went wrong while sending the file chunk",{error:e})}}else this.logger.error(`Unsupported message in publishFile(): ${t.component}`)})),t.url}async receiveData(e){const t=[],r=await this.createFileInfo(),i=await this.createSocket(r,["UploadChunk","UploadFinished"]);return i.addEventListener("message",(r=>{if(!(r.data instanceof ArrayBuffer))return void this.logger.error("Received non-ArrayBuffer data from the socket",{data:r.data});const n=fp.toObject(r.data);if(this.logger.debug("Received GFTP request for receiveData",n),"UploadChunk"===n.component)t.push(n.payload.chunk),this.respond(i,n.id,null);else if("UploadFinished"===n.component){this.respond(i,n.id,null);const r=this.completeReceive(n.payload.hash,t);e(r)}else this.logger.error(`Unsupported message in receiveData(): ${n.component}`)})),r.url}async receiveFile(e){if(u)throw new r("Cannot receive files in browser context, did you mean to use `receiveData()`?");this.logger.info("Preparing file download",{destination:e});const t=await this.createFileInfo(),i=await of.open(e,"w");this.openHandles.add(i);const n=await this.createSocket(t,["UploadChunk","UploadFinished"]);return n.addEventListener("message",(async e=>{if(!(e.data instanceof ArrayBuffer))return void this.logger.error("Received non-ArrayBuffer data from the socket",{data:e.data});const t=fp.toObject(e.data);this.logger.debug("Received GFTP request for receiveFile",t),"UploadChunk"===t.component?(await i.write(t.payload.chunk.content),this.respond(n,t.id,null)):"UploadFinished"===t.component?(this.respond(n,t.id,null),await i.close(),this.openHandles.delete(i)):this.logger.error(`Unsupported message in receiveFile(): ${t.component}`)})),t.url}async release(e){e.forEach((e=>{const t=this.services.get(e);t&&this.deleteService(t).catch((e=>this.logger.warn("Failed to delete service",{serviceId:t,error:e}))),this.services.delete(e)}))}isReady(){return this.ready}async createFileInfo(){const e=Xn();return{id:e,url:`gftp://${(await this.yagnaApi.identity.getIdentity()).identity}/${e}`}}getWsConstructor(){return u?WebSocket:nf}async createSocket(e,t){const r=await this.createService(e,t),i=new(this.getWsConstructor())(r.url,["gsb+flexbuffers"]);return i.addEventListener("error",(()=>{this.logger.error(`Socket Error (${e.id})`)})),i.binaryType="arraybuffer",i}async createService(e,t){const r=(await this.yagnaApi.gsb.bindServices({listen:{on:`/public/gftp/${e.id}`,components:t}})).servicesId,i=`/gsb-api/v1/services/${r}?authToken=${this.yagnaApi.yagnaOptions.apiKey}`,n=new URL(i,this.yagnaApi.yagnaOptions.basePath);return n.protocol="ws:",this.services.set(e.url,r),{url:n,serviceId:r}}async deleteService(e){await this.yagnaApi.gsb.unbindServices(e)}respond(e,t,r){e.send(fp.encode({id:t,payload:r}))}completeReceive(e,t){t.sort(((e,t)=>e.offset-t.offset));const r=t.reduce(((e,t)=>e+t.content.byteLength),0),i=new Uint8Array(r);t.forEach((e=>{i.set(e.content,e.offset)}));const n=ef.sha3_256(i);if(e!==n)throw new o(`File corrupted, expected hash ${e}, got ${n}`);return i}}function af(e,t){return new sf(e,{logger:null==t?void 0:t.child("storage")})}var cf,uf,lf,hf;!function(e){e.ServiceNotInitialized="ServiceNotInitialized",e.ScriptExecutionFailed="ScriptExecutionFailed",e.ActivityDestroyingFailed="ActivityDestroyingFailed",e.ActivityResultsFetchingFailed="ActivityResultsFetchingFailed",e.ActivityCreationFailed="ActivityCreationFailed",e.NetworkSetupMissing="NetworkSetupMissing",e.ScriptInitializationFailed="ScriptInitializationFailed",e.ActivityDeploymentFailed="ActivityDeploymentFailed",e.ActivityStatusQueryFailed="ActivityStatusQueryFailed",e.ActivityResetFailed="ActivityResetFailed"}(hf||(hf={}));class df extends c{constructor(e,t,r,i,n,o){super(e,t,o),this.code=t,this.previous=o,cf.set(this,void 0),uf.set(this,void 0),lf.set(this,void 0),ss(this,cf,r,"f"),ss(this,uf,i,"f"),ss(this,lf,n,"f")}getAgreement(){return os(this,cf,"f")}getActivity(){return os(this,uf,"f")}getProvider(){return os(this,lf,"f")}}cf=new WeakMap,uf=new WeakMap,lf=new WeakMap;class pf{constructor(e,t,r){this.executor=e,this.storageProvider=t,this.logger=r,this.script=new Lh([])}run(e,t){return t?this.script.add(new Wh(e,t)):this.script.add(new Wh("/bin/sh",["-c",e])),this}transfer(e,t){return this.script.add(new Gh(e,t)),this}uploadFile(e,t){return this.script.add(new Yh(this.storageProvider,e,t)),this}uploadJson(e,t){const r=(new TextEncoder).encode(JSON.stringify(e));return this.script.add(new Kh(this.storageProvider,r,t)),this}uploadData(e,t){return this.script.add(new Kh(this.storageProvider,e,t)),this}downloadFile(e,t){return this.script.add(new Jh(this.storageProvider,e,t)),this}async end(){await this.script.before();try{const e=[],t=this.script.getExeScriptRequest();this.logger.debug("Sending exec script request to the exe-unit on provider:",{script:t});const r=await this.executor.execute(t),i=this.executor.getResultsObservable(r);return new Promise(((t,r)=>{this.logger.debug("Reading the results of the batch script"),i.subscribe({next:t=>{this.logger.debug("Received data for batch script execution",{res:t}),e.push(t)},complete:()=>{this.logger.debug("End of batch script execution"),this.script.after(e).then((e=>t(e))).catch((e=>r(e)))},error:t=>{const i=t instanceof df?t:new df(`Unable to execute script ${t}`,hf.ScriptExecutionFailed,this.executor.activity.agreement,this.executor.activity,this.executor.activity.agreement.provider,t);this.logger.debug("Error in batch script execution",{error:t}),this.script.after(e).then((()=>r(i))).catch((()=>r(i)))}})}))}catch(e){if(this.logger.error("Failed to send the exec script to the exe-unit on provider",{error:e}),await this.script.after([]),e instanceof df)throw e;throw new df(`Unable to execute script ${e}`,hf.ScriptExecutionFailed,this.executor.activity.agreement,this.executor.activity,this.executor.activity.agreement.provider,e)}}async endStream(){const e=this.script;let t;await e.before();try{t=await this.executor.execute(this.script.getExeScriptRequest())}catch(t){if(await e.after([]),t instanceof df)throw t;throw new df(`Unable to execute script ${t}`,hf.ScriptExecutionFailed,this.executor.activity.agreement,this.executor.activity,this.executor.activity.agreement.provider,t)}const r=[],{activity:i}=this.executor;return this.executor.getResultsObservable(t).pipe(oa((e=>{if("Error"!==e.result)return e;throw new df(`${null==e?void 0:e.message}. Stdout: ${String(null==e?void 0:e.stdout).trim()}. Stderr: ${String(null==e?void 0:e.stderr).trim()}`,hf.ScriptExecutionFailed,i.agreement,i,i.provider)})),ga((e=>{r.push(e)})),ha((()=>e.after(r).catch((e=>this.logger.error("Failed to cleanup script",{error:e}))))))}}const ff=2e4;class gf{constructor(e,t,r,i){this.activityModule=e,this.activity=r,this.logger=i,this.stdout=new Fs,this.stderr=new Fs,this.subscription=t.pipe(ha((()=>{this.stdout.complete(),this.stderr.complete()}))).subscribe({next:e=>{this.lastResult=e,e.stdout&&this.stdout.next(e.stdout),e.stderr&&this.stderr.next(e.stderr)},error:e=>{this.streamError=e}})}waitForExit(e){return new Promise(((t,r)=>{const i=null!=e?e:ff,n=setTimeout((()=>{r(new df(`Unable to get activity results. The waiting time (${i} ms) for the final result has been exceeded`,hf.ActivityResultsFetchingFailed,this.activity.agreement,this.activity,this.activity.provider,new a(`The waiting time (${i} ms) for the final result has been exceeded`))),this.activityModule.destroyActivity(this.activity).catch((e=>this.logger.error("Error when destroying activity",e)))}),i),o=()=>{clearTimeout(n),this.lastResult?t(this.lastResult):(r(new df(`An error occurred while retrieving the results. ${this.streamError}`,hf.ActivityResultsFetchingFailed,this.activity.agreement,this.activity,this.activity.provider)),this.activityModule.destroyActivity(this.activity).catch((e=>this.logger.error("Error when destroying activity",e))))};this.subscription.add((()=>o()))}))}isFinished(){return this.subscription.closed}}var vf={};class mf{constructor(e,t,r={}){var i;this.wsUrl=e,this.appKey=t,this.events=new Gl,d("TCP Proxy"),this.heartBeatSec=null!==(i=r.heartBeatSec)&&void 0!==i?i:10,this.logger=r.logger?r.logger.child("tcp-proxy"):K("tcp-proxy"),this.server=vf.createServer((e=>{this.logger.debug("Client connected to TCP Server");const t={sReady:!0,sBuffer:[],wsReady:!1,wsBuffer:[]},r=()=>t.sBuffer=[],i=()=>t.wsBuffer=[],n=()=>{this.logger.debug("Flushing Socket buffer"),t.sBuffer.length>0&&e.write(Ee.concat(t.sBuffer)),r()},o=()=>{this.logger.debug("Flushing WebSocket buffer"),t.wsBuffer.length>0&&a.send(Ee.concat(t.wsBuffer),{binary:!0,mask:!0}),i()},s=()=>{a.close(),e.end(),i(),r()},a=new rf.WebSocket(this.wsUrl,{headers:{authorization:`Bearer ${this.appKey}`}});a.on("open",(()=>{this.logger.debug("Yagna WS opened"),t.wsReady=!0,o()})),e.on("connect",(()=>{this.logger.debug("Client socket connected"),t.sReady=!0,n()})),a.on("error",(e=>{this.notifyOfError("Yagna WS encountered an error",e),s()})),e.on("error",(e=>{this.notifyOfError("Server Socket encountered an error",e),s()})),a.on("close",(()=>{clearInterval(u),this.logger.debug("Yagna WS closed"),e.end(),i(),r()})),a.on("end",(()=>{this.logger.debug("Yagna WS end"),e.end(),i(),r()})),e.on("close",(e=>{e?this.logger.error("Server Socket encountered closed with an error error"):this.logger.debug("Server Socket has been closed (client disconnected)"),a.close(),i(),r()})),e.on("data",(async e=>{this.logger.debug("Server Socket received data",{length:e.length,wsReady:t.wsReady}),t.wsReady?a.send(e,{binary:!0,mask:!0}):t.wsBuffer.push(e)})),a.on("message",(r=>{const i="length"in r?r.length:null;this.logger.debug("Yagna WS received data",{length:i,socketReady:t.sReady}),r instanceof Ee?t.sReady?e.write(r):t.wsBuffer.push(r):this.logger.error("Encountered unsupported type of message",typeof r)})),a.on("ping",(()=>{this.logger.debug("Yagna WS received ping event")}));let c=!0;const u=setInterval((()=>{if(t.wsReady){if(this.logger.debug("Yagna WS checking if the client is alive"),!c)return this.notifyOfError("Yagna WS doesn't seem to be healthy, going to terminate"),a.terminate();c=!1,a.ping()}else this.logger.debug("Yagna WS is not ready yet, skipping heart beat")}),1e3*this.heartBeatSec);a.on("pong",(()=>{this.logger.debug("Yagna WS received pong event"),c=!0}))})),this.attachDebugLogsToServer()}async listen(e,t){return this.logger.debug("TcpProxy listen initiated"),this.server.listen({port:e,signal:t?t.signal:void 0}),new Promise(((t,r)=>{const i=t=>{this.notifyOfError("TcpProxy failed to start listening",{port:e,err:t}),this.server.removeListener("listening",n),r(t)},n=()=>{this.logger.info("TcpProxy is listening",{port:e}),this.server.removeListener("error",i),t()};this.server.once("listening",n),this.server.once("error",i)}))}close(){return this.logger.debug("TCP Server close initiated by the user"),new Promise(((e,t)=>{var r;this.server.listening?null===(r=this.server)||void 0===r||r.close((r=>{r?(this.notifyOfError("TCP Server closed with an error",r),t(r)):(this.logger.info("TCP server closed - was listening"),e())})):(this.logger.info("TCP Server closed - was not listening"),e())}))}notifyOfError(e,t){this.logger.error(e,t),this.events.emit("error",`${e}: ${t}`)}attachDebugLogsToServer(){this.server.on("listening",(()=>this.logger.debug("TCP Server started to listen"))),this.server.on("close",(()=>this.logger.debug("TCP Server closed"))),this.server.on("connection",(()=>this.logger.debug("TCP Server received new connection"))),this.server.on("drop",(e=>this.logger.debug("TCP Server dropped a connection because of reaching `maxConnections`",{data:e}))),this.server.on("error",(e=>this.logger.error("Server event 'error'",e)))}}class yf{constructor(e,t,r){var i,n,o;this.activity=e,this.activityModule=t,this.options=r,this.logger=null!==(i=null==r?void 0:r.logger)&&void 0!==i?i:K("work"),this.provider=e.provider,this.storageProvider=null!==(n=null==r?void 0:r.storageProvider)&&void 0!==n?n:new dp,this.networkNode=null==r?void 0:r.networkNode,this.abortSignal=Dl(null==r?void 0:r.signalOrTimeout),this.executor=this.activityModule.createScriptExecutor(this.activity,{...null===(o=this.options)||void 0===o?void 0:o.executionOptions,signalOrTimeout:this.abortSignal})}async fetchState(){if(this.abortSignal.aborted)throw new i("ExeUnit has been aborted");return this.activityModule.refreshActivity(this.activity).then((e=>e.getState())).catch((e=>{throw this.logger.error("Failed to read activity state",e),new df("Failed to read activity state",hf.ActivityStatusQueryFailed,this.activity.agreement,this.activity,e)}))}async setup(){try{let t=await this.fetchState();if(t===Fh.Ready)return void await this.setupActivity();if(t===Fh.Initialized&&await this.deployActivity(),await e(1e3,!0),t=await this.fetchState(),t!==Fh.Ready)throw new df(`Activity ${this.activity.id} cannot reach the Ready state. Current state: ${t}`,hf.ActivityDeploymentFailed,this.activity.agreement,this.activity,this.activity.provider);await this.setupActivity()}catch(e){if(this.abortSignal.aborted)throw"TimeoutError"===this.abortSignal.reason.name?new a("Initializing of the exe-unit has been aborted due to a timeout",this.abortSignal.reason):new i("Initializing of the exe-unit has been aborted",this.abortSignal.reason);throw e}}async teardown(){var e;(null===(e=this.options)||void 0===e?void 0:e.teardown)&&await this.options.teardown(this)}async deployActivity(){var e,t;try{const r=await this.executor.execute(new Lh([new Hh({...null===(t=null===(e=this.networkNode)||void 0===e?void 0:e.getNetworkDeploymentArg)||void 0===t?void 0:t.call(e),...this.getVolumeDeploymentArg()}),new zh]).getExeScriptRequest()),i=this.executor.getResultsObservable(r);await na(i.pipe(ga((e=>{if("Error"===e.result)throw new Error(String(e.message))}))))}catch(e){throw new df(`Unable to deploy activity. ${e}`,hf.ActivityDeploymentFailed,this.activity.agreement,this.activity,this.activity.provider,e)}}async setupActivity(){var e;(null===(e=this.options)||void 0===e?void 0:e.setup)&&await this.options.setup(this)}async run(e,t,r){const i=Array.isArray(t);this.logger.debug("Running command",{command:i?`${e} ${null==t?void 0:t.join(" ")}`:e,provider:this.provider.name});const n=i?new Wh(e,t,null==r?void 0:r.env,null==r?void 0:r.capture):new Wh("/bin/sh",["-c",e],null==t?void 0:t.env,null==t?void 0:t.capture),o=i?r:t;return this.runOneCommand(n,o)}async runAndStream(e,t,r){const i={stdout:{stream:{format:"string"}},stderr:{stream:{format:"string"}}},n=Array.isArray(t)?new Wh(e,t,null==r?void 0:r.env,i):new Wh("/bin/sh",["-c",e],null==t?void 0:t.env,i),o=new Lh([n]),s=await this.executor.execute(o.getExeScriptRequest()),a=this.executor.getResultsObservable(s,!0,null==r?void 0:r.signalOrTimeout,null==r?void 0:r.maxRetries);return new gf(this.activityModule,a,this.activity,this.logger)}async transfer(e,t,r){return this.logger.debug("Transferring",{from:e,to:t}),this.runOneCommand(new Gh(e,t),r)}async uploadFile(e,t,r){return this.logger.debug("Uploading file",{src:e,dst:t}),this.runOneCommand(new Yh(this.storageProvider,e,t),r)}uploadJson(e,t,r){this.logger.debug("Uploading json",{dst:t});const i=(new TextEncoder).encode(JSON.stringify(e));return this.runOneCommand(new Kh(this.storageProvider,i,t),r)}uploadData(e,t,r){return this.logger.debug("Uploading data",{dst:t}),this.runOneCommand(new Kh(this.storageProvider,e,t),r)}downloadFile(e,t,r){return this.logger.debug("Downloading file from",{src:e,dst:t}),this.runOneCommand(new Jh(this.storageProvider,e,t),r)}downloadData(e,t){return this.logger.debug("Downloading data",{src:e}),this.runOneCommand(new Xh(this.storageProvider,e),t)}async downloadJson(e,t){this.logger.debug("Downloading json",{src:e});const r=await this.downloadData(e,t);return"Ok"!==r.result?new Bh({...r,data:void 0}):new Bh({...r,data:JSON.parse((new TextDecoder).decode(r.data))})}beginBatch(){return new pf(this.executor,this.storageProvider,this.logger)}getWebsocketUri(e){if(!this.networkNode)throw new df("There is no network in this exe-unit",hf.NetworkSetupMissing,this.activity.agreement,this.activity,this.activity.provider);return this.networkNode.getWebsocketUri(e)}getIp(){if(!this.networkNode)throw new df("There is no network in this exe-unit",hf.NetworkSetupMissing,this.activity.agreement,this.activity,this.activity.provider);return this.networkNode.ip}createTcpProxy(e){var t,r;if(!(null===(r=null===(t=this.options)||void 0===t?void 0:t.yagnaOptions)||void 0===r?void 0:r.apiKey))throw new n("You need to provide yagna API key to use the TCP Proxy functionality");return new mf(this.getWebsocketUri(e),this.options.yagnaOptions.apiKey,{logger:this.logger})}getDto(){return{provider:this.provider,id:this.activity.id,agreement:this.activity.agreement}}async runOneCommand(t,r){const i=new Lh([t]);await i.before().catch((e=>{var r,i;throw new df(`Script initialization failed for command: ${JSON.stringify(t.toJson())}. ${(null===(i=null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.data)||void 0===i?void 0:i.message)||(null==e?void 0:e.message)||e}`,hf.ScriptInitializationFailed,this.activity.agreement,this.activity,this.activity.provider,e)})),await e(100,!0);const n=await this.executor.execute(i.getExeScriptRequest()),o=this.executor.getResultsObservable(n,!1,null==r?void 0:r.signalOrTimeout,null==r?void 0:r.maxRetries);let s=await na(o.pipe(ks((function(e,t){ua(la,[])(e).subscribe(t)}))));s=await i.after(s);const a=s.filter((e=>"Error"===e.result));if(a.length){const e=a.map((e=>{var t,r;return`Error: ${e.message}. Stdout: ${null===(t=e.stdout)||void 0===t?void 0:t.toString().trim()}. Stderr: ${null===(r=e.stderr)||void 0===r?void 0:r.toString().trim()}`})).join(". ");this.logger.warn("Task error",{provider:this.provider.name,error:e})}return s[0]}getVolumeDeploymentArg(){var e;if(!(null===(e=this.options)||void 0===e?void 0:e.volumes))return{};const t={volumes:{}};for(const[,e]of Object.entries(this.options.volumes))t.volumes[e.path]={storage:{size:`${e.sizeGib}g`,errors:"panic"}};return t}}async function wf(e,t){let r;return Promise.race([e,(i=t,new Promise(((e,t)=>{r=setTimeout((()=>t(new a("Timeout for the operation was reached"))),i)})))]).finally((()=>clearTimeout(r)));var i}var bf={};function Ef(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Sf=Ef;Ef.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},Ef.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},Ef.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var i=this;return this._timer=setTimeout((function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout((function(){i._operationTimeoutCb(i._attempts)}),i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)}),r),this._options.unref&&this._timer.unref(),!0},Ef.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},Ef.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},Ef.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},Ef.prototype.start=Ef.prototype.try,Ef.prototype.errors=function(){return this._errors},Ef.prototype.attempts=function(){return this._attempts},Ef.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,i=0;i<this._errors.length;i++){var n=this._errors[i],o=n.message,s=(e[o]||0)+1;e[o]=s,s>=r&&(t=n,r=s)}return t},function(e){var t=Sf;e.operation=function(r){var i=e.timeouts(r);return new t(i,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},e.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],n=0;n<t.retries;n++)i.push(this.createTimeout(n,t));return e&&e.forever&&!i.length&&i.push(this.createTimeout(n,t)),i.sort((function(e,t){return e-t})),i},e.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,i=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return i=Math.min(i,t.maxTimeout)},e.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i)for(var n in i=[],t)"function"==typeof t[n]&&i.push(n);for(var o=0;o<i.length;o++){var s=i[o],a=t[s];t[s]=function(i){var n=e.operation(r),o=Array.prototype.slice.call(arguments,1),s=o.pop();o.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))})),n.attempt((function(){i.apply(t,o)}))}.bind(t,a),t[s].options=r}}}(bf);var If=bf;var Af=function(e,t){return new Promise((function(r,i){var n,o=t||{};function s(e){i(e||new Error("Aborted"))}function a(e,t){e.bail?s(e):n.retry(e)?o.onRetry&&o.onRetry(e,t):i(n.mainError())}"randomize"in o||(o.randomize=!0),(n=If.operation(o)).attempt((function(t){var i;try{i=e(s,t)}catch(e){return void a(e,t)}Promise.resolve(i).then(r).catch((function(e){a(e,t)}))}))}))},Pf=L(Af);const Tf=[408,500];class Rf{constructor(e,t,r,i){this.activity=e,this.activityModule=t,this.logger=r,this.options=new Mh(i),this.abortSignal=Dl(null==i?void 0:i.signalOrTimeout)}async execute(e){try{this.abortSignal.throwIfAborted();const t=await this.send(e),r=JSON.parse(e.text).length;return this.logger.debug("Script sent.",{batchId:t,script:e}),{batchId:t,batchSize:r}}catch(e){const t=kh(e);if(this.logger.error("Execution of script failed.",{reason:t}),this.abortSignal.aborted)throw new i("Executions of script has been aborted",this.abortSignal.reason);throw new df(`Unable to execute script. ${t}`,hf.ScriptExecutionFailed,this.activity.agreement,this.activity,this.activity.provider,e)}}getResultsObservable(e,t,r,n){const{signal:o,cleanup:s}=Fl(this.abortSignal,Dl(r));return Bl(new Cs((e=>{const t=()=>new i("Execution of script has been aborted",o.reason);o.aborted&&e.error(t()),o.addEventListener("abort",(()=>{e.error(t())}))})),t?this.streamingBatch(e.batchId,e.batchSize):this.pollingBatch(e.batchId,n)).pipe(ha(s))}async send(e){return wf(this.activityModule.executeScript(this.activity,e),1e4)}pollingBatch(e,t){let r,i=!1;const{id:n,agreement:o}=this.activity,{activityExeBatchResultPollIntervalSeconds:s,activityExeBatchResultMaxRetries:a}=this.options,{logger:c,activity:u,activityModule:l}=this;return new Cs((o=>{const h=async()=>{if(!i)return c.debug("Polling for batch script execution result"),await Pf((async(t,a)=>{var h,d;c.debug(`Trying to poll for batch execution results from yagna. Attempt: ${a}`);try{i&&t(new Error("Batch is finished"));const a=await l.getBatchResults(u,e,void 0,s),h=a&&a.slice(r+1);c.debug("Received batch execution results",{results:h,activityId:n}),Array.isArray(h)&&h.length&&h.forEach((e=>{o.next(e),i||(i=!!e.isBatchFinished),r=e.index}))}catch(e){c.debug(`Failed to fetch activity results. Attempt: ${a}. ${e}`);const r=null!==(h=null==e?void 0:e.status)&&void 0!==h?h:null===(d=e.previous)||void 0===d?void 0:d.status;if(Tf.includes(r))throw e;t(e)}}),{retries:null!=t?t:a,maxTimeout:15e3}),ql(h);o.complete()};return h().catch((e=>{c.error("Polling for batch results failed",e),o.error(e)})),()=>{i=!0}})).pipe(ca((e=>{if(e instanceof df)throw e;throw new df(`Unable to get activity results. ${e}`,hf.ActivityResultsFetchingFailed,o,u,u.provider,e)})))}streamingBatch(e,t){return this.activityModule.observeStreamingBatchEvents(this.activity,e).pipe(oa((e=>this.parseEventToResult(e,t))),(r=e=>!e.isBatchFinished,i=!0,ks((function(e,t){var n=0;e.subscribe(_s(t,(function(e){var o=r(e,n++);(o||i)&&t.next(e),!o&&t.complete()})))}))),ca((e=>{throw new df(`Unable to get activity results. ${e}`,hf.ActivityResultsFetchingFailed,this.activity.agreement,this.activity,this.activity.provider,e)})));var r,i}parseEventToResult(e,t){var r,i,n,o,s,a,c,u,l;const h=new Bh({index:e.index,eventDate:e.timestamp,result:(null===(r=null==e?void 0:e.kind)||void 0===r?void 0:r.finished)?0===(null===(n=null===(i=null==e?void 0:e.kind)||void 0===i?void 0:i.finished)||void 0===n?void 0:n.return_code)?"Ok":"Error":(null===(o=null==e?void 0:e.kind)||void 0===o?void 0:o.stderr)?"Error":"Ok",stdout:null===(s=null==e?void 0:e.kind)||void 0===s?void 0:s.stdout,stderr:null===(a=null==e?void 0:e.kind)||void 0===a?void 0:a.stderr,message:null===(u=null===(c=null==e?void 0:e.kind)||void 0===c?void 0:c.finished)||void 0===u?void 0:u.message,isBatchFinished:e.index+1>=t&&Boolean(null===(l=null==e?void 0:e.kind)||void 0===l?void 0:l.finished)});return this.logger.debug("Received stream batch execution result",{result:h}),h}}class Of{constructor(e){this.services=e,this.events=new Gl,this.logger=K("activity"),this.logger=e.logger,this.activityApi=e.activityApi}createScriptExecutor(e,t){return new Rf(e,this,this.logger.child("executor"),t)}async executeScript(e,t){this.logger.debug("Executing script on activity",{activityId:e.id});try{this.events.emit("scriptSent",{activity:e,script:t});const r=await this.activityApi.executeScript(e,t);return this.events.emit("scriptExecuted",{activity:await this.refreshActivity(e).catch((()=>(this.logger.warn("Failed to refresh activity after script execution",{activityId:e.id}),e))),script:t,result:r}),r}catch(r){throw this.events.emit("errorExecutingScript",{activity:await this.refreshActivity(e).catch((()=>(this.logger.warn("Failed to refresh activity after script execution error",{activityId:e.id}),e))),script:t,error:r}),r}}async getBatchResults(e,t,r,i){this.logger.debug("Fetching batch results",{activityId:e.id,batchId:t});try{const n=await this.activityApi.getExecBatchResults(e,t,r,i);return this.events.emit("batchResultsReceived",{activity:await this.refreshActivity(e).catch((()=>(this.logger.warn("Failed to refresh activity after batch results received",{activityId:e.id}),e))),batchId:t,results:n}),n}catch(r){throw this.events.emit("errorGettingBatchResults",{activity:await this.refreshActivity(e).catch((()=>(this.logger.warn("Failed to refresh activity after batch results error",{activityId:e.id}),e))),batchId:t,error:r}),r}}observeStreamingBatchEvents(e,t,r){return this.logger.debug("Observing streaming batch events",{activityId:e.id,batchId:t}),this.activityApi.getExecBatchEvents(e,t,r).pipe(ga((async r=>{this.events.emit("batchEventsReceived",{activity:await this.refreshActivity(e).catch((()=>(this.logger.warn("Failed to refresh activity after batch events received",{activityId:e.id}),e))),batchId:t,event:r})})),ca((async r=>{throw this.events.emit("errorGettingBatchEvents",{activity:await this.refreshActivity(e).catch((()=>(this.logger.warn("Failed to refresh activity after batch events error",{activityId:e.id}),e))),batchId:t,error:r}),r})))}async createActivity(e){this.logger.debug("Creating activity",{agreementId:e.id,provider:e.provider});try{const t=await this.activityApi.createActivity(e);return this.events.emit("activityCreated",{activity:t}),this.logger.info("Created activity",{activityId:t.id,agreementId:e.id,provider:e.provider}),t}catch(e){throw this.events.emit("errorCreatingActivity",e),e}}async destroyActivity(e){this.logger.debug("Destroying activity",e);try{const t=await this.activityApi.destroyActivity(e);return this.events.emit("activityDestroyed",{activity:t}),this.logger.info("Destroyed activity",{activityId:t.id,agreementId:t.agreement.id,provider:t.agreement.provider}),t}catch(t){throw this.events.emit("errorDestroyingActivity",{activity:e,error:t}),t}}async refreshActivity(e){this.logger.debug("Fetching latest activity state",{activityId:e.id,lastState:e.getState()});try{const t=await this.activityApi.getActivity(e.id);return t.getState()!==t.getPreviousState()&&(this.logger.debug("Activity state changed",{activityId:e.id,previousState:t.getPreviousState(),newState:t.getState()}),this.events.emit("activityStateChanged",{activity:t,previousState:t.getPreviousState()})),t}catch(t){throw this.events.emit("errorRefreshingActivity",{activity:e,error:t}),t}}async findActivityById(e){return this.logger.info("Fetching activity by ID",{activityId:e}),await this.activityApi.getActivity(e)}async createExeUnit(e,t){this.logger.debug("Creating exe-unit for activity",{activityId:e.id});const r=new yf(e,this,{yagnaOptions:this.services.yagna.yagnaOptions,logger:this.logger.child("exe-unit"),...t});this.logger.debug("Initializing the exe-unit for activity",{activityId:e.id});try{await r.setup();const t=await this.refreshActivity(e).catch((()=>(this.logger.warn("Failed to refresh activity after work context initialization",{activityId:e.id}),e)));return this.events.emit("exeUnitInitialized",{activity:t}),this.logger.info("Initialized exe-unit",{activityId:e.id,state:t.getState()}),r}catch(t){throw this.events.emit("errorInitializingExeUnit",{activity:await this.refreshActivity(e).catch((()=>(this.logger.warn("Failed to refresh activity after exe-unit initialization error",{activityId:e.id}),e))),error:t}),t}}}var Cf,Nf={},kf={};Cf=kf,Object.defineProperty(Cf,"__esModule",{value:!0}),Cf.matchingBitCount=Cf.intLog2=Cf.cidrPrefixToMaskBinaryString=Cf.leftPadWithZeroBit=Cf.dottedDecimalNotationToBinaryString=Cf.parseBinaryStringToBigInt=Cf.decimalNumberToOctetString=Cf.numberToBinaryString=void 0,Cf.numberToBinaryString=e=>e.toString(2),Cf.decimalNumberToOctetString=e=>{let t=Cf.numberToBinaryString(e);if(t.length>8)throw new Error("Given decimal in binary contains digits greater than an octet");return Cf.leftPadWithZeroBit(t,8)},Cf.parseBinaryStringToBigInt=e=>BigInt(`0b${e}`),Cf.dottedDecimalNotationToBinaryString=e=>e.split(".").reduce(((e,t)=>e.concat(Cf.decimalNumberToOctetString(parseInt(t)))),""),Cf.leftPadWithZeroBit=(e,t)=>{if(e.length>t)throw new Error(`Given string is already longer than given final length after padding: ${t}`);return"0".repeat(t-e.length).concat(e)},Cf.cidrPrefixToMaskBinaryString=(e,t)=>{let r;if(r="IPv4"==t?32:128,e>r)throw Error(`Value is greater than ${r}`);return`${"1".repeat(e)}${"0".repeat(r-e)}`},Cf.intLog2=e=>{let t=0;for(;e%2n===0n;){if(2n===e){t++;break}if((e>>=1n)%2n!==0n){t=0;break}t++}if(0==t)throw new Error(`The value of log2 for ${e.toString()} is not an integer`);return t},Cf.matchingBitCount=(e,t)=>{let r,i;e.length>=t.length?(r=e,i=t):(r=t,i=e);let n=0;for(;n<r.length&&r.charAt(n)===i.charAt(n);n++);return n};var _f,xf={},Df={},Ff={};function qf(){if(_f)return Ff;_f=1,Object.defineProperty(Ff,"__esModule",{value:!0}),Ff.collapseIPv6Number=Ff.expandIPv6Number=void 0;const e=kf,t=Lf();let r=e=>e.includes("/")?`/${e.split("/")[1]}`:"";return Ff.expandIPv6Number=i=>{let n=t=>t.map((t=>e.leftPadWithZeroBit(t,4))).join(":");if(/(:){3,}/.test(i))throw"given IPv6 contains consecutive : more than two";const o=r(i);if(i.includes("/")&&(i=i.split("/")[0]),!t.Validator.IPV6_PATTERN.test(i))throw Error(t.Validator.invalidIPv6PatternMessage);if(i.includes("::")){let e=i.split("::"),t=e[0],r=e[1],s=t.split(":").filter((e=>""!==e)),a=r.split(":").filter((e=>""!==e)),c=(e=>{let t=[];for(let r=0;r<e;r++)t.push("0000");return t.join(":")})(8-(s.length+a.length)),u=n(s);""!==u&&(u+=":");let l=n(a);return""!==l&&(l=":"+l),`${u}${c}${l}${o}`}return`${n(i.split(":"))}${o}`},Ff.collapseIPv6Number=e=>{const i=r(e);if(e.includes("/")&&(e=e.split("/")[0]),!t.Validator.IPV6_PATTERN.test(e))throw Error(t.Validator.invalidIPv6PatternMessage);let n=e.split(":").map((e=>{let t=e.replace(/^0+/,"");return""!==t?t:"0"})).join(":").replace(/((^0)?(:0){2,}|(^0)(:0){1,})/,":");return":"===n.slice(-1)?`${n}:${i}`:(n=n.replace(":0:","::"),`${n}${i}`)},Ff}var Bf,jf,$f={};function Mf(){return Bf||(Bf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hexadectetNotationToBinaryString=e.binaryStringToHexadecimalString=e.colonHexadecimalNotationToBinaryString=e.hexadecimalStringToHexadecatetString=e.hexadecimalStringToBinaryString=e.bigIntToHexadecimalString=void 0;const t=qf(),r=kf;e.bigIntToHexadecimalString=e=>e.toString(16),e.hexadecimalStringToBinaryString=e=>BigInt(`0x${e}`).toString(2),e.hexadecimalStringToHexadecatetString=t=>{let i=e.hexadecimalStringToBinaryString(t);if(i.length>16)throw new Error("Given decimal in binary contains digits greater than an Hexadecatet");return r.leftPadWithZeroBit(i,16)},e.colonHexadecimalNotationToBinaryString=r=>t.expandIPv6Number(r).split(":").reduce(((t,r)=>t.concat(e.hexadecimalStringToHexadecatetString(r))),""),e.binaryStringToHexadecimalString=e=>BigInt(`0b${e}`).toString(16),e.hexadectetNotationToBinaryString=i=>t.expandIPv6Number(i).split(":").reduce(((t,i)=>t.concat(r.leftPadWithZeroBit(e.hexadecimalStringToBinaryString(i),16))),"")}($f)),$f}function Lf(){if(jf)return Df;jf=1,Object.defineProperty(Df,"__esModule",{value:!0}),Df.Validator=void 0;const e=kf,t=kf,r=qf(),i=Mf(),n=Mf();let o=class o{static isWithinRange(e,t,r){return e>=t&&e<=r}static isValidAsnNumber(e){let t=this.isWithinRange(e,0n,this.THIRTY_TWO_BIT_SIZE);return[t,t?[]:[o.invalidAsnRangeMessage]]}static isValid16BitAsnNumber(e){let t=o.isWithinRange(e,0n,o.SIXTEEN_BIT_SIZE);return[t,t?[]:[o.invalid16BitAsnRangeMessage]]}static isValidIPv4Number(e){e="bigint"==typeof e?e:BigInt(e);let t=this.isWithinRange(e,0n,this.THIRTY_TWO_BIT_SIZE);return t?[t,[]]:[t,[o.invalidIPv4NumberMessage]]}static isValidIPv6Number(e){let t=this.isWithinRange(e,0n,this.ONE_HUNDRED_AND_TWENTY_EIGHT_BIT_SIZE);return t?[t,[]]:[t,[o.invalidIPv6NumberMessage]]}static isValidIPv4Octet(e){let t=this.isWithinRange(e,0n,this.EIGHT_BIT_SIZE);return[t,t?[]:[o.invalidOctetRangeMessage]]}static isValidIPv6Hexadecatet(e){let t=this.isWithinRange(e,0n,this.SIXTEEN_BIT_SIZE);return t?[t,[]]:[t,[o.invalidHexadecatetMessage]]}static isValidIPv4String(e){let t=e.split(".");if(4!=t.length||t.includes(""))return[!1,[o.invalidOctetCountMessage]];let r=t.every((e=>!!o.isNumeric(e)&&o.isValidIPv4Octet(BigInt(e))[0]));return r?(r=o.IPV4_PATTERN.test(e),[r,r?[]:[o.invalidIPv4PatternMessage]]):[!1,[o.invalidOctetRangeMessage]]}static isValidIPv6String(e){try{let t=r.expandIPv6Number(e).split(":");if(8!=t.length)return[!1,[o.invalidHexadecatetCountMessage]];let i=t.every((e=>!!o.isHexadecatet(e)&&o.isValidIPv6Hexadecatet(BigInt(`0x${e}`))[0]));return i?(i=o.IPV6_PATTERN.test(e),[i,i?[]:[o.invalidIPv6PatternMessage]]):[!1,[o.invalidHexadecatetMessage]]}catch(e){return[!1,[e]]}}static isValidPrefixValue(e,t){if("IPv4"===t){let t=o.isWithinRange(BigInt(e),0n,32n);return[t,t?[]:[o.invalidPrefixValueMessage]]}if("IPv6"===t){let t=o.isWithinRange(BigInt(e),0n,128n);return[t,t?[]:[o.invalidPrefixValueMessage]]}return[!1,[o.invalidInetNumType]]}static isValidIPv4Mask(t){let r=e.dottedDecimalNotationToBinaryString(t),i=o.IPV4_CONTIGUOUS_MASK_BIT_PATTERN.test(r);return i?[i,[]]:[i,[o.invalidMaskMessage]]}static isValidIPv6Mask(e){let t=n.hexadectetNotationToBinaryString(e),r=o.IPV6_CONTIGUOUS_MASK_BIT_PATTERN.test(t);return r?[r,[]]:[r,[o.invalidMaskMessage]]}static isValidIPv4CidrNotation(e){let t=e.split("/");if(2!==t.length||0===t[0].length||0===t[1].length)return[!1,[o.invalidIPv4CidrNotationMessage]];let r=t[0],i=t[1];if(isNaN(Number(i)))return[!1,[o.invalidIPv4CidrNotationMessage]];let[n,s]=o.isValidIPv4String(r),[a,c]=o.isValidPrefixValue(BigInt(i),"IPv4"),u=n&&a,l=s.concat(c);return u?[u,[]]:[u,l]}static isValidIPv4CidrRange(r){return o.isValidCidrRange(r,o.isValidIPv4CidrNotation,e.dottedDecimalNotationToBinaryString,(e=>t.cidrPrefixToMaskBinaryString(e,"IPv4")))}static isValidIPv6CidrRange(e){return o.isValidCidrRange(e,o.isValidIPv6CidrNotation,i.colonHexadecimalNotationToBinaryString,(e=>t.cidrPrefixToMaskBinaryString(e,"IPv6")))}static isValidCidrRange(e,t,r,i){let n=t(e);if(!n[0])return n;let s=e.split("/"),a=s[0],c=s[1],u=BigInt(`0b${r(a)}`),l=(u&BigInt(`0b${i(parseInt(c))}`))===u;return l?[l,[]]:[l,[o.InvalidIPCidrRangeMessage]]}static isValidIPv4RangeString(t){return this.isValidRange(t,o.isValidIPv4String,((t,r)=>BigInt(`0b${e.dottedDecimalNotationToBinaryString(t)}`)>=BigInt(`0b${e.dottedDecimalNotationToBinaryString(r)}`)))}static isValidIPv6RangeString(e){return this.isValidRange(e,o.isValidIPv6String,((e,t)=>BigInt(`0b${n.hexadectetNotationToBinaryString(e)}`)>=BigInt(`0b${n.hexadectetNotationToBinaryString(t)}`)))}static isValidRange(e,t,r){let i=e.split("-").map((e=>e.trim()));if(2!==i.length||0===i[0].length||0===i[1].length)return[!1,[o.invalidRangeNotationMessage]];let n=i[0],s=i[1],[a,c]=t(n),[u,l]=t(s),h=a&&u;if(h&&r(n,s))return[!1,[o.invalidRangeFirstNotGreaterThanLastMessage]];let d=c.concat(l);return h?[h,[]]:[h,d]}static isValidIPv6CidrNotation(e){let t=o.IPV6_RANGE_PATTERN.test(e);return t?[t,[]]:[t,[o.invalidIPv6CidrNotationString]]}static isValidBinaryString(e){return/^([10])+$/.test(e)?[!0,[]]:[!1,[o.invalidBinaryStringErrorMessage]]}static isNumeric(e){return/^(\d+)$/.test(e)}static isHexadecatet(e){return/^[0-9A-Fa-f]{4}$/.test(e)}};return Df.Validator=o,o.IPV4_PATTERN=new RegExp(/^(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/),o.IPV6_PATTERN=new RegExp(/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/),o.IPV4_RANGE_PATTERN=new RegExp(/^(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\/)([1-9]|[1-2][0-9]|3[0-2])$/),o.IPV6_RANGE_PATTERN=new RegExp(/^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*(\/([0-9]|[1-9][0-9]|1[0-1][0-9]|12[0-8]))?$/),o.IPV4_CONTIGUOUS_MASK_BIT_PATTERN=new RegExp(/^(1){0,32}(0){0,32}$/),o.IPV6_CONTIGUOUS_MASK_BIT_PATTERN=new RegExp(/^(1){0,128}(0){0,128}$/),o.EIGHT_BIT_SIZE=BigInt(`0b${"1".repeat(8)}`),o.SIXTEEN_BIT_SIZE=BigInt(`0b${"1".repeat(16)}`),o.THIRTY_TWO_BIT_SIZE=BigInt(`0b${"1".repeat(32)}`),o.ONE_HUNDRED_AND_TWENTY_EIGHT_BIT_SIZE=BigInt(`0b${"1".repeat(128)}`),o.IPV4_SIZE=BigInt("4294967296"),o.IPV6_SIZE=BigInt("340282366920938463463374607431768211456"),o.invalidAsnRangeMessage="ASN number given less than zero or is greater than 32bit",o.invalid16BitAsnRangeMessage="ASN number given less than zero or is greater than 16bit",o.invalidIPv4NumberMessage="IPv4 number given less than zero or is greater than 32bit",o.invalidIPv6NumberMessage="IPv6 number given less than zero or is greater than 128bit",o.invalidOctetRangeMessage="Value given contains an invalid Octet; Value is less than zero or is greater than 8bit",o.invalidHexadecatetMessage="The value given is less than zero or is greater than 16bit",o.invalidOctetCountMessage="An IP4 number cannot have less or greater than 4 octets",o.invalidHexadecatetCountMessage="An IP6 number must have exactly 8 hexadecatet",o.invalidMaskMessage="The Mask is invalid",o.invalidPrefixValueMessage="A Prefix value cannot be less than 0 or greater than 32",o.invalidIPv4CidrNotationMessage="Cidr notation should be in the form [ip number]/[range]",o.InvalidIPCidrRangeMessage="Given IP number portion must is not the start of the range",o.invalidRangeNotationMessage="Range notation should be in the form [first ip]-[last ip]",o.invalidRangeFirstNotGreaterThanLastMessage="First IP in [first ip]-[last ip] must be less than Last IP",o.invalidIPv6CidrNotationString="A Cidr notation string should contain an IPv6 number and prefix",o.takeOutOfRangeSizeMessage="$count is greater than $size, the size of the range",o.cannotSplitSingleRangeErrorMessage="Cannot split an IP range with a single IP number",o.invalidInetNumType="Given ipNumType must be either InetNumType.IPv4 or InetNumType.IPv6",o.invalidBinaryStringErrorMessage="Binary string should contain only contiguous 1s and 0s",o.invalidIPRangeSizeMessage="Given size is zero or greater than maximum size of $iptype",o.invalidIPRangeSizeForCidrMessage="Given size can't be created via cidr prefix",o.invalidIPv4PatternMessage="Given IPv4 is not confirm to a valid IPv6 address",o.invalidIPv6PatternMessage="Given IPv6 is not confirm to a valid IPv6 address",Df}Object.defineProperty(xf,"__esModule",{value:!0}),xf.Hexadecatet=void 0;const Vf=Lf();class Uf{constructor(e){let t;t="string"==typeof e?parseInt(e,16):parseInt(String(e),16);let[r,i]=Vf.Validator.isValidIPv6Hexadecatet(BigInt(t));if(!r)throw Error(i.filter((e=>""!==e)).toString());this.value=t}static fromString(e){return new Uf(e)}static fromNumber(e){return new Uf(e)}getValue(){return this.value}toString(){return this.value.toString(16)}}xf.Hexadecatet=Uf;var Hf={},zf={};Object.defineProperty(zf,"__esModule",{value:!0}),zf.Octet=void 0;const Wf=Lf();class Gf{constructor(e){let t;t="string"==typeof e?parseInt(e):e;let[r,i]=Wf.Validator.isValidIPv4Octet(BigInt(t));if(!r)throw Error(i.filter((e=>""!==e)).toString());this.value=t}static fromString(e){return new Gf(e)}static fromNumber(e){return new Gf(e)}getValue(){return this.value}toString(){return this.value.toString(10)}}zf.Octet=Gf,Object.defineProperty(Hf,"__esModule",{value:!0}),Hf.isIPv4=Hf.IPv6Mask=Hf.IPv4Mask=Hf.IPv6=Hf.Asn=Hf.IPv4=Hf.AbstractIPNum=void 0;const Yf=zf,Kf=Lf(),Jf=kf,Xf=kf,Qf=kf,Zf=kf,eg=xf,tg=Mf(),rg=qf(),ig=Mf();class ng{getValue(){return this.value}toBinaryString(){return Qf.leftPadWithZeroBit(this.value.toString(2),this.bitSize)}hasNext(){return this.value<this.maximumBitSize}hasPrevious(){return this.value>0n}isEquals(e){return this.value===e.value}isLessThan(e){return this.value<e.value}isGreaterThan(e){return this.value>e.value}isLessThanOrEquals(e){return this.value<=e.value}isGreaterThanOrEquals(e){return this.value>=e.value}}Hf.AbstractIPNum=ng;class og extends ng{constructor(e){if(super(),this.bitSize=32,this.maximumBitSize=Kf.Validator.THIRTY_TWO_BIT_SIZE,this.type="IPv4",this.octets=[],this.separator=".","string"==typeof e){let[t,r]=this.constructFromDecimalDottedString(e);this.value=t,this.octets=r}else{let[t,r]=this.constructFromBigIntValue(e);this.value=t,this.octets=r}}static fromNumber(e){return new og(e)}static fromDecimalDottedString(e){return new og(e)}static fromString(e){return og.fromDecimalDottedString(e)}static fromBinaryString(e){let t=Kf.Validator.isValidBinaryString(e);if(t[0])return new og(Xf.parseBinaryStringToBigInt(e));throw Error(t[1].join(","))}toString(){return this.octets.map((e=>e.toString())).join(this.separator)}getOctets(){return this.octets}nextIPNumber(){return og.fromNumber(this.getValue()+1n)}previousIPNumber(){return og.fromNumber(this.getValue()-1n)}toIPv4MappedIPv6(){let e="1".repeat(16)+this.toBinaryString();return ag.fromBinaryString(e)}constructFromDecimalDottedString(e){let t,r,[i,n]=Kf.Validator.isValidIPv4String(e);if(!i)throw new Error(n.filter((e=>""!==e)).toString());return t=e.split(".").map((e=>Yf.Octet.fromString(e))),r=BigInt(`0b${Jf.dottedDecimalNotationToBinaryString(e)}`),[r,t]}constructFromBigIntValue(e){let[t,r]=Kf.Validator.isValidIPv4Number(e);if(!t)throw new Error(r.filter((e=>""!==e)).toString());let i=Zf.numberToBinaryString(e);return[e="bigint"==typeof e?e:BigInt(e),this.binaryStringToDecimalOctets(i)]}binaryStringToDecimalOctets(e){return e.length<32&&(e=Qf.leftPadWithZeroBit(e,32)),e.match(/.{1,8}/g).map((e=>Yf.Octet.fromString(Xf.parseBinaryStringToBigInt(e).toString())))}}Hf.IPv4=og;class sg extends ng{constructor(e){if(super(),this.bitSize=32,this.maximumBitSize=Kf.Validator.THIRTY_TWO_BIT_SIZE,this.type="ASN","string"==typeof e)sg.startWithASPrefix(e)?this.value=BigInt(parseInt(e.substring(2))):-1!=e.indexOf(".")?this.value=BigInt(this.parseFromDotNotation(e)):this.value=BigInt(parseInt(e));else{let t=BigInt(e),[r,i]=Kf.Validator.isValidAsnNumber(t);if(!r)throw Error(i.filter((e=>""!==e)).toString());this.value=t}}static fromString(e){return new sg(e)}static fromNumber(e){return new sg(e)}static fromBinaryString(e){let t=Kf.Validator.isValidBinaryString(e);if(t[0])return new sg(parseInt(e,2));throw Error(t[1].join(","))}toString(){let e=this.value.toString();return`${sg.AS_PREFIX}${e}`}toASPlain(){return this.value.toString()}toASDot(){return this.value.valueOf()>=65536n?this.toASDotPlus():this.toASPlain()}toASDotPlus(){let e=this.value.valueOf()/65535n;return`${e}.${this.value.valueOf()%65535n-e}`}toBinaryString(){return Zf.numberToBinaryString(this.value)}is16Bit(){let[e]=Kf.Validator.isValid16BitAsnNumber(this.value);return e}is32Bit(){return!this.is16Bit()}nextIPNumber(){return new sg(this.value.valueOf()+1n)}previousIPNumber(){return new sg(this.value.valueOf()-1n)}static startWithASPrefix(e){return 0===e.indexOf(sg.AS_PREFIX)}parseFromDotNotation(e){let t=e.split("."),r=parseInt(t[0]);return 65535*r+(parseInt(t[1])+r)}}Hf.Asn=sg,sg.AS_PREFIX="AS";class ag extends ng{constructor(e){if(super(),this.bitSize=128,this.maximumBitSize=Kf.Validator.ONE_HUNDRED_AND_TWENTY_EIGHT_BIT_SIZE,this.type="IPv6",this.hexadecatet=[],this.separator=":","string"==typeof e){let t=rg.expandIPv6Number(e),[r,i]=this.constructFromHexadecimalDottedString(t);this.value=r,this.hexadecatet=i}else{let[t,r]=this.constructFromBigIntValue(e);this.value=t,this.hexadecatet=r}}static fromBigInt(e){return new ag(e)}static fromHexadecatet(e){return new ag(e)}static fromString(e){return ag.fromHexadecatet(e)}static fromBinaryString(e){let t=Kf.Validator.isValidBinaryString(e);if(t[0]){let t=Qf.leftPadWithZeroBit(e,128);return new ag(Xf.parseBinaryStringToBigInt(t))}throw Error(t[1].join(","))}static fromIPv4(e){return e.toIPv4MappedIPv6()}static fromIPv4DotDecimalString(e){return new og(e).toIPv4MappedIPv6()}toString(){let e=this.hexadecatet.map((e=>e.toString())).join(":");return this.hexadecatet.length<8?"::"+e:e}getHexadecatet(){return this.hexadecatet}nextIPNumber(){return ag.fromBigInt(this.getValue()+1n)}previousIPNumber(){return ag.fromBigInt(this.getValue()-1n)}constructFromBigIntValue(e){let[t,r]=Kf.Validator.isValidIPv6Number(e);if(!t)throw new Error(r.filter((e=>""!==e)).toString());let i=Zf.numberToBinaryString(e);return[e,this.binaryStringToHexadecatets(i)]}constructFromHexadecimalDottedString(e){let[t,r]=Kf.Validator.isValidIPv6String(e);if(!t)throw new Error(r.filter((e=>""!==e)).toString());let i=e.split(":").map((e=>eg.Hexadecatet.fromString(e)));return[BigInt(`0b${ig.hexadectetNotationToBinaryString(e)}`),i]}binaryStringToHexadecatets(e){let t=tg.binaryStringToHexadecimalString(e);for(;t.length%4!=0;)t="0"+t;return t.match(/.{1,4}/g).map((e=>eg.Hexadecatet.fromString(e)))}}Hf.IPv6=ag;class cg extends og{constructor(e){let t,r;if(super(e),this.octets=[],[t,r]=Kf.Validator.isValidIPv4Mask(e),!t)throw new Error(r.filter((e=>""!==e)).toString());let i=e.split(".");this.octets=i.map((e=>Yf.Octet.fromString(e)));let n=Jf.dottedDecimalNotationToBinaryString(e);this.prefix=(n.match(/1/g)||[]).length,this.value=BigInt(`0b${n}`)}static fromDecimalDottedString(e){return new cg(e)}}Hf.IPv4Mask=cg;class ug extends ag{constructor(e){let t,r;super(e),this.hexadecatet=[];let i=rg.expandIPv6Number(e);if([t,r]=Kf.Validator.isValidIPv6Mask(i),!t)throw new Error(r.filter((e=>""!==e)).toString());let n=i.split(":");this.hexadecatet=n.map((e=>eg.Hexadecatet.fromString(e)));let o=ig.hexadectetNotationToBinaryString(i);this.prefix=(o.match(/1/g)||[]).length,this.value=BigInt(`0b${o}`),this.value=BigInt(`0b${ig.hexadectetNotationToBinaryString(i)}`)}static fromHexadecatet(e){return new ug(e)}}Hf.IPv6Mask=ug,Hf.isIPv4=function(e){return 32===e.bitSize};var lg={};Object.defineProperty(lg,"__esModule",{value:!0});var hg={},dg={},pg={};Object.defineProperty(pg,"__esModule",{value:!0}),pg.isIPv4Prefix=pg.IPv6Prefix=pg.IPv4Prefix=void 0;const fg=Lf(),gg=Hf,vg=kf,mg=Mf(),yg=xf;class wg{constructor(e){let t,r;if(this.type="IPv4",this.bitValue=32n,[t,r]=fg.Validator.isValidPrefixValue(e,"IPv4"),!t)throw new Error(r.filter((e=>""!==e)).toString());this.value=e}static fromNumber(e){return new wg(e)}static fromRangeSize(e){let t=1n===e?32:32-Eg(e,fg.Validator.IPV4_SIZE);return wg.fromNumber(BigInt(t))}getValue(){return this.value}toString(){return this.value.toString()}toMask(){let e="1".repeat(Number(this.value)),t="0".repeat(Number(32n-this.value));return gg.IPv4Mask.fromDecimalDottedString(this.toDecimalNotation(`${e}${t}`))}toRangeSize(){return 1n<<this.bitValue-this.getValue()}merge(){return new wg(this.value-1n)}split(){return new wg(this.value+1n)}toDecimalNotation(e){return`${vg.parseBinaryStringToBigInt(e.substr(0,8))}.${vg.parseBinaryStringToBigInt(e.substr(8,8))}.${vg.parseBinaryStringToBigInt(e.substr(16,8))}.${vg.parseBinaryStringToBigInt(e.substr(24,8))}`}}pg.IPv4Prefix=wg;class bg{constructor(e){let t,r;if(this.type="IPv6",this.bitValue=128n,[t,r]=fg.Validator.isValidPrefixValue(e,"IPv6"),!t)throw new Error(r.filter((e=>""!==e)).toString());this.value=e}static fromNumber(e){return new bg(e)}static fromRangeSize(e){let t=1n===e?128:128-Eg(e,fg.Validator.IPV6_SIZE);return bg.fromNumber(BigInt(t))}getValue(){return this.value}toString(){return this.value.toString()}toMask(){let e="1".repeat(Number(this.value)),t="0".repeat(128-Number(this.value));return gg.IPv6Mask.fromHexadecatet(this.toHexadecatetNotation(`${e}${t}`))}toRangeSize(){return 1n<<this.bitValue-this.getValue()}merge(){return new bg(this.value-1n)}split(){return new bg(this.value+1n)}toHexadecatetNotation(e){return e.match(/.{1,16}/g).map((e=>yg.Hexadecatet.fromString(mg.binaryStringToHexadecimalString(e)))).map((e=>e.toString())).join(":")}}function Eg(e,t){let r=t>fg.Validator.IPV4_SIZE?"IPv6":"IPv4";if(e>t||0n===e)throw new Error(fg.Validator.invalidIPRangeSizeMessage.replace("$iptype",r));try{return vg.intLog2(e)}catch(e){throw new Error(fg.Validator.invalidIPRangeSizeForCidrMessage)}}pg.IPv6Prefix=bg,pg.isIPv4Prefix=function(e){return"IPv4"===e.type},Object.defineProperty(dg,"__esModule",{value:!0}),dg.isIPv4CidrRange=dg.IPv6CidrRange=dg.IPv4CidrRange=dg.AbstractIPRange=dg.RangedSet=void 0;const Sg=Hf,Ig=pg,Ag=kf,Pg=Lf();class Tg{constructor(e,t){if(this.first=e,this.last=t,e.isGreaterThan(t))throw new Error(`${e.toString()} should be lower than ${t.toString()}`);this.currentValue=e,this.bitValue=BigInt(e.bitSize)}static fromSingleIP(e){return new Tg(e,e)}static fromCidrRange(e){return new Tg(e.getFirst(),e.getLast())}static fromRangeString(e){let t=e.split("-").map((e=>e.trim()));if(2!==t.length)throw new Error("Argument should be in the format firstip-lastip");let[r,i]=t,[n]=Pg.Validator.isValidIPv4String(r),[o]=Pg.Validator.isValidIPv4String(i),[s]=Pg.Validator.isValidIPv6String(r),[a]=Pg.Validator.isValidIPv6String(i);if(n&&o)return new Tg(Sg.IPv4.fromDecimalDottedString(r),Sg.IPv4.fromDecimalDottedString(i));if(s&&a)return new Tg(Sg.IPv6.fromHexadecatet(r),Sg.IPv6.fromHexadecatet(i));throw new Error("First IP and Last IP should be valid and same type")}getFirst(){return this.first}getLast(){return this.last}getSize(){return this.last.getValue()-this.first.getValue()+1n}toRangeString(){return`${this.getFirst()}-${this.getLast()}`}inside(e){return e.contains(this)}contains(e){let t=this.getFirst(),r=this.getLast(),i=e.getFirst(),n=e.getLast();return t.isLessThanOrEquals(i)&&r.isGreaterThanOrEquals(n)}isEquals(e){return this.getFirst().isEquals(e.getFirst())&&this.getLast().isEquals(e.getLast())}isLessThan(e){return!this.isEquals(e)&&(this.getFirst().isEquals(e.getFirst())?this.getSize()<e.getSize():this.getFirst().isLessThan(e.getFirst()))}isGreaterThan(e){return!this.isEquals(e)&&(this.getFirst().isEquals(e.getFirst())?this.getSize()>e.getSize():this.getFirst().isGreaterThan(e.getFirst()))}isOverlapping(e){let t=this.getFirst(),r=this.getLast(),i=e.getFirst(),n=e.getLast();return r.isGreaterThan(i)&&r.isLessThanOrEquals(n)&&t.isLessThan(i)||n.isGreaterThan(t)&&n.isLessThanOrEquals(r)&&i.isLessThan(t)}isCidrAble(){if(1n===this.getSize())return!0;try{let e=Ag.intLog2(this.getSize()),t=Ag.parseBinaryStringToBigInt(Ag.cidrPrefixToMaskBinaryString(e,Sg.isIPv4(this.currentValue)?"IPv4":"IPv6"));return this.first.getValue()===(t&this.first.getValue())}catch(e){return!1}}toCidrRange(){return Sg.isIPv4(this.currentValue)?this.toIPv4CidrRange():this.toIPv6CidrRange()}isConsecutive(e){let t=this.getFirst(),r=this.getLast(),i=e.getFirst(),n=e.getLast();return r.hasNext()&&r.nextIPNumber().isEquals(i)||n.hasNext()&&n.nextIPNumber().isEquals(t)}union(e){if(this.isEquals(e))return new Tg(e.getFirst(),e.getLast());if(this.isOverlapping(e))return this.getFirst().isLessThan(e.getFirst())?new Tg(this.getFirst(),e.getLast()):new Tg(e.getFirst(),this.getLast());if(this.contains(e))return new Tg(this.getFirst(),this.getLast());if(e.contains(this))return new Tg(e.getFirst(),e.getLast());throw new Error("Ranges do not overlap nor are equal")}prepend(e){if(e.getLast().nextIPNumber().isEquals(this.getFirst()))return new Tg(e.getFirst(),this.getLast());throw new Error("Range to prepend must be adjacent")}append(e){if(this.getLast().nextIPNumber().isEquals(e.getFirst()))return new Tg(this.getFirst(),e.getLast());throw new Error("Range to append must be adjacent")}subtract(e){if(!this.isOverlapping(e))throw new Error("Cannot subtract ranges that are not overlapping");if(!this.isLessThan(e))throw new Error("Cannot subtract a larger range from this range");return new Tg(this.getFirst(),e.getLast())}takeSubRange(e,t){if(e+t>this.getSize())throw new RangeError("Requested range is greater than what can be taken");if(0n===t)throw new Error("Sub range cannot be zero");let r=this.getFirst().value+e,i=Sg.isIPv4(this.getFirst())?Sg.IPv4.fromNumber(r):Sg.IPv6.fromBigInt(r),n=i.value+(t-1n),o=Sg.isIPv4(i)?Sg.IPv4.fromNumber(n):Sg.IPv6.fromBigInt(n);return new Tg(i,o)}difference(e){if(e.getSize()>this.getSize())throw new Error("Range is greater than range to be subtracted from");if(!this.contains(e))throw new Error("Range to subtract is not contained in this range");let t=[];try{t.push(new Tg(this.getFirst(),e.getFirst().previousIPNumber()))}catch(e){}try{t.push(new Tg(e.getLast().nextIPNumber(),this.getLast()))}catch(e){}return t}*take(e){let t=this.getFirst(),r=void 0===e?this.getSize().valueOf():e;for(;r>0;)r--,yield t,t=t.nextIPNumber()}*[Symbol.iterator](){yield*this.take()}toIPv4CidrRange(){let e=new Og(Sg.IPv4.fromNumber(this.getFirst().getValue()),Ig.IPv4Prefix.fromRangeSize(this.getSize()));if(e.getFirst().isEquals(this.getFirst()))return e;throw new Error("Range cannot be converted to CIDR")}toIPv6CidrRange(){let e=new Cg(Sg.IPv6.fromBigInt(this.getFirst().getValue()),Ig.IPv6Prefix.fromRangeSize(this.getSize()));if(e.getFirst().isEquals(this.getFirst()))return e;throw new Error("Range cannot be converted to CIDR")}}dg.RangedSet=Tg;class Rg{hasNextRange(){let e=this.getSize();return 2n**this.bitValue-e>=this.getFirst().getValue()+e}hasPreviousRange(){return this.getSize()<=this.getFirst().getValue()}toRangeSet(){return new Tg(this.getFirst(),this.getLast())}inside(e){return this.toRangeSet().inside(e.toRangeSet())}contains(e){return this.toRangeSet().contains(e.toRangeSet())}toRangeString(){return this.toRangeSet().toRangeString()}isOverlapping(e){return this.toRangeSet().isOverlapping(e.toRangeSet())}isConsecutive(e){return this.toRangeSet().isConsecutive(e.toRangeSet())}isCidrMergeable(e){const t=BigInt(Ag.matchingBitCount(this.getFirst().toBinaryString(),e.getFirst().toBinaryString()));return this.getPrefix().value-t===1n&&(this.isConsecutive(e)&&this.getSize()===e.getSize())}isMergeable(e){return this.isCidrMergeable(e)||this.contains(e)||this.inside(e)}isEquals(e){return this.toRangeSet().isEquals(e.toRangeSet())}merge(e){if(!this.isCidrMergeable(e))throw new Error(`Cannot merge. Ranges (${this.toRangeString()},${e.toRangeString()}) are not consecutive and/or of same size`);return this.newInstance(this.getFirst(),this.getPrefix().merge())}*takeStream(e){return this.toRangeSet().take(e)}*[Symbol.iterator](){yield*this.toRangeSet()}}dg.AbstractIPRange=Rg;class Og extends Rg{constructor(e,t){super(),this.ipv4=e,this.cidrPrefix=t,this.bitValue=32n}static fromCidr(e){let[t,r]=Pg.Validator.isValidIPv4CidrNotation(e);if(!t){let e=r.filter((e=>""!==e));throw new Error(e.join(" and "))}let i=e.split("/"),n=i[0],o=BigInt(parseInt(i[1]));return new Og(Sg.IPv4.fromDecimalDottedString(n),Ig.IPv4Prefix.fromNumber(o))}getSize(){return this.cidrPrefix.toRangeSize()}toCidrString(){return`${this.ipv4.toString().toString()}/${this.cidrPrefix.toString()}`}toRangeString(){return super.toRangeString()}getFirst(){return Sg.IPv4.fromNumber(this.ipv4.getValue()&this.cidrPrefix.toMask().getValue())}getLast(){return Ng(this,this.ipv4)}newInstance(e,t){return new Og(e,t)}getPrefix(){return this.cidrPrefix}isConsecutive(e){return super.isConsecutive(e)}contains(e){return super.contains(e)}inside(e){return super.inside(e)}isOverlapping(e){return super.isOverlapping(e)}take(e){let t=[this.getFirst()],r=this.getFirst();if(e>this.getSize()){let t=Pg.Validator.takeOutOfRangeSizeMessage.replace("$count",e.toString()).replace("$size",this.getSize().toString());throw new Error(t)}for(let i=0;i<e-1n;i++)t.push(r.nextIPNumber()),r=r.nextIPNumber();return t}split(){let e=this.cidrPrefix.getValue();if(32n===e)throw new Error("Cannot split an IP range with a single IP number");let t=Ig.IPv4Prefix.fromNumber(e+1n),r=this.getFirst(),i=new Og(r,t),n=i.getLast().nextIPNumber();return[i,new Og(n,t)]}splitInto(e){let t=e.getValue()-this.cidrPrefix.getValue();if(t<0)throw new Error("Prefix to split into is larger than source prefix");if(0n===t)return[new Og(this.getFirst(),e)];if(1n===t)return this.split();{let e=this.split();for(;t>1;)e=e.flatMap((e=>e.split())),t-=1n;return e}}hasNextRange(){return super.hasNextRange()}hasPreviousRange(){return super.hasPreviousRange()}nextRange(){if(this.hasNextRange()){let e=this.getSize(),t=this.getFirst().getValue()+e;return new Og(new Sg.IPv4(t),this.cidrPrefix)}}previousRange(){if(this.hasPreviousRange()){let e=this.getSize(),t=this.getFirst().getValue()-e;return new Og(new Sg.IPv4(t),this.cidrPrefix)}}}dg.IPv4CidrRange=Og;class Cg extends Rg{constructor(e,t){super(),this.ipv6=e,this.cidrPrefix=t,this.bitValue=128n}static fromCidr(e){let[t,r]=Pg.Validator.isValidIPv6CidrNotation(e);if(!t)throw new Error(r.filter((e=>""!==e)).toString());let i=e.split("/"),n=i[0],o=BigInt(parseInt(i[1]));return new Cg(Sg.IPv6.fromHexadecatet(n),Ig.IPv6Prefix.fromNumber(o))}getSize(){return this.cidrPrefix.toRangeSize()}toCidrString(){return`${this.ipv6.toString().toString()}/${this.cidrPrefix.toString()}`}toRangeString(){return super.toRangeString()}getFirst(){return Sg.IPv6.fromBigInt(this.ipv6.getValue()&this.cidrPrefix.toMask().getValue())}getLast(){return Ng(this,this.ipv6)}newInstance(e,t){return new Cg(e,t)}getPrefix(){return this.cidrPrefix}isConsecutive(e){return super.isConsecutive(e)}contains(e){return super.contains(e)}inside(e){return super.inside(e)}isOverlapping(e){return super.isOverlapping(e)}take(e){let t=[this.getFirst()],r=this.getFirst();if(e>this.getSize())throw new Error(`${e.toString()} is greater than ${this.getSize().toString()}, the size of the range`);for(var i=0;i<e-1n;i++)t.push(r.nextIPNumber()),r=r.nextIPNumber();return t}split(){let e=this.cidrPrefix.getValue();if(128n===e)throw new Error("Cannot split an IP range with a single IP number");let t=Ig.IPv6Prefix.fromNumber(e+1n),r=this.getFirst(),i=new Cg(r,t),n=i.getLast().nextIPNumber();return[i,new Cg(n,t)]}splitInto(e){let t=e.getValue()-this.cidrPrefix.getValue();if(t<0)throw new Error("Prefix to split into is larger than source prefix");if(0n===t)return[new Cg(this.getFirst(),e)];if(1n===t)return this.split();{let e=this.split();for(;t>1;)e=e.flatMap((e=>e.split())),t-=1n;return e}}hasNextRange(){return super.hasNextRange()}hasPreviousRange(){return super.hasPreviousRange()}nextRange(){if(this.hasNextRange()){let e=this.getSize(),t=this.getFirst().getValue()+e;return new Cg(new Sg.IPv6(t),this.cidrPrefix)}}previousRange(){if(this.hasPreviousRange()){let e=this.getSize(),t=this.getFirst().getValue()-e;return new Cg(new Sg.IPv6(t),this.cidrPrefix)}}}dg.IPv6CidrRange=Cg;let Ng=(e,t)=>{let r=Number(e.bitValue.valueOf()),i=BigInt(`0b${"1".repeat(r)}`),n=e.cidrPrefix.toMask().getValue(),o=Ag.leftPadWithZeroBit((n^i).toString(2),r);return kg(e)?Sg.IPv4.fromNumber(t.getValue()|Ag.parseBinaryStringToBigInt(o)):Sg.IPv6.fromBigInt(t.getValue()|Ag.parseBinaryStringToBigInt(o))};function kg(e){return 32n===e.bitValue.valueOf()}dg.isIPv4CidrRange=kg,Object.defineProperty(hg,"__esModule",{value:!0}),hg.Pool=void 0;const _g=dg,xg=pg;class Dg{constructor(e){this.backingSet=new Fg,e.forEach((e=>{this.backingSet.add(e)}))}static fromIP(e){let t=e.map((e=>_g.RangedSet.fromSingleIP(e)));return new Dg(t)}static fromRangeSet(e){return new Dg(e)}static fromCidrRanges(e){let t=e.map((e=>e.toRangeSet()));return new Dg(t)}getRanges(){return this.backingSet.asArray()}aggregate(){let e=this.backingSet.asArray().reduce(((e,t,r,i)=>{if(0==e.length)return e.push(t),e;{let r=e.pop(),i=r.toCidrRange(),n=t.toCidrRange();if(i.isCidrMergeable(n)){let t=i.merge(n);return e.push(t.toRangeSet()),e}return r.contains(t)?e.push(r):(e.push(r),e.push(t)),e}}),[]),t=Dg.fromRangeSet(e);return t.getRanges().length!==this.getRanges().length?t.aggregate():t}getCidrRange(e){if(e.toRangeSize()>this.getSize())throw new Error(`Not enough IP number in the pool for requested prefix: ${e}`);let t,r;e:for(let i of this.getRanges())for(let n=0n;n+e.toRangeSize()<=i.getSize();n+=1n)try{let r=i.takeSubRange(n,e.toRangeSize());t=r.toCidrRange();let o=i.difference(r);this.removeExact(i),this.add(o);break e}catch(e){if(e instanceof RangeError)continue e;r=e}if(t)return t;throw void 0===r?new Error(`No range big enough in the pool for requested prefix: ${e}`):r}getCidrRanges(e){if(e.toRangeSize()>this.getSize())throw new Error("Prefix greater than pool");let t=(e,r,i)=>{try{let n=this.getCidrRange(r);i.push(n);let o=i.reduce(((e,t)=>e+t.getSize()),0n);return e.toRangeSize()===o?i:t(e,r,i)}catch(n){let o=xg.isIPv4Prefix(r)?xg.IPv4Prefix.fromNumber(r.getValue()+1n):xg.IPv6Prefix.fromNumber(r.getValue()+1n);return t(e,o,i)}};return t(e,e,[])}getSize(){return this.aggregate().getRanges().reduce(((e,t)=>e+t.getSize()),0n)}resetWith(e){this.backingSet.clear(),this.backingSet=this.backingSet.add(e)}removeExact(e){let t=this.backingSet.removeExact(e),r=!this.backingSet.isEquals(t);return this.backingSet=t,r}removeOverlapping(e){let t=this.backingSet.removeOverlapping(e),r=!this.backingSet.isEquals(t);return this.backingSet=t,r}add(e){this.backingSet=this.backingSet.add(e)}clear(){this.backingSet.clear()}}hg.Pool=Dg;class Fg{constructor(e){this.backingArray=e?this.sortArray(e):new Array}sortArray(e){return e.sort(((e,t)=>e.isLessThan(t)?-1:e.isGreaterThan(t)?1:0)),e}asArray(){return this.backingArray}isEquals(e){return this.backingArray.length===e.asArray().length&&this.backingArray.every(((t,r)=>t.getSize()===e.asArray()[r].getSize()))}add(e){let t=this.backingArray;return"push"in e?t=t.concat(e):t.push(e),new Fg(this.sortArray(t))}removeExact(e){let t=this.backingArray.filter((t=>"push"in e?void 0!==e.find((e=>e.isEquals(t))):!e.isEquals(t)));return new Fg(this.sortArray(t))}removeOverlapping(e){let t=this.backingArray.flatMap((t=>{if("push"in e)return e.flatMap((e=>t.contains(e)?t.difference(e):t.inside(e)?new Array:t.isOverlapping(e)?[t.subtract(e)]:[e]));try{return t.difference(e)}catch(e){return t}}));return new Fg(this.sortArray(t))}clear(){this.backingArray=[]}}var qg,Bg,jg;!function(e){var t=M&&M.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),r=M&&M.__exportStar||function(e,r){for(var i in e)"default"===i||r.hasOwnProperty(i)||t(r,e,i)};Object.defineProperty(e,"__esModule",{value:!0}),r(kf,e),r(xf,e),r(Mf(),e),r(Hf,e),r(lg,e),r(hg,e),r(dg,e),r(qf(),e),r(zf,e),r(pg,e),r(Lf(),e)}(Nf),function(e){e.ServiceNotInitialized="ServiceNotInitialized",e.NetworkSetupMissing="NetworkSetupMissing",e.NetworkCreationFailed="NetworkCreationFailed",e.NoAddressesAvailable="NoAddressesAvailable",e.AddressOutOfRange="AddressOutOfRange",e.AddressAlreadyAssigned="AddressAlreadyAssigned",e.NodeAddingFailed="NodeAddingFailed",e.NodeRemovalFailed="NodeRemovalFailed",e.NetworkRemovalFailed="NetworkRemovalFailed",e.GettingIdentityFailed="GettingIdentityFailed",e.NetworkRemoved="NetworkRemoved"}(Bg||(Bg={}));class $g extends c{constructor(e,t,r,i){super(e,t,i),this.code=t,this.previous=i,qg.set(this,void 0),ss(this,qg,r,"f")}getNetwork(){return os(this,qg,"f")}}qg=new WeakMap,function(e){e.Active="Active",e.Removed="Removed"}(jg||(jg={}));class Mg{constructor(e,t,r,i){this.id=e,this.nodes=new Map,this.state=jg.Active,this.ipRange=Nf.IPv4CidrRange.fromCidr(r?`${t.split("/")[0]}/${Nf.IPv4Mask.fromDecimalDottedString(r).prefix}`:t),this.ipIterator=this.ipRange[Symbol.iterator](),this.ip=this.getFirstAvailableIpAddress(),this.mask=this.ipRange.getPrefix().toMask(),this.gateway=i?new Nf.IPv4(i):void 0}getNetworkInfo(){var e,t;return{id:this.id,ip:this.ip.toString(),mask:this.mask.toString(),gateway:null===(t=null===(e=this.gateway)||void 0===e?void 0:e.toString)||void 0===t?void 0:t.call(e),nodes:Object.fromEntries(Array.from(this.nodes).map((([e,t])=>[t.ip,e])))}}addNode(e){if(this.isRemoved())throw new $g(`Unable to add node ${e.id} to removed network`,Bg.NetworkRemoved,this.getNetworkInfo());if(this.hasNode(e))throw new $g(`Node ${e.id} has already been added to this network`,Bg.AddressAlreadyAssigned);this.nodes.set(e.id,e)}hasNode(e){return this.nodes.has(e.id)}removeNode(e){if(this.isRemoved())throw new $g(`Unable to remove node ${e.id} from removed network`,Bg.NetworkRemoved,this.getNetworkInfo());if(!this.hasNode(e))throw new $g(`There is no node ${e.id} in the network`,Bg.NodeRemovalFailed);this.nodes.delete(e.id)}markAsRemoved(){if(this.state===jg.Removed)throw new $g("Network already removed",Bg.NetworkRemoved,this.getNetworkInfo());this.state=jg.Removed}getFirstAvailableIpAddress(){const e=this.ipIterator.next().value;if(!e)throw new $g(`No more addresses available in ${this.ipRange.toCidrString()}`,Bg.NoAddressesAvailable,this.getNetworkInfo());return e}isIpInNetwork(e){return this.ipRange.contains(new Nf.IPv4CidrRange(e,new Nf.IPv4Prefix(BigInt(this.mask.prefix))))}isNodeIdUnique(e){return!this.nodes.has(e)}isNodeIpUnique(e){for(const t of this.nodes.values())if(new Nf.IPv4(t.ip).isEquals(e))return!1;return!0}isRemoved(){return this.state===jg.Removed}}class Lg{constructor(e,t,r,i){this.id=e,this.ip=t,this.getNetworkInfo=r,this.yagnaBaseUri=i}getNetworkDeploymentArg(){return{net:[{...this.getNetworkInfo(),nodeIp:this.ip}]}}getWebsocketUri(e){const t=new URL(this.yagnaBaseUri);return t.protocol="ws",`${t.href}/net/${this.getNetworkInfo().id}/tcp/${this.ip}/${e}`}}class Vg{constructor(e){this.events=new Gl,this.logger=K("network"),this.lock=new Ql,this.networkApi=e.networkApi,e.logger&&(this.logger=e.logger)}async createNetwork(e){var t,r,i,n;this.logger.debug("Creating network",e);try{const o=(null===(r=null===(t=null==e?void 0:e.ip)||void 0===t?void 0:t.split("/"))||void 0===r?void 0:r[0])||"192.168.0.0",s=parseInt((null===(n=null===(i=null==e?void 0:e.ip)||void 0===i?void 0:i.split("/"))||void 0===n?void 0:n[1])||"24"),a=(null==e?void 0:e.mask)?Nf.IPv4Mask.fromDecimalDottedString(e.mask).prefix:s,c=Nf.IPv4CidrRange.fromCidr(`${Nf.IPv4.fromString(o)}/${a}`),u=c.getFirst(),l=c.getPrefix().toMask(),h=(null==e?void 0:e.gateway)?new Nf.IPv4(e.gateway):void 0,d=await this.networkApi.createNetwork({ip:u.toString(),mask:null==l?void 0:l.toString(),gateway:null==h?void 0:h.toString()}),p=await this.networkApi.getIdentity();return await this.createNetworkNode(d,p,null==e?void 0:e.ownerIp),this.logger.info("Created network",d.getNetworkInfo()),this.events.emit("networkCreated",{network:d}),d}catch(e){const t=kh(e),r=e instanceof $g?e:new $g(`Unable to create network. ${t}`,Bg.NetworkCreationFailed,void 0,e);throw this.events.emit("errorCreatingNetwork",{error:r}),r}}async removeNetwork(e){this.logger.debug("Removing network",e.getNetworkInfo()),await this.lock.acquire(`net-${e.id}`,(async()=>{try{await this.networkApi.removeNetwork(e),e.markAsRemoved(),this.logger.info("Removed network",e.getNetworkInfo()),this.events.emit("networkRemoved",{network:e})}catch(t){throw this.events.emit("errorRemovingNetwork",{network:e,error:t}),t}}))}async createNetworkNode(e,t,r){return this.logger.debug("Creating network node",{nodeId:t,nodeIp:r}),await this.lock.acquire(`net-${e.id}`,(async()=>{try{if(!e.isNodeIdUnique(t))throw new $g(`Network ID '${t}' has already been assigned in this network.`,Bg.AddressAlreadyAssigned,e.getNetworkInfo());if(e.isRemoved())throw new $g(`Unable to create network node ${t}. Network has already been removed`,Bg.NetworkRemoved,e.getNetworkInfo());const i=this.getFreeIpInNetwork(e,r),n=await this.networkApi.createNetworkNode(e,t,i.toString());return e.addNode(n),this.logger.info("Added network node",{id:t,ip:i.toString()}),this.events.emit("nodeCreated",{network:e,node:n}),n}catch(t){throw this.events.emit("errorCreatingNode",{network:e,error:t}),t}}))}async removeNetworkNode(e,t){return this.logger.debug("Removing network node",{nodeId:t.id,nodeIp:t.ip}),await this.lock.acquire(`net-${e.id}`,(async()=>{try{if(!e.hasNode(t))throw new $g(`The network node ${t.id} does not belong to the network`,Bg.NodeRemovalFailed,e.getNetworkInfo());if(e.isRemoved())return void this.logger.debug(`Unable to remove network node ${t.id}. Network has already been removed`,{network:e,node:t});await this.networkApi.removeNetworkNode(e,t),e.removeNode(t),this.logger.info("Removed network node",{network:e.getNetworkInfo().ip,nodeIp:t.ip}),this.events.emit("nodeRemoved",{network:e,node:t})}catch(r){throw this.events.emit("errorRemovingNode",{network:e,node:t,error:r}),r}}))}getFreeIpInNetwork(e,t){if(!t)return e.getFirstAvailableIpAddress();const r=Nf.IPv4.fromString(t);if(!e.isIpInNetwork(r))throw new $g(`The given IP ('${t}') address must belong to the network ('${e.getNetworkInfo().ip}').`,Bg.AddressOutOfRange,e.getNetworkInfo());if(!e.isNodeIpUnique(r))throw new $g(`IP '${t.toString()}' has already been assigned in this network.`,Bg.AddressAlreadyAssigned,e.getNetworkInfo());return r}}class Ug{constructor(e,t,r,i,n,o,s){var a;this.agreement=e,this.storageProvider=t,this.paymentProcess=r,this.marketModule=i,this.activityModule=n,this.logger=o,this.resourceRentalOptions=s,this.events=new Gl,this.currentExeUnit=null,this.abortController=new AbortController,this.networkNode=null===(a=this.resourceRentalOptions)||void 0===a?void 0:a.networkNode,this.createExeUnit(this.abortController.signal).catch((e=>this.logger.debug("Failed to automatically create the exe unit during resource rental initialization",{error:e})))}async startStopAndFinalize(e){var t;try{if(this.currentExeUnit&&await this.currentExeUnit.teardown(),this.abortController.abort("The resource rental is finalizing"),(null===(t=this.currentExeUnit)||void 0===t?void 0:t.activity)&&await this.activityModule.destroyActivity(this.currentExeUnit.activity),"Terminated"!==await this.fetchAgreementState()&&await this.marketModule.terminateAgreement(this.agreement),this.paymentProcess.isFinished())return;this.logger.info("Waiting for payment process of agreement to finish",{agreementId:this.agreement.id});const r=Dl(e);await va((()=>this.paymentProcess.isFinished()),{abortSignal:r}).catch((e=>{if(this.paymentProcess.stop(),e instanceof a)throw new a("The finalization of payment process has been aborted due to a timeout",r.reason);throw new i("The finalization of payment process has been aborted",r.reason)})),this.logger.info("Finalized payment process",{agreementId:this.agreement.id})}catch(e){throw this.logger.error("Filed to finalize payment process",{agreementId:this.agreement.id,error:e}),e}finally{this.events.emit("finalized")}}async stopAndFinalize(e){return this.finalizePromise||(this.finalizePromise=this.startStopAndFinalize(e)),this.finalizePromise}hasActivity(){return null!==this.currentExeUnit}async getExeUnit(e){if(this.finalizePromise||this.abortController.signal.aborted)throw new r("The resource rental is not active. It may have been aborted or finalized");if(null!==this.currentExeUnit)return this.currentExeUnit;const t=new AbortController;if(this.abortController.signal.addEventListener("abort",(()=>t.abort(this.abortController.signal.reason))),e){const r=Dl(e);r.addEventListener("abort",(()=>t.abort(r.reason))),e instanceof AbortSignal&&e.aborted&&t.abort(e.reason)}return this.createExeUnit(t.signal)}async destroyExeUnit(){var e;try{if(null===this.currentExeUnit)throw new r("There is no exe-unit to destroy.");await this.activityModule.destroyActivity(this.currentExeUnit.activity),this.currentExeUnit=null}catch(t){throw this.events.emit("error",t),this.logger.error(`Failed to destroy exe-unit. ${t}`,{activityId:null===(e=this.currentExeUnit)||void 0===e?void 0:e.activity}),t}}async fetchAgreementState(){return this.marketModule.fetchAgreement(this.agreement.id).then((e=>e.getState()))}async createExeUnit(e){return this.exeUnitPromise||(this.exeUnitPromise=(async()=>{var t,r,i;const n=await this.activityModule.createActivity(this.agreement);return this.currentExeUnit=await this.activityModule.createExeUnit(n,{storageProvider:this.storageProvider,networkNode:null===(t=this.resourceRentalOptions)||void 0===t?void 0:t.networkNode,executionOptions:null===(r=this.resourceRentalOptions)||void 0===r?void 0:r.activity,signalOrTimeout:e,...null===(i=this.resourceRentalOptions)||void 0===i?void 0:i.exeUnit}),this.events.emit("exeUnitCreated",n),this.currentExeUnit})().catch((e=>{throw this.events.emit("error",e),this.logger.error(`Failed to create exe-unit. ${e}`,{agreementId:this.agreement.id}),e})).finally((()=>{this.exeUnitPromise=void 0}))),this.exeUnitPromise}}class Hg{constructor(e){this.events=new Gl,this.lowPriority=new Set,this.highPriority=new Set,this.borrowed=new Set,this.acquireQueue=new Yl,this.asyncLock=new Ql,this.rentalsBeingSigned=0,this.allocation=e.allocation,this.proposalPool=e.proposalPool,this.marketModule=e.marketModule,this.rentalModule=e.rentalModule,this.networkModule=e.networkModule,this.network=e.network,this.resourceRentalOptions=e.resourceRentalOptions,this.agreementOptions=e.agreementOptions,this.logger=e.logger,this.minPoolSize=("number"==typeof(null==e?void 0:e.poolSize)?null==e?void 0:e.poolSize:"object"==typeof(null==e?void 0:e.poolSize)?null==e?void 0:e.poolSize.min:void 0)||0,this.maxPoolSize=(()=>{if("object"==typeof(null==e?void 0:e.poolSize))return null==e?void 0:e.poolSize.max})()||100,this.abortController=new AbortController}async createNewResourceRental(e){this.logger.debug("Creating new resource rental to add to pool");const{signal:t,cleanup:r}=Fl(this.abortController.signal,Dl(e));try{this.rentalsBeingSigned++;const e=await this.marketModule.signAgreementFromPool(this.proposalPool,this.agreementOptions,t),r=this.network?await this.networkModule.createNetworkNode(this.network,e.provider.id):void 0,i=this.rentalModule.createResourceRental(e,this.allocation,{networkNode:r,...this.resourceRentalOptions});return this.events.emit("created",{agreement:e}),i}catch(e){if(t.aborted)throw this.logger.debug("Creating resource rental was aborted",e),e;throw this.events.emit("errorCreatingRental",{error:new Ll("Creating resource rental failed",Ml.ResourceRentalCreationFailed,e)}),this.logger.error("Creating resource rental failed",e),e}finally{this.rentalsBeingSigned--,r()}}async validate(e){try{const t=await e.fetchAgreementState(),r="Approved"===t;return this.logger.debug("Validated resource rental in the pool",{result:r,state:t}),r}catch(e){return this.logger.error("Something went wrong while validating resource rental, it will be destroyed",e),!1}}canCreateMoreResourceRentals(){return this.getSize()+this.rentalsBeingSigned<this.maxPoolSize}async takeValidResourceRental(){let e=null;if(this.highPriority.size>0?(e=this.highPriority.values().next().value,this.highPriority.delete(e)):this.lowPriority.size>0&&(e=this.lowPriority.values().next().value,this.lowPriority.delete(e)),!e)return null;return await this.validate(e)?e:(await this.destroy(e),this.takeValidResourceRental())}async enqueueAcquire(e){const t=await this.acquireQueue.get(e);return this.borrowed.add(t),this.events.emit("acquired",{agreement:t.agreement}),t}async raceNewRentalWithAcquireQueue(e){const t=new AbortController,{signal:r,cleanup:i}=Fl(t.signal,Dl(e),this.abortController.signal);return Promise.any([this.createNewResourceRental(r),this.acquireQueue.get(r).then((e=>(this.logger.info("A rental became available in the pool, using it instead of creating a new one"),e)))]).catch((e=>{throw e.errors[0]})).finally((()=>{t.abort(),i()}))}async acquire(e){if(this.isDraining)throw new i("The pool is in draining mode, you cannot acquire new resources");let t=await this.takeValidResourceRental();if(!t){if(!this.canCreateMoreResourceRentals())return this.enqueueAcquire(e);t=await this.raceNewRentalWithAcquireQueue(e)}return this.borrowed.add(t),this.events.emit("acquired",{agreement:t.agreement}),t}passResourceRentalToWaitingAcquireOrBackToPool(e){this.acquireQueue.hasAcquirers()?this.acquireQueue.put(e):e.hasActivity()?this.highPriority.add(e):this.lowPriority.add(e)}async release(e){return this.asyncLock.acquire("resource-rental-pool",(async()=>{if(this.getAvailableSize()>=this.maxPoolSize)return this.destroy(e);this.borrowed.delete(e);if(!await this.validate(e))return this.destroy(e);this.passResourceRentalToWaitingAcquireOrBackToPool(e),this.events.emit("released",{agreement:e.agreement})}))}async destroy(e){try{this.borrowed.delete(e),this.logger.debug("Destroying resource rental from the pool",{agreementId:e.agreement.id}),await Promise.all([e.stopAndFinalize(),this.removeNetworkNode(e)]),this.events.emit("destroyed",{agreement:e.agreement})}catch(t){this.events.emit("errorDestroyingRental",{agreement:e.agreement,error:new Ll("Destroying resource rental failed",Ml.ResourceRentalTerminationFailed,t)}),this.logger.error("Destroying resource rental failed",t)}}get isDraining(){return!!this.drainPromise}async startDrain(){try{await this.asyncLock.acquire("resource-rental-pool",(async()=>{this.abortController.abort("The pool is in draining mode"),this.events.emit("draining"),this.acquireQueue.releaseAll();const e=Array.from(this.borrowed).concat(Array.from(this.lowPriority)).concat(Array.from(this.highPriority));await Promise.allSettled(e.map((e=>this.destroy(e)))),this.lowPriority.clear(),this.highPriority.clear(),this.borrowed.clear(),this.abortController=new AbortController}))}catch(e){throw this.logger.error("Draining the pool failed",e),e}finally{this.events.emit("end")}}async drainAndClear(){return this.isDraining||(this.drainPromise=this.startDrain().finally((()=>{this.drainPromise=void 0}))),this.drainPromise}getSize(){return this.getAvailableSize()+this.getBorrowedSize()}getAvailableSize(){return this.lowPriority.size+this.highPriority.size}getBorrowedSize(){return this.borrowed.size}async ready(e){if(this.minPoolSize<=this.getAvailableSize())return;const{signal:t,cleanup:r}=Fl(this.abortController.signal,Dl(e)),i=async()=>{await Promise.allSettled(new Array(this.minPoolSize-this.getAvailableSize()).fill(0).map((()=>this.createNewResourceRental(t).then((e=>this.lowPriority.add(e)),(e=>this.logger.error("Creating resource rental failed",e))))))};for(;this.minPoolSize>this.getAvailableSize()&&!t.aborted;)await ql(i);if(r(),this.minPoolSize>this.getAvailableSize())throw new Error("Could not create enough resource rentals to reach the minimum pool size in time");this.events.emit("ready")}async removeNetworkNode(e){this.network&&e.networkNode&&(this.logger.debug("Removing a node from the network",{network:this.network.getNetworkInfo().ip,nodeIp:e.networkNode.ip}),await this.networkModule.removeNetworkNode(this.network,e.networkNode))}async withRental(e,t){const r=await this.acquire(t);try{return await e(r)}finally{await this.release(r)}}}class zg{constructor(e){this.deps=e,this.events=new Gl}createResourceRental(e,t,r){const i=this.deps.paymentModule.createAgreementPaymentProcess(e,t,null==r?void 0:r.payment),n=new Ug(e,this.deps.storageProvider,i,this.deps.marketModule,this.deps.activityModule,this.deps.logger.child("resource-rental"),r);return this.events.emit("resourceRentalCreated",n.agreement),n}createResourceRentalPool(e,t,r){const i=new Hg({allocation:t,rentalModule:this,marketModule:this.deps.marketModule,networkModule:this.deps.networkModule,proposalPool:e,resourceRentalOptions:null==r?void 0:r.resourceRentalOptions,logger:this.deps.logger.child("resource-rental-pool"),network:null==r?void 0:r.network,poolSize:null==r?void 0:r.poolSize});return this.events.emit("resourceRentalPoolCreated"),i}}class Wg{constructor(e,t,r,i){this.yagna=e,this.invoiceRepo=t,this.debitNoteRepo=r,this.logger=i,this.receivedInvoices$=new Fs,this.receivedDebitNotes$=new Fs}async connect(){this.logger.debug("Connecting Payment API Adapter"),ta(this.yagna.invoiceEvents$).pipe(sa((e=>e&&e.invoiceId?this.invoiceRepo.getById(e.invoiceId):ra()))).subscribe({next:e=>this.receivedInvoices$.next(e),error:e=>this.receivedInvoices$.error(e),complete:()=>this.logger.debug("Finished reading InvoiceEvents")}),ta(this.yagna.debitNoteEvents$).pipe(sa((e=>e&&e.debitNoteId?this.debitNoteRepo.getById(e.debitNoteId):ra()))).subscribe({next:e=>this.receivedDebitNotes$.next(e),error:e=>this.receivedDebitNotes$.error(e),complete:()=>this.logger.debug("Finished reading DebitNoteEvents")}),this.logger.debug("Payment API Adapter connected")}getInvoice(e){return this.invoiceRepo.getById(e)}getDebitNote(e){return this.debitNoteRepo.getById(e)}async acceptInvoice(e,t,r){try{return await this.yagna.payment.acceptInvoice(e.id,{totalAmountAccepted:r,allocationId:t.id}),this.invoiceRepo.getById(e.id)}catch(r){const i=kh(r);throw new Oh(`Could not accept invoice. ${i}`,Th.InvoiceAcceptanceFailed,t,e.provider)}}async rejectInvoice(e,t){try{return await this.yagna.payment.rejectInvoice(e.id,{rejectionReason:"BAD_SERVICE",totalAmountAccepted:"0.00",message:t}),this.invoiceRepo.getById(e.id)}catch(t){const r=kh(t);throw new Oh(`Could not reject invoice. ${r}`,Th.InvoiceRejectionFailed,void 0,e.provider)}}async acceptDebitNote(e,t,r){try{return await this.yagna.payment.acceptDebitNote(e.id,{totalAmountAccepted:r,allocationId:t.id}),this.debitNoteRepo.getById(e.id)}catch(r){const i=kh(r);throw new Oh(`Could not accept debit note. ${i}`,Th.DebitNoteAcceptanceFailed,t,e.provider)}}async rejectDebitNote(e){try{return this.debitNoteRepo.getById(e.id)}catch(t){const r=kh(t);throw new Oh(`Could not reject debit note. ${r}`,Th.DebitNoteRejectionFailed,void 0,e.provider,t)}}async getAllocation(e){try{const t=await this.yagna.payment.getAllocation(e);return new Ih(t)}catch(e){const t=kh(e);throw new Oh(`Could not retrieve allocation. ${t}`,Th.AllocationCreationFailed,void 0,void 0,e)}}async createAllocation(e){try{const{identity:t}=await this.yagna.identity.getIdentity(),r=new Date,i=await this.yagna.payment.createAllocation({totalAmount:e.budget.toString(),paymentPlatform:e.paymentPlatform,address:t,timestamp:r.toISOString(),timeout:new Date(+r+1e3*e.expirationSec).toISOString(),makeDeposit:!1,remainingAmount:"",spentAmount:"",allocationId:"",deposit:e.deposit});this.logger.debug(`Allocation ${i.allocationId} has been created for address ${t} using payment platform ${e.paymentPlatform}`);return new Ih(i)}catch(e){const t=kh(e);throw new Oh(`Could not create new allocation. ${t}`,Th.AllocationCreationFailed,void 0,void 0,e)}}async releaseAllocation(e){var t,r;try{return this.yagna.payment.releaseAllocation(e.id)}catch(i){throw new Oh(`Could not release allocation. ${(null===(r=null===(t=i.response)||void 0===t?void 0:t.data)||void 0===r?void 0:r.message)||i}`,Th.AllocationReleaseFailed,e,void 0,i)}}}class Gg{constructor(e,t,r,i,n){this.yagnaApi=e,this.agreementRepo=t,this.proposalRepo=r,this.demandRepo=i,this.logger=n}async publishDemandSpecification(e){const t=await this.yagnaApi.market.subscribeDemand(this.buildDemandRequestBody(e.prototype));if("string"!=typeof t)throw new Error(`Failed to subscribe to demand: ${t.message}`);const r=new $l(t,e);return this.demandRepo.add(r),r}async unpublishDemand(e){const t=await this.yagnaApi.market.unsubscribeDemand(e.id);if(null==t?void 0:t.message)throw new Error(`Failed to unsubscribe from demand: ${t.message}`)}collectMarketProposalEvents(e){return new Cs((t=>{let r=!1;const i=async()=>{if(!r){try{for(const r of await this.yagnaApi.market.collectOffers(e.id)){const i=new Date(Date.parse(r.eventDate));switch(r.eventType){case"ProposalEvent":try{const n=new Ul(r.proposal,e);this.proposalRepo.add(n),t.next({type:"ProposalReceived",proposal:n,timestamp:i})}catch(i){t.error(i),this.logger.error("Failed to create offer proposal from the event",{err:i,event:r,demand:e})}break;case"ProposalRejectedEvent":{const{proposalId:e,reason:n}=r,o=this.proposalRepo.getById(e);o&&this.isOfferCounterProposal(o)?t.next({type:"ProposalRejected",counterProposal:o,reason:n.message,timestamp:i}):this.logger.error("Could not locate counter proposal with ID issued by the Requestor while handling ProposalRejectedEvent",{event:r});break}case"PropertyQueryEvent":t.next({type:"PropertyQueryReceived",timestamp:i});break;default:this.logger.warn("Unsupported demand subscription event",{event:r})}}}catch(e){if("status"in e&&404===e.status)return;this.logger.error("Polling yagna for offer proposal events failed",e),t.error(e)}i()}};return i(),()=>{r=!0}}))}async counterProposal(e,t){const r=structuredClone(this.buildDemandRequestBody(t.prototype));r.properties["golem.com.payment.chosen-platform"]=t.paymentPlatform;const i=await this.yagnaApi.market.counterProposalDemand(e.demand.id,e.id,r);if(this.logger.debug("Proposal counter result from yagna",{result:i}),"string"!=typeof i)throw new o(`Counter proposal failed ${i.message}`);const n=await this.yagnaApi.market.getProposalOffer(e.demand.id,i),s=new Jl(n);return this.proposalRepo.add(s),s}async rejectProposal(e,t){try{const r=await this.yagnaApi.market.rejectProposalOffer(e.demand.id,e.id,{message:t});this.logger.debug("Proposal rejection result from yagna",{response:r})}catch(e){const t=kh(e);throw new Ll(`Failed to reject proposal. ${t}`,Ml.ProposalRejectionFailed,e)}}buildDemandRequestBody(e){var t,r;let i;i=(null===(t=e.constraints)||void 0===t?void 0:t.length)?1==e.constraints.length?e.constraints[0]:`(&${e.constraints.join("\n\t")})`:"(&)";const n={};return null===(r=e.properties)||void 0===r||r.forEach((e=>n[e.key]=e.value)),{constraints:i,properties:n}}async getPaymentRelatedDemandDecorations(e){return this.yagnaApi.payment.getDemandDecorations([e])}async confirmAgreement(e,t){try{return this.logger.debug("Confirming agreement by Requestor",{agreementId:e.id}),await this.yagnaApi.market.confirmAgreement(e.id,this.yagnaApi.appSessionId),this.logger.debug("Waiting for agreement approval by Provider",{agreementId:e.id}),await this.yagnaApi.market.waitForApproval(e.id,(null==t?void 0:t.waitingForApprovalTimeoutSec)||60),this.logger.debug("Agreement approved by Provider",{agreementId:e.id}),this.agreementRepo.getById(e.id)}catch(e){throw new Ll("Unable to confirm agreement with provider",Ml.AgreementApprovalFailed,e)}}async createAgreement(e,t){const r=(null==t?void 0:t.expirationSec)||3600;try{const t={proposalId:e.id,validTo:new Date(+new Date+1e3*r).toISOString()},i=await wf(this.yagnaApi.market.createAgreement(t),3e4);if("string"!=typeof i)throw new Ll("Unable to create agreement. Invalid response from the server",Ml.ResourceRentalCreationFailed);const n=await this.agreementRepo.getById(i);return this.logger.debug("Agreement created",{agreement:n,proposalId:e.id,demandId:e.demand.id}),n}catch(e){const t=kh(e);throw new Ll(`Unable to create agreement ${t}`,Ml.ResourceRentalCreationFailed,e)}}async proposeAgreement(e,t){const r=await this.createAgreement(e,t),i=await this.confirmAgreement(r),n=i.getState();if("Approved"!==n)throw new Ll(`Agreement ${r.id} cannot be approved. Current state: ${n}`,Ml.AgreementApprovalFailed);return this.logger.debug("Established agreement",r),i}getAgreement(e){return this.agreementRepo.getById(e)}async getAgreementState(e){return(await this.agreementRepo.getById(e)).getState()}async terminateAgreement(e,t="Finished"){try{const i=await this.agreementRepo.getById(e.id);if("Terminated"===i.getState())throw new r("You can not terminate an agreement that's already terminated");return await wf(this.yagnaApi.market.terminateAgreement(i.id,{message:t}),3e4),this.logger.debug("Agreement terminated",{id:e.id,reason:t}),this.agreementRepo.getById(e.id)}catch(t){const r=kh(t);throw new Ll(`Unable to terminate agreement ${e.id}. ${r}`,Ml.ResourceRentalTerminationFailed,t)}}collectAgreementEvents(){return this.yagnaApi.agreementEvents$.pipe(pa((e=>new Cs((t=>{try{this.logger.debug("Market API Adapter received agreement event",{event:e});const r=new Date(Date.parse(e.eventDate)),i=e.eventType||e.eventtype;this.getAgreement(e.agreementId).then((n=>{switch(i){case"AgreementApprovedEvent":t.next({type:"AgreementApproved",agreement:n,timestamp:r});break;case"AgreementTerminatedEvent":t.next({type:"AgreementTerminated",agreement:n,terminatedBy:e.terminator,reason:e.reason.message,timestamp:r});break;case"AgreementRejectedEvent":t.next({type:"AgreementRejected",agreement:n,reason:e.reason.message,timestamp:r});break;case"AgreementCancelledEvent":t.next({type:"AgreementCancelled",agreement:n,timestamp:r});break;default:this.logger.warn("Unsupported agreement event type for event",{event:e})}})).catch((t=>this.logger.error("Failed to load agreement",{agreementId:e.agreementId,err:t})))}catch(r){const i=new Ll("Error while processing agreement event from yagna",Ml.InternalError,r);this.logger.error(i.message,{event:e,err:r}),t.error(r)}})))))}isOfferCounterProposal(e){return"Requestor"===e.issuer}scan(e){const t=new AbortController;return new Cs((r=>(this.yagnaApi.market.beginScan({type:"offer",...this.buildDemandRequestBody(e)}).then((e=>{if("string"!=typeof e)throw new Error(`Something went wrong while starting the scan, ${e.message}`);return e})).then((async e=>{const i=()=>this.yagnaApi.market.endScan(e);if(t.signal.aborted)return void await i();const n=new kl(`${this.yagnaApi.market.httpRequest.config.BASE}/scan/${e}/events`,{headers:{Accept:"text/event-stream",Authorization:`Bearer ${this.yagnaApi.yagnaOptions.apiKey}`}});n.addEventListener("offer",(e=>{try{const t=JSON.parse(e.data);r.next(new ph(t))}catch(e){r.error(e)}})),n.addEventListener("error",(e=>r.error(e))),t.signal.onabort=async()=>{n.close(),await i()}})).catch((e=>{const t=kh(e);r.error(new Ll(`Error while scanning for offers. ${t}`,Ml.ScanFailed,e))})),()=>{t.abort()})))}}class Yg{constructor(e,t){this.paymentClient=e,this.marketClient=t}async getById(e){let t,r;try{t=await this.paymentClient.getInvoice(e)}catch(e){const t=kh(e);throw new Oh(`Failed to get debit note: ${t}`,Th.CouldNotGetInvoice,void 0,void 0,e)}try{r=await this.marketClient.getAgreement(t.agreementId)}catch(e){const t=kh(e);throw new Ll(`Failed to get agreement for invoice: ${t}`,Ml.CouldNotGetAgreement,e)}const i={id:t.issuerId,walletAddress:t.payeeAddr,name:r.offer.properties["golem.node.id.name"]};return new Eh(t,i)}}class Kg{constructor(e,t){this.paymentClient=e,this.marketClient=t}async getById(e){let t,r;try{t=await this.paymentClient.getDebitNote(e)}catch(e){const t=kh(e);throw new Oh(`Failed to get debit note: ${t}`,Th.CouldNotGetDebitNote,void 0,void 0,e)}try{r=await this.marketClient.getAgreement(t.agreementId)}catch(e){const t=kh(e);throw new Ll(`Failed to get agreement for debit note: ${t}`,Ml.CouldNotGetAgreement,e)}const i={id:t.issuerId,walletAddress:t.payeeAddr,name:r.offer.properties["golem.node.id.name"]};return new Sh(t,i)}}class Jg{constructor(e,t,r,i){this.state=e,this.control=t,this.exec=r,this.activityRepo=i}getActivity(e){return this.activityRepo.getById(e)}async createActivity(e){try{const t=await this.control.createActivity({agreementId:e.id});if("object"!=typeof t||!("activityId"in t))throw new Error(t);return this.activityRepo.getById(t.activityId)}catch(t){const r=kh(t);throw new df(`Failed to create activity: ${r}`,hf.ActivityCreationFailed,e,void 0,e.provider)}}async destroyActivity(e){try{return await this.control.destroyActivity(e.id,30),this.activityRepo.getById(e.id)}catch(t){const r=kh(t);throw new df(`Failed to destroy activity: ${r}`,hf.ActivityDestroyingFailed,e.agreement,e,e.agreement.provider)}}async getActivityState(e){return this.activityRepo.getStateOfActivity(e)}async executeScript(e,t){try{return await this.control.exec(e.id,t)}catch(t){const r=kh(t);throw new df(`Failed to execute script. ${r}`,hf.ScriptExecutionFailed,e.agreement,e,e.agreement.provider)}}async getExecBatchResults(e,t,r,i){try{return(await this.control.getExecBatchResults(e.id,t,r,i)).map((e=>new Bh(e)))}catch(t){const r=kh(t);throw new df(`Failed to fetch activity results. ${r}`,hf.ActivityResultsFetchingFailed,e.agreement,e,e.provider,t)}}getExecBatchEvents(e,t){return this.exec.observeBatchExecResults(e.id,t)}}class Xg{constructor(){this.storage=new Map}set(e,t){return this.storage.set(e,t),t}get(e){return this.storage.get(e)}delete(e){return this.storage.delete(e)}has(e){return this.storage.has(e)}getAll(){return[...this.storage.values()]}flushAll(){return this.storage.clear()}}class Qg{constructor(e,t){this.state=e,this.agreementRepo=t,this.stateCache=new Xg}async getById(e){var t;try{const r=await this.state.getActivityAgreement(e),i=await this.agreementRepo.getById(r),n=null!==(t=this.stateCache.get(e))&&void 0!==t?t:Fh.New,o=await this.getStateOfActivity(e),s=await this.state.getActivityUsage(e);return new qh(e,i,null!=o?o:Fh.Unknown,n,s)}catch(e){const t=kh(e);throw new df(`Failed to get activity: ${t}`,hf.ActivityStatusQueryFailed,void 0,void 0,void 0,e)}}async getStateOfActivity(e){try{const t=await this.state.getActivityState(e);if(!t||null===t.state[0])return Fh.Unknown;const r=Fh[t.state[0]];return this.stateCache.set(e,r),r}catch(e){const t=kh(e);throw new df(`Failed to get activity state: ${t}`,hf.ActivityStatusQueryFailed,void 0,void 0,void 0,e)}}}class Zg{constructor(e,t){this.api=e,this.demandRepo=t}async getById(e){let t;try{t=await this.api.getAgreement(e)}catch(e){const t=kh(e);throw new Ll(`Failed to get agreement: ${t}`,Ml.CouldNotGetAgreement,e)}const{demandId:r}=t.demand,i=this.demandRepo.getById(r);if(!i)throw new o(`Could not find information for demand ${r} of agreement ${e}`);return new gh(e,t,i)}}class ev{constructor(e,t,r){this.marketService=e,this.identityService=t,this.cache=r}add(e){return this.cache.set(e.id,e),e}getById(e){return this.cache.get(e)}async getByDemandAndId(e,t){try{const r=await this.marketService.getProposalOffer(e.id,t),i=await this.identityService.getIdentity();return(i.identity===r.issuerId?"Requestor":"Provider")?new Jl(r):new Ul(r,e)}catch(e){const t=e.message;throw new Ll(`Failed to get proposal: ${t}`,Ml.CouldNotGetProposal,e)}}}class tv{constructor(e,t){this.api=e,this.cache=t}getById(e){return this.cache.get(e)}add(e){return this.cache.set(e.id,e),e}getAll(){return this.cache.getAll()}}class rv{constructor(e){this.storage=e,this.published=new Map}async publishFile(e){if(!this.storage.isReady())throw new o("The GFTP server as to be initialized before publishing a file ");if(!yd.existsSync(e)||yd.lstatSync(e).isDirectory())throw new n(`File ${e} does not exist o is a directory`);const t={fileUrl:await this.storage.publishFile(e),fileHash:await this.calculateFileHash(e)};return this.published.set(e,t),t}isServing(){return 0!==this.published.size}getPublishInfo(e){return this.published.get(e)}isFilePublished(e){return this.published.has(e)}async calculateFileHash(e){const t=yd.createReadStream(e),r=tf.sha3_224.create();return new Promise(((e,i)=>{t.on("data",(e=>r.update(e))),t.on("end",(()=>e(r.hex()))),t.on("error",(e=>i(new o(`Error calculating file hash: ${e}`,e))))}))}}class iv{constructor(e){this.yagnaApi=e}async createNetwork(e){try{const{id:t,ip:r,mask:i,gateway:n}=await this.yagnaApi.net.createNetwork(e);return new Mg(t,r,i,n)}catch(e){const t=kh(e);throw new $g(`Unable to create network. ${t}`,Bg.NetworkCreationFailed,void 0,e)}}async removeNetwork(e){try{await this.yagnaApi.net.removeNetwork(e.id)}catch(t){const r=kh(t);throw new $g(`Unable to remove network. ${r}`,Bg.NetworkRemovalFailed,e.getNetworkInfo(),t)}}async createNetworkNode(e,t,r){try{await this.yagnaApi.net.addNode(e.id,{id:t,ip:r});return new Lg(t,r,e.getNetworkInfo.bind(e),this.yagnaApi.net.httpRequest.config.BASE)}catch(t){const r=kh(t);throw new $g(`Unable to add node to network. ${r}`,Bg.NodeAddingFailed,e.getNetworkInfo(),t)}}async removeNetworkNode(e,t){try{await this.yagnaApi.net.removeNode(e.id,t.id)}catch(t){const r=kh(t);throw new $g(`Unable to remove network node. ${r}`,Bg.NodeRemovalFailed,e.getNetworkInfo(),t)}}async getIdentity(){try{return await this.yagnaApi.identity.getIdentity().then((e=>e.identity))}catch(e){const t=kh(e);throw new $g(`Unable to get requestor identity. ${t}`,Bg.GettingIdentityFailed,void 0,e)}}}function nv(e,t){return t?"function"==typeof t?(...e)=>new t(...e):()=>t:(...t)=>new e(...t)}class ov{constructor(e={}){var t,r,i,n,o,s,a,c,u,l,h,d,p,f,g;this.events=new Gl,this.hasConnection=!1,this.abortController=new AbortController,this.cleanupTasks=[],this.registeredPlugins=[];this.options={dataTransferProtocol:"ws",...e},this.logger=null!==(t=e.logger)&&void 0!==t?t:K("golem-network"),this.logger.debug("Creating Golem Network instance with options",{options:this.options});try{this.yagna=(null===(r=e.override)||void 0===r?void 0:r.yagna)||new xl({logger:this.logger,apiKey:null===(i=this.options.api)||void 0===i?void 0:i.key,basePath:null===(n=this.options.api)||void 0===n?void 0:n.url}),this.storageProvider=(null===(o=e.override)||void 0===o?void 0:o.storageProvider)||this.createStorageProvider();const t=new Xg,v=new Xg,m=new tv(this.yagna.market,t),y=new ev(this.yagna.market,this.yagna.identity,v),w=new Zg(this.yagna.market,m);this.services={logger:this.logger,yagna:this.yagna,storageProvider:this.storageProvider,demandRepository:m,proposalCache:v,proposalRepository:y,paymentApi:(null===(s=this.options.override)||void 0===s?void 0:s.paymentApi)||new Wg(this.yagna,new Yg(this.yagna.payment,this.yagna.market),new Kg(this.yagna.payment,this.yagna.market),this.logger),activityApi:(null===(a=this.options.override)||void 0===a?void 0:a.activityApi)||new Jg(this.yagna.activity.state,this.yagna.activity.control,this.yagna.activity.exec,new Qg(this.yagna.activity.state,w)),marketApi:(null===(c=this.options.override)||void 0===c?void 0:c.marketApi)||new Gg(this.yagna,w,y,m,this.logger),networkApi:(null===(u=this.options.override)||void 0===u?void 0:u.networkApi)||new iv(this.yagna),fileServer:(null===(l=this.options.override)||void 0===l?void 0:l.fileServer)||new rv(this.storageProvider)},this.network=nv(Vg,null===(h=this.options.override)||void 0===h?void 0:h.network)(this.services),this.market=nv(fh,null===(d=this.options.override)||void 0===d?void 0:d.market)({...this.services,networkModule:this.network},this.options.market),this.payment=nv(Dh,null===(p=this.options.override)||void 0===p?void 0:p.payment)(this.services,this.options.payment),this.activity=nv(Of,null===(f=this.options.override)||void 0===f?void 0:f.activity)(this.services),this.rental=nv(zg,null===(g=this.options.override)||void 0===g?void 0:g.rental)({activityModule:this.activity,paymentModule:this.payment,marketModule:this.market,networkModule:this.network,logger:this.logger,storageProvider:this.storageProvider})}catch(e){throw this.events.emit("error",e),e}}async connect(){try{await this.yagna.connect(),await this.services.paymentApi.connect(),await this.storageProvider.init(),await this.connectPlugins(),this.events.emit("connected"),this.hasConnection=!0}catch(e){throw this.events.emit("error",e),e}}async startDisconnect(){try{this.abortController.abort("Golem Network is disconnecting"),await Promise.allSettled(this.cleanupTasks.map((e=>e()))),this.cleanupTasks=[],await this.storageProvider.close().catch((e=>this.logger.warn("Closing storage provider resulted with an error, it will be ignored",e))),await this.yagna.disconnect().catch((e=>this.logger.warn("Closing connections with yagna resulted with an error, it will be ignored",e))),this.services.proposalCache.flushAll(),this.abortController=new AbortController}catch(e){throw this.logger.error("Error while disconnecting",e),e}finally{this.events.emit("disconnected"),this.hasConnection=!1}}async disconnect(){return this.disconnectPromise||(this.disconnectPromise=this.startDisconnect().finally((()=>{this.disconnectPromise=void 0}))),this.disconnectPromise}async getAllocationFromOrder({order:e,maxAgreements:t}){var r;if(!(null===(r=e.payment)||void 0===r?void 0:r.allocation)){const r=this.market.estimateBudget({order:e,maxAgreements:t}),i=15;return this.payment.createAllocation({budget:r,expirationSec:e.market.rentHours*(60+i)*60})}return"string"==typeof e.payment.allocation?this.payment.getAllocation(e.payment.allocation):e.payment.allocation}async oneOf({order:e,setup:t,teardown:r,signalOrTimeout:i,volumes:n}){this.validateSettings({order:e,volumes:n});const{signal:o,cleanup:s}=Fl(Dl(i),this.abortController.signal);let a,c,u,l;const h=async()=>{var t;s(),c&&c.unsubscribe(),u&&await u.stopAndFinalize().catch((e=>this.logger.error("Error while finalizing rental",e))),e.network&&l&&await this.network.removeNetworkNode(e.network,l).catch((e=>this.logger.error("Error while removing network node",e))),!(null===(t=e.payment)||void 0===t?void 0:t.allocation)&&a&&await this.payment.releaseAllocation(a).catch((e=>this.logger.error("Error while releasing allocation",e)))};try{const i=new Kl({logger:this.logger,validateOfferProposal:e.market.offerProposalFilter,selectOfferProposal:e.market.offerProposalSelector});a=await this.getAllocationFromOrder({order:e,maxAgreements:1}),o.throwIfAborted();const s=await this.market.buildDemandDetails(e.demand,e.market,a),d=this.market.collectDraftOfferProposals({demandSpecification:s,pricing:e.market.pricing,filter:e.market.offerProposalFilter});c=i.readFrom(d);const p=await this.market.signAgreementFromPool(i,{expirationSec:60*e.market.rentHours*60},o);return l=e.network?await this.network.createNetworkNode(e.network,p.provider.id):void 0,u=this.rental.createResourceRental(p,a,{payment:e.payment,activity:e.activity,networkNode:l,exeUnit:{setup:t,teardown:r,volumes:n}}),c.unsubscribe(),this.cleanupTasks.push(h),u}catch(e){throw this.logger.error("Error while creating rental",e),await h(),e}}async manyOf({poolSize:e,order:t,setup:r,teardown:i,volumes:n}){var o,s;this.validateSettings({order:t,volumes:n});const a=this.abortController.signal;let c,u,l;const h=async()=>{var e;l&&l.unsubscribe(),u&&await u.drainAndClear().catch((e=>this.logger.error("Error while draining resource rental pool",e))),!(null===(e=t.payment)||void 0===e?void 0:e.allocation)&&c&&await this.payment.releaseAllocation(c).catch((e=>this.logger.error("Error while releasing allocation",e)))};try{const d=new Kl({logger:this.logger,validateOfferProposal:t.market.offerProposalFilter,selectOfferProposal:t.market.offerProposalSelector}),p="number"==typeof e?e:null!==(s=null!==(o=null==e?void 0:e.max)&&void 0!==o?o:null==e?void 0:e.min)&&void 0!==s?s:1;c=await this.getAllocationFromOrder({order:t,maxAgreements:p}),a.throwIfAborted();const f=await this.market.buildDemandDetails(t.demand,t.market,c),g=this.market.collectDraftOfferProposals({demandSpecification:f,pricing:t.market.pricing,filter:t.market.offerProposalFilter});l=d.readFrom(g);const v=60*t.market.rentHours*60;return u=this.rental.createResourceRentalPool(d,c,{poolSize:e,network:t.network,resourceRentalOptions:{activity:t.activity,payment:t.payment,exeUnit:{setup:r,teardown:i,volumes:n}},agreementOptions:{expirationSec:v}}),this.cleanupTasks.push(h),u}catch(e){throw this.logger.error("Error while creating rental pool",e),await h(),e}}isConnected(){return this.hasConnection}async createNetwork(e){return await this.network.createNetwork(e)}async destroyNetwork(e){return await this.network.removeNetwork(e)}use(e,t){this.registeredPlugins.push({initializer:e,options:t})}createStorageProvider(){if("string"!=typeof this.options.dataTransferProtocol)return void 0!==this.options.dataTransferProtocol?this.options.dataTransferProtocol:new dp;switch(this.options.dataTransferProtocol){case"gftp":return new hp(this.logger);case"ws":return new sf(this.yagna,{logger:this.logger});default:throw new n(`Unsupported data transfer protocol ${this.options.dataTransferProtocol}. Supported protocols are "gftp" and "ws"`)}}async connectPlugins(){this.logger.debug("Started plugin initialization");for(const e of this.registeredPlugins){const t=await e.initializer(this,e.options);t&&this.cleanupTasks.push(t)}this.logger.debug("Finished plugin initialization")}validateSettings(e){var t,i;if(e.volumes&&void 0!==(null===(t=e.order.demand.workload)||void 0===t?void 0:t.minStorageGib)){const t=Math.max(...Object.values(e.volumes).map((e=>e.sizeGib)));if(e.order.demand.workload.minStorageGib<t)throw new r("Your minStorageGib requirement is below your expected largest volume size.")}if(e.volumes&&void 0===(null===(i=e.order.demand.workload)||void 0===i?void 0:i.minStorageGib))throw new r("You have specified volumes but did not specify a minStorageGib requirement.")}}var sv=Object.freeze({__proto__:null}),av=Object.freeze({__proto__:null,default:{}});export{qh as Activity,Of as ActivityModuleImpl,Fh as ActivityStateEnum,gh as Agreement,Ih as Allocation,ch as BasicDemandDirector,pf as Batch,Sh as DebitNote,Kg as DebitNoteRepository,$l as Demand,jl as DemandSpecification,Kl as DraftOfferProposalPool,re as EnvUtils,ya as EventReader,yf as ExeUnit,Mh as ExecutionConfig,hp as GftpStorageProvider,i as GolemAbortError,n as GolemConfigError,t as GolemError,o as GolemInternalError,Ll as GolemMarketError,c as GolemModuleError,ov as GolemNetwork,$g as GolemNetworkError,Oh as GolemPaymentError,s as GolemPlatformError,a as GolemTimeoutError,r as GolemUserError,df as GolemWorkError,Eh as Invoice,Ch as InvoiceProcessor,Yg as InvoiceRepository,_l as MIN_SUPPORTED_YAGNA,Gg as MarketApiAdapter,Ml as MarketErrorCode,zl as MarketHelpers,fh as MarketModuleImpl,Mg as Network,Bg as NetworkErrorCode,Vg as NetworkModuleImpl,Lg as NetworkNode,jg as NetworkState,dp as NullStorageProvider,Ul as OfferProposal,Hl as OfferProposalFilterFactory,Wg as PaymentApiAdapter,lh as PaymentDemandDirector,Th as PaymentErrorCode,Rh as PaymentFilters,Dh as PaymentModuleImpl,wh as RejectionReason,gf as RemoteProcess,zg as RentalModuleImpl,Ug as ResourceRental,Hg as ResourceRentalPool,Bh as Result,dh as ScanDirector,ph as ScannedOffer,mf as TcpProxy,sf as WebSocketStorageProvider,hf as WorkErrorCode,hh as WorkloadDemandDirector,xl as YagnaApi,Fl as anyAbortSignal,d as checkAndThrowUnsupportedInBrowserError,Dl as createAbortSignalFromTimeout,af as createDefaultStorageProvider,K as defaultLogger,u as isBrowser,l as isNode,h as isWebWorker,Bl as mergeUntilFirstComplete,p as nullLogger,ql as runOnNextEventLoopIteration,e as sleep,ma as waitAndCall,va as waitFor};
//# sourceMappingURL=golem-js.min.js.map
